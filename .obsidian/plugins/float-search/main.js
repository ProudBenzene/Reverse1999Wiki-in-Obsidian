/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var V=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var $=(p,l)=>{for(var t in l)V(p,t,{get:l[t],enumerable:!0})},z=(p,l,t,e)=>{if(l&&typeof l=="object"||typeof l=="function")for(let i of N(l))!U.call(p,i)&&i!==t&&V(p,i,{get:()=>l[i],enumerable:!(e=B(l,i))||e.enumerable});return p};var Z=p=>z(V({},"__esModule",{value:!0}),p);var _={};$(_,{default:()=>M});module.exports=Z(_);var h=require("obsidian");var d=require("obsidian"),C=new WeakMap;function x(p){return p.containerEl.matches(".fs-block.fs-leaf-view .workspace-leaf")}function G(p){let l=[];for(let t=0;t<p;t++)l.push((16*Math.random()|0).toString(16));return l.join("")}function J(p){let l=function(){return Object.setPrototypeOf(new d.Component,new.target.prototype)};return l.prototype=p.prototype,Object.setPrototypeOf(l,p)}var I=(p,l,t,e)=>{let i=app.workspace.activeLeaf;i||(i=t),l||(l=i==null?void 0:i.containerEl);let s=new k(i,l,p,void 0,e);return[s.attachLeaf(),s]},D,O,H,A,k=class extends J(d.HoverPopover){constructor(t,e,i,s,a){super();this.targetEl=e;this.plugin=i;this.onShowCallback=a;this.abortController=this.addChild(new d.Component);this.detaching=!1;this.opening=!1;this.rootSplit=new d.WorkspaceSplit(window.app.workspace,"vertical");this.isPinned=!0;this.oldPopover=(D=this.parent)==null?void 0:D.hoverPopover;this.document=(A=(H=(O=this.targetEl)==null?void 0:O.ownerDocument)!=null?H:window.activeDocument)!=null?A:window.document;this.id=G(8);this.hoverEl=this.document.defaultView.createDiv({cls:"fs-block fs-leaf-view",attr:{id:"fs-"+this.id}});s===void 0&&(s=300),this.onTarget=!0,this.parent=t,this.waitTime=s,this.state=d.PopoverState.Showing;let{hoverEl:n}=this;this.abortController.load(),this.show(),this.onShow(),this.setActive=this._setActive.bind(this),C.set(this.hoverEl,this),this.hoverEl.addClass("fs-block"),this.containerEl=this.hoverEl.createDiv("fs-content"),this.buildWindowControls(),this.setInitialDimensions()}static activeWindows(){let t=[window],{floatingSplit:e}=app.workspace;if(e)for(let i of e.children)i.win&&t.push(i.win);return t}static containerForDocument(t){if(t!==document&&app.workspace.floatingSplit){for(let e of app.workspace.floatingSplit.children)if(e.doc===t)return e}return app.workspace.rootSplit}static activePopovers(){return this.activeWindows().flatMap(this.popoversForWindow)}static popoversForWindow(t){var e,i;return Array.prototype.slice.call((i=(e=t==null?void 0:t.document)==null?void 0:e.body.querySelectorAll(".fs-leaf-view"))!=null?i:[]).map(s=>C.get(s)).filter(s=>s)}static forLeaf(t){let e=t&&document.body.matchParent.call(t.containerEl,".fs-leaf-view");return e?C.get(e):void 0}static iteratePopoverLeaves(t,e){for(let i of this.activePopovers())if(i.rootSplit&&t.iterateLeaves(e,i.rootSplit))return!0;return!1}_setActive(t){t.preventDefault(),t.stopPropagation(),this.plugin.app.workspace.setActiveLeaf(this.leaves()[0],{focus:!0})}getDefaultMode(){return"source"}updateLeaves(){this.onTarget&&this.targetEl&&!this.document.contains(this.targetEl)&&(this.onTarget=!1,this.transition());let t=0;this.plugin.app.workspace.iterateLeaves(e=>{t++},this.rootSplit),t===0&&this.hide(),this.hoverEl.setAttribute("data-leaf-count",t.toString())}leaves(){let t=[];return this.plugin.app.workspace.iterateLeaves(e=>{t.push(e)},this.rootSplit),t}setInitialDimensions(){this.hoverEl.style.height="auto",this.hoverEl.style.width="100%"}transition(){this.shouldShow()?this.state===d.PopoverState.Hiding&&(this.state=d.PopoverState.Shown,clearTimeout(this.timer)):this.state===d.PopoverState.Showing?this.hide():this.state===d.PopoverState.Shown&&(this.state=d.PopoverState.Hiding,this.timer=window.setTimeout(()=>{this.shouldShow()?this.transition():this.hide()},this.waitTime))}buildWindowControls(){this.titleEl=this.document.defaultView.createDiv("popover-titlebar"),this.titleEl.createDiv("popover-title"),this.containerEl.prepend(this.titleEl)}attachLeaf(){this.rootSplit.getRoot=()=>this.plugin.app.workspace[this.document===document?"rootSplit":"floatingSplit"],this.rootSplit.getContainer=()=>k.containerForDocument(this.document),this.titleEl.insertAdjacentElement("afterend",this.rootSplit.containerEl);let t=this.plugin.app.workspace.createLeafInParent(this.rootSplit,0);return this.updateLeaves(),t}onload(){super.onload(),this.registerEvent(this.plugin.app.workspace.on("layout-change",this.updateLeaves,this)),this.registerEvent(app.workspace.on("layout-change",()=>{this.rootSplit.children.forEach((t,e)=>{t instanceof d.WorkspaceTabs&&this.rootSplit.replaceChild(e,t.children[0])})}))}onShow(){var a,n;setTimeout(()=>this.waitTime=600,600),(a=this.oldPopover)==null||a.hide(),this.oldPopover=null,this.hoverEl.toggleClass("is-new",!0),this.document.body.addEventListener("click",()=>{this.hoverEl.toggleClass("is-new",!1)},{once:!0,capture:!0}),this.parent&&(this.parent.hoverPopover=this);let e=this.hoverEl.querySelector(".view-header");e==null||e.remove();let i=this.hoverEl.querySelector(".workspace-leaf");i&&this.hoverEl.appendChild(i);let s=this.hoverEl.querySelector(".inline-title");s&&s.remove(),(n=this.onShowCallback)==null||n.call(this),this.onShowCallback=void 0}detect(t){let{targetEl:e}=this;e&&(this.onTarget=t===e||e.contains(t))}shouldShow(){return this.shouldShowSelf()||this.shouldShowChild()}shouldShowChild(){return k.activePopovers().some(t=>t!==this&&t.targetEl&&this.hoverEl.contains(t.targetEl)?t.shouldShow():!1)}shouldShowSelf(){return!this.detaching&&!!(this.onTarget||this.state==d.PopoverState.Shown||this.document.querySelector(`body>.modal-container, body > #he${this.id} ~ .menu, body > #he${this.id} ~ .suggestion-container`))}show(){this.state=d.PopoverState.Shown,this.timer=0,this.targetEl.appendChild(this.hoverEl),this.onShow(),app.workspace.onLayoutChange(),this.load(),this.hoverEl.dataset.imgHeight&&this.hoverEl.dataset.imgWidth&&(this.hoverEl.style.height=parseFloat(this.hoverEl.dataset.imgHeight)+this.titleEl.offsetHeight+"px",this.hoverEl.style.width=parseFloat(this.hoverEl.dataset.imgWidth)+"px")}onHide(){var t;this.oldPopover=null,((t=this.parent)==null?void 0:t.hoverPopover)===this&&(this.parent.hoverPopover=null)}hide(){var e;if(this.onTarget=!1,this.detaching=!0,this.timer&&(clearTimeout(this.timer),this.timer=0),this.hoverEl.hide(),this.opening)return;if(this.leaves().length)this.targetEl.empty();else return this.parent=null,(e=this.abortController)==null||e.unload(),this.abortController=void 0,this.nativeHide()}nativeHide(){var i;let{hoverEl:t,targetEl:e}=this;if(this.state=d.PopoverState.Hidden,t.detach(),e){let s=e.matchParent(".fs-leaf-view");s&&((i=C.get(s))==null||i.transition())}this.onHide(),this.unload()}resolveLink(t,e){let i=(0,d.parseLinktext)(t);return i?this.plugin.app.metadataCache.getFirstLinkpathDest(i.path,e):null}async openLink(t,e,i,s){var v,w,g;let a=this.resolveLink(t,e),n=(0,d.parseLinktext)(t);if(!a&&s){let y=this.plugin.app.fileManager.getNewFileParent(e);a=await this.plugin.app.fileManager.createNewMarkdownFile(y,n.path)}if(!a)return;let{viewRegistry:o}=this.plugin.app,c=o.typeByExtension[a.extension];if(!c||!o.viewByType[c])return;i=Object.assign(this.buildEphemeralState(a,n),i);let r=this.getDefaultMode(),f=this.buildState(r,i),u=await this.openFile(a,f,s),m=(v=u==null?void 0:u.view)==null?void 0:v.getViewType();if(m==="image"){((w=this.parent)==null?void 0:w.hasOwnProperty("editorEl"))&&this.parent.editorEl.hasClass("is-live-preview")&&(this.waitTime=3e3);let y=u.view.contentEl.querySelector("img");this.hoverEl.dataset.imgHeight=String(y.naturalHeight),this.hoverEl.dataset.imgWidth=String(y.naturalWidth),this.hoverEl.dataset.imgRatio=String(y.naturalWidth/y.naturalHeight)}else m==="pdf"&&(this.hoverEl.style.height="800px",this.hoverEl.style.width="600px");((g=f.state)==null?void 0:g.mode)==="source"&&this.whenShown(()=>{var y,S,L,T;(0,d.requireApiVersion)("1.0")&&((L=(S=(y=u==null?void 0:u.view)==null?void 0:y.editMode)==null?void 0:S.reinit)==null||L.call(S)),(T=u==null?void 0:u.view)==null||T.setEphemeralState(f.eState)})}whenShown(t){if(this.detaching)return;let e=this.onShowCallback;this.onShowCallback=()=>{this.detaching||(t(),typeof e=="function"&&e())},this.state===d.PopoverState.Shown&&(this.onShowCallback(),this.onShowCallback=void 0)}async openFile(t,e,i){if(this.detaching)return;let s=i!=null?i:this.attachLeaf();this.opening=!0;try{await s.openFile(t,e)}catch(a){console.error(a)}finally{this.opening=!1,this.detaching&&this.hide()}return this.plugin.app.workspace.setActiveLeaf(s),s}buildState(t,e){return{active:!1,state:{mode:"source"},eState:e}}buildEphemeralState(t,e){let i=this.plugin.app.metadataCache.getFileCache(t),s=i?(0,d.resolveSubpath)(i,(e==null?void 0:e.subpath)||""):void 0,a={subpath:e==null?void 0:e.subpath};return s&&(a.line=s.start.line,a.startLoc=s.start,a.endLoc=s.end||void 0),a}};function E(p,l){let t=Object.keys(l).map(e=>Q(p,e,l[e]));return t.length===1?t[0]:function(){t.forEach(e=>e())}}function Q(p,l,t){let e=p[l],i=p.hasOwnProperty(l),s=t(e);return e&&Object.setPrototypeOf(s,e),Object.setPrototypeOf(a,s),p[l]=a,n;function a(...o){return s===e&&p[l]===a&&n(),s.apply(this,o)}function n(){p[l]===a&&(i?p[l]=e:delete p[l]),s!==e&&(s=e,Object.setPrototypeOf(a,e||Function))}}var F=require("obsidian"),X={searchViewState:{collapseAll:!1,explainSearch:!1,extraContext:!1,matchingCase:!1,query:"",sortOrder:"alphabetical"},showFilePath:!1},Y=[{type:"modal",icon:"square-equal"},{type:"sidebar",icon:"panel-left-inactive"},{type:"split",icon:"split-square-horizontal"},{type:"tab",icon:"panel-top"},{type:"window",icon:"app-window"}],b=async(p,l,t)=>{let e=l==="sidebar"?p.workspace.getLeftLeaf(!1):p.workspace.getLeaf(l);e==null||e.setPinned(l!=="sidebar"),await(e==null?void 0:e.setViewState({type:"search",active:!0,state:t})),setTimeout(()=>{var s;let i=(s=e==null?void 0:e.containerEl.getElementsByTagName("input"))==null?void 0:s[0];i==null||i.focus()},0)},M=class extends h.Plugin{constructor(){super(...arguments);this.patchedDomChildren=!1;this.applySettingsUpdate=(0,F.debounce)(async()=>{await this.saveSettings()},1e3);this.applyStateUpdate=(0,F.debounce)(()=>{this.state={...this.state,query:""}},3e4)}async onload(){await this.loadSettings(),this.initState(),this.registerIcons(),this.app.workspace.onLayoutReady(()=>{this.patchWorkspace(),this.patchWorkspaceLeaf(),this.patchSearchView(),this.patchVchildren()}),this.registerObsidianURIHandler(),this.registerObsidianCommands(),this.registerEditorMenuHandler(),this.registerContextMenuHandler(),this.addRibbonIcon("search","Search Obsidian In Modal",()=>this.initModal(this.state,!0,!0)),this.updateFilePathVisibility()}onunload(){var t;this.state=void 0,(t=this.modal)==null||t.close()}updateFilePathVisibility(){let{showFilePath:t}=this.settings;console.log(t),document.body.toggleClass("show-file-path",t)}changeFilePathVisibility(){this.settings.showFilePath=!this.settings.showFilePath,this.updateFilePathVisibility(),this.applySettingsUpdate()}registerIcons(){(0,h.addIcon)("panel-left-inactive",'<path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 4.999687 3 L 19.000312 3 C 20.104688 3 21 3.895312 21 4.999687 L 21 19.000312 C 21 20.104688 20.104688 21 19.000312 21 L 4.999687 21 C 3.895312 21 3 20.104688 3 19.000312 L 3 4.999687 C 3 3.895312 3.895312 3 4.999687 3 Z M 4.999687 3 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 9 13.999688 L 9 15 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 9 19.000312 L 9 21 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 9 3 L 9 4.999687 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 9 9 L 9 10.000312 " transform="matrix(4.166667,0,0,4.166667,0,0)"/>'),(0,h.addIcon)("app-window",'<path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 4.000312 4.000312 L 19.999688 4.000312 C 21.105 4.000312 22.000312 4.895625 22.000312 6 L 22.000312 18 C 22.000312 19.104375 21.105 19.999688 19.999688 19.999688 L 4.000312 19.999688 C 2.895 19.999688 1.999687 19.104375 1.999687 18 L 1.999687 6 C 1.999687 4.895625 2.895 4.000312 4.000312 4.000312 Z M 4.000312 4.000312 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 10.000312 4.000312 L 10.000312 7.999687 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 1.999687 7.999687 L 22.000312 7.999687 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 6 4.000312 L 6 7.999687 " transform="matrix(4.166667,0,0,4.166667,0,0)"/>'),(0,h.addIcon)("panel-top",'<path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 4.999687 3 L 19.000312 3 C 20.104688 3 21 3.895312 21 4.999687 L 21 19.000312 C 21 20.104688 20.104688 21 19.000312 21 L 4.999687 21 C 3.895312 21 3 20.104688 3 19.000312 L 3 4.999687 C 3 3.895312 3.895312 3 4.999687 3 Z M 4.999687 3 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 3 9 L 21 9 " transform="matrix(4.166667,0,0,4.166667,0,0)"/>'),(0,h.addIcon)("square-equal",'<path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 4.999687 3 L 19.000312 3 C 20.104688 3 21 3.895312 21 4.999687 L 21 19.000312 C 21 20.104688 20.104688 21 19.000312 21 L 4.999687 21 C 3.895312 21 3 20.104688 3 19.000312 L 3 4.999687 C 3 3.895312 3.895312 3 4.999687 3 Z M 4.999687 3 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 7.000312 10.000312 L 16.999688 10.000312 " transform="matrix(4.166667,0,0,4.166667,0,0)"/><path style="fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke:currentColor;stroke-opacity:1;stroke-miterlimit:4;" d="M 7.000312 13.999688 L 16.999688 13.999688 " transform="matrix(4.166667,0,0,4.166667,0,0)"/>')}initState(){this.state=this.settings.searchViewState}initModal(t,e=!1,i=!1){this.modal=new P(s=>{this.state=s,e&&this.applyStateUpdate(),this.settings.searchViewState=s,this.applySettingsUpdate()},this,{...t,query:i?"":t.query}),this.modal.open()}patchWorkspace(){let t=!1,e=this,i=E(h.Workspace.prototype,{getLeaf:s=>function(...a){let n=this.activeLeaf;if(n){let o=n.parent.containerEl.parentElement;if(o!=null&&o.hasClass("fs-content")){if(n.view.getViewType()==="markdown")return n;let c=e.app.workspace.getMostRecentLeaf();c&&this.setActiveLeaf(c)}return s.call(this,...a)}return s.call(this,...a)},changeLayout(s){return async function(a){t=!0;try{await s.call(this,a)}finally{t=!1}}},iterateLeaves(s){return function(a,n){if(s.call(this,a,n))return!0;let o=typeof a=="function"?a:n,c=typeof a=="function"?n:a;if(!c||t)return!1;if(c===e.app.workspace.rootSplit||h.WorkspaceContainer&&c instanceof h.WorkspaceContainer){for(let r of k.popoversForWindow(c.win))if(s.call(this,o,r.rootSplit))return!1}return!1}},setActiveLeaf(s){return function(a,n){return x(a)&&(s.call(this,a,n),a.activeTime=17e11),s.call(this,a,n)}},onDragLeaf(s){return function(a,n){return s.call(this,a,n)}},pushUndoHistory(s){return function(a,n,...o){if(a.getViewState().type!=="search")return s.call(this,a,n,...o)}}});this.register(i)}patchWorkspaceLeaf(){this.register(E(h.WorkspaceLeaf.prototype,{getRoot(t){return function(){let e=t.call(this);return(e==null?void 0:e.getRoot)===this.getRoot?e:e==null?void 0:e.getRoot()}},setPinned(t){return function(e){t.call(this,e),x(this)&&!e&&this.setPinned(!0)}},openFile(t){return function(e,i){if(x(this)){setTimeout(E(h.Workspace.prototype,{recordMostRecentOpenedFile(n){return function(o){if(o!==e)return n.call(this,o)}}}),1);let a=this.app.plugins.plugins["recent-files-obsidian"];a&&setTimeout(E(a,{shouldAddFile(n){return function(o){return o!==e&&n.call(this,o)}}}),1)}let s=t.call(this,e,i);return setTimeout(()=>{let a=this.parent.containerEl.parentElement;if(!(a!=null&&a.classList.contains("fs-content"))||e.extension!="canvas")return;let n=this.view.canvas;setTimeout(()=>{var o,c;if(n&&((o=i==null?void 0:i.eState)==null?void 0:o.match)){let r=(c=n.data.nodes)==null?void 0:c.find(f=>f.text===i.eState.match.content);r=n.nodes.get(r.id),n.selectOnly(r),n.zoomToSelection()}},20)},1),s}}}))}patchSearchView(){let t=a=>{this.state=a,this.settings.searchViewState=a,this.applySettingsUpdate()},e=a=>{var c;let n=document.querySelector(".float-search-modal")!==null,o=a.getRoot();return(o==null?void 0:o.side)&&((o==null?void 0:o.side)==="left"||(o==null?void 0:o.side)==="right")?"sidebar":((c=a.getContainer())==null?void 0:c.type)==="window"?"window":n?"modal":"split"},i=(a,n,o)=>{a.dom.toggleClass("float-search-view-menu",!0);let c=Y.filter(r=>n==="split"?r.type!=="tab":r.type!==n);for(let r of c)a.addItem(f=>{f.setTitle(`${r.type} view`).setIcon(`${r.icon}`).onClick(async()=>{r.type==="modal"?(o==null||o.detach(),setTimeout(()=>{this.initModal(this.state,!0,!1)},10)):r.type==="sidebar"?await b(this.app,r.type,this.state):n==="window"?(o==null||o.detach(),setTimeout(async()=>{await b(this.app,r.type,this.state)},10)):await b(this.app,r.type,this.state),n==="modal"?this.modal.close():o==null||o.detach()})});return a},s=()=>{var c,r;let a=(c=this.app.workspace.getLeavesOfType("search")[0])==null?void 0:c.view,n=this;if(!a)return!1;let o=a.constructor;return this.register(E(o.prototype,{onOpen(f){return function(){f.call(this),this.scope.register(["Mod"],"w",()=>{var w;(w=this.leaf)==null||w.detach()});let u=createDiv({cls:"float-search-view-switch"}),m=this.filterSectionToggleEl,v=new h.ExtraButtonComponent(u);v.setIcon("layout-template").setTooltip("Switch to File View"),v.onClick(()=>{let w=e(this.leaf),g=i(new h.Menu,w,this.leaf),y=u.getBoundingClientRect();g.showAtPosition({x:y.x,y:y.y+30})}),m.parentElement.insertBefore(u,m),this.hidePathToggle||(this.hidePathToggle=new h.Setting(this.searchParamsContainerEl).setName("Show file path").addToggle(w=>{w.toggleEl.toggleClass("mod-small",!0),w.setValue(n.settings.showFilePath).onChange(async g=>{n.settings.showFilePath=!g,n.changeFilePathVisibility(),n.applySettingsUpdate()})}))}},setState(f){return async function(u,m){f.call(this,u,m),n.app.workspace.layoutReady&&t({...u,query:this.searchComponent.getValue()})}}})),(r=a.leaf)==null||r.rebuildView(),!0};this.app.workspace.onLayoutReady(()=>{if(!s()){let a=this.app.workspace.on("layout-change",()=>{s()&&this.app.workspace.offref(a)});this.registerEvent(a)}})}patchVchildren(){let t=()=>{var a;let e=(a=this.app.workspace.getLeavesOfType("search")[0])==null?void 0:a.view;if(!e)return!1;let i=e.dom.constructor,s=this;return this.register(E(i.prototype,{stopLoader(n){return function(){var o,c;n.call(this),(c=(o=this==null?void 0:this.vChildren)==null?void 0:o.children)==null||c.forEach(r=>{var f;if((r==null?void 0:r.file)&&!(r!=null&&r.pathEl)){let u=((f=r==null?void 0:r.file.parent)==null?void 0:f.path)||"/",m=createDiv({cls:"search-result-file-path"}),v=m.createDiv({cls:"search-result-file-path-icon"});(0,h.setIcon)(v,"folder");let w=m.createDiv({cls:"search-result-file-path-text",text:u});r.pathEl=m,r.containerEl.find(".search-result-file-title").prepend(m)}})}}})),!0};this.app.workspace.onLayoutReady(()=>{if(!t()){let e=this.app.workspace.on("layout-change",()=>{t()&&this.app.workspace.offref(e)});this.registerEvent(e)}})}registerObsidianURIHandler(){this.registerObsidianProtocolHandler("fs",t=>this.initModal({...this.state,query:t.query,current:!1},!0,!1))}createCommand(t){this.addCommand({id:t.id,name:t.name,checkCallback:e=>{let i=this.app.workspace.activeLeaf;if(!i)return;let s=i.view.getViewType();if(s==="markdown"||s==="canvas"){if(!e){let a=i.view.file,n=t.queryBuilder(a);this.initModal({...this.state,query:n,current:!0},!0,!1)}return!0}}})}registerObsidianCommands(){this.addCommand({id:"show-or-hide-file-path",name:"Show/hide file path",callback:()=>{this.changeFilePathVisibility()}}),this.addCommand({id:"search-obsidian-globally",name:"Search obsidian globally",callback:()=>this.initModal({...this.state,query:"",current:!1},!1,!0)}),this.addCommand({id:"search-obsidian-globally-state",name:"Search Obsidian Globally (With Last State)",callback:()=>this.initModal({...this.state,query:this.state.query,current:!1},!0,!1)}),this.createCommand({id:"search-in-backlink",name:"Search in backlink Of current file",queryBuilder:t=>" /\\[\\["+(t.extension==="canvas"?t.name:t.basename)+"(\\|[^\\]]*)?\\]\\]/"}),this.createCommand({id:"search-in-current-file",name:"Search in current file",queryBuilder:t=>` path:"${t.path}"`});for(let t of["split","tab","window"])this.addCommand({id:`open-search-view-${t}`,name:`Open search view (${t})`,callback:async()=>{let e=this.app.workspace.getLeavesOfType("search");switch(t){case"window":let i=e.find(a=>a.parentSplit.parent.type==="window");if(i){this.app.workspace.revealLeaf(i);return}await b(this.app,t);break;case"tab":case"split":let s=e.find(a=>!a.parentSplit.parent.side);if(s){this.app.workspace.revealLeaf(s),s.setViewState({type:"search",active:!0,state:this.state});return}await b(this.app,t);break}}})}registerEditorMenuHandler(){this.registerEvent(this.app.workspace.on("editor-menu",(t,e)=>{if(!e||e.getSelection().length===0)return;let i=e.getSelection().trim(),s=i;i.length>8?s=i.substring(0,3)+"..."+i.substring(i.length-3,i.length):s=i,t.addItem(a=>{a.setTitle('Search "'+s+'" in Float Search').setIcon("search").onClick(()=>this.initModal({...this.state,query:i,current:!1},!0,!1))})}))}registerContextMenuHandler(){this.registerEvent(this.app.workspace.on("file-menu",(t,e,i,s)=>{let a=s?k.forLeaf(s):void 0;e instanceof h.TFile&&!a&&!s&&t.addItem(n=>{var o,c;(c=(o=n.setIcon("popup-open").setTitle("Open in Float Preview").onClick(async()=>{if(this.modal){await this.modal.initFileView(e,void 0);return}this.initModal({...this.state,current:!1},!0,!0),setTimeout(async()=>{await this.modal.initFileView(e,void 0)},20)})).setSection)==null||c.call(o,"open")})}))}async loadSettings(){this.settings=Object.assign({},X,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},P=class extends h.Modal{constructor(t,e,i,s="search"){super(e.app);this.plugin=e,this.cb=t,this.state=i,this.viewType=s}async onOpen(){let{contentEl:t,containerEl:e,modalEl:i}=this;this.searchCtnEl=t.createDiv({cls:"float-search-modal-search-ctn"}),this.instructionsEl=i.createDiv({cls:"float-search-modal-instructions"}),this.initInstructions(this.instructionsEl),this.initCss(t,i,e),await this.initSearchView(this.searchCtnEl),this.initInput(),this.initContent()}onClose(){var e,i;let{contentEl:t}=this;this.cb(this.searchLeaf.view.getState()),this.searchLeaf.detach(),(e=this.fileLeaf)==null||e.detach(),this.searchEmbeddedView.unload(),(i=this.fileEmbeddedView)==null||i.unload(),t.empty()}initInstructions(t){let e=t.createDiv({cls:"float-search-modal-instructions-navigate"}),i=t.createDiv({cls:"float-search-modal-instructions-collapse"}),s=t.createDiv({cls:"float-search-modal-instructions-enter"}),a=t.createDiv({cls:"float-search-modal-instructions-alt-enter"}),n=t.createDiv({cls:"float-search-modal-instructions-tab"}),o=t.createDiv({cls:"float-search-modal-instructions-switch"}),c=e.createSpan({cls:"float-search-modal-instructions-key"}),r=e.createSpan({cls:"float-search-modal-instructions-text"});c.setText("\u2191\u2193"),r.setText("Navigate");let f=i.createSpan({cls:"float-search-modal-instructions-key"}),u=i.createSpan({cls:"float-search-modal-instructions-text"});f.setText("Shift+\u2191\u2193"),u.setText("Collapse/Expand");let m=s.createSpan({cls:"float-search-modal-instructions-key"}),v=s.createSpan({cls:"float-search-modal-instructions-text"});m.setText("\u21B5"),v.setText("Open in background");let w=a.createSpan({cls:"float-search-modal-instructions-key"}),g=a.createSpan({cls:"float-search-modal-instructions-text"});w.setText("Alt+\u21B5"),g.setText("Open File and Close");let y=a.createSpan({cls:"float-search-modal-instructions-key"}),S=a.createSpan({cls:"float-search-modal-instructions-text"});w.setText("Ctrl+\u21B5"),g.setText("Create File When Not Exist");let L=n.createSpan({cls:"float-search-modal-instructions-key"}),T=n.createSpan({cls:"float-search-modal-instructions-text"});L.setText("Tab/Shift+Tab"),T.setText("Preview/Close Preview");let q=o.createSpan({cls:"float-search-modal-instructions-key"}),R=o.createSpan({cls:"float-search-modal-instructions-text"});q.setText("Ctrl+G"),R.setText("Switch Between Search and File View");let W=t.createDiv({cls:"float-search-modal-instructions-click"}),j=W.createSpan({cls:"float-search-modal-instructions-key"}),K=W.createSpan({cls:"float-search-modal-instructions-text"});j.setText("Alt+Click"),K.setText("Close Modal While In File View")}initCss(t,e,i){t.classList.add("float-search-modal-content"),e.classList.add("float-search-modal"),i.classList.add("float-search-modal-container")}async initSearchView(t){let[e,i]=I(this.plugin,t);this.searchLeaf=e,this.searchEmbeddedView=i,this.searchLeaf.setPinned(!0),await this.searchLeaf.setViewState({type:"search"}),setTimeout(async()=>{var s,a,n;await this.searchLeaf.view.setState(this.state,{history:!1}),(s=this.state)!=null&&s.current?this.searchLeaf.view.searchComponent.inputEl.setSelectionRange(0,0):this.searchLeaf.view.searchComponent.inputEl.setSelectionRange(0,(n=(a=this.state)==null?void 0:a.query)==null?void 0:n.length)},0)}initInput(){let t=this.contentEl.getElementsByTagName("input")[0];t.focus(),t.onkeydown=e=>{var s,a;let i=this.searchLeaf.view;switch(e.key){case"ArrowDown":if(e.shiftKey){i.onKeyShowMoreAfter(e),i.dom.focusedItem&&(i.dom.focusedItem.collapsible&&i.dom.focusedItem.setCollapse(!1),this.focusdItem=i.dom.focusedItem);break}else{i.onKeyArrowDownInFocus(e),this.focusdItem=i.dom.focusedItem;break}case"ArrowUp":if(e.shiftKey){i.onKeyShowMoreBefore(e),i.dom.focusedItem&&(i.dom.focusedItem.collapseEl&&i.dom.focusedItem.setCollapse(!0),this.focusdItem=i.dom.focusedItem);break}else{i.onKeyArrowUpInFocus(e),this.focusdItem=i.dom.focusedItem,i.dom.focusedItem.content||(this.focusdItem=void 0);break}case"ArrowLeft":i.onKeyArrowLeftInFocus(e);break;case"ArrowRight":i.onKeyArrowRightInFocus(e);break;case"Enter":if(h.Keymap.isModifier(e,"Mod")&&h.Keymap.isModifier(e,"Shift")&&!this.focusdItem){e.preventDefault();let o=t.value.trim().replace(/[/\\?%*:|"<>]/g,"-");this.plugin.app.workspace.openLinkText(o,"",!0),this.close();break}i.onKeyEnterInFocus(e),e.altKey&&i.dom.focusedItem&&this.close();break;case"Tab":if(e.preventDefault(),e.shiftKey&&this.fileLeaf){(s=this.fileLeaf)==null||s.detach(),this.fileLeaf=void 0,(a=this.fileEmbeddedView)==null||a.unload(),this.modalEl.toggleClass("float-search-width",!1),this.fileEl.detach();break}if(i.dom.focusedItem){let n=i.dom.focusedItem,o=n.parent.file instanceof h.TFile?n.parent.file:n.file;n.parent.file instanceof h.TFile?this.initFileView(o,{match:{content:n.content,matches:n.matches}}):this.initFileView(o,void 0)}break;case"e":if(e.ctrlKey&&(e.preventDefault(),this.fileLeaf)){let n=this.fileLeaf.getViewState();n.state.mode=n.state.mode==="preview"?"source":"preview",this.fileLeaf.setViewState(n,{focus:!0}),setTimeout(()=>{this.searchLeaf.view.searchComponent.inputEl.focus()},0)}break;case"g":this.fileLeaf&&e.ctrlKey&&(e.preventDefault(),this.plugin.app.workspace.setActiveLeaf(this.fileLeaf,{focus:!0}));break;case"C":if(e.ctrlKey&&e.shiftKey){e.preventDefault();let n=i.dom.focusedItem.el.innerText;navigator.clipboard.writeText(n)}break}}}initContent(){let{contentEl:t}=this;t.onclick=e=>{if(t.getElementsByClassName("search-results-children")[0].children.length<2)return;let s=e.target;if(e.altKey||!this.fileLeaf){for(;s&&!(s.classList.contains("tree-item-icon")||s.classList.contains("search-result-hover-button"));){if(s.classList.contains("tree-item")){this.close();break}s=s.parentElement}return}if(this.fileLeaf){let a=this.searchLeaf.view;if(this.searchCtnEl.contains(s)){for(;s&&!s.classList.contains("tree-item");)s=s.parentElement;if(!s)return;let o=(s==null?void 0:s.getElementsByClassName("tree-item-inner")[0]).innerText,c=this.plugin.app.metadataCache.getFirstLinkpathDest(o,"");if(c){let r=a.dom.resultDomLookup.get(c);a.dom.setFocusedItem(r),this.initFileView(c,void 0),this.searchLeaf.view.searchComponent.inputEl.focus()}}return}}}async initFileView(t,e){var n,o,c;if(this.fileLeaf){await this.fileLeaf.openFile(t,{active:!1,eState:e}),((o=(n=this.fileState)==null?void 0:n.match)==null?void 0:o.matches[0])===((c=e==null?void 0:e.match)==null?void 0:c.matches[0])&&e&&this.fileState?setTimeout(()=>{this.fileLeaf&&this.plugin.app.workspace.setActiveLeaf(this.fileLeaf,{focus:!0})},0):(this.fileState=e,setTimeout(()=>{this.searchLeaf.view.searchComponent.inputEl.focus()},0));return}let{contentEl:i}=this;if(this.fileEl=i.createDiv({cls:"float-search-modal-file-ctn"}),this.modalEl.toggleClass("float-search-width",!0),this.fileEl.onkeydown=r=>{r.ctrlKey&&r.key==="g"&&(r.preventDefault(),r.stopPropagation(),this.searchLeaf.view.searchComponent.inputEl.focus()),r.key==="Tab"&&r.ctrlKey&&(r.preventDefault(),r.stopPropagation(),this.searchLeaf.view.searchComponent.inputEl.focus())},!this.fileEl)return;let[s,a]=I(this.plugin,this.fileEl);this.fileLeaf=s,this.fileEmbeddedView=a,this.fileLeaf.setPinned(!0),await this.fileLeaf.openFile(t,{active:!1,eState:e}),this.fileState=e,this.searchLeaf.view.searchComponent.inputEl.focus()}};
