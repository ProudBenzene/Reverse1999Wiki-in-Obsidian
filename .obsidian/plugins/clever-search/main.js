/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Hc=Object.create;var Yn=Object.defineProperty;var el=Object.getOwnPropertyDescriptor;var qc=Object.getOwnPropertyNames;var Gc=Object.getPrototypeOf,Xc=Object.prototype.hasOwnProperty;var Yc=(n,e)=>()=>(n&&(e=n(n=0)),e);var re=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),tl=(n,e)=>{for(var t in e)Yn(n,t,{get:e[t],enumerable:!0})},nl=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qc(e))!Xc.call(n,i)&&i!==t&&Yn(n,i,{get:()=>e[i],enumerable:!(r=el(e,i))||r.enumerable});return n};var ue=(n,e,t)=>(t=n!=null?Hc(Gc(n)):{},nl(e||!n||!n.__esModule?Yn(t,"default",{value:n,enumerable:!0}):t,n)),Xr=n=>nl(Yn({},"__esModule",{value:!0}),n),R=(n,e,t,r)=>{for(var i=r>1?void 0:r?el(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Yn(e,t,i),i},Yr=(n,e)=>(t,r)=>e(t,r,n);var Jr={};tl(Jr,{__assign:()=>bs,__asyncDelegator:()=>cf,__asyncGenerator:()=>uf,__asyncValues:()=>ff,__await:()=>Jn,__awaiter:()=>nf,__classPrivateFieldGet:()=>mf,__classPrivateFieldSet:()=>gf,__createBinding:()=>sf,__decorate:()=>Zc,__exportStar:()=>of,__extends:()=>Jc,__generator:()=>rf,__importDefault:()=>pf,__importStar:()=>hf,__makeTemplateObject:()=>df,__metadata:()=>tf,__param:()=>ef,__read:()=>il,__rest:()=>Qc,__spread:()=>af,__spreadArrays:()=>lf,__values:()=>ws});function Jc(n,e){_s(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Qc(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Zc(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function ef(n,e){return function(t,r){e(t,r,n)}}function tf(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function nf(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,e||[])).next())})}function rf(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function sf(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}function of(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function ws(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function il(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function af(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(il(arguments[e]));return n}function lf(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Jn(n){return this instanceof Jn?(this.v=n,this):new Jn(n)}function uf(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(d){return new Promise(function(m,p){s.push([f,d,m,p])>1||a(f,d)})})}function a(f,d){try{l(r[f](d))}catch(m){h(s[0][3],m)}}function l(f){f.value instanceof Jn?Promise.resolve(f.value.v).then(u,c):h(s[0][2],f)}function u(f){a("next",f)}function c(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function cf(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Jn(n[i](o)),done:i==="return"}:s?s(o):o}:s}}function ff(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof ws=="function"?ws(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}function df(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function hf(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function pf(n){return n&&n.__esModule?n:{default:n}}function mf(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function gf(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}var _s,bs,Qr=Yc(()=>{_s=function(n,e){return _s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},_s(n,e)};bs=function(){return bs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},bs.apply(this,arguments)}});var Ss=re(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});var xs;(function(n){n[n.Transient=0]="Transient",n[n.Singleton=1]="Singleton",n[n.ResolutionScoped=2]="ResolutionScoped",n[n.ContainerScoped=3]="ContainerScoped"})(xs||(xs={}));Es.default=xs});var sl=re(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});var yf=Ss();Object.defineProperty(Ts,"Lifecycle",{enumerable:!0,get:function(){return yf.default}})});var Yt=re(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.defineInjectionTokenMetadata=rt.getParamInfo=rt.INJECTION_TOKEN_METADATA_KEY=void 0;rt.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function vf(n){let e=Reflect.getMetadata("design:paramtypes",n)||[],t=Reflect.getOwnMetadata(rt.INJECTION_TOKEN_METADATA_KEY,n)||{};return Object.keys(t).forEach(r=>{e[+r]=t[r]}),e}rt.getParamInfo=vf;function _f(n,e){return function(t,r,i){let s=Reflect.getOwnMetadata(rt.INJECTION_TOKEN_METADATA_KEY,t)||{};s[i]=e?{token:n,transform:e.transformToken,transformArgs:e.args||[]}:n,Reflect.defineMetadata(rt.INJECTION_TOKEN_METADATA_KEY,s,t)}}rt.defineInjectionTokenMetadata=_f});var As=re(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.isClassProvider=void 0;function bf(n){return!!n.useClass}Zr.isClassProvider=bf});var Cs=re(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.isFactoryProvider=void 0;function wf(n){return!!n.useFactory}ei.isFactoryProvider=wf});var ni=re(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.delay=xn.DelayedConstructor=void 0;var ti=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},r=!1,i,s=()=>(r||(i=e(this.wrap()),r=!0),i);return new Proxy(t,this.createHandler(s))}createHandler(e){let t={},r=i=>{t[i]=(...s)=>{s[0]=e();let o=Reflect[i];return o(...s)}};return this.reflectMethods.forEach(r),t}};xn.DelayedConstructor=ti;function xf(n){if(typeof n=="undefined")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new ti(n)}xn.delay=xf});var ri=re(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.isConstructorToken=ft.isTransformDescriptor=ft.isTokenDescriptor=ft.isNormalToken=void 0;var Ef=ni();function Sf(n){return typeof n=="string"||typeof n=="symbol"}ft.isNormalToken=Sf;function Tf(n){return typeof n=="object"&&"token"in n&&"multiple"in n}ft.isTokenDescriptor=Tf;function Af(n){return typeof n=="object"&&"token"in n&&"transform"in n}ft.isTransformDescriptor=Af;function Cf(n){return typeof n=="function"||n instanceof Ef.DelayedConstructor}ft.isConstructorToken=Cf});var Fs=re(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.isTokenProvider=void 0;function Ff(n){return!!n.useToken}ii.isTokenProvider=Ff});var Ps=re(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.isValueProvider=void 0;function Pf(n){return n.useValue!=null}si.isValueProvider=Pf});var Is=re(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});var If=As();Object.defineProperty(Jt,"isClassProvider",{enumerable:!0,get:function(){return If.isClassProvider}});var kf=Cs();Object.defineProperty(Jt,"isFactoryProvider",{enumerable:!0,get:function(){return kf.isFactoryProvider}});var Mf=ri();Object.defineProperty(Jt,"isNormalToken",{enumerable:!0,get:function(){return Mf.isNormalToken}});var Df=Fs();Object.defineProperty(Jt,"isTokenProvider",{enumerable:!0,get:function(){return Df.isTokenProvider}});var Of=Ps();Object.defineProperty(Jt,"isValueProvider",{enumerable:!0,get:function(){return Of.isValueProvider}})});var ol=re(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.isProvider=void 0;var Lf=As(),Rf=Ps(),Nf=Fs(),jf=Cs();function Bf(n){return Lf.isClassProvider(n)||Rf.isValueProvider(n)||Nf.isTokenProvider(n)||jf.isFactoryProvider(n)}oi.isProvider=Bf});var Ds=re(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});var ks=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};Ms.default=ks});var al=re(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});var zf=Ds(),Os=class extends zf.default{};Ls.default=Os});var ll=re(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});var Rs=class{constructor(){this.scopedResolutions=new Map}};Ns.default=Rs});var js=re(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.formatErrorCtor=void 0;function Vf(n,e){return n===null?`at position #${e}`:`"${n.split(",")[e].trim()}" at position #${e}`}function Kf(n,e,t="    "){return[n,...e.message.split(`
`).map(r=>t+r)].join(`
`)}function Uf(n,e,t){let[,r=null]=n.toString().match(/constructor\(([\w, ]+)\)/)||[],i=Vf(r,e);return Kf(`Cannot inject the dependency ${i} of "${n.name}" constructor. Reason:`,t)}ai.formatErrorCtor=Uf});var ul=re(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.isDisposable=void 0;function $f(n){return!(typeof n.dispose!="function"||n.dispose.length>0)}li.isDisposable=$f});var fl=re(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.PostResolutionInterceptors=Qt.PreResolutionInterceptors=void 0;var cl=Ds(),ui=class extends cl.default{};Qt.PreResolutionInterceptors=ui;var ci=class extends cl.default{};Qt.PostResolutionInterceptors=ci;var Bs=class{constructor(){this.preResolution=new ui,this.postResolution=new ci}};Qt.default=Bs});var Zt=re(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.instance=yt.typeInfo=void 0;var Wf=(Qr(),Xr(Jr)),Re=Is(),Hf=ol(),fi=ri(),qf=al(),Be=Ss(),dl=ll(),Gf=js(),Xf=ni(),Yf=ul(),Jf=fl();yt.typeInfo=new Map;var Qn=class{constructor(e){this.parent=e,this._registry=new qf.default,this.interceptors=new Jf.default,this.disposed=!1,this.disposables=new Set}register(e,t,r={lifecycle:Be.default.Transient}){this.ensureNotDisposed();let i;if(Hf.isProvider(t)?i=t:i={useClass:t},Re.isTokenProvider(i)){let s=[e],o=i;for(;o!=null;){let a=o.useToken;if(s.includes(a))throw new Error(`Token registration cycle detected! ${[...s,a].join(" -> ")}`);s.push(a);let l=this._registry.get(a);l&&Re.isTokenProvider(l.provider)?o=l.provider:o=null}}if((r.lifecycle===Be.default.Singleton||r.lifecycle==Be.default.ContainerScoped||r.lifecycle==Be.default.ResolutionScoped)&&(Re.isValueProvider(i)||Re.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${Be.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,t){return this.ensureNotDisposed(),Re.isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),Re.isNormalToken(e)){if(Re.isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:Be.default.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Be.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return t&&!Re.isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:Be.default.Singleton})}resolve(e,t=new dl.default){this.ensureNotDisposed();let r=this.getRegistration(e);if(!r&&Re.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"Single"),r){let i=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(fi.isConstructorToken(e)){let i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,t);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,t,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,t,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Be.default.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let r=e.options.lifecycle===Be.default.Singleton,i=e.options.lifecycle===Be.default.ContainerScoped,s=r||i,o;return Re.isValueProvider(e.provider)?o=e.provider.useValue:Re.isTokenProvider(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Re.isClassProvider(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Re.isFactoryProvider(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===Be.default.ResolutionScoped&&t.scopedResolutions.set(e,o),o}resolveAll(e,t=new dl.default){this.ensureNotDisposed();let r=this.getAllRegistrations(e);if(!r&&Re.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"All"),r){let s=r.map(o=>this.resolveRegistration(o,t));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(r=>!Re.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new Qn(this);for(let[t,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===Be.default.ContainerScoped)&&e._registry.setAll(t,r.map(i=>i.options.lifecycle===Be.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,t,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:r})}afterResolution(e,t,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:r})}dispose(){return Wf.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let r=t.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof Xf.DelayedConstructor)return e.createProxy(i=>this.resolve(i,t));let r=(()=>{let i=yt.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(t,e));return new e(...s)})();return Yf.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,t){return(r,i)=>{try{return fi.isTokenDescriptor(r)?fi.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):fi.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(Gf.formatErrorCtor(t,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};yt.instance=new Qn;yt.default=yt.instance});var hl=re(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});var Qf=Yt(),vt=Zt(),zs=ri(),Zf=js();function ed(){return function(n){let e=Qf.getParamInfo(n);return class extends n{constructor(...t){super(...t.concat(e.slice(t.length).map((r,i)=>{try{return zs.isTokenDescriptor(r)?zs.isTransformDescriptor(r)?r.multiple?vt.instance.resolve(r.transform).transform(vt.instance.resolveAll(r.token),...r.transformArgs):vt.instance.resolve(r.transform).transform(vt.instance.resolve(r.token),...r.transformArgs):r.multiple?vt.instance.resolveAll(r.token):vt.instance.resolve(r.token):zs.isTransformDescriptor(r)?vt.instance.resolve(r.transform).transform(vt.instance.resolve(r.token),...r.transformArgs):vt.instance.resolve(r)}catch(s){let o=i+t.length;throw new Error(Zf.formatErrorCtor(n,o,s))}})))}}}}Vs.default=ed});var pl=re(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});var td=Yt();function nd(n){return td.defineInjectionTokenMetadata(n)}Ks.default=nd});var di=re(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});var rd=Yt(),id=Zt();function sd(){return function(n){id.typeInfo.set(n,rd.getParamInfo(n))}}Us.default=sd});var ml=re($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});var od=(Qr(),Xr(Jr)),ad=Zt();function ld(n=[]){return function(e){return n.forEach(t=>{var{token:r,options:i}=t,s=od.__rest(t,["token","options"]);return ad.instance.register(r,s,i)}),e}}$s.default=ld});var gl=re(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});var ud=di(),cd=Zt();function fd(){return function(n){ud.default()(n),cd.instance.registerSingleton(n)}}Ws.default=fd});var yl=re(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});var dd=Yt();function hd(n){let e={token:n,multiple:!0};return dd.defineInjectionTokenMetadata(e)}Hs.default=hd});var vl=re(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});var pd=Yt();function md(n,e,...t){let r={token:n,multiple:!0,transform:e,transformArgs:t};return pd.defineInjectionTokenMetadata(r)}qs.default=md});var _l=re(Gs=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});var gd=Yt();function yd(n,e,...t){return gd.defineInjectionTokenMetadata(n,{transformToken:e,args:t})}Gs.default=yd});var bl=re(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});var vd=di(),_d=Zt();function bd(n,e){return function(t){vd.default()(t),_d.instance.register(e||t,t,{lifecycle:n})}}Xs.default=bd});var wl=re(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});var wd=hl();Object.defineProperty(it,"autoInjectable",{enumerable:!0,get:function(){return wd.default}});var xd=pl();Object.defineProperty(it,"inject",{enumerable:!0,get:function(){return xd.default}});var Ed=di();Object.defineProperty(it,"injectable",{enumerable:!0,get:function(){return Ed.default}});var Sd=ml();Object.defineProperty(it,"registry",{enumerable:!0,get:function(){return Sd.default}});var Td=gl();Object.defineProperty(it,"singleton",{enumerable:!0,get:function(){return Td.default}});var Ad=yl();Object.defineProperty(it,"injectAll",{enumerable:!0,get:function(){return Ad.default}});var Cd=vl();Object.defineProperty(it,"injectAllWithTransform",{enumerable:!0,get:function(){return Cd.default}});var Fd=_l();Object.defineProperty(it,"injectWithTransform",{enumerable:!0,get:function(){return Fd.default}});var Pd=bl();Object.defineProperty(it,"scoped",{enumerable:!0,get:function(){return Pd.default}})});var xl=re(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});function Id(n){let e;return t=>(e==null&&(e=n(t)),e)}Ys.default=Id});var El=re(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});function kd(n){let e=new WeakMap;return t=>{let r=e.get(t);return r==null&&(r=n(t),e.set(t,r)),r}}Js.default=kd});var Sl=re(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});function Md(n,e,t,r=!0){let i,s;return o=>{let a=n(o);return(!r||s!==a)&&((s=a)?i=o.resolve(e):i=o.resolve(t)),i}}Qs.default=Md});var Tl=re(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});var Dd=xl();Object.defineProperty(Zn,"instanceCachingFactory",{enumerable:!0,get:function(){return Dd.default}});var Od=El();Object.defineProperty(Zn,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return Od.default}});var Ld=Sl();Object.defineProperty(Zn,"predicateAwareClassFactory",{enumerable:!0,get:function(){return Ld.default}})});var de=re(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});var Zs=(Qr(),Xr(Jr));if(typeof Reflect=="undefined"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var Rd=sl();Object.defineProperty(Mt,"Lifecycle",{enumerable:!0,get:function(){return Rd.Lifecycle}});Zs.__exportStar(wl(),Mt);Zs.__exportStar(Tl(),Mt);Zs.__exportStar(Is(),Mt);var Nd=ni();Object.defineProperty(Mt,"delay",{enumerable:!0,get:function(){return Nd.delay}});var jd=Zt();Object.defineProperty(Mt,"container",{enumerable:!0,get:function(){return jd.instance}})});var Nm={};tl(Nm,{RenderMarkdownModal:()=>ds,default:()=>Gn});module.exports=Xr(Nm);var Ye=require("obsidian");var rl;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect=="undefined"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,u={create:o?function(){return vs(Object.create(null))}:a?function(){return vs({__proto__:null})}:function(){return vs({})},has:l?function(v,E){return t.call(v,E)}:function(v,E){return E in v},get:l?function(v,E){return t.call(v,E)?v[E]:void 0}:function(v,E){return v[E]}},c=Object.getPrototypeOf(Function),h=typeof process=="object"&&process["env"]&&process["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!h&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:It(),d=!h&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:wn(),m=!h&&typeof WeakMap=="function"?WeakMap:Xt(),p=new m;function g(v,E,F,k){if(ne(F)){if(!Hr(v))throw new TypeError;if(!qr(E))throw new TypeError;return j(v,E)}else{if(!Hr(v))throw new TypeError;if(!q(E))throw new TypeError;if(!q(k)&&!ne(k)&&!$(k))throw new TypeError;return $(k)&&(k=void 0),F=xe(F),M(v,E,F,k)}}e("decorate",g);function y(v,E){function F(k,V){if(!q(k))throw new TypeError;if(!ne(V)&&!gs(V))throw new TypeError;te(v,E,k,V)}return F}e("metadata",y);function _(v,E,F,k){if(!q(F))throw new TypeError;return ne(k)||(k=xe(k)),te(v,E,F,k)}e("defineMetadata",_);function x(v,E,F){if(!q(E))throw new TypeError;return ne(F)||(F=xe(F)),D(v,E,F)}e("hasMetadata",x);function w(v,E,F){if(!q(E))throw new TypeError;return ne(F)||(F=xe(F)),z(v,E,F)}e("hasOwnMetadata",w);function S(v,E,F){if(!q(E))throw new TypeError;return ne(F)||(F=xe(F)),H(v,E,F)}e("getMetadata",S);function T(v,E,F){if(!q(E))throw new TypeError;return ne(F)||(F=xe(F)),Y(v,E,F)}e("getOwnMetadata",T);function C(v,E){if(!q(v))throw new TypeError;return ne(E)||(E=xe(E)),ie(v,E)}e("getMetadataKeys",C);function P(v,E){if(!q(v))throw new TypeError;return ne(E)||(E=xe(E)),me(v,E)}e("getOwnMetadataKeys",P);function I(v,E,F){if(!q(E))throw new TypeError;ne(F)||(F=xe(F));var k=O(E,F,!1);if(ne(k)||!k.delete(v))return!1;if(k.size>0)return!0;var V=p.get(E);return V.delete(F),V.size>0||p.delete(E),!0}e("deleteMetadata",I);function j(v,E){for(var F=v.length-1;F>=0;--F){var k=v[F],V=k(E);if(!ne(V)&&!$(V)){if(!qr(V))throw new TypeError;E=V}}return E}function M(v,E,F,k){for(var V=v.length-1;V>=0;--V){var Se=v[V],X=Se(E,F,k);if(!ne(X)&&!$(X)){if(!q(X))throw new TypeError;k=X}}return k}function O(v,E,F){var k=p.get(v);if(ne(k)){if(!F)return;k=new f,p.set(v,k)}var V=k.get(E);if(ne(V)){if(!F)return;V=new f,k.set(E,V)}return V}function D(v,E,F){var k=z(v,E,F);if(k)return!0;var V=gt(E);return $(V)?!1:D(v,V,F)}function z(v,E,F){var k=O(E,F,!1);return ne(k)?!1:B(k.has(v))}function H(v,E,F){var k=z(v,E,F);if(k)return Y(v,E,F);var V=gt(E);if(!$(V))return H(v,V,F)}function Y(v,E,F){var k=O(E,F,!1);if(!ne(k))return k.get(v)}function te(v,E,F,k){var V=O(F,k,!0);V.set(v,E)}function ie(v,E){var F=me(v,E),k=gt(v);if(k===null)return F;var V=ie(k,E);if(V.length<=0)return F;if(F.length<=0)return V;for(var Se=new d,X=[],Q=0,U=F;Q<U.length;Q++){var se=U[Q],oe=Se.has(se);oe||(Se.add(se),X.push(se))}for(var kt=0,Za=V;kt<Za.length;kt++){var se=Za[kt],oe=Se.has(se);oe||(Se.add(se),X.push(se))}return X}function me(v,E){var F=[],k=O(v,E,!1);if(ne(k))return F;for(var V=k.keys(),Se=nt(V),X=0;;){var Q=Gr(Se);if(!Q)return F.length=X,F;var U=ys(Q);try{F[X]=U}catch(se){try{Pt(Se)}finally{throw se}}X++}}function ct(v){if(v===null)return 1;switch(typeof v){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return v===null?1:6;default:return 6}}function ne(v){return v===void 0}function $(v){return v===null}function Z(v){return typeof v=="symbol"}function q(v){return typeof v=="object"?v!==null:typeof v=="function"}function Ce(v,E){switch(ct(v)){case 0:return v;case 1:return v;case 2:return v;case 3:return v;case 4:return v;case 5:return v}var F=E===3?"string":E===5?"number":"default",k=bn(v,i);if(k!==void 0){var V=k.call(v,F);if(q(V))throw new TypeError;return V}return Le(v,F==="default"?"number":F)}function Le(v,E){if(E==="string"){var F=v.toString;if(Ft(F)){var k=F.call(v);if(!q(k))return k}var V=v.valueOf;if(Ft(V)){var k=V.call(v);if(!q(k))return k}}else{var V=v.valueOf;if(Ft(V)){var k=V.call(v);if(!q(k))return k}var Se=v.toString;if(Ft(Se)){var k=Se.call(v);if(!q(k))return k}}throw new TypeError}function B(v){return!!v}function ee(v){return""+v}function xe(v){var E=Ce(v,3);return Z(E)?E:ee(E)}function Hr(v){return Array.isArray?Array.isArray(v):v instanceof Object?v instanceof Array:Object.prototype.toString.call(v)==="[object Array]"}function Ft(v){return typeof v=="function"}function qr(v){return typeof v=="function"}function gs(v){switch(ct(v)){case 3:return!0;case 4:return!0;default:return!1}}function bn(v,E){var F=v[E];if(F!=null){if(!Ft(F))throw new TypeError;return F}}function nt(v){var E=bn(v,s);if(!Ft(E))throw new TypeError;var F=E.call(v);if(!q(F))throw new TypeError;return F}function ys(v){return v.value}function Gr(v){var E=v.next();return E.done?!1:E}function Pt(v){var E=v.return;E&&E.call(v)}function gt(v){var E=Object.getPrototypeOf(v);if(typeof v!="function"||v===c||E!==c)return E;var F=v.prototype,k=F&&Object.getPrototypeOf(F);if(k==null||k===Object.prototype)return E;var V=k.constructor;return typeof V!="function"||V===v?E:V}function It(){var v={},E=[],F=function(){function X(Q,U,se){this._index=0,this._keys=Q,this._values=U,this._selector=se}return X.prototype["@@iterator"]=function(){return this},X.prototype[s]=function(){return this},X.prototype.next=function(){var Q=this._index;if(Q>=0&&Q<this._keys.length){var U=this._selector(this._keys[Q],this._values[Q]);return Q+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:U,done:!1}}return{value:void 0,done:!0}},X.prototype.throw=function(Q){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),Q},X.prototype.return=function(Q){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:Q,done:!0}},X}();return function(){function X(){this._keys=[],this._values=[],this._cacheKey=v,this._cacheIndex=-2}return Object.defineProperty(X.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),X.prototype.has=function(Q){return this._find(Q,!1)>=0},X.prototype.get=function(Q){var U=this._find(Q,!1);return U>=0?this._values[U]:void 0},X.prototype.set=function(Q,U){var se=this._find(Q,!0);return this._values[se]=U,this},X.prototype.delete=function(Q){var U=this._find(Q,!1);if(U>=0){for(var se=this._keys.length,oe=U+1;oe<se;oe++)this._keys[oe-1]=this._keys[oe],this._values[oe-1]=this._values[oe];return this._keys.length--,this._values.length--,Q===this._cacheKey&&(this._cacheKey=v,this._cacheIndex=-2),!0}return!1},X.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=v,this._cacheIndex=-2},X.prototype.keys=function(){return new F(this._keys,this._values,k)},X.prototype.values=function(){return new F(this._keys,this._values,V)},X.prototype.entries=function(){return new F(this._keys,this._values,Se)},X.prototype["@@iterator"]=function(){return this.entries()},X.prototype[s]=function(){return this.entries()},X.prototype._find=function(Q,U){return this._cacheKey!==Q&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Q)),this._cacheIndex<0&&U&&(this._cacheIndex=this._keys.length,this._keys.push(Q),this._values.push(void 0)),this._cacheIndex},X}();function k(X,Q){return X}function V(X,Q){return Q}function Se(X,Q){return[X,Q]}}function wn(){return function(){function v(){this._map=new f}return Object.defineProperty(v.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),v.prototype.has=function(E){return this._map.has(E)},v.prototype.add=function(E){return this._map.set(E,E),this},v.prototype.delete=function(E){return this._map.delete(E)},v.prototype.clear=function(){this._map.clear()},v.prototype.keys=function(){return this._map.keys()},v.prototype.values=function(){return this._map.values()},v.prototype.entries=function(){return this._map.entries()},v.prototype["@@iterator"]=function(){return this.keys()},v.prototype[s]=function(){return this.keys()},v}()}function Xt(){var v=16,E=u.create(),F=k();return function(){function U(){this._key=k()}return U.prototype.has=function(se){var oe=V(se,!1);return oe!==void 0?u.has(oe,this._key):!1},U.prototype.get=function(se){var oe=V(se,!1);return oe!==void 0?u.get(oe,this._key):void 0},U.prototype.set=function(se,oe){var kt=V(se,!0);return kt[this._key]=oe,this},U.prototype.delete=function(se){var oe=V(se,!1);return oe!==void 0?delete oe[this._key]:!1},U.prototype.clear=function(){this._key=k()},U}();function k(){var U;do U="@@WeakMap@@"+Q();while(u.has(E,U));return E[U]=!0,U}function V(U,se){if(!t.call(U,F)){if(!se)return;Object.defineProperty(U,F,{value:u.create()})}return U[F]}function Se(U,se){for(var oe=0;oe<se;++oe)U[oe]=Math.random()*255|0;return U}function X(U){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(U)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(U)):Se(new Uint8Array(U),U):Se(new Array(U),U)}function Q(){var U=X(v);U[6]=U[6]&79|64,U[8]=U[8]&191|128;for(var se="",oe=0;oe<v;++oe){var kt=U[oe];(oe===4||oe===6||oe===8)&&(se+="-"),kt<16&&(se+="0"),se+=kt.toString(16).toLowerCase()}return se}}function vs(v){return v.__=void 0,delete v.__,v}})})(rl||(rl={}));var ms=ue(de());var We="CleverSearch",eo='"\u25B6"',to='"\u25BC"';var no="&nbsp;&nbsp;&nbsp;&nbsp;";var $d={},Fe,Al=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Al.decode();var hi=null;function gi(){return(hi===null||hi.buffer!==Fe.memory.buffer)&&(hi=new Uint8Array(Fe.memory.buffer)),hi}function ro(n,e){return Al.decode(gi().subarray(n,n+e))}var _t=new Array(32).fill(void 0);_t.push(void 0,null,!0,!1);var nr=_t.length;function er(n){nr===_t.length&&_t.push(_t.length+1);let e=nr;return nr=_t[e],_t[e]=n,e}function yi(n){return _t[n]}function Bd(n){n<36||(_t[n]=nr,nr=n)}function tr(n){let e=yi(n);return Bd(n),e}function io(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=io(n[0]));for(let o=1;o<i;o++)s+=", "+io(n[o]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch(i){return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}var _i=0,vi=new TextEncoder("utf-8"),zd=typeof vi.encodeInto=="function"?function(n,e){return vi.encodeInto(n,e)}:function(n,e){let t=vi.encode(n);return e.set(t),{read:n.length,written:t.length}};function Cl(n,e,t){if(t===void 0){let a=vi.encode(n),l=e(a.length);return gi().subarray(l,l+a.length).set(a),_i=a.length,l}let r=n.length,i=e(r),s=gi(),o=0;for(;o<r;o++){let a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3);let a=gi().subarray(i+o,i+r),l=zd(n,a);o+=l.written}return _i=o,i}var pi=null;function bi(){return(pi===null||pi.buffer!==Fe.memory.buffer)&&(pi=new Int32Array(Fe.memory.buffer)),pi}var mi=null;function Vd(){return(mi===null||mi.buffer!==Fe.memory.buffer)&&(mi=new Uint32Array(Fe.memory.buffer)),mi}function Kd(n,e){let r=Vd().subarray(n/4,n/4+e),i=[];for(let s=0;s<r.length;s++)i.push(tr(r[s]));return i}function so(n,e){try{let a=Fe.__wbindgen_add_to_stack_pointer(-16);var t=Cl(n,Fe.__wbindgen_malloc,Fe.__wbindgen_realloc),r=_i;Fe.cut_for_search(a,t,r,e);var i=bi()[a/4+0],s=bi()[a/4+1],o=Kd(i,s).slice();return Fe.__wbindgen_free(i,s*4),o}finally{Fe.__wbindgen_add_to_stack_pointer(16)}}async function Ud(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}async function Fl(n){typeof n=="undefined"&&(n=new URL("jieba_rs_wasm_bg.wasm",$d.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var o=ro(i,s);return er(o)},e.wbg.__wbindgen_object_drop_ref=function(i){tr(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return er(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return er(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,o){yi(i)[tr(s)]=tr(o)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=yi(i);return er(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var o=new Error(ro(i,s));return er(o)},e.wbg.__wbindgen_debug_string=function(i,s){var o=io(yi(s)),a=Cl(o,Fe.__wbindgen_malloc,Fe.__wbindgen_realloc),l=_i;bi()[i/4+1]=l,bi()[i/4+0]=a},e.wbg.__wbindgen_throw=function(i,s){throw new Error(ro(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw tr(i)},(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await Ud(await n,e);return Fe=t.exports,Fl.__wbindgen_wasm_module=r,Fe}var Pl=Fl;var rr=(r=>(r.other="Other Language",r.en="English",r.zh="\u7B80\u4F53\u4E2D\u6587",r))(rr||{});var Il=ue(de());var ir={traceLog:!1,loadIndexFromDatabase:!0};var oo=class{constructor(){this.logLevel="debug";this.levelWeights={trace:1,debug:2,info:3,warn:4,error:5,none:6}}getLevel(){return this.logLevel}setLevel(e){this.logLevel=e}trace(...e){this.shouldLog("trace")&&(ir.traceLog?(console.groupCollapsed(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.log(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;",...e))}debug(...e){this.shouldLog("debug")&&(ir.traceLog?(console.groupCollapsed(`%c[debug] ${this.getCallerName()}
`,"color: #379237;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.debug(`%c[debug] ${this.getCallerName()}
`,"color: #379237",...e))}info(...e){this.shouldLog("info")&&console.info(`%c[info] ${this.getCallerName()}
`,"color: blue;",...e)}warn(...e){this.shouldLog("warn")&&console.warn(`%c[warn] ${this.getCallerName()}
`,"color: orange;",...e)}error(...e){this.shouldLog("error")&&console.error(`%c[error] ${this.getCallerName()}
`,"color: red;",...e)}getCallerName(){var i;let e=(i=new Error().stack)==null?void 0:i.split(`
`),t=e==null?void 0:e.slice(3).find(s=>!s.includes("eval")&&!s.includes("Array.map"));if(t!=null&&t.startsWith("    at blob:"))return"child-thread";let r=t==null?void 0:t.match(/at (\S+)/);return r?`<${r[1]}> `:"failed to parse caller"}shouldLog(e){return this.levelWeights[e]>=this.levelWeights[this.logLevel]}},A=new oo;var En=!1,Sn="This branch hasn't been implemented",wi="this branch shouldn't be reached by design",dt=class{static extractDomainFromHttpsUrl(e){if(e.startsWith("http://"))return A.error("Only support https, current url starts with http"),"";let t=/^(https?:\/\/)?([\w.-]+)(?:\/|$)/,r=e.match(t);return r&&r[2]?r[2]:""}static append(e,t){for(let r of t)e.push(r);return e}static mergeDeep(e,...t){if(!t.length)return e;let r=t.shift();if(ao(e)&&ao(r))for(let i in r)ao(r[i])?(e[i]||Object.assign(e,{[i]:{}}),dt.mergeDeep(e[i],r[i])):Object.assign(e,{[i]:r[i]});return dt.mergeDeep(e,...t)}static getCurrLanguage(){let e=window.localStorage.getItem("language")||"en";return e in rr?rr[e]:"Other Language"}static sleep(e){return new Promise(t=>setTimeout(t,e))}};async function kl(n,...e){let t=Date.now();await n(...e);let r=Date.now(),i=Ml(r-t);A.debug(`<${n.name.replace(/^bound /,"")}> Execution time: ${i}`)}function Pe(n,e,t){let r=t.value;return t.value=function(...i){let s=Date.now(),o=r.apply(this,i),a=()=>{let l=Date.now();A.trace(`<${n.constructor.name}-${e}> Execution time: ${Ml(l-s)}`)};return o instanceof Promise?o.then(l=>(a(),l)):(a(),o)},t}function Ml(n){if(n<1e3)return`${n} ms`;if(n<6e4){let e=Math.floor(n/1e3),t=n%1e3;return`${e} s ${t} ms`}else{let e=Math.floor(n/6e4),t=Math.floor(n%6e4/1e3),r=n%1e3;return`${e} min ${t} s ${r} ms`}}function b(n){try{return Il.container.resolve(n)}catch(e){let t=`CleverSearch for developer:
There might be wrong usages for tsyringe:
1. Inject an instance for static field
2. Cycle dependencies without delay
3. Unknown error`;return A.warn(t),A.error(e),alert(t),-1}}function ao(n){return n&&typeof n=="object"&&!Array.isArray(n)}var ae=class{},Dl=window.localStorage.getItem("language")==="zh",Ol={customExtensions:{plaintext:["md"]},followObsidianExcludedFiles:!0,excludedPaths:[],logLevel:En?"trace":"info",enableStopWordsEn:!0,enableChinesePatch:!!Dl,enableStopWordsZh:!!Dl,apiProvider1:{domain:"",key:""},apiProvider2:{domain:"",key:""},ui:{openInNewPane:!0,maxItemResults:30,floatingWindowForInFile:!0,showedExtension:"except md",collapseDevSettingByDefault:!1,inFileFloatingWindowTop:"2.7em",inFileFloatingWindowLeft:"2.5em"},semantic:{isEnabled:!1,serverType:"local"}},Ll={search:{fuzzyProportion:.2,minTermLengthForPrefixSearch:2,weightFilename:3,weightFolder:2,weightTagText:1.15,weightHeading:1.27}};var Kl=require("obsidian");var Tn=require("obsidian");var ye=class extends Tn.Notice{constructor(e,t=0){super(e+`
(clever-search)`,t)}},xi=class extends Tn.AbstractInputSuggest{constructor(t,r,i){super(b(Tn.App),t);this.inputEl=t;this.onSelectCb=i;this.content=r}getSuggestions(t){return[...this.content].filter(r=>r.toLowerCase().contains(t.toLowerCase()))}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t,r){this.onSelectCb(t),this.inputEl.value="",this.close()}},lo=class{},kg=new lo;var zl=require("obsidian");var Wd=ue(require("fs")),Hd=ue(require("path")),Rl=ue(de());var An=Wd,Ee=Hd,ce=class{static getBasename(e){return Ee.basename(e,Ee.extname(e))}static getExtension(e){return Ee.extname(e).slice(1)}static getFolderPath(e){let t=Ee.dirname(e);return t==="."||t===Ee.sep||t==="/"?"./":t.replace(new RegExp("\\"+Ee.sep,"g"),"/")+"/"}static countFileByExtensions(e){let t=new Map;e.forEach(i=>{let s=i.extension||"no_extension";t.set(s,(t.get(s)||0)+1)});let r=Object.fromEntries(t);return A.trace(r),r}};ce.SPLIT_EOL=`
`,ce.JOIN_EOL=`
`,ce=R([(0,Rl.singleton)()],ce);var Nl=require("electron"),qd=(Nl.app||Nl.remote.app).getPath("userData"),Gd=Ee.join(qd,"clever-search"),uo=Ee.join(Gd,"stop-words-en.txt"),co={"Reindexing...":"Reindexing...","Indexing finished":"Indexing finished","files need to be indexed. Obsidian may freeze for a while":"files need to be indexed. Obsidian may freeze for a while","Omnisearch isn't installed":"Omnisearch isn't installed","Omnisearch is installed but not enabled":"Omnisearch is installed but not enabled","Database has been updated, a reindex is required":"Database has been updated, a reindex is required","Semantic init time":"The local model indexes at a speed of approximately 100-500 words per second. During this time, please do not close Obsidian.","Semantic init finished":"Semantic engine is ready","Downloading aiHelper":"Downloading clever-search-ai-helper.zip (972 MB)...","Download success":"Successfully downloaded","Download failure":"Failed to download clever-search-ai-helper.zip  ","Download manually":"Download manually","Max items count":"Max items count","Max items count desc":"Due to renderer's limited capabilities, this plugin can find thousands of results, but cannot display them all at once","Floating window for in-file search":"Floating window for in-file search","Floating window for in-file search desc":"Execute 'in-file search' command again will close the existing floating window. Disable this option to use classic modal UI","English word blacklist":"English word blacklist","English word blacklist desc":`Exclude some meaningless English words like "do", "and", "them" from indexing, enhancing search and indexing speed. Modify the file at ${uo} to tailor the list to your needs.`,"Chinese patch":"Chinese patch","Chinese patch desc":"Better search result for Chinese","Chinese word blacklist":"Chinese word blacklist","Chinese word blacklist desc":`Activates only if the Chinese Patch is enabled. This excludes some meaningless Chinese words like "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" listed in 'stop-words-zh.txt', improving search efficiency and speed. More details are listed in "English word blacklist" option`,Advanced:"Advanced","Advanced.desc":"The previous settings cover most needs. For further customization, adjust the following options","Semantic search":"Semantic search",Introduction:"Introduction","Introduction.desc":"Semantic search is only supported on the Windows system. It is only recommended for small and medium-sized vault. If a vault has more than 8 million words, the initial indexing may take dozens of hours. You need to extract the .cache folder from the downloaded archive and place it in C:\\Users\\<current user>. Then, run clever-search-ai-helper.exe to start the semantic engine. Semantic search is intended to complement lexical search and is not as effective in exact matching as lexical search.",Enable:"Enable","Server type":"Server type","Server type.desc":"For local server, Clever Search AI Helper needs to run in the background. For remote server, it will not be implemented in the short term.",local:"local",Utilities:"Utilities","Test connection":"Test connection",Download:"Download","Additional Information":"Additional Information","Additional Information.desc":"When semantic search is turned on and ai-helper is running, Reindex will be applied to both lexical and semantic engine; each time this plugin is loaded, the semantic engine will automatically perform an incremental index, and subsequent file modifications will not update the index to avoid blocking semantic search.","Excluded files":"Excluded files",Manage:"Manage","Follow Obsidian Excluded Files":"Follow Obsidian Excluded Files","Enter path...":"Enter path...",Add:"Add","Customize extensions":"Customize extensions","extensionModal.desc":"Customize the file extensions you would like to index. By default, file types not natively supported by Obsidian, such as 'txt', will be opened with an external program. To open these files within Obsidian, you may need to install plugins like 'obsidian-custom-file-extension-plugin' or 'obsidian-vscode-editor'.","extensionModal.plaintextName":"Plaintext","extensionModal.plaintextDesc":"Extensions should be separated by a space or a newline character. Please do not include binary filetypes like 'pdf', 'jpg', 'mp4', etc, that can't be opened with notepad. Including them might cause indexing issues. Additionally, the indexing and searching of HTML files may be slower because they require conversion to clean Markdown format first. Furthermore, due to the extremely limited API, it seems impossible to automatically scroll to specific locations within HTML files.","For Development":"For Development","Collapse development setting by default":"Collapse development setting by default","Reindex the vault":"Reindex the vault",Reindex:"Reindex","Log level":"Log level","Reset floating window position":"Reset floating window position","Reset floating window position desc":"In case the window is moved outside the visible area","Reset position":"Reset position","Support the Project":"Support the Project","Support the Project desc":"Enjoying this plugin? Show your support with a star on GitHub!","Visit GitHub":"Visit GitHub"};var jl={"Reindexing...":"\u91CD\u5EFA\u7D22\u5F15\u4E2D...","Indexing finished":"\u7D22\u5F15\u5B8C\u6210","files need to be indexed. Obsidian may freeze for a while":"\u6587\u4EF6\u9700\u8981\u88AB\u7D22\u5F15, Obsidian \u53EF\u80FD\u4F1A\u5361\u987F\u4E00\u4F1A\u513F","Omnisearch isn't installed":"\u672A\u5B89\u88C5 Omnisearch","Omnisearch is installed but not enabled":"\u5B89\u88C5\u4E86 Omnisearch \u4F46\u662F\u6CA1\u6709\u542F\u7528","Database has been updated, a reindex is required":"\u6570\u636E\u5E93\u5DF2\u66F4\u65B0\uFF0C\u9700\u8981\u91CD\u5EFA\u7D22\u5F15","Semantic init time":"\u672C\u5730\u6A21\u578B\u7D22\u5F15\u901F\u5EA6\u5927\u7EA6\u662F 200-800 \u5B57\u6BCF\u79D2\uFF0C\u5728\u6B64\u671F\u95F4\u8BF7\u4E0D\u8981\u5173\u95ED Obsidian","Semantic init finished":"\u8BED\u4E49\u5F15\u64CE\u5DF2\u5C31\u7EEA","Downloading aiHelper":"\u6B63\u5728\u4E0B\u8F7D clever-search-ai-helper.zip (972 MB)...","Download success":"\u4E0B\u8F7D\u6210\u529F","Download failure":"clever-search-ai-helper.zip \u4E0B\u8F7D\u5931\u8D25  ","Download manually":"\u70B9\u6B64\u624B\u52A8\u4E0B\u8F7D","Max items count":"\u6700\u5927\u5019\u9009\u9879\u6570","Max items count desc":"\u867D\u7136\u672C\u63D2\u4EF6\u53EF\u4EE5\u641C\u7D22\u5230\u6210\u5343\u4E0A\u4E07\u4E2A\u7ED3\u679C\uFF0C\u4F46\u7531\u4E8E\u5E95\u5C42\u6E32\u67D3\u5668\u6027\u80FD\u9650\u5236\uFF0C\u4E0D\u80FD\u5373\u65F6\u6E32\u67D3\u6240\u6709\u7ED3\u679C","Floating window for in-file search":"\u6587\u4EF6\u5185\u641C\u7D22\u4F7F\u7528\u60AC\u6D6E\u7A97\u53E3 UI","Floating window for in-file search desc":"\u518D\u6B21\u6267\u884C '\u6587\u4EF6\u5185\u641C\u7D22' \u547D\u4EE4\u4F1A\u5173\u95ED\u5DF2\u6709\u7684\u60AC\u6D6E\u7A97\u53E3\u3002\u5173\u95ED\u8FD9\u4E2A\u9009\u9879\u5C06\u4F7F\u7528\u6A21\u6001\u6846 UI","English word blacklist":"\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355","English word blacklist desc":`\u5EFA\u7ACB\u7D22\u5F15\u65F6\uFF0C\u5FFD\u7565\u4E00\u4E9B\u542B\u4E49\u6A21\u7CCA\u7684\u5355\u8BCD\uFF0C\u6BD4\u5982 "do", "and", "them", \u53EF\u4EE5\u52A0\u5FEB\u7D22\u5F15\u548C\u641C\u7D22\u901F\u5EA6\uFF0C\u4F46\u662F\u8FD9\u4E9B\u5355\u8BCD\u4E0D\u4F1A\u88AB\u641C\u7D22\u5230. \u53EF\u4EE5\u5728 ${uo} \u6309\u9700\u4FEE\u6539\u5355\u8BCD\u9ED1\u540D\u5355`,"Chinese patch":"\u4E2D\u6587\u641C\u7D22\u4F18\u5316","Chinese patch desc":"\u66F4\u597D\u7684\u4E2D\u6587\u641C\u7D22\u7ED3\u679C","Chinese word blacklist":"\u4E2D\u6587\u8BCD\u8BED\u9ED1\u540D\u5355","Chinese word blacklist desc":'\u53EA\u5728\u5F00\u542F\u4E2D\u6587\u641C\u7D22\u4F18\u5316\u65F6\u751F\u6548\u3002\u5FFD\u7565 "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" \u7B49\u8BCD\u8BED\uFF0C\u8BE6\u7EC6\u5217\u8868\u5728 "stop-words-zh.txt"\u3002\u8BE6\u89C1 "\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355" \u9009\u9879',Advanced:"\u8FDB\u9636\u8BBE\u7F6E","Advanced.desc":"\u4E4B\u524D\u7684\u8BBE\u7F6E\u901A\u5E38\u80FD\u6EE1\u8DB3\u5927\u591A\u6570\u4F7F\u7528\u573A\u666F\uFF0C\u5982\u679C\u4F60\u60F3\u6709\u66F4\u4E2A\u6027\u5316\u7684\u8BBE\u7F6E\uFF0C\u53EF\u4EE5\u8C03\u6574\u4E0B\u9762\u7684\u9009\u9879","Semantic search":"\u8BED\u4E49\u641C\u7D22",Introduction:"\u4ECB\u7ECD","Introduction.desc":"\u8BED\u4E49\u641C\u7D22\u53EA\u652F\u6301 Windows \u7CFB\u7EDF\u3002\u4EC5\u63A8\u8350\u4E2D\u5C0F\u578B\u8D44\u6599\u5E93\u4F7F\u7528, \u5982\u679C\u67D0\u4E2A\u4ED3\u5E93\u6709\u8D85\u8FC71500\u4E07\u5B57, \u521D\u6B21\u7D22\u5F15\u53EF\u80FD\u9700\u8981\u51E0\u5341\u4E2A\u5C0F\u65F6\u3002\u5C06\u4E0B\u8F7D\u7684\u538B\u7F29\u5305\u89E3\u538B\u51FA\u7684 .cache \u6587\u4EF6\u5939\u653E\u5728 C:\\Users\\<current user>, \u7136\u540E\u8FD0\u884C clever-search-ai-helper.exe \u6765\u542F\u52A8\u8BED\u4E49\u5F15\u64CE\u3002\u8BED\u4E49\u641C\u7D22\u65E8\u5728\u4F5C\u4E3A\u8BCD\u6C47\u641C\u7D22\u7684\u8865\u5145\uFF0C\u5728\u7CBE\u786E\u5339\u914D\u4E0A\u6548\u679C\u662F\u4E0D\u5982\u8BCD\u6C47\u641C\u7D22\u7684",Enable:"\u542F\u7528","Server type":"\u670D\u52A1\u5668\u7C7B\u578B","Server type.desc":"\u5BF9\u4E8E\u672C\u5730\u670D\u52A1\u5668\uFF0Cclever-search-ai-helper.exe \u9700\u8981\u5728\u540E\u53F0\u8FD0\u884C; \u8FDC\u7A0B\u670D\u52A1\u5668\u77ED\u671F\u5185\u4E0D\u4F1A\u5B9E\u73B0",local:"\u672C\u5730",Utilities:"\u5B9E\u7528\u529F\u80FD","Test connection":"\u6D4B\u8BD5\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Additional Information":"\u8865\u5145\u4FE1\u606F","Additional Information.desc":"\u5728\u5F00\u542F\u8BED\u4E49\u641C\u7D22\u5E76\u8FD0\u884C ai-helper \u7684\u60C5\u51B5\u4E0B\uFF0C\u91CD\u65B0\u7D22\u5F15 \u4F1A\u540C\u65F6\u5E94\u7528\u4E8E\u8BCD\u6C47\u5F15\u64CE\u548C\u8BED\u4E49\u5F15\u64CE\uFF1B\u6BCF\u6B21\u52A0\u8F7D\u63D2\u4EF6\u7684\u65F6\u5019\uFF0C\u8BED\u4E49\u5F15\u64CE\u4F1A\u81EA\u52A8\u8FDB\u884C\u4E00\u6B21\u589E\u91CF\u7D22\u5F15\uFF0C\u4E4B\u540E\u4FEE\u6539\u6587\u4EF6\u4E0D\u4F1A\u66F4\u65B0\u7D22\u5F15\u4EE5\u907F\u514D\u963B\u585E\u8BED\u4E49\u641C\u7D22\u3002","Excluded files":"\u5FFD\u7565\u6587\u4EF6",Manage:"\u7BA1\u7406","Follow Obsidian Excluded Files":"\u8DDF\u968F Obsidian \u5FFD\u7565\u6587\u4EF6\u8BBE\u7F6E","Enter path...":"\u8BF7\u8F93\u5165\u8DEF\u5F84...",Add:"\u6DFB\u52A0","Customize extensions":"\u81EA\u5B9A\u4E49\u540E\u7F00\u540D","extensionModal.desc":"\u81EA\u5B9A\u4E49\u5E0C\u671B\u7D22\u5F15\u7684\u6587\u4EF6\u540E\u7F00\u540D\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B Obsidian \u4E0D\u539F\u751F\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B\uFF0C\u5982 'txt'\uFF0C\u5C06\u901A\u8FC7\u5916\u90E8\u7A0B\u5E8F\u6253\u5F00\u3002\u8981\u5728 Obsidian \u5185\u6253\u5F00\u8FD9\u4E9B\u6587\u4EF6\uFF0C\u53EF\u80FD\u9700\u8981\u5B89\u88C5\u63D2\u4EF6\uFF0C\u5982 'obsidian-custom-file-extension-plugin' \u6216 'obsidian-vscode-editor'\u3002","extensionModal.plaintextName":"\u7EAF\u6587\u672C","extensionModal.plaintextDesc":"\u540E\u7F00\u540D\u4F7F\u7528\u7A7A\u683C\u6216\u6362\u884C\u7B26\u5206\u9694\u3002\u8BF7\u4E0D\u8981\u5728\u6B64\u5904\u5305\u542B 'pdf'\u3001'jpg'\u3001'mp4' \u7B49\u65E0\u6CD5\u7528\u8BB0\u4E8B\u672C\u6253\u5F00\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u7D22\u5F15\u95EE\u9898\u3002\u53E6\u5916\uFF0C\u7D22\u5F15\u548C\u641C\u7D22 HTML \u6587\u4EF6\u53EF\u80FD\u4F1A\u66F4\u6162\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u9996\u5148\u9700\u8981\u8F6C\u6362\u4E3A\u5E72\u51C0\u7684 Markdown \u683C\u5F0F\u3002\u6B64\u5916\uFF0C\u53D7 API \u9650\u5236, \u81EA\u52A8\u6EDA\u52A8\u5230 HTML \u6587\u4EF6\u4E2D\u7684\u7279\u5B9A\u4F4D\u7F6E\u4F3C\u4E4E\u4E0D\u53EF\u884C\u3002","For Development":"\u5F00\u53D1\u8BBE\u7F6E","Collapse development setting by default":"\u9ED8\u8BA4\u6298\u53E0\u5F00\u53D1\u8BBE\u7F6E","Reindex the vault":"\u91CD\u65B0\u7D22\u5F15\u5168\u5E93",Reindex:"\u91CD\u65B0\u7D22\u5F15","Log level":"\u65E5\u5FD7\u7B49\u7EA7","Reset floating window position":"\u91CD\u7F6E\u60AC\u6D6E\u7A97\u53E3\u4F4D\u7F6E","Reset floating window position desc":"\u5982\u679C\u7A97\u53E3\u88AB\u62D6\u5230\u770B\u4E0D\u89C1\u7684\u4F4D\u7F6E, \u53EF\u4EE5\u70B9\u6B64\u6309\u94AE\u91CD\u7F6E","Reset position":"\u91CD\u7F6E\u4F4D\u7F6E","Support the Project":"\u652F\u6301\u8FD9\u4E2A\u9879\u76EE","Support the Project desc":"\u5982\u679C\u89C9\u5F97\u672C\u63D2\u4EF6\u5BF9\u4F60\u6709\u5E2E\u52A9\uFF0C\u5E0C\u671B\u80FD\u5230 GitHub \u70B9\u4E2A star","Visit GitHub":"\u8BBF\u95EE GitHub"};var Xd={en:co,"zh-cn":jl},Bl=Xd[zl.moment.locale()];function N(n){return Bl&&Bl[n]||co[n]}var Ul=ue(de());var Vl=require("electron"),Yd=(Vl.app||Vl.remote.app).getPath("userData"),go=Ee.join(Yd,"clever-search"),Jd="https://bitbucket.org/alexclifton37/obsidian-clever-search/raw/dev/assets/for-program/",Qd="https://raw.githubusercontent.com/yan42685/obsidian-clever-search/dev/assets/for-program/",Zd="https://bitbucket.org/alexclifton37/shared-assets/raw/master/",eh="https://unpkg.com/",Xg=eh+"@dqbd/tiktoken@1.0.7/tiktoken_bg.wasm",Yg=Ee.join(go,"tiktoken_bg.wasm"),fo="jieba_rs_wasm_bg.wasm",ho="stop-words-en.txt",po="stop-words-zh.txt",mo="clever-search-ai-helper.zip",ze=class{constructor(){this.setting=b(ae);this._assets=th}get assets(){return this._assets}async initAsync(){A.trace("preparing assets..."),A.trace(`target dir: ${go}`);try{await this.initHelper(Jd)}catch(e){try{await this.initHelper(Qd),A.info("download successfully")}catch(t){throw A.warn("failed to download assets"),t}}}async downloadAiHelper(){let e=new ye(N("Downloading aiHelper"));try{await this.downloadFile(this.targetPath(mo),Zd+mo),new ye(N("Download success"),5e3);let{shell:t}=require("electron");t.showItemInFolder(this.targetPath(mo)),t.openPath(require("os").userInfo().homedir)}catch(t){A.error(t);let r=document.createDocumentFragment(),i=document.createTextNode(N("Download failure")),s=document.createElement("button");s.textContent=N("Download manually"),s.onclick=()=>window.open("https://bitbucket.org/alexclifton37/shared-assets/raw/master/clever-search-ai-helper.zip"),r.appendChild(i),r.appendChild(s),new Kl.Notice(r,0)}finally{e.hide()}}async initHelper(e){this.setting.enableChinesePatch&&(await this.downloadFile(this.targetPath(fo),e+fo),await this.downloadFile(this.targetPath(po),e+po),this._assets.jiebaBinary=An.promises.readFile(this.targetPath(fo)),this._assets.stopWordsZh=await this.readLinesAsSet(this.targetPath(po))),await this.downloadFile(this.targetPath(ho),e+ho),this._assets.stopWordsEn=await this.readLinesAsSet(this.targetPath(ho))}targetPath(e){return Ee.join(go,e)}async readLinesAsSet(e){return new Set((await An.promises.readFile(e,{encoding:"utf-8"})).split(ce.SPLIT_EOL))}async downloadFile(e,t){try{await An.promises.access(e),A.trace("file exists:",e);return}catch(s){if(s.code!=="ENOENT")throw s}let r=Ee.dirname(e);await An.promises.mkdir(r,{recursive:!0}).catch(s=>{if(s.code!=="EEXIST")throw s});let i=await fetch(t);if(!i.ok)throw new Error(`unexpected response ${i.statusText}`);try{await An.promises.writeFile(e,Buffer.from(await i.arrayBuffer()),"utf-8"),A.info(`successfully download from ${t}`)}catch(s){throw A.error(`failed to download ${t}`),s}}};ze=R([(0,Ul.singleton)()],ze);var th={stopWordsZh:null,stopWordsEn:null,jiebaBinary:new Promise(()=>null)};var $l=ue(de());var st=class{constructor(){this.isReady=!1;this.reportedError=!1}async initAsync(){if(b(ae).enableChinesePatch){let e=b(ze).assets.jiebaBinary;await Pl(e),so("",!1),this.isReady=!0}}cut(e,t){return!this.isReady&&!this.reportedError?(A.error("jieba segmenter isn't ready"),this.reportedError=!0,[e]):so(e,t)}};st=R([(0,$l.singleton)()],st);var he=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,ve=Object.keys,ke=Array.isArray;typeof Promise!="undefined"&&!he.Promise&&(he.Promise=Promise);function je(n,e){return typeof e!="object"||ve(e).forEach(function(t){n[t]=e[t]}),n}var cr=Object.getPrototypeOf,nh={}.hasOwnProperty;function qe(n,e){return nh.call(n,e)}function kn(n,e){typeof e=="function"&&(e=e(cr(n))),(typeof Reflect=="undefined"?ve:Reflect.ownKeys)(e).forEach(t=>{Tt(n,t,e[t])})}var ru=Object.defineProperty;function Tt(n,e,t,r){ru(n,e,je(t&&qe(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function Mn(n){return{from:function(e){return n.prototype=Object.create(e.prototype),Tt(n.prototype,"constructor",n),{extend:kn.bind(null,n.prototype)}}}}var rh=Object.getOwnPropertyDescriptor;function Jo(n,e){let t=rh(n,e),r;return t||(r=cr(n))&&Jo(r,e)}var ih=[].slice;function $i(n,e,t){return ih.call(n,e,t)}function iu(n,e){return e(n)}function sr(n){if(!n)throw new Error("Assertion Failed")}function su(n){he.setImmediate?setImmediate(n):setTimeout(n,0)}function ou(n,e){return n.reduce((t,r,i)=>{var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function sh(n,e,t){try{n.apply(null,t)}catch(r){e&&e(r)}}function St(n,e){if(typeof e=="string"&&qe(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=St(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a==null?void 0:St(a,e.substr(o+1))}}function ot(n,e,t){if(!(!n||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){sr(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)ot(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")t===void 0?ke(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var l=n[o];(!l||!qe(n,o))&&(l=n[o]={}),ot(l,a,t)}}else t===void 0?ke(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function oh(n,e){typeof e=="string"?ot(n,e,void 0):"length"in e&&[].map.call(e,function(t){ot(n,t,void 0)})}function au(n){var e={};for(var t in n)qe(n,t)&&(e[t]=n[t]);return e}var ah=[].concat;function lu(n){return ah.apply([],n)}var uu="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(lu([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>he[n]),lh=uu.map(n=>he[n]);ou(uu,n=>[n,!0]);var Ot=null;function yr(n){Ot=typeof WeakMap!="undefined"&&new WeakMap;let e=Eo(n);return Ot=null,e}function Eo(n){if(!n||typeof n!="object")return n;let e=Ot&&Ot.get(n);if(e)return e;if(ke(n)){e=[],Ot&&Ot.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(Eo(n[t]))}else if(lh.indexOf(n.constructor)>=0)e=n;else{let s=cr(n);e=s===Object.prototype?{}:Object.create(s),Ot&&Ot.set(n,e);for(var i in n)qe(n,i)&&(e[i]=Eo(n[i]))}return e}var{toString:uh}={};function So(n){return uh.call(n).slice(8,-1)}var To=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",ch=typeof To=="symbol"?function(n){var e;return n!=null&&(e=n[To])&&e.apply(n)}:function(){return null},Pn={};function xt(n){var e,t,r,i;if(arguments.length===1){if(ke(n))return n.slice();if(this===Pn&&typeof n=="string")return[n];if(i=ch(n)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(n==null)return[n];if(e=n.length,typeof e=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}var Qo=typeof Symbol!="undefined"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1,pt=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function cu(n,e){pt=n,fu=e}var fu=()=>!0,fh=!new Error("").stack;function an(){if(fh)try{throw an.arguments,new Error}catch(n){return n}return new Error}function Ao(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(fu).map(r=>`
`+r).join("")):""}var dh=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],du=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Zo=dh.concat(du),hh={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Dn(n,e){this._e=an(),this.name=n,this.message=e}Mn(Dn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ao(this._e,2))}},toString:function(){return this.name+": "+this.message}});function hu(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,r,i)=>i.indexOf(t)===r).join(`
`)}function Oi(n,e,t,r){this._e=an(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=hu(n,e)}Mn(Oi).from(Dn);function ar(n,e){this._e=an(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=hu(n,e)}Mn(ar).from(Dn);var ea=Zo.reduce((n,e)=>(n[e]=e+"Error",n),{}),ph=Dn,W=Zo.reduce((n,e)=>{var t=e+"Error";function r(i,s){this._e=an(),this.name=t,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=hh[e]||t,this.inner=null)}return Mn(r).from(ph),n[e]=r,n},{});W.Syntax=SyntaxError;W.Type=TypeError;W.Range=RangeError;var Wl=du.reduce((n,e)=>(n[e+"Error"]=W[e],n),{});function mh(n,e){if(!n||n instanceof Dn||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Wl[n.name])return n;var t=new Wl[n.name](e||n.message,n);return"stack"in n&&Tt(t,"stack",{get:function(){return this.inner.stack}}),t}var Wi=Zo.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=W[e]),n),{});Wi.ModifyError=Oi;Wi.DexieError=Dn;Wi.BulkError=ar;function le(){}function vr(n){return n}function gh(n,e){return n==null||n===vr?e:function(t){return e(n(t))}}function sn(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function yh(n,e){return n===le?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?sn(r,this.onsuccess):r),i&&(this.onerror=this.onerror?sn(i,this.onerror):i),s!==void 0?s:t}}function vh(n,e){return n===le?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?sn(t,this.onsuccess):t),r&&(this.onerror=this.onerror?sn(r,this.onerror):r)}}function _h(n,e){return n===le?e:function(t){var r=n.apply(this,arguments);je(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?sn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?sn(s,this.onerror):s),r===void 0?o===void 0?void 0:o:je(r,o)}}function bh(n,e){return n===le?e:function(){return e.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function ta(n,e){return n===le?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var fr={},wh=100,xh=20,pu=100,[Co,Li,Fo]=typeof Promise=="undefined"?[]:(()=>{let n=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[n,cr(n),n];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,cr(e),n]})(),mu=Li&&Li.then,Fi=Co&&Co.constructor,na=!!Fo,Po=!1,Eh=Fo?()=>{Fo.then(Ei)}:he.setImmediate?setImmediate.bind(null,Ei):he.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{Ei(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(Ei,0)},dr=function(n,e){or.push([n,e]),Ri&&(Eh(),Ri=!1)},Io=!0,Ri=!0,nn=[],Pi=[],ko=null,Mo=vr,In={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Gl,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{Gl(n[0],n[1])}catch(e){}})}},K=In,or=[],rn=0,Ii=[];function L(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=le,this._lib=!1;var e=this._PSD=K;if(pt&&(this._stackHolder=an(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==fr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Oo(this,this._value);return}this._state=null,this._value=null,++e.ref,yu(this,n)}var Do={get:function(){var n=K,e=Ni;function t(r,i){var s=!n.global&&(n!==K||e!==Ni);let o=s&&!At();var a=new L((l,u)=>{ra(this,new gu(Bi(r,n,s,o),Bi(i,n,s,o),l,u,n))});return pt&&bu(a,this),a}return t.prototype=fr,t},set:function(n){Tt(this,"then",n&&n.prototype===fr?Do:{get:function(){return n},set:Do.set})}};kn(L.prototype,{then:Do,_then:function(n,e){ra(this,new gu(null,null,n,e,K))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?t(r):ki(r)):this.then(null,r=>r&&r.name===e?t(r):ki(r))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),ki(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Po=!0;var n=_u(this,[],xh),e=n.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Po=!1}}},timeout:function(n,e){return n<1/0?new L((t,r)=>{var i=setTimeout(()=>r(new W.Timeout(e)),n);this.then(t,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Tt(L.prototype,Symbol.toStringTag,"Dexie.Promise");In.env=wu();function gu(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}kn(L,{all:function(){var n=xt.apply(null,arguments).map(ji);return new L(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach((i,s)=>L.resolve(i).then(o=>{n[s]=o,--r||e(n)},t))})},resolve:n=>{if(n instanceof L)return n;if(n&&typeof n.then=="function")return new L((t,r)=>{n.then(t,r)});var e=new L(fr,!0,n);return bu(e,ko),e},reject:ki,race:function(){var n=xt.apply(null,arguments).map(ji);return new L((e,t)=>{n.map(r=>L.resolve(r).then(e,t))})},PSD:{get:()=>K,set:n=>K=n},totalEchoes:{get:()=>Ni},newPSD:Rt,usePSD:Ln,scheduler:{get:()=>dr,set:n=>{dr=n}},rejectionMapper:{get:()=>Mo,set:n=>{Mo=n}},follow:(n,e)=>new L((t,r)=>Rt((i,s)=>{var o=K;o.unhandleds=[],o.onunhandled=s,o.finalize=sn(function(){Th(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),n()},e,t,r))});Fi&&(Fi.allSettled&&Tt(L,"allSettled",function(){let n=xt.apply(null,arguments).map(ji);return new L(e=>{n.length===0&&e([]);let t=n.length,r=new Array(t);n.forEach((i,s)=>L.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--t||e(r)))})}),Fi.any&&typeof AggregateError!="undefined"&&Tt(L,"any",function(){let n=xt.apply(null,arguments).map(ji);return new L((e,t)=>{n.length===0&&t(new AggregateError([]));let r=n.length,i=new Array(r);n.forEach((s,o)=>L.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||t(new AggregateError(i))}))})}));function yu(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&_r();t&&typeof t.then=="function"?yu(n,(i,s)=>{t instanceof L?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,vu(n)),r&&br()}},Oo.bind(null,n))}catch(t){Oo(n,t)}}function Oo(n,e){if(Pi.push(e),n._state===null){var t=n._lib&&_r();e=Mo(e),n._state=!1,n._value=e,pt&&e!==null&&typeof e=="object"&&!e._promise&&sh(()=>{var r=Jo(e,"stack");e._promise=n,Tt(e,"stack",{get:()=>Po?r&&(r.get?r.get.apply(e):r.value):n.stack})}),Ah(n),vu(n),t&&br()}}function vu(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)ra(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),rn===0&&(++rn,dr(()=>{--rn===0&&ia()},[]))}function ra(n,e){if(n._state===null){n._listeners.push(e);return}var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++rn,dr(Sh,[t,n,e])}function Sh(n,e,t){try{ko=e;var r,i=e._value;e._state?r=n(i):(Pi.length&&(Pi=[]),r=n(i),Pi.indexOf(i)===-1&&Ch(e)),t.resolve(r)}catch(s){t.reject(s)}finally{ko=null,--rn===0&&ia(),--t.psd.ref||t.psd.finalize()}}function _u(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i=n._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=Ao(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return pt&&(r=Ao(n._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),n._prev&&_u(n._prev,e,t)),e}function bu(n,e){var t=e?e._numPrev+1:0;t<wh&&(n._prev=e,n._numPrev=t)}function Ei(){_r()&&br()}function _r(){var n=Io;return Io=!1,Ri=!1,n}function br(){var n,e,t;do for(;or.length>0;)for(n=or,or=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(or.length>0);Io=!0,Ri=!0}function ia(){var n=nn;nn=[],n.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Ii.slice(0),t=e.length;t;)e[--t]()}function Th(n){function e(){n(),Ii.splice(Ii.indexOf(e),1)}Ii.push(e),++rn,dr(()=>{--rn===0&&ia()},[])}function Ah(n){nn.some(e=>e._value===n._value)||nn.push(n)}function Ch(n){for(var e=nn.length;e;)if(nn[--e]._value===n._value){nn.splice(e,1);return}}function ki(n){return new L(fr,!1,n)}function pe(n,e){var t=K;return function(){var r=_r(),i=K;try{return Nt(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{Nt(i,!1),r&&br()}}}var Ie={awaits:0,echoes:0,id:0},Fh=0,Mi=[],yo=0,Ni=0,Ph=0;function Rt(n,e,t,r){var i=K,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Ph;var o=In.env;s.env=na?{Promise:L,PromiseProp:{value:L,configurable:!0,writable:!0},all:L.all,race:L.race,allSettled:L.allSettled,any:L.any,resolve:L.resolve,reject:L.reject,nthen:Hl(o.nthen,s),gthen:Hl(o.gthen,s)}:{},e&&je(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Ln(s,n,t,r);return s.ref===0&&s.finalize(),a}function On(){return Ie.id||(Ie.id=++Fh),++Ie.awaits,Ie.echoes+=pu,Ie.id}function At(){return Ie.awaits?(--Ie.awaits===0&&(Ie.id=0),Ie.echoes=Ie.awaits*pu,!0):!1}(""+mu).indexOf("[native code]")===-1&&(On=At=le);function ji(n){return Ie.echoes&&n&&n.constructor===Fi?(On(),n.then(e=>(At(),e),e=>(At(),we(e)))):n}function Ih(n){++Ni,(!Ie.echoes||--Ie.echoes===0)&&(Ie.echoes=Ie.id=0),Mi.push(K),Nt(n,!0)}function kh(){var n=Mi[Mi.length-1];Mi.pop(),Nt(n,!1)}function Nt(n,e){var t=K;if((e?Ie.echoes&&(!yo++||n!==K):yo&&(!--yo||n!==K))&&xu(e?Ih.bind(null,n):kh),n!==K&&(K=n,t===In&&(In.env=wu()),na)){var r=In.env.Promise,i=n.env;Li.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(he,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function wu(){var n=he.Promise;return na?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(he,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:Li.then,gthen:n.prototype.then}:{}}function Ln(n,e,t,r,i){var s=K;try{return Nt(n,!0),e(t,r,i)}finally{Nt(s,!1)}}function xu(n){mu.call(Co,n)}function Bi(n,e,t,r){return typeof n!="function"?n:function(){var i=K;t&&On(),Nt(e,!0);try{return n.apply(this,arguments)}finally{Nt(i,!1),r&&xu(At)}}}function Hl(n,e){return function(t,r){return n.call(this,Bi(t,e),Bi(r,e))}}var ql="unhandledrejection";function Gl(n,e){var t;try{t=e.onuncatched(n)}catch(s){}if(t!==!1)try{var r,i={promise:e,reason:n};if(he.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(ql,!0,!0),je(r,i)):he.CustomEvent&&(r=new CustomEvent(ql,{detail:i}),je(r,i)),r&&he.dispatchEvent&&(dispatchEvent(r),!he.PromiseRejectionEvent&&he.onunhandledrejection))try{he.onunhandledrejection(r)}catch(s){}pt&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch(s){}}var we=L.reject;function Lo(n,e,t,r){if(!n.idbdb||!n._state.openComplete&&!K.letThrough&&!n._vip){if(n._state.openComplete)return we(new W.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return we(new W.DatabaseClosed);n.open().catch(le)}return n._state.dbReadyPromise.then(()=>Lo(n,e,t,r))}else{var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(s){return s.name===ea.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Lo(n,e,t,r))):we(s)}return i._promise(e,(s,o)=>Rt(()=>(K.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var Xl="3.2.7",tn=String.fromCharCode(65535),Ro=-1/0,bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Eu="String expected.",lr=[],Hi=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Mh=Hi,Dh=Hi,Su=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),qi="__dbnames",vo="readonly",_o="readwrite";function on(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}var Tu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Si(n){return typeof n=="string"&&!/\./.test(n)?e=>(e[n]===void 0&&n in e&&(e=yr(e),delete e[n]),e):e=>e}var No=class{_trans(e,t,r){let i=this._tx||K.trans,s=this.name;function o(l,u,c){if(!c.schema[s])throw new W.NotFound("Table "+s+" not part of transaction");return t(c.idbtrans,c)}let a=_r();try{return i&&i.db===this.db?i===K.trans?i._promise(e,o,r):Rt(()=>i._promise(e,o,r),{trans:i,transless:K.transless||K}):Lo(this.db,e,[this.name],o)}finally{a&&br()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ke(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let t=ve(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);let r=this.schema.indexes.concat(this.schema.primKey).filter(u=>{if(u.compound&&t.every(c=>u.keyPath.indexOf(c)>=0)){for(let c=0;c<t.length;++c)if(t.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort((u,c)=>u.keyPath.length-c.keyPath.length)[0];if(r&&this.db._maxKey!==tn){let u=r.keyPath.slice(0,t.length);return this.where(u).equals(u.map(c=>e[c]))}!r&&pt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,c){try{return s.cmp(u,c)===0}catch(h){return!1}}let[a,l]=t.reduce(([u,c],h)=>{let f=i[h],d=e[h];return[u||f,u||!f?on(c,f&&f.multi?m=>{let p=St(m,h);return ke(p)&&p.some(g=>o(d,g))}:m=>o(d,St(m,h))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ke(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let t=r=>{if(!r)return r;let i=Object.create(e.prototype);for(var s in r)if(qe(r,s))try{i[s]=r[s]}catch(o){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){function e(t){je(this,t)}return this.mapToClass(e)}add(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=Si(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[s]})).then(o=>o.numFailures?L.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{ot(e,i,o)}catch(a){}return o})}update(e,t){if(typeof e=="object"&&!ke(e)){let r=St(e,this.schema.primKey.keyPath);if(r===void 0)return we(new W.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?ve(t).forEach(i=>{ot(e,i,t[i])}):t(e,{value:e,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(e).modify(t)}put(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=Si(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:t!=null?[t]:null})).then(o=>o.numFailures?L.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{ot(e,i,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?L.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Tu})).then(e=>e.numFailures?L.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(Si(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:m})=>{let p=s?f:d;if(h===0)return p;throw new ar(`${this.name}.bulkAdd(): ${h} of ${u} operations failed`,m)})})}bulkPut(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(Si(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:m})=>{let p=s?f:d;if(h===0)return p;throw new ar(`${this.name}.bulkPut(): ${h} of ${u} operations failed`,m)})})}bulkDelete(e){let t=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new ar(`${this.name}.bulkDelete(): ${r} of ${t} operations failed`,s)})}};function wr(n){var e={},t=function(a,l){if(l){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[a].subscribe.apply(null,c),n}else if(typeof a=="string")return e[a]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(a,l,u){if(typeof a=="object")return o(a);l||(l=bh),u||(u=le);var c={subscribers:[],fire:u,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=l(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(f){return f!==h}),c.fire=c.subscribers.reduce(l,u)}};return e[a]=t[a]=c,c}function o(a){ve(a).forEach(function(l){var u=a[l];if(ke(u))s(l,a[l][0],a[l][1]);else if(u==="asap")var c=s(l,vr,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];c.subscribers.forEach(function(m){su(function(){m.apply(null,d)})})});else throw new W.InvalidArgument("Invalid event config")})}}function xr(n,e){return Mn(e).from({prototype:n}),e}function Oh(n){return xr(No.prototype,function(t,r,i){this.db=n,this._tx=i,this.name=t,this.schema=r,this.hook=n._allTables[t]?n._allTables[t].hook:wr(null,{creating:[yh,le],reading:[gh,vr],updating:[_h,le],deleting:[vh,le]})})}function Cn(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function bo(n,e){n.filter=on(n.filter,e)}function wo(n,e,t){var r=n.replayFilter;n.replayFilter=r?()=>on(r(),e()):e,n.justLimit=t&&!r}function Lh(n,e){n.isMatch=on(n.isMatch,e)}function Di(n,e){if(n.isPrimKey)return e.primaryKey;let t=e.getIndexByKeyPath(n.index);if(!t)throw new W.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function Yl(n,e,t){let r=Di(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function Ti(n,e,t,r){let i=n.replayFilter?on(n.filter,n.replayFilter()):n.filter;if(n.or){let s={},o=(a,l,u)=>{if(!i||i(l,u,f=>l.stop(f),f=>l.fail(f))){var c=l.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),qe(s,h)||(s[h]=!0,e(a,l,u))}};return Promise.all([n.or._iterate(o,t),Jl(Yl(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}else return Jl(Yl(n,r,t),on(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function Jl(n,e,t,r){var i=r?(o,a,l)=>t(r(o),a,l):t,s=pe(i);return n.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=le},l=>{o.fail(l),a=le}))&&s(o.value,o,l=>a=l),a()})})}function Ne(n,e){try{let t=Ql(n),r=Ql(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return Nh(Zl(n),Zl(e));case"Array":return Rh(n,e)}}catch(t){}return NaN}function Rh(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s){let o=Ne(n[s],e[s]);if(o!==0)return o}return t===r?0:t<r?-1:1}function Nh(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s)if(n[s]!==e[s])return n[s]<e[s]?-1:1;return t===r?0:t<r?-1:1}function Ql(n){let e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";let t=So(n);return t==="ArrayBuffer"?"binary":t}function Zl(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var jo=class{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,we.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,we.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=on(t.algorithm,e)}_iterate(e,t){return Ti(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&je(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(r=>Ti(t,e,r,t.table.core))}count(e){return this._read(t=>{let r=this._ctx,i=r.table.core;if(Cn(r,!0))return i.count({trans:t,query:{index:Di(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return Ti(r,()=>(++s,!1),t,i).then(()=>s)}).then(e)}sortBy(e,t){let r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(u,c){return c?o(u[r[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,c){var h=o(u,s),f=o(c,s);return h<f?-a:h>f?a:0}return this.toArray(function(u){return u.sort(l)}).then(t)}toArray(e){return this._read(t=>{var r=this._ctx;if(r.dir==="next"&&Cn(r,!0)&&r.limit>0){let{valueMapper:i}=r,s=Di(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return Ti(r,s=>i.push(s),t,r.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0?this:(t.offset+=e,Cn(t)?wo(t,()=>{var r=e;return(i,s)=>r===0?!0:r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1)}):wo(t,()=>{var r=e;return()=>--r<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),wo(this._ctx,()=>{var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this}until(e,t){return bo(this._ctx,function(r,i,s){return e(r.value)?(i(s),t):!0}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return bo(this._ctx,function(t){return e(t.value)}),Lh(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&Cn(t,!0)&&t.limit>0)return this._read(i=>{var s=Di(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return bo(this._ctx,function(i){var s=i.primaryKey.toString(),o=qe(r,s);return r[s]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=ve(e),o=s.length;i=function(p){for(var g=!1,y=0;y<o;++y){var _=s[y],x=e[_];St(p,_)!==x&&(ot(p,_,x),g=!0)}return g}}let a=t.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[],f=0,d=[],m=(p,g)=>{let{failures:y,numFailures:_}=g;f+=p-_;for(let x of ve(y))h.push(y[x])};return this.clone().primaryKeys().then(p=>{let g=y=>{let _=Math.min(c,p.length-y);return a.getMany({trans:r,keys:p.slice(y,y+_),cache:"immutable"}).then(x=>{let w=[],S=[],T=l?[]:null,C=[];for(let I=0;I<_;++I){let j=x[I],M={value:yr(j),primKey:p[y+I]};i.call(M,M.value,M)!==!1&&(M.value==null?C.push(p[y+I]):!l&&Ne(u(j),u(M.value))!==0?(C.push(p[y+I]),w.push(M.value)):(S.push(M.value),l&&T.push(p[y+I])))}let P=Cn(t)&&t.limit===1/0&&(typeof e!="function"||e===xo)&&{index:t.index,range:t.range};return Promise.resolve(w.length>0&&a.mutate({trans:r,type:"add",values:w}).then(I=>{for(let j in I.failures)C.splice(parseInt(j),1);m(w.length,I)})).then(()=>(S.length>0||P&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:T,values:S,criteria:P,changeSpec:typeof e!="function"&&e}).then(I=>m(S.length,I))).then(()=>(C.length>0||P&&e===xo)&&a.mutate({trans:r,type:"delete",keys:C,criteria:P}).then(I=>m(C.length,I))).then(()=>p.length>y+_&&g(y+c))})};return g(0).then(()=>{if(h.length>0)throw new Oi("Error modifying one or more objects",h,f,d);return p.length})})})}delete(){var e=this._ctx,t=e.range;return Cn(e)&&(e.isPrimKey&&!Dh||t.type===3)?this._write(r=>{let{primaryKey:i}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:u,numFailures:c})=>{if(c)throw new Oi("Could not delete some values",Object.keys(a).map(h=>a[h]),o-c);return o-c}))}):this.modify(xo)}},xo=(n,e)=>e.value=null;function jh(n){return xr(jo.prototype,function(t,r){this.db=n;let i=Tu,s=null;if(r)try{i=r()}catch(u){s=u}let o=t._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==vr?l:null}})}function Bh(n,e){return n<e?-1:n===e?0:1}function zh(n,e){return n>e?-1:n===e?0:1}function He(n,e,t){var r=n instanceof zi?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function Fn(n){return new n.Collection(n,()=>Au("")).limit(0)}function Vh(n){return n==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function Kh(n){return n==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function Uh(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),a=-1,l=0;l<o;++l){var u=e[l];if(u!==r[l])return i(n[l],t[l])<0?n.substr(0,l)+t[l]+t.substr(l+1):i(n[l],r[l])<0?n.substr(0,l)+r[l]+t.substr(l+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;i(n[l],u)<0&&(a=l)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+r[a]+t.substr(a+1)}function Ai(n,e,t,r){var i,s,o,a,l,u,c,h=t.length;if(!t.every(p=>typeof p=="string"))return He(n,Eu);function f(p){i=Vh(p),s=Kh(p),o=p==="next"?Bh:zh;var g=t.map(function(y){return{lower:s(y),upper:i(y)}}).sort(function(y,_){return o(y.lower,_.lower)});a=g.map(function(y){return y.upper}),l=g.map(function(y){return y.lower}),u=p,c=p==="next"?"":r}f("next");var d=new n.Collection(n,()=>Dt(a[0],l[h-1]+r));d._ondirectionchange=function(p){f(p)};var m=0;return d._addAlgorithm(function(p,g,y){var _=p.key;if(typeof _!="string")return!1;var x=s(_);if(e(x,l,m))return!0;for(var w=null,S=m;S<h;++S){var T=Uh(_,x,a[S],l[S],o,u);T===null&&w===null?m=S+1:(w===null||o(w,T)>0)&&(w=T)}return g(w!==null?function(){p.continue(w+c)}:y),!1}),d}function Dt(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function Au(n){return{type:1,lower:n,upper:n}}var zi=class{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&!(r&&i)?Fn(this):new this.Collection(this,()=>Dt(e,t,!r,!i))}catch(s){return He(this,bt)}}equals(e){return e==null?He(this,bt):new this.Collection(this,()=>Au(e))}above(e){return e==null?He(this,bt):new this.Collection(this,()=>Dt(e,void 0,!0))}aboveOrEqual(e){return e==null?He(this,bt):new this.Collection(this,()=>Dt(e,void 0,!1))}below(e){return e==null?He(this,bt):new this.Collection(this,()=>Dt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?He(this,bt):new this.Collection(this,()=>Dt(void 0,e))}startsWith(e){return typeof e!="string"?He(this,Eu):this.between(e,e+tn,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Ai(this,(t,r)=>t.indexOf(r[0])===0,[e],tn)}equalsIgnoreCase(e){return Ai(this,(t,r)=>t===r[0],[e],"")}anyOfIgnoreCase(){var e=xt.apply(Pn,arguments);return e.length===0?Fn(this):Ai(this,(t,r)=>r.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=xt.apply(Pn,arguments);return e.length===0?Fn(this):Ai(this,(t,r)=>r.some(i=>t.indexOf(i)===0),e,tn)}anyOf(){let e=xt.apply(Pn,arguments),t=this._cmp;try{e.sort(t)}catch(s){return He(this,bt)}if(e.length===0)return Fn(this);let r=new this.Collection(this,()=>Dt(e[0],e[e.length-1]));r._ondirectionchange=s=>{t=s==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return r._addAlgorithm((s,o,a)=>{let l=s.key;for(;t(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return t(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[Ro,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=xt.apply(Pn,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return He(this,bt)}let t=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Ro,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){let r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return Fn(this);if(!e.every(w=>w[0]!==void 0&&w[1]!==void 0&&i(w[0],w[1])<=0))return He(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);let l=!t||t.includeLowers!==!1,u=t&&t.includeUppers===!0;function c(w,S){let T=0,C=w.length;for(;T<C;++T){let P=w[T];if(r(S[0],P[1])<0&&r(S[1],P[0])>0){P[0]=o(P[0],S[0]),P[1]=a(P[1],S[1]);break}}return T===C&&w.push(S),w}let h=i;function f(w,S){return h(w[0],S[0])}let d;try{d=e.reduce(c,[]),d.sort(f)}catch(w){return He(this,bt)}let m=0,p=u?w=>i(w,d[m][1])>0:w=>i(w,d[m][1])>=0,g=l?w=>s(w,d[m][0])>0:w=>s(w,d[m][0])>=0;function y(w){return!p(w)&&!g(w)}let _=p,x=new this.Collection(this,()=>Dt(d[0][0],d[d.length-1][1],!l,!u));return x._ondirectionchange=w=>{w==="next"?(_=p,h=i):(_=g,h=s),d.sort(f)},x._addAlgorithm((w,S,T)=>{for(var C=w.key;_(C);)if(++m,m===d.length)return S(T),!1;return y(C)?!0:(this._cmp(C,d[m][1])===0||this._cmp(C,d[m][0])===0||S(()=>{h===i?w.continue(d[m][0]):w.continue(d[m][1])}),!1)}),x}startsWithAnyOf(){let e=xt.apply(Pn,arguments);return e.every(t=>typeof t=="string")?e.length===0?Fn(this):this.inAnyRange(e.map(t=>[t,t+tn])):He(this,"startsWithAnyOf() only works with strings")}};function $h(n){return xr(zi.prototype,function(t,r,i){this.db=n,this._ctx={table:t,index:r===":id"?null:r,or:i};let s=n._deps.indexedDB;if(!s)throw new W.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=n._deps.IDBKeyRange})}function ht(n){return pe(function(e){return hr(e),n(e.target.error),!1})}function hr(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var pr="storagemutated",Lt="x-storagemutated-1",jt=wr(null,pr),Bo=class{_lock(){return sr(!K.global),++this._reculock,this._reculock===1&&!K.global&&(K.lockOwnerFor=this),this}_unlock(){if(sr(!K.global),--this._reculock===0)for(K.global||(K.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Ln(e[1],e[0])}catch(t){}}return this}_locked(){return this._reculock&&K.lockOwnerFor!==this}create(e){if(!this.mode)return this;let t=this.db.idbdb,r=this.db._state.dbOpenError;if(sr(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new W.DatabaseClosed(r);case"MissingAPIError":throw new W.MissingAPI(r.message,r);default:throw new W.OpenFailed(r)}if(!this.active)throw new W.TransactionInactive;return sr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=pe(i=>{hr(i),this._reject(e.error)}),e.onabort=pe(i=>{hr(i),this.active&&this._reject(new W.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=pe(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&jt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,r){if(e==="readwrite"&&this.mode!=="readwrite")return we(new W.ReadOnly("Transaction is readonly"));if(!this.active)return we(new W.TransactionInactive);if(this._locked())return new L((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(s,o)},K])});if(r)return Rt(()=>{var s=new L((o,a)=>{this._lock();let l=t(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new L((s,o)=>{var a=t(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();let r=L.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>r);else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new L((o,a)=>{r.then(l=>t._waitingQueue.push(pe(o.bind(null,l))),l=>t._waitingQueue.push(pe(a.bind(null,l)))).finally(()=>{t._waitingFor===s&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))}table(e){let t=this._memoizedTables||(this._memoizedTables={});if(qe(t,e))return t[e];let r=this.schema[e];if(!r)throw new W.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i}};function Wh(n){return xr(Bo.prototype,function(t,r,i,s,o){this.db=n,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=wr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new L((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),we(a)})})}function zo(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Cu(e)}}function Cu(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Fu(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:ou(t,r=>[r.name,r])}}function Hh(n){return n.length===1?n[0]:n}var mr=n=>{try{return n.only([[]]),mr=()=>[[]],[[]]}catch(e){return mr=()=>tn,tn}};function Vo(n){return n==null?()=>{}:typeof n=="string"?qh(n):e=>St(e,n)}function qh(n){return n.split(".").length===1?t=>t[n]:t=>St(t,n)}function eu(n){return[].slice.call(n)}var Gh=0;function ur(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Xh(n,e,t){function r(c,h){let f=eu(c.objectStoreNames);return{schema:{name:c.name,tables:f.map(d=>h.objectStore(d)).map(d=>{let{keyPath:m,autoIncrement:p}=d,g=ke(m),y=m==null,_={},x={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y,compound:g,keyPath:m,autoIncrement:p,unique:!0,extractKey:Vo(m)},indexes:eu(d.indexNames).map(w=>d.index(w)).map(w=>{let{name:S,unique:T,multiEntry:C,keyPath:P}=w,I=ke(P),j={name:S,compound:I,keyPath:P,unique:T,multiEntry:C,extractKey:Vo(P)};return _[ur(P)]=j,j}),getIndexByKeyPath:w=>_[ur(w)]};return _[":id"]=x.primaryKey,m!=null&&(_[ur(m)]=x.primaryKey),x})},hasGetAll:f.length>0&&"getAll"in h.objectStore(f[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:f,lowerOpen:d,upperOpen:m}=c;return h===void 0?f===void 0?null:e.upperBound(f,!!m):f===void 0?e.lowerBound(h,!!d):e.bound(h,f,!!d,!!m)}function s(c){let h=c.name;function f({trans:p,type:g,keys:y,values:_,range:x}){return new Promise((w,S)=>{w=pe(w);let T=p.objectStore(h),C=T.keyPath==null,P=g==="put"||g==="add";if(!P&&g!=="delete"&&g!=="deleteRange")throw new Error("Invalid operation type: "+g);let{length:I}=y||_||{length:1};if(y&&_&&y.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(I===0)return w({numFailures:0,failures:{},results:[],lastResult:void 0});let j,M=[],O=[],D=0,z=Y=>{++D,hr(Y)};if(g==="deleteRange"){if(x.type===4)return w({numFailures:D,failures:O,results:[],lastResult:void 0});x.type===3?M.push(j=T.clear()):M.push(j=T.delete(i(x)))}else{let[Y,te]=P?C?[_,y]:[_,null]:[y,null];if(P)for(let ie=0;ie<I;++ie)M.push(j=te&&te[ie]!==void 0?T[g](Y[ie],te[ie]):T[g](Y[ie])),j.onerror=z;else for(let ie=0;ie<I;++ie)M.push(j=T[g](Y[ie])),j.onerror=z}let H=Y=>{let te=Y.target.result;M.forEach((ie,me)=>ie.error!=null&&(O[me]=ie.error)),w({numFailures:D,failures:O,results:g==="delete"?y:M.map(ie=>ie.result),lastResult:te})};j.onerror=Y=>{z(Y),H(Y)},j.onsuccess=H})}function d({trans:p,values:g,query:y,reverse:_,unique:x}){return new Promise((w,S)=>{w=pe(w);let{index:T,range:C}=y,P=p.objectStore(h),I=T.isPrimaryKey?P:P.index(T.name),j=_?x?"prevunique":"prev":x?"nextunique":"next",M=g||!("openKeyCursor"in I)?I.openCursor(i(C),j):I.openKeyCursor(i(C),j);M.onerror=ht(S),M.onsuccess=pe(O=>{let D=M.result;if(!D){w(null);return}D.___id=++Gh,D.done=!1;let z=D.continue.bind(D),H=D.continuePrimaryKey;H&&(H=H.bind(D));let Y=D.advance.bind(D),te=()=>{throw new Error("Cursor not started")},ie=()=>{throw new Error("Cursor not stopped")};D.trans=p,D.stop=D.continue=D.continuePrimaryKey=D.advance=te,D.fail=pe(S),D.next=function(){let me=1;return this.start(()=>me--?this.continue():this.stop()).then(()=>this)},D.start=me=>{let ct=new Promise(($,Z)=>{$=pe($),M.onerror=ht(Z),D.fail=Z,D.stop=q=>{D.stop=D.continue=D.continuePrimaryKey=D.advance=ie,$(q)}}),ne=()=>{if(M.result)try{me()}catch($){D.fail($)}else D.done=!0,D.start=()=>{throw new Error("Cursor behind last entry")},D.stop()};return M.onsuccess=pe($=>{M.onsuccess=ne,ne()}),D.continue=z,D.continuePrimaryKey=H,D.advance=Y,ne(),ct},w(D)},S)})}function m(p){return g=>new Promise((y,_)=>{y=pe(y);let{trans:x,values:w,limit:S,query:T}=g,C=S===1/0?void 0:S,{index:P,range:I}=T,j=x.objectStore(h),M=P.isPrimaryKey?j:j.index(P.name),O=i(I);if(S===0)return y({result:[]});if(p){let D=w?M.getAll(O,C):M.getAllKeys(O,C);D.onsuccess=z=>y({result:z.target.result}),D.onerror=ht(_)}else{let D=0,z=w||!("openKeyCursor"in M)?M.openCursor(O):M.openKeyCursor(O),H=[];z.onsuccess=Y=>{let te=z.result;if(!te)return y({result:H});if(H.push(w?te.value:te.primaryKey),++D===S)return y({result:H});te.continue()},z.onerror=ht(_)}})}return{name:h,schema:c,mutate:f,getMany({trans:p,keys:g}){return new Promise((y,_)=>{y=pe(y);let x=p.objectStore(h),w=g.length,S=new Array(w),T=0,C=0,P,I=M=>{let O=M.target;(S[O._pos]=O.result)!=null,++C===T&&y(S)},j=ht(_);for(let M=0;M<w;++M)g[M]!=null&&(P=x.get(g[M]),P._pos=M,P.onsuccess=I,P.onerror=j,++T);T===0&&y(S)})},get({trans:p,key:g}){return new Promise((y,_)=>{y=pe(y);let w=p.objectStore(h).get(g);w.onsuccess=S=>y(S.target.result),w.onerror=ht(_)})},query:m(a),openCursor:d,count({query:p,trans:g}){let{index:y,range:_}=p;return new Promise((x,w)=>{let S=g.objectStore(h),T=y.isPrimaryKey?S:S.index(y.name),C=i(_),P=C?T.count(C):T.count();P.onsuccess=pe(I=>x(I.target.result)),P.onerror=ht(w)})}}}let{schema:o,hasGetAll:a}=r(n,t),l=o.tables.map(c=>s(c)),u={};return l.forEach(c=>u[c.name]=c),{stack:"dbcore",transaction:n.transaction.bind(n),table(c){if(!u[c])throw new Error(`Table '${c}' not found`);return u[c]},MIN_KEY:-1/0,MAX_KEY:mr(e),schema:o}}function Yh(n,e){return e.reduce((t,{create:r})=>({...t,...r(t)}),n)}function Jh(n,e,{IDBKeyRange:t,indexedDB:r},i){return{dbcore:Yh(Xh(e,t,i),n.dbcore)}}function sa({_novip:n},e){let t=e.db,r=Jh(n._middlewares,t,n._deps,e);n.core=r.dbcore,n.tables.forEach(i=>{let s=i.name;n.core.schema.tables.some(o=>o.name===s)&&(i.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=i.core))})}function Vi({_novip:n},e,t,r){t.forEach(i=>{let s=r[i];e.forEach(o=>{let a=Jo(o,i);(!a||"value"in a&&a.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?Tt(o,i,{get(){return this.table(i)},set(l){ru(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,s))})})}function Ko({_novip:n},e){e.forEach(t=>{for(let r in t)t[r]instanceof n.Table&&delete t[r]})}function Qh(n,e){return n._cfg.version-e._cfg.version}function Zh(n,e,t,r){let i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);let o=s._reject.bind(s),a=K.transless||K;Rt(()=>{K.trans=s,K.transless=a,e===0?(ve(i).forEach(l=>{oa(t,l,i[l].primKey,i[l].indexes)}),sa(n,t),L.follow(()=>n.on.populate.fire(s)).catch(o)):ep(n,e,s,t).catch(o)})}function ep({_novip:n},e,t,r){let i=[],s=n._versions,o=n._dbSchema=aa(n,n.idbdb,r),a=!1;s.filter(c=>c._cfg.version>=e).forEach(c=>{i.push(()=>{let h=o,f=c._cfg.dbschema;$o(n,h,r),$o(n,f,r),o=n._dbSchema=f;let d=Pu(h,f);d.add.forEach(p=>{oa(r,p[0],p[1].primKey,p[1].indexes)}),d.change.forEach(p=>{if(p.recreate)throw new W.Upgrade("Not yet support for changing primary key");{let g=r.objectStore(p.name);p.add.forEach(y=>Uo(g,y)),p.change.forEach(y=>{g.deleteIndex(y.name),Uo(g,y)}),p.del.forEach(y=>g.deleteIndex(y))}});let m=c._cfg.contentUpgrade;if(m&&c._cfg.version>e){sa(n,r),t._memoizedTables={},a=!0;let p=au(f);d.del.forEach(x=>{p[x]=h[x]}),Ko(n,[n.Transaction.prototype]),Vi(n,[n.Transaction.prototype],ve(p),p),t.schema=p;let g=Qo(m);g&&On();let y,_=L.follow(()=>{if(y=m(t),y&&g){var x=At.bind(null,null);y.then(x,x)}});return y&&typeof y.then=="function"?L.resolve(y):_.then(()=>y)}}),i.push(h=>{if(!a||!Mh){let f=c._cfg.dbschema;np(f,h)}Ko(n,[n.Transaction.prototype]),Vi(n,[n.Transaction.prototype],n._storeNames,n._dbSchema),t.schema=n._dbSchema})});function u(){return i.length?L.resolve(i.shift()(t.idbtrans)).then(u):L.resolve()}return u().then(()=>{tp(o,r)})}function Pu(n,e){let t={del:[],add:[],change:[]},r;for(r in n)e[r]||t.del.push(r);for(r in e){let i=n[r],s=e[r];if(!i)t.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Hi)o.recreate=!0,t.change.push(o);else{let a=i.idxByName,l=s.idxByName,u;for(u in a)l[u]||o.del.push(u);for(u in l){let c=a[u],h=l[u];c?c.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}}return t}function oa(n,e,t,r){let i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(s=>Uo(i,s)),i}function tp(n,e){ve(n).forEach(t=>{e.db.objectStoreNames.contains(t)||oa(e,t,n[t].primKey,n[t].indexes)})}function np(n,e){[].slice.call(e.db.objectStoreNames).forEach(t=>n[t]==null&&e.db.deleteObjectStore(t))}function Uo(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function aa(n,e,t){let r={};return $i(e.objectStoreNames,0).forEach(s=>{let o=t.objectStore(s),a=o.keyPath,l=zo(Cu(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),u=[];for(let h=0;h<o.indexNames.length;++h){let f=o.index(o.indexNames[h]);a=f.keyPath;var c=zo(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);u.push(c)}r[s]=Fu(s,l,u)}),r}function rp({_novip:n},e,t){n.verno=e.version/10;let r=n._dbSchema=aa(n,e,t);n._storeNames=$i(e.objectStoreNames,0),Vi(n,[n._allTables],ve(r),r)}function ip(n,e){let t=aa(n,n.idbdb,e),r=Pu(t,n._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function $o({_novip:n},e,t){let r=t.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=t.objectStore(s);n._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],u=o.index(l).keyPath,c=typeof u=="string"?u:"["+$i(u).join("+")+"]";if(e[s]){let h=e[s].idxByName[c];h&&(h.name=l,delete e[s].idxByName[c],e[s].idxByName[l]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&he.WorkerGlobalScope&&he instanceof he.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function sp(n){return n.split(",").map((e,t)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return zo(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),ke(i),t===0)})}var Wo=class{_parseStoresSpec(e,t){ve(e).forEach(r=>{if(e[r]!==null){var i=sp(e[r]),s=i.shift();if(s.multi)throw new W.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),t[r]=Fu(r,s,i)}})}stores(e){let t=this.db;this._cfg.storesSource=this._cfg.storesSource?je(this._cfg.storesSource,e):e;let r=t._versions,i={},s={};return r.forEach(o=>{je(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,Ko(t,[t._allTables,t,t.Transaction.prototype]),Vi(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],ve(s),s),t._storeNames=ve(s),this}upgrade(e){return this._cfg.contentUpgrade=ta(this._cfg.contentUpgrade||le,e),this}};function op(n){return xr(Wo.prototype,function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function la(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new Je(qi,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function ua(n){return n&&typeof n.databases=="function"}function ap({indexedDB:n,IDBKeyRange:e}){return ua(n)?Promise.resolve(n.databases()).then(t=>t.map(r=>r.name).filter(r=>r!==qi)):la(n,e).toCollection().primaryKeys()}function lp({indexedDB:n,IDBKeyRange:e},t){!ua(n)&&t!==qi&&la(n,e).put({name:t}).catch(le)}function up({indexedDB:n,IDBKeyRange:e},t){!ua(n)&&t!==qi&&la(n,e).delete(t).catch(le)}function Ho(n){return Rt(function(){return K.letThrough=!0,n()})}function cp(){var n=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!n||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function fp(n){let e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?we(e.dbOpenError):n);pt&&(e.openCanceller._stackHolder=an()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new W.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1,l=()=>new L((u,c)=>{if(i(),!t)throw new W.MissingAPI;let h=n.name,f=e.autoSchema?t.open(h):t.open(h,Math.round(n.verno*10));if(!f)throw new W.MissingAPI;f.onerror=ht(c),f.onblocked=pe(n._fireOnBlocked),f.onupgradeneeded=pe(d=>{if(o=f.transaction,e.autoSchema&&!n._options.allowEmptyDB){f.onerror=hr,o.abort(),f.result.close();let p=t.deleteDatabase(h);p.onsuccess=p.onerror=pe(()=>{c(new W.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{o.onerror=ht(c);var m=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=m<1,n._novip.idbdb=f.result,Zh(n,m/10,o,c)}},c),f.onsuccess=pe(()=>{o=null;let d=n._novip.idbdb=f.result,m=$i(d.objectStoreNames);if(m.length>0)try{let p=d.transaction(Hh(m),"readonly");e.autoSchema?rp(n,d,p):($o(n,n._dbSchema,p),ip(n,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),sa(n,p)}catch(p){}lr.push(n),d.onversionchange=pe(p=>{e.vcFired=!0,n.on("versionchange").fire(p)}),d.onclose=pe(p=>{n.on("close").fire(p)}),a&&lp(n._deps,h),u()},c)}).catch(u=>u&&u.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l()):L.reject(u));return L.race([r,(typeof navigator=="undefined"?L.resolve():cp()).then(l)]).then(()=>(i(),e.onReadyBeingFired=[],L.resolve(Ho(()=>n.on.ready.fire(n.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(ta,le);return e.onReadyBeingFired=[],L.resolve(Ho(()=>c(n.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(u=>{e.dbOpenError=u;try{o&&o.abort()}catch(c){}return r===e.openCanceller&&n._close(),we(u)}).finally(()=>{e.openComplete=!0,s()})}function qo(n){var e=o=>n.next(o),t=o=>n.throw(o),r=s(e),i=s(t);function s(o){return a=>{var l=o(a),u=l.value;return l.done?u:!u||typeof u.then!="function"?ke(u)?Promise.all(u).then(r,i):r(u):u.then(r,i)}}return s(e)()}function dp(n,e,t){var r=arguments.length;if(r<2)throw new W.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var s=lu(i);return[n,s,t]}function Iu(n,e,t,r,i){return L.resolve().then(()=>{let s=K.transless||K,o=n._createTransaction(e,t,n._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(h){return h.name===ea.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Iu(n,e,t,null,i))):we(h)}let l=Qo(i);l&&On();let u,c=L.follow(()=>{if(u=i.call(o,o),u)if(l){var h=At.bind(null,null);u.then(h,h)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=qo(u))},a);return(u&&typeof u.then=="function"?L.resolve(u).then(h=>o.active?h:we(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(h=>(r&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),we(h)))})}function Ci(n,e,t){let r=ke(n)?n.slice():[n];for(let i=0;i<t;++i)r.push(e);return r}function hp(n){return{...n,table(e){let t=n.table(e),{schema:r}=t,i={},s=[];function o(f,d,m){let p=ur(f),g=i[p]=i[p]||[],y=f==null?0:typeof f=="string"?1:f.length,_=d>0,x={...m,isVirtual:_,keyTail:d,keyLength:y,extractKey:Vo(f),unique:!_&&m.unique};if(g.push(x),x.isPrimaryKey||s.push(x),y>1){let w=y===2?f[0]:f.slice(0,y-1);o(w,d+1,m)}return g.sort((w,S)=>w.keyTail-S.keyTail),x}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let f of r.indexes)o(f.keyPath,0,f);function l(f){let d=i[ur(f)];return d&&d[0]}function u(f,d){return{type:f.type===1?2:f.type,lower:Ci(f.lower,f.lowerOpen?n.MAX_KEY:n.MIN_KEY,d),lowerOpen:!0,upper:Ci(f.upper,f.upperOpen?n.MIN_KEY:n.MAX_KEY,d),upperOpen:!0}}function c(f){let d=f.query.index;return d.isVirtual?{...f,query:{index:d,range:u(f.query.range,d.keyTail)}}:f}return{...t,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:l},count(f){return t.count(c(f))},query(f){return t.query(c(f))},openCursor(f){let{keyTail:d,isVirtual:m,keyLength:p}=f.query.index;if(!m)return t.openCursor(f);function g(y){function _(w){w!=null?y.continue(Ci(w,f.reverse?n.MAX_KEY:n.MIN_KEY,d)):f.unique?y.continue(y.key.slice(0,p).concat(f.reverse?n.MIN_KEY:n.MAX_KEY,d)):y.continue()}return Object.create(y,{continue:{value:_},continuePrimaryKey:{value(w,S){y.continuePrimaryKey(Ci(w,n.MAX_KEY,d),S)}},primaryKey:{get(){return y.primaryKey}},key:{get(){let w=y.key;return p===1?w[0]:w.slice(0,p)}},value:{get(){return y.value}}})}return t.openCursor(c(f)).then(y=>y&&g(y))}}}}}var pp={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:hp};function ca(n,e,t,r){return t=t||{},r=r||"",ve(n).forEach(i=>{if(!qe(e,i))t[r+i]=void 0;else{var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=So(s),l=So(o);a!==l?t[r+i]=e[i]:a==="Object"?ca(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}}),ve(e).forEach(i=>{qe(n,i)||(t[r+i]=e[i])}),t}function mp(n,e){return e.type==="delete"?e.keys:e.keys||e.values.map(n.extractKey)}var gp={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){let t=n.table(e),{primaryKey:r}=t.schema;return{...t,mutate(s){let o=K.trans,{deleting:a,creating:l,updating:u}=o.table(e).hook;switch(s.type){case"add":if(l.fire===le)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(l.fire===le&&u.fire===le)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(a.fire===le)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(a.fire===le)break;return o._promise("readwrite",()=>h(s),!0)}return t.mutate(s);function c(d){let m=K.trans,p=d.keys||mp(r,d);if(!p)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?{...d,keys:p}:{...d},d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),yp(t,d,p).then(g=>{let y=p.map((_,x)=>{let w=g[x],S={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(S,_,w,m);else if(d.type==="add"||w===void 0){let T=l.fire.call(S,_,d.values[x],m);_==null&&T!=null&&(_=T,d.keys[x]=_,r.outbound||ot(d.values[x],r.keyPath,_))}else{let T=ca(w,d.values[x]),C=u.fire.call(S,T,_,w,m);if(C){let P=d.values[x];Object.keys(C).forEach(I=>{qe(P,I)?P[I]=C[I]:ot(P,I,C[I])})}}return S});return t.mutate(d).then(({failures:_,results:x,numFailures:w,lastResult:S})=>{for(let T=0;T<p.length;++T){let C=x?x[T]:p[T],P=y[T];C==null?P.onerror&&P.onerror(_[T]):P.onsuccess&&P.onsuccess(d.type==="put"&&g[T]?d.values[T]:C)}return{failures:_,results:x,numFailures:w,lastResult:S}}).catch(_=>(y.forEach(x=>x.onerror&&x.onerror(_)),Promise.reject(_)))})}function h(d){return f(d.trans,d.range,1e4)}function f(d,m,p){return t.query({trans:d,values:!1,query:{index:r,range:m},limit:p}).then(({result:g})=>c({type:"delete",keys:g,trans:d}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):g.length<p?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...m,lower:g[g.length-1],lowerOpen:!0},p)))}}}}})};function yp(n,e,t){return e.type==="add"?Promise.resolve([]):n.getMany({trans:e.trans,keys:t,cache:"immutable"})}function ku(n,e,t){try{if(!e||e.keys.length<n.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<n.length;++i)Ne(e.keys[i],n[s])===0&&(r.push(t?yr(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch(r){return null}}var vp={stack:"dbcore",level:-1,create:n=>({table:e=>{let t=n.table(e);return{...t,getMany:r=>{if(!r.cache)return t.getMany(r);let i=ku(r.keys,r.trans._cache,r.cache==="clone");return i?L.resolve(i):t.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?yr(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),t.mutate(r))}}})};function fa(n){return!("from"in n)}var wt=function(n,e){if(this)je(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0});else{let t=new wt;return n&&"d"in n&&je(t,n),t}};kn(wt.prototype,{add(n){return Ki(this,n),this},addKey(n){return gr(this,n,n),this},addKeys(n){return n.forEach(e=>gr(this,e,e)),this},[To](){return Go(this)}});function gr(n,e,t){let r=Ne(e,t);if(isNaN(r))return;if(r>0)throw RangeError();if(fa(n))return je(n,{from:e,to:t,d:1});let i=n.l,s=n.r;if(Ne(t,n.from)<0)return i?gr(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},tu(n);if(Ne(e,n.to)>0)return s?gr(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},tu(n);Ne(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),Ne(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);let o=!n.r;i&&!n.l&&Ki(n,i),s&&o&&Ki(n,s)}function Ki(n,e){function t(r,{from:i,to:s,l:o,r:a}){gr(r,i,s),o&&t(r,o),a&&t(r,a)}fa(e)||t(n,e)}function _p(n,e){let t=Go(e),r=t.next();if(r.done)return!1;let i=r.value,s=Go(n),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Ne(a.from,i.to)<=0&&Ne(a.to,i.from)>=0)return!0;Ne(i.from,a.from)<0?i=(r=t.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Go(n){let e=fa(n)?null:{s:0,n};return{next(t){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Ne(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Ne(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function tu(n){var e,t;let r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...n},a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],o[i]=a[s],n[s]=o,o.d=nu(o)}n.d=nu(n)}function nu({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}var bp={stack:"dbcore",level:0,create:n=>{let e=n.schema.name,t=new wt(n.MIN_KEY,n.MAX_KEY);return{...n,table:r=>{let i=n.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,u={...i,mutate:f=>{let d=f.trans,m=d.mutatedParts||(d.mutatedParts={}),p=T=>{let C=`idb://${e}/${r}/${T}`;return m[C]||(m[C]=new wt)},g=p(""),y=p(":dels"),{type:_}=f,[x,w]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],S=f.trans._cache;return i.mutate(f).then(T=>{if(ke(x)){_!=="delete"&&(x=T.results),g.addKeys(x);let C=ku(x,S);!C&&_!=="add"&&y.addKeys(x),(C||w)&&wp(p,s,C,w)}else if(x){let C={from:x.lower,to:x.upper};y.add(C),g.add(C)}else g.add(t),y.add(t),s.indexes.forEach(C=>p(C.name).add(t));return T})}},c=({query:{index:f,range:d}})=>{var m,p;return[f,new wt((m=d.lower)!==null&&m!==void 0?m:n.MIN_KEY,(p=d.upper)!==null&&p!==void 0?p:n.MAX_KEY)]},h={get:f=>[o,new wt(f.key)],getMany:f=>[o,new wt().addKeys(f.keys)],count:c,query:c,openCursor:c};return ve(h).forEach(f=>{u[f]=function(d){let{subscr:m}=K;if(m){let p=w=>{let S=`idb://${e}/${r}/${w}`;return m[S]||(m[S]=new wt)},g=p(""),y=p(":dels"),[_,x]=h[f](d);if(p(_.name||"").add(x),!_.isPrimaryKey)if(f==="count")y.add(t);else{let w=f==="query"&&l&&d.values&&i.query({...d,values:!1});return i[f].apply(this,arguments).then(S=>{if(f==="query"){if(l&&d.values)return w.then(({result:C})=>(g.addKeys(C),S));let T=d.values?S.result.map(a):S.result;d.values?g.addKeys(T):y.addKeys(T)}else if(f==="openCursor"){let T=S,C=d.values;return T&&Object.create(T,{key:{get(){return y.addKey(T.primaryKey),T.key}},primaryKey:{get(){let P=T.primaryKey;return y.addKey(P),P}},value:{get(){return C&&g.addKey(T.primaryKey),T.value}}})}return S})}}return i[f].apply(this,arguments)}}),u}}}};function wp(n,e,t,r){function i(s){let o=n(s.name||"");function a(u){return u!=null?s.extractKey(u):null}let l=u=>s.multiEntry&&ke(u)?u.forEach(c=>o.addKey(c)):o.addKey(u);(t||r).forEach((u,c)=>{let h=t&&a(t[c]),f=r&&a(r[c]);Ne(h,f)!==0&&(h!=null&&l(h),f!=null&&l(f))})}e.indexes.forEach(i)}var Je=class{constructor(e,t){this._middlewares={},this.verno=0;let r=Je.dependencies;this._options=t={addons:Je.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};let{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:le,dbReadyPromise:null,cancelOpen:le,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new L(o=>{s.dbReadyResolve=o}),s.openCanceller=new L((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=wr(this,"populate","blocked","versionchange","close",{ready:[ta,le]}),this.on.ready.subscribe=iu(this.on.ready.subscribe,o=>(a,l)=>{Je.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||L.resolve().then(a),l&&o(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&o(a);else{o(a);let c=this;l||o(function h(){c.on.ready.unsubscribe(a),c.on.ready.unsubscribe(h)})}})}),this.Collection=jh(this),this.Table=Oh(this),this.Transaction=Wh(this),this.Version=op(this),this.WhereClause=$h(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=mr(t.IDBKeyRange),this._createTransaction=(o,a,l,u)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),lr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(pp),this.use(gp),this.use(bp),this.use(vp),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new W.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let t=this._versions;var r=t.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),t.push(r),t.sort(Qh),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||K.letThrough||this._vip)?e():new L((t,r)=>{if(this._state.openComplete)return r(new W.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new W.DatabaseClosed);return}this.open().catch(le)}this._state.dbReadyPromise.then(t,r)}).then(e)}use({stack:e,create:t,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:r==null?10:r,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:t?i.name!==t:!1)),this}open(){return fp(this)}_close(){let e=this._state,t=lr.indexOf(this);if(t>=0&&lr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}e.dbReadyPromise=new L(r=>{e.dbReadyResolve=r}),e.openCanceller=new L((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new W.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,t=this._state;return new L((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=pe(()=>{up(this._deps,this.name),r()}),o.onerror=ht(i),o.onblocked=this._fireOnBlocked};if(e)throw new W.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ve(this._allTables).map(e=>this._allTables[e])}transaction(){let e=dp.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let i=K.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=t.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===vo)o=vo;else if(e=="rw"||e==_o)o=_o;else throw new W.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===vo&&o===_o)if(s)i=null;else throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(s)i=null;else throw new W.SubTransaction("Table "+u+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,h)=>{h(u)}):we(u)}let l=Iu.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):K.trans?Ln(K.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!qe(this._allTables,e))throw new W.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},xp=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Xo=class{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:t,complete:r}:e)}[xp](){return this}};function Mu(n,e){return ve(e).forEach(t=>{let r=n[t]||(n[t]=new wt);Ki(r,e[t])}),n}function Ep(n){let e=!1,t,r=new Xo(i=>{let s=Qo(n);function o(g){s&&On();let y=()=>Rt(n,{subscr:g,trans:null}),_=K.trans?Ln(K.transless,y):y();return s&&_.then(At,At),_}let a=!1,l={},u={},c={get closed(){return a},unsubscribe:()=>{a=!0,jt.storagemutated.unsubscribe(m)}};i.start&&i.start(c);let h=!1,f=!1;function d(){return ve(u).some(g=>l[g]&&_p(l[g],u[g]))}let m=g=>{Mu(l,g),d()&&p()},p=()=>{if(h||a)return;l={};let g={},y=o(g);f||(jt(pr,m),f=!0),h=!0,Promise.resolve(y).then(_=>{e=!0,t=_,h=!1,!a&&(d()?p():(l={},u=g,i.next&&i.next(_)))},_=>{h=!1,e=!1,i.error&&i.error(_),c.unsubscribe()})};return p(),c});return r.hasValue=()=>e,r.getValue=()=>t,r}var Yo;try{Yo={indexedDB:he.indexedDB||he.mozIndexedDB||he.webkitIndexedDB||he.msIndexedDB,IDBKeyRange:he.IDBKeyRange||he.webkitIDBKeyRange}}catch(n){Yo={indexedDB:null,IDBKeyRange:null}}var en=Je;kn(en,{...Wi,delete(n){return new en(n,{addons:[]}).delete()},exists(n){return new en(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(n){try{return ap(en.dependencies).then(n)}catch(e){return we(new W.MissingAPI)}},defineClass(){function n(e){je(this,e)}return n},ignoreTransaction(n){return K.trans?Ln(K.transless,n):n()},vip:Ho,async:function(n){return function(){try{var e=qo(n.apply(this,arguments));return!e||typeof e.then!="function"?L.resolve(e):e}catch(t){return we(t)}}},spawn:function(n,e,t){try{var r=qo(n.apply(t,e||[]));return!r||typeof r.then!="function"?L.resolve(r):r}catch(i){return we(i)}},currentTransaction:{get:()=>K.trans||null},waitFor:function(n,e){let t=L.resolve(typeof n=="function"?en.ignoreTransaction(n):n).timeout(e||6e4);return K.trans?K.trans.waitFor(t):t},Promise:L,debug:{get:()=>pt,set:n=>{cu(n,n==="dexie"?()=>!0:Su)}},derive:Mn,extend:je,props:kn,override:iu,Events:wr,on:jt,liveQuery:Ep,extendObservabilitySet:Mu,getByKeyPath:St,setByKeyPath:ot,delByKeyPath:oh,shallowClone:au,deepClone:yr,getObjectDiff:ca,cmp:Ne,asap:su,minKey:Ro,addons:[],connections:lr,errnames:ea,dependencies:Yo,semVer:Xl,version:Xl.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,t*2))});en.maxKey=mr(en.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(jt(pr,n=>{if(!Et){let e;Hi?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Lt,!0,!0,n)):e=new CustomEvent(Lt,{detail:n}),Et=!0,dispatchEvent(e),Et=!1}}),addEventListener(Lt,({detail:n})=>{Et||Ui(n)}));function Ui(n){let e=Et;try{Et=!0,jt.storagemutated.fire(n)}finally{Et=e}}var Et=!1;if(typeof BroadcastChannel!="undefined"){let n=new BroadcastChannel(Lt);typeof n.unref=="function"&&n.unref(),jt(pr,e=>{Et||n.postMessage(e)}),n.onmessage=e=>{e.data&&Ui(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){jt(pr,e=>{try{Et||(typeof localStorage!="undefined"&&localStorage.setItem(Lt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:Lt,changedParts:e})))}catch(t){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===Lt){let t=JSON.parse(e.newValue);t&&Ui(t.changedParts)}});let n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",Sp)}function Sp({data:n}){n&&n.type===Lt&&Ui(n.changedParts)}L.rejectionMapper=mh;cu(pt,Su);var Lu=require("obsidian");var Du=require("obsidian");var Ou=ue(de());var Me=class{constructor(){this.app=b(Du.App);this.plugin=b(We);this.obsidianFs=this.app.vault.adapter}getVaultAbsolutePath(){return this.obsidianFs.getBasePath().replace(/\\/g,"/")+"/"}getAbsolutePath(e){return Ee.join(this.getVaultAbsolutePath(),e)}getFileBacklinks(e){this.app.metadataCache.getBacklinksForFile(e)}getAppId(){return this.app.appId}executeCommandById(e){this.app.commands.executeCommandById(e)}isNotObsidianExcludedPath(e){return!(this.app.metadataCache.isUserIgnored&&this.app.metadataCache.isUserIgnored(e))}};Me=R([(0,Ou.singleton)()],Me);var Ru=ue(de());var at=class{constructor(){this.app=b(Lu.App);this.privateApi=b(Me)}async initAsync(){if(this.app.plugins.plugins.omnisearch){let e="omnisearch/cache/"+this.privateApi.getAppId(),t=new Je(e);t.version(at.DB_VERSION).stores({searchHistory:"++id",minisearch:"date"}),this.db=t}}async getLastQuery(){let e="";if(this.checkOmnisearchStatus()){let t=await this.db.searchHistory.toArray();e=t.length!==0?t[t.length-1].query:""}return e}checkOmnisearchStatus(){let e=this.app.plugins.plugins.omnisearch,t=!0;return e?e._loaded||(new ye(N("Omnisearch is installed but not enabled")),t=!1):(new ye(N("Omnisearch isn't installed")),t=!1),t}};at.DB_VERSION=8,at=R([(0,Ru.singleton)()],at);var G=require("obsidian");var pn=ue(de());var Nu=ue(de());var De=class{constructor(){this.setting=b(ae);this.extensionViewMap=new Map;this.plugin=b(We)}init(){this.fillMap(this.setting.customExtensions.plaintext,ln.MARKDOWN);try{}catch(e){}}viewTypeByPath(e){let t=this.extensionViewMap.get(ce.getExtension(e));return t===void 0?ln.UNSUPPORTED:t}refreshAll(){this.extensionViewMap.clear(),this.init()}fillMap(e,t){for(let r of e)this.extensionViewMap.set(r,t)}};De=R([(0,Nu.singleton)()],De);var ln=(a=>(a.UNSUPPORTED="unsupported",a.MARKDOWN="markdown",a.PDF="pdf",a.CANVAS="canvas",a.IMAGE="image",a.AUDIO="audio",a.VIDEO="video",a))(ln||{});var Rn=class{constructor(e,t){this.text=e,this.row=t}},Ct=class{constructor(e,t){this.sourcePath=e,this.items=t}};var Er=class{},Bt=class extends Er{constructor(t,r){super();this.line=t,this.context=r}},zt=class extends Er{constructor(t,r,i,s,o,a){super();this.engineType=t,this.path=r,this.queryTerms=i,this.matchedTerms=s,this.subItems=o,this.previewContent=a}get viewType(){return b(De).viewTypeByPath(this.path)}get basename(){return ce.getBasename(this.path)}get extension(){return ce.getExtension(this.path)}get folderPath(){return ce.getFolderPath(this.path)}},Gi=class extends Er{constructor(t,r,i){super();this.text=t,this.row=r,this.col=i}};var ju=require("obsidian");var Xi=class{constructor(e){this.option=e}async get(e,t){return this.request("GET",e,t,void 0)}async post(e,t,r){return this.request("POST",e,t,r)}async put(e,t,r){return this.request("PUT",e,t,r)}async delete(e,t){return this.request("DELETE",e,t,void 0)}async request(e,t,r,i){return t=this.buildUrlWithParams(t,r),this.option.responseProcessor(await(0,ju.requestUrl)({url:t,method:e,contentType:"application/json",body:i?JSON.stringify(i):void 0,headers:this.option.headers}))}buildUrlWithParams(e,t){e=`${this.option.protocol}://${this.option.baseUrl}/${e}`;let r=t?this.serializeParams(t):"";return r?`${e}?${r}`:e}serializeParams(e){return Object.keys(e).map(t=>{let r=e[t];return`${encodeURIComponent(t)}=${encodeURIComponent(this.stringifyParam(r))}`}).join("&")}stringifyParam(e){return typeof e=="object"?JSON.stringify(e):String(e)}};var da=ue(de());var Ve=class{constructor(){this.request=b(Sr);this.viewRegistry=b(De);this._status="stopped"}get status(){return this._status}async testConnection(){await this.request.testConnection()?new ye("Connected",5e3):new ye("Failed to connect",5e3)}async doesCollectionExist(){try{let e=await this.request.doesCollectionExist();return this._status="ready",e}catch(e){return this._status="stopped",A.warn("failed to connect to ai-helper. launch clever-search-ai-helper or disable semantic search in the setting to avoid this warning."),A.error(e),null}}async reindexAll(e){this._status="indexing";let t=this.convertToDocuments(e);try{await this.request.reindexAll(t),this._status="ready"}catch(r){A.error(r),this._status="stopped"}}async addDocuments(e){this._status="indexing";let t=this.convertToDocuments(e);try{let r=await this.request.addDocuments(t);return this._status="ready",r}catch(r){return A.error(r),this._status="stopped",!1}}async deleteDocuments(e){this._status="indexing";try{let t=await this.request.deleteDocuments(e);return this._status="ready",t}catch(t){return A.error(t),this._status="stopped",!1}}async search(e,t){try{let r=await this.request.search(e,t);return this._status="ready",r.map(i=>{let s=i.subItems.map(o=>new Gi(o.text,o.row,o.col));return new zt(i.engineType,i.path,i.queryTerms,i.matchedTerms,s,i.previewContent)})}catch(r){return A.error(r),this._status="stopped",[]}}async docsCount(){return this.request.docsCount()}convertToDocuments(e){return e.map(t=>({path:t.path,view_type:this.viewRegistry.viewTypeByPath(t.path),content:t.content}))}};Ve=R([(0,da.singleton)()],Ve);var Sr=class{constructor(){this.responseProcessor=e=>{if(e.status===200){let t=e.json;if(t.code===0)return t.data;if(t.code===-1)return A.error(`KnownException: ${t.message}`),null;if(t.code===-2)return A.error(`UnknownException: ${t.message}`),null;throw Error(wi)}else return A.error(e.text),null};this.client=new Xi({baseUrl:"localhost:19528/api",protocol:"http",responseProcessor:this.responseProcessor,headers:{"X-vaultId":b(Me).getAppId()}})}async testConnection(){try{return!!await this.client.get("testConnection")}catch(e){return A.error(e),!1}}async doesCollectionExist(){return await this.client.get("doesCollectionExist",void 0)}async reindexAll(e){await this.client.post("reindexAll",void 0,e)}async docsCount(){try{return await this.client.get("docsCount")}catch(e){return A.error(e),null}}async addDocuments(e){return await this.client.post("addDocuments",void 0,e)}async deleteDocuments(e){return await this.client.post("deleteDocuments",void 0,e)}async search(e,t){return await this.client.get("search",{queryText:e,viewType:t})}};Sr=R([(0,da.singleton)()],Sr);var gc=require("obsidian");var Tr=ue(de());var Vt=class{constructor(){this.db=b(Qe)}async deleteMinisearchData(){this.db.minisearch.clear()}async setMiniSearchData(e){this.db.transaction("rw",this.db.minisearch,async()=>{await this.db.minisearch.clear(),await this.db.minisearch.add({data:e}),A.trace("minisearch data saved")})}async getMiniSearchData(){var e;return((e=(await this.db.minisearch.toArray())[0])==null?void 0:e.data)||null}async setLexicalDocRefs(e){this.db.transaction("rw",this.db.lexicalDocRefs,async()=>{await this.db.lexicalDocRefs.clear(),await this.db.lexicalDocRefs.bulkAdd(e)})}async getLexicalDocRefs(){return await this.db.lexicalDocRefs.toArray()||null}async setSemanticDocRefs(e){this.db.transaction("rw",this.db.semanticDocRefs,async()=>{await this.db.semanticDocRefs.clear(),await this.db.semanticDocRefs.bulkAdd(e)})}async getSemanticDocRefs(){return await this.db.semanticDocRefs.toArray()||null}async setPluginSetting(e){try{return await this.db.transaction("rw",this.db.pluginSetting,()=>{this.db.pluginSetting.clear(),this.db.pluginSetting.add({data:e})}),A.trace("settings have been saved to database"),!0}catch(t){return A.trace(`settings failed to be saved: ${t}`),!1}}async deleteOldDatabases(){let e=(await indexedDB.databases()).filter(t=>t.name===this.db.dbName&&t.version!==this.db.dbVersion*10);if(e.length){A.info("Old version databases will be deleted");for(let t of e)t.name&&indexedDB.deleteDatabase(t.name)}}};R([Pe],Vt.prototype,"getMiniSearchData",1),R([Pe],Vt.prototype,"getLexicalDocRefs",1),Vt=R([(0,Tr.singleton)()],Vt);var Qe=class extends Je{constructor(t){super(Qe.dbNamePrefix+t.getAppId());this.privateApi=t,this.version(Qe._dbVersion).stores({pluginSetting:"++id",minisearch:"++id",lexicalDocRefs:"++id",semanticDocRefs:"++id"})}get dbVersion(){return Qe._dbVersion}get dbName(){return Qe.dbNamePrefix+this.privateApi.getAppId()}};Qe._dbVersion=2,Qe.dbNamePrefix="clever-search/",Qe=R([(0,Tr.singleton)(),Yr(0,(0,Tr.inject)(Me))],Qe);var ya={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let n="\u0300".codePointAt(0);n<="\u036F".codePointAt(0);++n){let e=String.fromCodePoint(n);for(let t of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let i=(t+e).normalize().codePointAt(0);i>126&&(ya[i]=t)}}var ha={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(let n of Object.keys(ha)){let e=n.toUpperCase();for(let t=ha[n][0];t<=ha[n][1];++t)ya[t]=t%2===0?e:n}function kr(n){if(n<192||n>8580)return n;let e=ya[n];return e!==void 0?e.codePointAt(0):n}function Kt(n,e){return n>e?n:e}var Vu=n=>n.split("").map(e=>e.codePointAt(0));var Tp=new Set(` \f
\r	\v\xA0\u1680\u2028\u2029\u202F\u205F\u3000\uFEFF`.split("").map(n=>n.codePointAt(0)));for(let n="\u2000".codePointAt(0);n<="\u200A".codePointAt(0);n++)Tp.add(n);var jn="\x7F".codePointAt(0),Cr="A".codePointAt(0),Fr="Z".codePointAt(0),Ku="a".codePointAt(0),Uu="z".codePointAt(0),Ap="0".codePointAt(0),Cp="9".codePointAt(0);function Nn(n,e,t){return t?n:e-n-1}var Pr=16,Yi=-3,Ir=-1,un=Pr/2,Fp=Pr/2,Pp=un+Ir,$u=-(Yi+Ir),Wu=2;function pa(n){return n?new Set:null}function Ar(n,e,t){if(e!==null&&e.i16.length>n+t){let r=e.i16.subarray(n,n+t);return[n+t,r]}return[n,new Int16Array(t)]}function Bu(n,e,t){if(e!==null&&e.i32.length>n+t){let r=e.i32.subarray(n,n+t);return[n+t,r]}return[n,new Int32Array(t)]}function Hu(n){return n>=Ku&&n<=Uu?1:n>=Cr&&n<=Fr?2:n>=Ap&&n<=Cp?4:0}function qu(n){let e=String.fromCodePoint(n);return e!==e.toUpperCase()?1:e!==e.toLowerCase()?2:e.match(/\p{Number}/gu)!==null?4:e.match(/\p{Letter}/gu)!==null?3:0}function Ji(n){return n<=jn?Hu(n):qu(n)}function va(n,e){return n===0&&e!==0?un:n===1&&e===2||n!==4&&e===4?Pp:e===0?Fp:0}function Ip(n,e){return e===0?un:va(Ji(n[e-1]),Ji(n[e]))}function kp(n,e,t,r){let i=n.slice(r),s=i.indexOf(t);if(s===0)return r;if(!e&&t>=Ku&&t<=Uu){s>0&&(i=i.slice(0,s));let o=i.indexOf(t-32);o>=0&&(s=o)}return s<0?-1:r+s}function zu(n){for(let e of n)if(e>=128)return!1;return!0}function _a(n,e,t){if(!zu(n))return 0;if(!zu(e))return-1;let r=0,i=0;for(let s=0;s<e.length;s++){if(i=kp(n,t,e[s],i),i<0)return-1;s===0&&i>0&&(r=i-1),i++}return r}var Mp=(n,e,t,r,i,s,o)=>{let a=i.length;if(a===0)return[{start:0,end:0,score:0},pa(s)];let l=r.length;if(o!==null&&l*a>o.i16.length)return Xu(n,e,t,r,i,s);let u=_a(r,i,n);if(u<0)return[{start:-1,end:-1,score:0},null];let c=0,h=0,f=null,d=null,m=null,p=null;[c,f]=Ar(c,o,l),[c,d]=Ar(c,o,l),[c,m]=Ar(c,o,l),[h,p]=Bu(h,o,a);let[,g]=Bu(h,o,l);for(let $=0;$<g.length;$++)g[$]=r[$];let y=0,_=0,x=0,w=0,S=i[0],T=i[0],C=0,P=0,I=!1,j=g.subarray(u),M=f.subarray(u).subarray(0,j.length),O=d.subarray(u).subarray(0,j.length),D=m.subarray(u).subarray(0,j.length);for(let[$,Z]of j.entries()){let q=null;Z<=jn?(q=Hu(Z),!n&&q===2&&(Z+=32)):(q=qu(Z),!n&&q===2&&(Z=String.fromCodePoint(Z).toLowerCase().codePointAt(0)),e&&(Z=kr(Z))),j[$]=Z;let Ce=va(P,q);if(D[$]=Ce,P=q,Z===T&&(x<a&&(p[x]=u+$,x++,T=i[Math.min(x,a-1)]),w=u+$),Z===S){let Le=Pr+Ce*Wu;if(M[$]=Le,O[$]=1,a===1&&(t&&Le>y||!t&&Le>=y)&&(y=Le,_=u+$,t&&Ce===un))break;I=!1}else I?M[$]=Kt(C+Ir,0):M[$]=Kt(C+Yi,0),O[$]=0,I=!0;C=M[$]}if(x!==a)return[{start:-1,end:-1,score:0},null];if(a===1){let $={start:_,end:_+1,score:y};if(!s)return[$,null];let Z=new Set;return Z.add(_),[$,Z]}let z=p[0],H=w-z+1,Y=null;[c,Y]=Ar(c,o,H*a);{let $=f.subarray(z,w+1);for(let[Z,q]of $.entries())Y[Z]=q}let[,te]=Ar(c,o,H*a);{let $=d.subarray(z,w+1);for(let[Z,q]of $.entries())te[Z]=q}let ie=p.subarray(1),me=i.slice(1).slice(0,ie.length);for(let[$,Z]of ie.entries()){let q=!1,Ce=me[$],Le=$+1,B=Le*H,ee=g.subarray(Z,w+1),xe=m.subarray(Z).subarray(0,ee.length),Hr=te.subarray(B+Z-z).subarray(0,ee.length),Ft=te.subarray(B+Z-z-1-H).subarray(0,ee.length),qr=Y.subarray(B+Z-z).subarray(0,ee.length),gs=Y.subarray(B+Z-z-1-H).subarray(0,ee.length),bn=Y.subarray(B+Z-z-1).subarray(0,ee.length);bn[0]=0;for(let[nt,ys]of ee.entries()){let Gr=nt+Z,Pt=0,gt=0,It=0;if(q?gt=bn[nt]+Ir:gt=bn[nt]+Yi,Ce===ys){Pt=gs[nt]+Pr;let Xt=xe[nt];It=Ft[nt]+1,Xt===un?It=1:It>1&&(Xt=Kt(Xt,Kt($u,m[Gr-It+1]))),Pt+Xt<gt?(Pt+=xe[nt],It=0):Pt+=Xt}Hr[nt]=It,q=Pt<gt;let wn=Kt(Kt(Pt,gt),0);Le===a-1&&(t&&wn>y||!t&&wn>=y)&&(y=wn,_=Gr),qr[nt]=wn}}let ct=pa(s),ne=z;if(s&&ct!==null){let $=a-1;ne=_;let Z=!0;for(;;){let q=$*H,Ce=ne-z,Le=Y[q+Ce],B=0,ee=0;if($>0&&ne>=p[$]&&(B=Y[q-H+Ce-1]),ne>p[$]&&(ee=Y[q+Ce-1]),Le>B&&(Le>ee||Le===ee&&Z)){if(ct.add(ne),$===0)break;$--}Z=te[q+Ce]>1||q+H+Ce+1<te.length&&te[q+H+Ce+1]>0,ne--}}return[{start:ne,end:_+1,score:y},ct]};function Gu(n,e,t,r,i,s,o){let a=0,l=0,u=!1,c=0,h=0,f=pa(o),d=0;i>0&&(d=Ji(t[i-1]));for(let m=i;m<s;m++){let p=t[m],g=Ji(p);if(n||(p>=Cr&&p<=Fr?p+=32:p>jn&&(p=String.fromCodePoint(p).toLowerCase().codePointAt(0))),e&&(p=kr(p)),p===r[a]){o&&f!==null&&f.add(m),l+=Pr;let y=va(d,g);c===0?h=y:(y===un&&(h=y),y=Kt(Kt(y,h),$u)),a===0?l+=y*Wu:l+=y,u=!1,c++,a++}else u?l+=Ir:l+=Yi,u=!0,c=0,h=0;d=g}return[l,f]}var Xu=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];if(_a(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let a=0,l=-1,u=-1,c=r.length,h=i.length;for(let f=0;f<c;f++){let d=r[Nn(f,c,t)];n||(d>=Cr&&d<=Fr?d+=32:d>jn&&(d=String.fromCodePoint(d).toLowerCase().codePointAt(0))),e&&(d=kr(d));let m=i[Nn(a,h,t)];if(d===m&&(l<0&&(l=f),a++,a===h)){u=f+1;break}}if(l>=0&&u>=0){a--;for(let m=u-1;m>=l;m--){let p=Nn(m,c,t),g=r[p];n||(g>=Cr&&g<=Fr?g+=32:g>jn&&(g=String.fromCodePoint(g).toLowerCase().codePointAt(0)));let y=Nn(a,h,t),_=i[y];if(g===_&&(a--,a<0)){l=m;break}}if(!t){let m=l;l=c-u,u=c-m}let[f,d]=Gu(n,e,r,i,l,u,s);return[{start:l,end:u,score:f},d]}return[{start:-1,end:-1,score:0},null]},Dp=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];let a=r.length,l=i.length;if(a<l)return[{start:-1,end:-1,score:0},null];if(_a(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let u=0,c=-1,h=0,f=-1;for(let d=0;d<a;d++){let m=Nn(d,a,t),p=r[m];n||(p>=Cr&&p<=Fr?p+=32:p>jn&&(p=String.fromCodePoint(p).toLowerCase().codePointAt(0))),e&&(p=kr(p));let g=Nn(u,l,t);if(i[g]===p){if(g===0&&(h=Ip(r,m)),u++,u===l){if(h>f&&(c=d,f=h),h===un)break;d-=u-1,u=0,h=0}}else d-=u,u=0,h=0}if(c>=0){let d=0,m=0;t?(d=c-l+1,m=c+1):(d=a-(c+1),m=a-(c-l+1));let[p]=Gu(n,e,r,i,d,m,!1);return[{start:d,end:m,score:p},null]}return[{start:-1,end:-1,score:0},null]};var Op=100*1024,Lp=2048;function Rp(n,e){return{i16:new Int16Array(n),i32:new Int32Array(e)}}var Np=Rp(Op,Lp);var Yu=(n,e,t)=>{let r=!1;switch(e){case"smart-case":n.toLowerCase()!==n&&(r=!0);break;case"case-sensitive":r=!0;break;case"case-insensitive":n=n.toLowerCase(),r=!1;break}let i=Vu(n);return t&&(i=i.map(kr)),{queryRunes:i,caseSensitive:r}};function Ju(n,e){let t=Object.keys(n).map(i=>parseInt(i,10)).sort((i,s)=>s-i),r=[];for(let i of t)if(r=r.concat(n[i]),r.length>=e)break;return r}function Qu(n,e,t){return r=>{let i=this.runesList[r];if(e.length>i.length)return;let[s,o]=this.algoFn(t,this.opts.normalize,this.opts.forward,i,e,!0,Np);if(s.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let l=s.start;l<s.end;++l)o.add(l)}let a=this.opts.sort?s.score:0;n[a]===void 0&&(n[a]=[]),n[a].push({item:this.items[r],...s,positions:o!=null?o:new Set})}}function jp(n){let{queryRunes:e,caseSensitive:t}=Yu(n,this.opts.casing,this.opts.normalize),r={},i=Qu.bind(this)(r,e,t);for(let s=0,o=this.runesList.length;s<o;++s)i(s);return Ju(r,this.opts.limit)}var Bp=typeof require!="undefined"&&typeof window=="undefined";function zp(n,e,t,r){return new Promise((i,s)=>{let a=0,l=Math.min(1e3,e),u=()=>{if(n.cancelled)return s("search cancelled");for(;a<l;++a)t(a);l<e?(l=Math.min(l+1e3,e),Bp?setImmediate(u):setTimeout(u)):i(r())};u()})}function Vp(n,e){let{queryRunes:t,caseSensitive:r}=Yu(n,this.opts.casing,this.opts.normalize),i={};return zp(e,this.runesList.length,Qu.bind(this)(i,t,r),()=>Ju(i,this.opts.limit))}var ba={limit:1/0,selector:n=>n,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0},ma=class{constructor(e,...t){switch(this.opts={...ba,...t[0]},this.items=e,this.runesList=e.map(r=>Vu(this.opts.selector(r).normalize())),this.algoFn=Dp,this.opts.fuzzy){case"v2":this.algoFn=Mp;break;case"v1":this.algoFn=Xu;break}}},qy={...ba,match:jp};var Kp={...ba,match:Vp},ga=class extends ma{constructor(e,...t){super(e,...t),this.opts={...Kp,...t[0]},this.token={cancelled:!1}}async find(e){if(this.token.cancelled=!0,this.token={cancelled:!1},e.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(Up);e=e.normalize();let t=await this.opts.match.bind(this)(e,this.token);return $p(t,this.opts)}},Up=n=>({item:n,start:-1,end:-1,score:0,positions:new Set});function $p(n,e){if(e.sort){let{selector:t}=e;n.sort((r,i)=>{if(r.score===i.score)for(let s of e.tiebreakers){let o=s(r,i,t);if(o!==0)return o}return 0})}return Number.isFinite(e.limit)&&n.splice(e.limit),n}var Qi=class{constructor(e,...t){this.finder=new ga(e,...t),this.find=this.finder.find.bind(this.finder)}};var fe=function(){return fe=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},fe.apply(this,arguments)};function Wp(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,e||[])).next())})}function Hp(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function J(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ge(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}var qp="ENTRIES",rc="KEYS",ic="VALUES",Te="",wa=function(){function n(e,t){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:r,keys:i}]:[]}return n.prototype.next=function(){var e=this.dive();return this.backtrack(),e},n.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=Bn(this._path),t=e.node,r=e.keys;if(Bn(r)===Te)return{done:!1,value:this.result()};var i=t.get(Bn(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},n.prototype.backtrack=function(){if(this._path.length!==0){var e=Bn(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},n.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var t=e.keys;return Bn(t)}).filter(function(e){return e!==Te}).join("")},n.prototype.value=function(){return Bn(this._path).node.get(Te)},n.prototype.result=function(){switch(this._type){case ic:return this.value();case rc:return this.key();default:return[this.key(),this.value()]}},n.prototype[Symbol.iterator]=function(){return this},n}(),Bn=function(n){return n[n.length-1]},Gp=function(n,e,t){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,s=i+t,o=new Uint8Array(s*i).fill(t+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return sc(n,e,t,r,o,1,i,""),r},sc=function(n,e,t,r,i,s,o,a){var l,u,c=s*o;try{e:for(var h=J(n.keys()),f=h.next();!f.done;f=h.next()){var d=f.value;if(d===Te){var m=i[c-1];m<=t&&r.set(a,[n.get(d),m])}else{for(var p=s,g=0;g<d.length;++g,++p){for(var y=d[g],_=o*p,x=_-o,w=i[_],S=Math.max(0,p-t-1),T=Math.min(o-1,p+t),C=S;C<T;++C){var P=y!==e[C],I=i[x+C]+ +P,j=i[x+C+1]+1,M=i[_+C]+1,O=i[_+C+1]=Math.min(I,j,M);O<w&&(w=O)}if(w>t)continue e}sc(n.get(d),e,t,r,i,p,o,a+d)}}}catch(D){l={error:D}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}},xa=function(){function n(e,t){e===void 0&&(e=new Map),t===void 0&&(t=""),this._size=void 0,this._tree=e,this._prefix=t}return n.prototype.atPrefix=function(e){var t,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=ge(es(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=ge(Ia(o),2),l=a[0],u=a[1];try{for(var c=J(l.keys()),h=c.next();!h.done;h=c.next()){var f=h.value;if(f!==Te&&f.startsWith(u)){var d=new Map;return d.set(f.slice(u.length),l.get(f)),new n(d,e)}}}catch(m){t={error:m}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}return new n(s,e)},n.prototype.clear=function(){this._size=void 0,this._tree.clear()},n.prototype.delete=function(e){return this._size=void 0,Xp(this._tree,e)},n.prototype.entries=function(){return new wa(this,qp)},n.prototype.forEach=function(e){var t,r;try{for(var i=J(this),s=i.next();!s.done;s=i.next()){var o=ge(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.fuzzyGet=function(e,t){return Gp(this._tree,e,t)},n.prototype.get=function(e){var t=Ca(this._tree,e);return t!==void 0?t.get(Te):void 0},n.prototype.has=function(e){var t=Ca(this._tree,e);return t!==void 0&&t.has(Te)},n.prototype.keys=function(){return new wa(this,rc)},n.prototype.set=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=Ea(this._tree,e);return r.set(Te,t),this},Object.defineProperty(n.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),n.prototype.update=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=Ea(this._tree,e);return r.set(Te,t(r.get(Te))),this},n.prototype.fetch=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=Ea(this._tree,e),i=r.get(Te);return i===void 0&&r.set(Te,i=t()),i},n.prototype.values=function(){return new wa(this,ic)},n.prototype[Symbol.iterator]=function(){return this.entries()},n.from=function(e){var t,r,i=new n;try{for(var s=J(e),o=s.next();!o.done;o=s.next()){var a=ge(o.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},n.fromObject=function(e){return n.from(Object.entries(e))},n}(),es=function(n,e,t){var r,i;if(t===void 0&&(t=[]),e.length===0||n==null)return[n,t];try{for(var s=J(n.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==Te&&e.startsWith(a))return t.push([n,a]),es(n.get(a),e.slice(a.length),t)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return t.push([n,e]),es(void 0,"",t)},Ca=function(n,e){var t,r;if(e.length===0||n==null)return n;try{for(var i=J(n.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==Te&&e.startsWith(o))return Ca(n.get(o),e.slice(o.length))}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},Ea=function(n,e){var t,r,i=e.length;e:for(var s=0;n&&s<i;){try{for(var o=(t=void 0,J(n.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==Te&&e[s]===l[0]){for(var u=Math.min(i-s,l.length),c=1;c<u&&e[s+c]===l[c];)++c;var h=n.get(l);if(c===l.length)n=h;else{var f=new Map;f.set(l.slice(c),h),n.set(e.slice(s,s+c),f),n.delete(l),n=f}s+=c;continue e}}}catch(m){t={error:m}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}var d=new Map;return n.set(e.slice(s),d),d}return n},Xp=function(n,e){var t=ge(es(n,e),2),r=t[0],i=t[1];if(r!==void 0){if(r.delete(Te),r.size===0)oc(i);else if(r.size===1){var s=ge(r.entries().next().value,2),o=s[0],a=s[1];ac(i,o,a)}}},oc=function(n){if(n.length!==0){var e=ge(Ia(n),2),t=e[0],r=e[1];if(t.delete(r),t.size===0)oc(n.slice(0,-1));else if(t.size===1){var i=ge(t.entries().next().value,2),s=i[0],o=i[1];s!==Te&&ac(n.slice(0,-1),s,o)}}},ac=function(n,e,t){if(n.length!==0){var r=ge(Ia(n),2),i=r[0],s=r[1];i.set(s+e,t),i.delete(s)}},Ia=function(n){return n[n.length-1]},Mr,ka="or",lc="and",Yp="and_not",ts=function(){function n(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var t=e.autoVacuum==null||e.autoVacuum===!0?Aa:e.autoVacuum;this._options=fe(fe(fe({},Ta),e),{autoVacuum:t,searchOptions:fe(fe({},Zu),e.searchOptions||{}),autoSuggestOptions:fe(fe({},tm),e.autoSuggestOptions||{})}),this._index=new xa,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Pa,this.addFields(this._options.fields)}return n.prototype.add=function(e){var t,r,i,s,o,a,l=this._options,u=l.extractField,c=l.tokenize,h=l.processTerm,f=l.fields,d=l.idField,m=u(e,d);if(m==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(m))throw new Error("MiniSearch: duplicate ID ".concat(m));var p=this.addDocumentId(m);this.saveStoredFields(p,e);try{for(var g=J(f),y=g.next();!y.done;y=g.next()){var _=y.value,x=u(e,_);if(x!=null){var w=c(x.toString(),_),S=this._fieldIds[_],T=new Set(w).size;this.addFieldLength(p,S,this._documentCount-1,T);try{for(var C=(i=void 0,J(w)),P=C.next();!P.done;P=C.next()){var I=P.value,j=h(I,_);if(Array.isArray(j))try{for(var M=(o=void 0,J(j)),O=M.next();!O.done;O=M.next()){var D=O.value;this.addTerm(S,p,D)}}catch(z){o={error:z}}finally{try{O&&!O.done&&(a=M.return)&&a.call(M)}finally{if(o)throw o.error}}else j&&this.addTerm(S,p,j)}}catch(z){i={error:z}}finally{try{P&&!P.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}}}}catch(z){t={error:z}}finally{try{y&&!y.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}},n.prototype.addAll=function(e){var t,r;try{for(var i=J(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.addAllAsync=function(e,t){var r=this;t===void 0&&(t={});var i=t.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,h,f){var d=c.chunk,m=c.promise;return d.push(h),(f+1)%s===0?{chunk:[],promise:m.then(function(){return new Promise(function(p){return setTimeout(p,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:m}},o),l=a.chunk,u=a.promise;return u.then(function(){return r.addAll(l)})},n.prototype.remove=function(e){var t,r,i,s,o,a,l=this._options,u=l.tokenize,c=l.processTerm,h=l.extractField,f=l.fields,d=l.idField,m=h(e,d);if(m==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var p=this._idToShortId.get(m);if(p==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(m,": it is not in the index"));try{for(var g=J(f),y=g.next();!y.done;y=g.next()){var _=y.value,x=h(e,_);if(x!=null){var w=u(x.toString(),_),S=this._fieldIds[_],T=new Set(w).size;this.removeFieldLength(p,S,this._documentCount,T);try{for(var C=(i=void 0,J(w)),P=C.next();!P.done;P=C.next()){var I=P.value,j=c(I,_);if(Array.isArray(j))try{for(var M=(o=void 0,J(j)),O=M.next();!O.done;O=M.next()){var D=O.value;this.removeTerm(S,p,D)}}catch(z){o={error:z}}finally{try{O&&!O.done&&(a=M.return)&&a.call(M)}finally{if(o)throw o.error}}else j&&this.removeTerm(S,p,j)}}catch(z){i={error:z}}finally{try{P&&!P.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}}}}catch(z){t={error:z}}finally{try{y&&!y.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}this._storedFields.delete(p),this._documentIds.delete(p),this._idToShortId.delete(m),this._fieldLength.delete(p),this._documentCount-=1},n.prototype.removeAll=function(e){var t,r;if(e)try{for(var i=J(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new xa,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},n.prototype.discard=function(e){var t=this,r=this._idToShortId.get(e);if(r==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(r),this._storedFields.delete(r),(this._fieldLength.get(r)||[]).forEach(function(i,s){t.removeFieldLength(r,s,t._documentCount,i)}),this._fieldLength.delete(r),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},n.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,t=e.minDirtFactor,r=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:r,minDirtFactor:t})}},n.prototype.discardAll=function(e){var t,r,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=J(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},n.prototype.replace=function(e){var t=this._options,r=t.idField,i=t.extractField,s=i(e,r);this.discard(s),this.add(e)},n.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},n.prototype.conditionalVacuum=function(e,t){var r=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=r._enqueuedVacuumConditions;return r._enqueuedVacuumConditions=Pa,r.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},n.prototype.performVacuuming=function(e,t){return Wp(this,void 0,void 0,function(){var r,i,s,o,a,l,u,c,h,f,d,m,p,g,y,_,x,w,S,T,C,P,I,j,M;return Hp(this,function(O){switch(O.label){case 0:if(r=this._dirtCount,!this.vacuumConditionsMet(t))return[3,10];i=e.batchSize||Fa.batchSize,s=e.batchWait||Fa.batchWait,o=1,O.label=1;case 1:O.trys.push([1,7,8,9]),a=J(this._index),l=a.next(),O.label=2;case 2:if(l.done)return[3,6];u=ge(l.value,2),c=u[0],h=u[1];try{for(f=(P=void 0,J(h)),d=f.next();!d.done;d=f.next()){m=ge(d.value,2),p=m[0],g=m[1];try{for(y=(j=void 0,J(g)),_=y.next();!_.done;_=y.next())x=ge(_.value,1),w=x[0],!this._documentIds.has(w)&&(g.size<=1?h.delete(p):g.delete(w))}catch(D){j={error:D}}finally{try{_&&!_.done&&(M=y.return)&&M.call(y)}finally{if(j)throw j.error}}}}catch(D){P={error:D}}finally{try{d&&!d.done&&(I=f.return)&&I.call(f)}finally{if(P)throw P.error}}return this._index.get(c).size===0&&this._index.delete(c),o%i!==0?[3,4]:[4,new Promise(function(D){return setTimeout(D,s)})];case 3:O.sent(),O.label=4;case 4:o+=1,O.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return S=O.sent(),T={error:S},[3,9];case 8:try{l&&!l.done&&(C=a.return)&&C.call(a)}finally{if(T)throw T.error}return[7];case 9:this._dirtCount-=r,O.label=10;case 10:return[4,null];case 11:return O.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},n.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var t=e.minDirtCount,r=e.minDirtFactor;return t=t||Aa.minDirtCount,r=r||Aa.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=r},Object.defineProperty(n.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),n.prototype.has=function(e){return this._idToShortId.has(e)},n.prototype.getStoredFields=function(e){var t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)},n.prototype.search=function(e,t){var r,i;t===void 0&&(t={});var s=this.executeQuery(e,t),o=[];try{for(var a=J(s),l=a.next();!l.done;l=a.next()){var u=ge(l.value,2),c=u[0],h=u[1],f=h.score,d=h.terms,m=h.match,p=d.length||1,g={id:this._documentIds.get(c),score:f*p,terms:Object.keys(m),queryTerms:d,match:m};Object.assign(g,this._storedFields.get(c)),(t.filter==null||t.filter(g))&&o.push(g)}}catch(y){r={error:y}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return e===n.wildcard&&t.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(tc),o},n.prototype.autoSuggest=function(e,t){var r,i,s,o;t===void 0&&(t={}),t=fe(fe({},this._options.autoSuggestOptions),t);var a=new Map;try{for(var l=J(this.search(e,t)),u=l.next();!u.done;u=l.next()){var c=u.value,h=c.score,f=c.terms,d=f.join(" "),m=a.get(d);m!=null?(m.score+=h,m.count+=1):a.set(d,{score:h,terms:f,count:1})}}catch(S){r={error:S}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var p=[];try{for(var g=J(a),y=g.next();!y.done;y=g.next()){var _=ge(y.value,2),m=_[0],x=_[1],h=x.score,f=x.terms,w=x.count;p.push({suggestion:m,terms:f,score:h/w})}}catch(S){s={error:S}}finally{try{y&&!y.done&&(o=g.return)&&o.call(g)}finally{if(s)throw s.error}}return p.sort(tc),p},Object.defineProperty(n.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),n.loadJSON=function(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)},n.getDefault=function(e){if(Ta.hasOwnProperty(e))return Sa(Ta,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},n.loadJS=function(e,t){var r,i,s,o,a,l,u=e.index,c=e.documentCount,h=e.nextId,f=e.documentIds,d=e.fieldIds,m=e.fieldLength,p=e.averageFieldLength,g=e.storedFields,y=e.dirtCount,_=e.serializationVersion;if(_!==1&&_!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var x=new n(t);x._documentCount=c,x._nextId=h,x._documentIds=Zi(f),x._idToShortId=new Map,x._fieldIds=d,x._fieldLength=Zi(m),x._avgFieldLength=p,x._storedFields=Zi(g),x._dirtCount=y||0,x._index=new xa;try{for(var w=J(x._documentIds),S=w.next();!S.done;S=w.next()){var T=ge(S.value,2),C=T[0],P=T[1];x._idToShortId.set(P,C)}}catch(me){r={error:me}}finally{try{S&&!S.done&&(i=w.return)&&i.call(w)}finally{if(r)throw r.error}}try{for(var I=J(u),j=I.next();!j.done;j=I.next()){var M=ge(j.value,2),O=M[0],D=M[1],z=new Map;try{for(var H=(a=void 0,J(Object.keys(D))),Y=H.next();!Y.done;Y=H.next()){var te=Y.value,ie=D[te];_===1&&(ie=ie.ds),z.set(parseInt(te,10),Zi(ie))}}catch(me){a={error:me}}finally{try{Y&&!Y.done&&(l=H.return)&&l.call(H)}finally{if(a)throw a.error}}x._index.set(O,z)}}catch(me){s={error:me}}finally{try{j&&!j.done&&(o=I.return)&&o.call(I)}finally{if(s)throw s.error}}return x},n.prototype.executeQuery=function(e,t){var r=this;if(t===void 0&&(t={}),e===n.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){var i=fe(fe(fe({},t),e),{queries:void 0}),s=e.queries.map(function(g){return r.executeQuery(g,i)});return this.combineResults(s,i.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,u=o.searchOptions,c=fe(fe({tokenize:a,processTerm:l},u),t),h=c.tokenize,f=c.processTerm,d=h(e).flatMap(function(g){return f(g)}).filter(function(g){return!!g}),m=d.map(em(c)),p=m.map(function(g){return r.executeQuerySpec(g,c)});return this.combineResults(p,c.combineWith)},n.prototype.executeQuerySpec=function(e,t){var r,i,s,o,a=fe(fe({},this._options.searchOptions),t),l=(a.fields||this._options.fields).reduce(function(te,ie){var me;return fe(fe({},te),(me={},me[ie]=Sa(a.boost,ie)||1,me))},{}),u=a.boostDocument,c=a.weights,h=a.maxFuzzy,f=a.bm25,d=fe(fe({},Zu.weights),c),m=d.fuzzy,p=d.prefix,g=this._index.get(e.term),y=this.termResults(e.term,e.term,1,g,l,u,f),_,x;if(e.prefix&&(_=this._index.atPrefix(e.term)),e.fuzzy){var w=e.fuzzy===!0?.2:e.fuzzy,S=w<1?Math.min(h,Math.round(e.term.length*w)):w;S&&(x=this._index.fuzzyGet(e.term,S))}if(_)try{for(var T=J(_),C=T.next();!C.done;C=T.next()){var P=ge(C.value,2),I=P[0],j=P[1],M=I.length-e.term.length;if(M){x==null||x.delete(I);var O=p*I.length/(I.length+.3*M);this.termResults(e.term,I,O,j,l,u,f,y)}}}catch(te){r={error:te}}finally{try{C&&!C.done&&(i=T.return)&&i.call(T)}finally{if(r)throw r.error}}if(x)try{for(var D=J(x.keys()),z=D.next();!z.done;z=D.next()){var I=z.value,H=ge(x.get(I),2),Y=H[0],M=H[1];if(M){var O=m*I.length/(I.length+M);this.termResults(e.term,I,O,Y,l,u,f,y)}}}catch(te){s={error:te}}finally{try{z&&!z.done&&(o=D.return)&&o.call(D)}finally{if(s)throw s.error}}return y},n.prototype.executeWildcardQuery=function(e){var t,r,i=new Map,s=fe(fe({},this._options.searchOptions),e);try{for(var o=J(this._documentIds),a=o.next();!a.done;a=o.next()){var l=ge(a.value,2),u=l[0],c=l[1],h=s.boostDocument?s.boostDocument(c,"",this._storedFields.get(u)):1;i.set(u,{score:h,terms:[],match:{}})}}catch(f){t={error:f}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},n.prototype.combineResults=function(e,t){if(t===void 0&&(t=ka),e.length===0)return new Map;var r=t.toLowerCase();return e.reduce(Jp[r])||new Map},n.prototype.toJSON=function(){var e,t,r,i,s=[];try{for(var o=J(this._index),a=o.next();!a.done;a=o.next()){var l=ge(a.value,2),u=l[0],c=l[1],h={};try{for(var f=(r=void 0,J(c)),d=f.next();!d.done;d=f.next()){var m=ge(d.value,2),p=m[0],g=m[1];h[p]=Object.fromEntries(g)}}catch(y){r={error:y}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}s.push([u,h])}}catch(y){e={error:y}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},n.prototype.termResults=function(e,t,r,i,s,o,a,l){var u,c,h,f,d;if(l===void 0&&(l=new Map),i==null)return l;try{for(var m=J(Object.keys(s)),p=m.next();!p.done;p=m.next()){var g=p.value,y=s[g],_=this._fieldIds[g],x=i.get(_);if(x!=null){var w=x.size,S=this._avgFieldLength[_];try{for(var T=(h=void 0,J(x.keys())),C=T.next();!C.done;C=T.next()){var P=C.value;if(!this._documentIds.has(P)){this.removeTerm(_,P,t),w-=1;continue}var I=o?o(this._documentIds.get(P),t,this._storedFields.get(P)):1;if(I){var j=x.get(P),M=this._fieldLength.get(P)[_],O=Zp(j,w,this._documentCount,M,S,a),D=r*y*I*O,z=l.get(P);if(z){z.score+=D,nm(z.terms,e);var H=Sa(z.match,t);H?H.push(g):z.match[t]=[g]}else l.set(P,{score:D,terms:[e],match:(d={},d[t]=[g],d)})}}}catch(Y){h={error:Y}}finally{try{C&&!C.done&&(f=T.return)&&f.call(T)}finally{if(h)throw h.error}}}}}catch(Y){u={error:Y}}finally{try{p&&!p.done&&(c=m.return)&&c.call(m)}finally{if(u)throw u.error}}return l},n.prototype.addTerm=function(e,t,r){var i=this._index.fetch(r,nc),s=i.get(e);if(s==null)s=new Map,s.set(t,1),i.set(e,s);else{var o=s.get(t);s.set(t,(o||0)+1)}},n.prototype.removeTerm=function(e,t,r){if(!this._index.has(r)){this.warnDocumentChanged(t,e,r);return}var i=this._index.fetch(r,nc),s=i.get(e);s==null||s.get(t)==null?this.warnDocumentChanged(t,e,r):s.get(t)<=1?s.size<=1?i.delete(e):s.delete(t):s.set(t,s.get(t)-1),this._index.get(r).size===0&&this._index.delete(r)},n.prototype.warnDocumentChanged=function(e,t,r){var i,s;try{for(var o=J(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===t){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype.addDocumentId=function(e){var t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t},n.prototype.addFields=function(e){for(var t=0;t<e.length;t++)this._fieldIds[e[t]]=t},n.prototype.addFieldLength=function(e,t,r,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[t]=i;var o=this._avgFieldLength[t]||0,a=o*r+i;this._avgFieldLength[t]=a/(r+1)},n.prototype.removeFieldLength=function(e,t,r,i){if(r===1){this._avgFieldLength[t]=0;return}var s=this._avgFieldLength[t]*r-i;this._avgFieldLength[t]=s/(r-1)},n.prototype.saveStoredFields=function(e,t){var r,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=J(o),c=u.next();!c.done;c=u.next()){var h=c.value,f=a(t,h);f!==void 0&&(l[h]=f)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}},n.wildcard=Symbol("*"),n}(),Sa=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0},Jp=(Mr={},Mr[ka]=function(n,e){var t,r;try{for(var i=J(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=n.get(o);if(a==null)n.set(o,e.get(o));else{var l=e.get(o),u=l.score,c=l.terms,h=l.match;a.score=a.score+u,a.match=Object.assign(a.match,h),ec(a.terms,c)}}}catch(f){t={error:f}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},Mr[lc]=function(n,e){var t,r,i=new Map;try{for(var s=J(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=n.get(a);if(l!=null){var u=e.get(a),c=u.score,h=u.terms,f=u.match;ec(l.terms,h),i.set(a,{score:l.score+c,terms:l.terms,match:Object.assign(l.match,f)})}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},Mr[Yp]=function(n,e){var t,r;try{for(var i=J(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;n.delete(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},Mr),Qp={k:1.2,b:.7,d:.5},Zp=function(n,e,t,r,i,s){var o=s.k,a=s.b,l=s.d,u=Math.log(1+(t-e+.5)/(e+.5));return u*(l+n*(o+1)/(n+o*(1-a+a*r/i)))},em=function(n){return function(e,t,r){var i=typeof n.fuzzy=="function"?n.fuzzy(e,t,r):n.fuzzy||!1,s=typeof n.prefix=="function"?n.prefix(e,t,r):n.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},Ta={idField:"id",extractField:function(n,e){return n[e]},tokenize:function(n){return n.split(rm)},processTerm:function(n){return n.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(n,e){typeof(console==null?void 0:console[n])=="function"&&console[n](e)},autoVacuum:!0},Zu={combineWith:ka,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Qp},tm={combineWith:lc,prefix:function(n,e,t){return e===t.length-1}},Fa={batchSize:1e3,batchWait:10},Pa={minDirtFactor:.1,minDirtCount:20},Aa=fe(fe({},Fa),Pa),nm=function(n,e){n.includes(e)||n.push(e)},ec=function(n,e){var t,r;try{for(var i=J(e),s=i.next();!s.done;s=i.next()){var o=s.value;n.includes(o)||n.push(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},tc=function(n,e){var t=n.score,r=e.score;return r-t},nc=function(){return new Map},Zi=function(n){var e,t,r=new Map;try{for(var i=J(Object.keys(n)),s=i.next();!s.done;s=i.next()){var o=s.value;r.set(parseInt(o,10),n[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},rm=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;function Dr(n,e,t){var r=t||{},i=r.noTrailing,s=i===void 0?!1:i,o=r.noLeading,a=o===void 0?!1:o,l=r.debounceMode,u=l===void 0?void 0:l,c,h=!1,f=0;function d(){c&&clearTimeout(c)}function m(g){var y=g||{},_=y.upcomingOnly,x=_===void 0?!1:_;d(),h=!x}function p(){for(var g=arguments.length,y=new Array(g),_=0;_<g;_++)y[_]=arguments[_];var x=this,w=Date.now()-f;if(h)return;function S(){f=Date.now(),e.apply(x,y)}function T(){c=void 0}!a&&u&&!c&&S(),d(),u===void 0&&w>n?a?(f=Date.now(),s||(c=setTimeout(u?T:S,n))):S():s!==!0&&(c=setTimeout(u?T:S,u===void 0?n-w:n))}return p.cancel=m,p}function uc(n,e,t){var r=t||{},i=r.atBegin,s=i===void 0?!1:i;return Dr(n,e,{debounceMode:s!==!1})}var Or=class{static minInSet(e){let t=Number.MAX_VALUE;for(let r of e)r<t&&(t=r);return t}},ns=class{constructor(e,t,r){this.flushThrottled=Dr(1e4,()=>this.forceFlush());this.elementsMap=new Map,this.handler=e,this.identifier=t,this.autoFlushThreshold=r}add(e){let t=this.identifier(e);this.elementsMap.set(t,e),this.elementsMap.size>=this.autoFlushThreshold&&this.flushThrottled()}async forceFlush(){if(this.elementsMap.size===0)return;let e=Array.from(this.elementsMap.values());this.elementsMap.clear(),await this.handler(e),A.debug("flushed")}},rs=class{constructor(e,t=Number.MAX_VALUE){this.heap=[],this.compare=e,this.capacity=t}values(){return this.heap}push(e){this.size()<this.capacity?(this.heap.push(e),this.heapifyUp()):this.compare(e,this.heap[0])>0&&(this.heap[0]=e,this.heapifyDown())}clear(){this.heap=[]}pop(){if(this.isEmpty())return;let e=this.heap[0];return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.heapifyDown(),e}peek(){return this.heap[0]}isEmpty(){return this.heap.length===0}size(){return this.heap.length}getLeftChildIndex(e){return 2*e+1}getRightChildIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}heapifyUp(){let e=this.heap.length-1;for(;this.getParentIndex(e)>=0&&this.compare(this.heap[this.getParentIndex(e)],this.heap[e])>0;)this.swap(this.getParentIndex(e),e),e=this.getParentIndex(e)}heapifyDown(){let e=0;for(;this.getLeftChildIndex(e)<this.heap.length;){let t=this.getLeftChildIndex(e);if(this.getRightChildIndex(e)<this.heap.length&&this.compare(this.heap[this.getRightChildIndex(e)],this.heap[t])<0&&(t=this.getRightChildIndex(e)),this.compare(this.heap[e],this.heap[t])<0)break;this.swap(e,t),e=t}}};var Ma=ue(de());var is=class{constructor(e){this.text=e}};var im=/[\u4e00-\u9fa5]/,cc=/[\u4e00-\u9fa5]/g,fc=/[\u4e00-\u9fa5]/,ss=class{static isLargeCharset(e){return(e.match(cc)||[]).length>=Math.ceil(e.length*.35)}static testWideChar(e){return im.test(e)}static wideCharProportion(e){return(e.match(cc)||[]).length/e.length}};var dc=ue(de());var sm=/[\[\]{}()<>\s]+/u,om=/[\^=#%\/\*,\.`:;\?@\s\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,am=/[-_]|([a-z](?=[A-Z]))/g,Ut=class{constructor(){this.setting=b(ae);this.chsSegmenter=b(st);this.logThrottled=Dr(300,e=>A.info(e));this.assetsProvider=b(ze);this.stopWordsZh=this.assetsProvider.assets.stopWordsZh;this.stopWordsEn=this.assetsProvider.assets.stopWordsEn}tokenize(e,t){var s,o;let r=new Set,i=e.split(sm);for(let a of i)if(a)if(this.setting.enableChinesePatch&&fc.test(a)){let l=this.chsSegmenter.cut(a,!0);for(let u of l){if(this.setting.enableStopWordsZh&&((s=this.stopWordsZh)!=null&&s.has(u))){t==="search"&&u.length>1&&A.debug(`excluded: ${u}`);continue}r.add(u)}}else{let l=a.split(om);for(let u of l)if(!(u.length<2||this.setting.enableStopWordsEn&&((o=this.stopWordsEn)!=null&&o.has(u)))&&(r.add(u),u.length>3)){let c=u.replace(am,"$1 ").split(" ");for(let h of c)h.length>1&&r.add(h)}}return Array.from(r).filter(a=>a.length<30)}};Ut=R([(0,dc.singleton)()],Ut);var cn=class{static forType(e,t){return t&&ss.testWideChar(t)?this.limitsByLanguage["\u7B80\u4F53\u4E2D\u6587"][e]:this.limitsByLanguage["English"][e]}},Ze=cn;Ze.default={line:{maxPreLines:0,maxPostLines:0,maxPreChars:30,maxPostChars:230,boundaryLineMinChars:4},paragraph:{maxPreLines:4,maxPostLines:7,maxPreChars:220,maxPostChars:600,boundaryLineMinChars:4},subItem:{maxPreLines:3,maxPostLines:3,maxPreChars:180,maxPostChars:200,boundaryLineMinChars:4}},Ze.limitsByLanguage={["Other Language"]:cn.default,["English"]:cn.default,["\u7B80\u4F53\u4E2D\u6587"]:{line:{...cn.default.line,maxPreChars:30,maxPostChars:230},paragraph:{...cn.default.paragraph,maxPreChars:220,maxPostChars:600},subItem:{...cn.default.subItem,maxPreChars:60,maxPostChars:80}}};var Ge=class{constructor(){this.option=b(Lr);this.pluginSetting=b(ae);this.filesIndex=new ts(this.option.fileIndexOption);this.linesIndex=new ts(this.option.lineIndexOption);this.tokenizer=b(Ut);this._isReady=!1}async reIndexAll(e){if(this._isReady=!1,this.filesIndex.removeAll(),Array.isArray(e))A.trace("Indexing all documents..."),await this.addDocuments(e);else{A.trace("Loading indexed data...");try{this.filesIndex=ts.loadJS(e,this.option.fileIndexOption)}catch(t){return A.error(t),!1}}return this._isReady=!0,A.trace(this.filesIndex),!0}get isReady(){return this._isReady}async addDocuments(e){let t=e.filter(r=>!this.filesIndex.has(r.path));await this.filesIndex.addAllAsync(t,{chunkSize:this.option.documentChunkSize}),A.debug(`added ${t.length}`)}deleteDocuments(e){let t=e.filter(r=>this.filesIndex.has(r));this.filesIndex.discardAll(t),A.debug(`deleted ${t.length}`)}async fzfMatch(e,t){return(await new Qi(t,{selector:i=>i.text}).find(e)).slice(0,this.pluginSetting.ui.maxItemResults).map(i=>({text:i.item.text,row:i.item.row,positions:i.positions}))}async searchFiles(e){let t="and",r=new is(e),i=this.filesIndex.search(r.text,this.option.getFileSearchOption(t));return A.debug(`maxFileItems: ${this.pluginSetting.ui.maxItemResults}`),i.slice(0,this.pluginSetting.ui.maxItemResults).map(s=>({path:s.id,queryTerms:s.queryTerms,matchedTerms:s.terms}))}async searchLinesByFileItem(e,t,r,i,s){A.debug(i.queryTerms),A.debug(i.matchedTerms);let o=50;return A.debug(`max subItems: ${o}`),new Rr(e,t,r,i.queryTerms,i.matchedTerms,s).parse()}async searchLinesForSmallCharset(e,t,r){this.linesIndex.removeAll(),this.linesIndex.addAll(e);let i=this.linesIndex.search(t,this.option.getLineSearchOption());return A.debug(`matched lines count: ${i.length}`),A.debug(`only parse top ${r} matched lines per file`),i.slice(0,r).map(s=>{let o=e[s.id].text;return{text:o,row:s.id,positions:this.findAllTermPositions(o,s.terms)}})}findAllTermPositions(e,t){let r=new RegExp(t.join("|"),"gi"),i=new Set,s,o=-1;for(;(s=r.exec(e))!==null;){if(s.index===o||s[0].length===0){r.lastIndex++;continue}for(let a=0;a<s[0].length;a++)i.add(s.index+a);o=s.index}return i}};R([Pe],Ge.prototype,"reIndexAll",1),R([Pe],Ge.prototype,"searchFiles",1),R([Pe],Ge.prototype,"searchLinesForSmallCharset",1),Ge=R([(0,Ma.singleton)()],Ge);var Lr=class{constructor(){this.inSetting=Ll.search;this.tokenizer=b(Ut);this.tokenizeIndex=e=>this.tokenizer.tokenize(e,"index");this.tokenizeSearch=e=>this.tokenizer.tokenize(e,"search");this.fileIndexOption={tokenize:this.tokenizeIndex,idField:"path",fields:["basename","aliases","folder","headings","content"],storeFields:["tags"]};this.lineIndexOption={tokenize:this.tokenizeIndex,idField:"row",fields:["text"]}}getFileSearchOption(e){return{tokenize:this.tokenizeSearch,prefix:t=>t.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:t=>t.length<=3?0:this.inSetting.fuzzyProportion,boost:{basename:this.inSetting.weightFilename,aliases:this.inSetting.weightFilename,folder:this.inSetting.weightFolder,tags:this.inSetting.weightTagText,headings:this.inSetting.weightHeading},combineWith:e}}getLineSearchOption(){return{prefix:e=>e.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:e=>e.length<=3?0:this.inSetting.fuzzyProportion,combineWith:"or"}}};Lr=R([(0,Ma.singleton)()],Lr);var Rr=class{constructor(e,t,r,i,s,o){this.lines=e,this.matchedTerms=this.filterMatchedTerms(i,s),this.maxParsedLines=o;let a=Ze.forType(t,r);this.preChars=a.maxPreChars,this.postChars=a.maxPostChars,A.debug(`doc matchedTerms: ${this.matchedTerms.join(" ")}`)}parse(){return this.highlightLines(this.getTopRelevantLines(this.lines,this.maxParsedLines))}filterMatchedTerms(e,t){let r=e.filter(s=>!e.some(o=>o.length>s.length&&o.includes(s))&&t.includes(s)),i;if(r.length===0)i=t.filter(s=>!t.some(o=>o.length>s.length&&o.includes(s)));else{i=r;for(let s of t)!r.includes(s)&&!this.isSubstringOrSuperString(s,t)&&i.push(s)}return i}isSubstringOrSuperString(e,t){return t.some(r=>r.length>e.length&&r.includes(e)||e.length>r.length&&e.includes(r))}getTopRelevantLines(e,t){let r=new RegExp(this.matchedTerms.join("|"),"i"),i=this.matchedTerms.map(l=>new RegExp(l,"gi")),s=new rs((l,u)=>l-u,t);s.push(0);let o=new Map,a=new Map;for(let l of e){if(!r.test(l.text))continue;a.clear();let u=0;for(let c of i){c.lastIndex=0;let h;for(;(h=c.exec(l.text))!==null;){let f=h[0],d=(a.get(f)||0)+1;a.set(f,d),u+=d===1?f.length:.01}}u>s.peek()&&(s.push(u),o.set(l,u))}return Array.from(o.entries()).sort((l,u)=>u[1]-l[1]).slice(0,t).map(l=>l[0])}highlightLines(e){let t=new Map;for(let r of this.matchedTerms)t.set(r,new RegExp(r,"gi"));return e.map(r=>{let i=new Set,s=-1,o=-1;for(let a=this.matchedTerms.length-1;a>=0;a--){let l=this.matchedTerms[a],u=r.text.search(t.get(l));if(u!==-1){s=Math.max(0,u-this.preChars),o=Math.min(r.text.length,u+l.length+this.postChars);break}}if(s!==-1&&o!==-1){let a=r.text.slice(s,o);for(let l of this.matchedTerms){let u=t.get(l),c;for(;(c=u.exec(a))!==null;){let h=c.index+s,f=h+c[0].length;for(let d=h;d<f;d++)i.add(d)}}}return{text:r.text,row:r.row,positions:i}})}};R([Pe],Rr.prototype,"getTopRelevantLines",1),R([Pe],Rr.prototype,"highlightLines",1);var Da=class{constructor(){this.listeners=new Map}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(t)}off(e,t){let r=this.listeners.get(e);if(r){let i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){var r;(r=this.listeners.get(e))==null||r.forEach(i=>{i(...t)})}},$t=new Da;var yc=ue(de());var et=require("obsidian");var Oa=ue(de());var Oe=class{constructor(){this.vault=b(et.Vault);this.app=b(et.App);this.setting=b(ae);this.privateApi=b(Me);this.viewRegistry=b(De);this.htmlParser=b(Nr);this.init()}init(){this.excludedPaths=new Set(this.setting.excludedPaths),this.supportedExtensions=new Set(this.setting.customExtensions.plaintext)}async generateAllIndexedDocuments(e){return Promise.all(e.map(async t=>{if(this.isContentIndexable(t)){let r=this.app.metadataCache.getFileCache(t);if(this.viewRegistry.viewTypeByPath(t.path)==="markdown")return{path:t.path,basename:t.basename,folder:ce.getFolderPath(t.path),aliases:this.parseAliases(r),tags:this.parseTags(r),headings:this.parseHeadings(r),content:await this.readPlainText(t)};throw new Error(Sn)}else return{path:t.path,basename:t.basename,folder:ce.getFolderPath(t.path)}}))}allFilesToBeIndexed(){let e=this.vault.getFiles();A.debug(`all files: ${e.length}`),ce.countFileByExtensions(e);let t=e.filter(r=>this.isIndexable(r));return A.debug(`indexable files: ${t.length}`),ce.countFileByExtensions(t),t}isIndexable(e){if(e instanceof et.TFolder)return!1;let t;return typeof e=="string"?t=e:t=e.path,this.supportedExtensions.has(ce.getExtension(t))&&t.lastIndexOf("excalidraw.md")===-1&&(this.setting.followObsidianExcludedFiles?this.privateApi.isNotObsidianExcludedPath(t):!0)&&(this.excludedPaths.size===0?!0:this.isNotCustomExcludedPath(t))}async readPlainText(e){let t=typeof e=="string"?this.vault.getAbstractFileByPath(e):e;if(t instanceof et.TFile)if(this.viewRegistry.viewTypeByPath(t.path)==="markdown"){let r=await this.vault.cachedRead(t);return t.extension==="html"?this.htmlParser.toMarkdown(r):r}else throw Error(`unsupported file extension as plain text to read, path: ${t.path}`);else return""}async readPlainTextLines(e){return(await this.readPlainText(e)).split(ce.SPLIT_EOL)}parseAliases(e){return((0,et.parseFrontMatterAliases)(e==null?void 0:e.frontmatter)||[]).join(" ")}parseTags(e){var t;return((t=e==null?void 0:e.tags)==null?void 0:t.map(r=>r.tag.slice(1)).join(" "))||""}parseHeadings(e){var t;return((t=e==null?void 0:e.headings)==null?void 0:t.map(r=>r.heading).join(" "))||""}isContentIndexable(e){return Oe.contentIndexableViewTypes.has(this.viewRegistry.viewTypeByPath(e.path))}isNotCustomExcludedPath(e){let t=e.split("/"),r="";for(let i of t)if(r+=(r?"/":"")+i,this.excludedPaths.has(r))return!1;return!0}};Oe.contentIndexableViewTypes=new Set(["markdown"]),Oe=R([(0,Oa.singleton)()],Oe);var Nr=class{constructor(){this.MARKDOWN_LINK_REGEX=/\[([^[\]]+)\]\([^()]*\)/g;this.MARKDOWN_ASTERISK_REGEX=/\*\*(.*?)\*\*/g;this.MARKDOWN_BACKTICK_REGEX=/`(.*?)`/g}toMarkdown(e){let t=(0,et.htmlToMarkdown)(e);return t=t.replace(this.MARKDOWN_LINK_REGEX,"$1"),t=t.replace(this.MARKDOWN_ASTERISK_REGEX,"$1"),t=t.replace(this.MARKDOWN_BACKTICK_REGEX,"$1"),t}};Nr=R([(0,Oa.singleton)()],Nr);var hc=require("obsidian");var pc=ue(de());var fn=class{constructor(){this.dataManager=b(Ke);this.app=b(hc.App);this.onCreate=e=>{A.debug(`created: ${e.path}`),this.dataManager.receiveDocOperation(new dn(e))};this.onDelete=e=>{A.debug(`deleted: ${e.path}`),this.dataManager.receiveDocOperation(new hn(e.path))};this.onRename=(e,t)=>{A.debug(`renamed: ${t} => ${e.path}`),this.dataManager.receiveDocOperation(new hn(t)),this.dataManager.receiveDocOperation(new dn(e))};this.onModify=e=>{A.debug(`modified: ${e.path}`),this.dataManager.receiveDocOperation(new hn(e.path)),this.dataManager.receiveDocOperation(new dn(e))}}start(){this.stop(),this.app.vault.on("create",this.onCreate),this.app.vault.on("delete",this.onDelete),this.app.vault.on("rename",this.onRename),this.app.vault.on("modify",this.onModify),A.trace("FileWatcher started")}stop(){this.app.vault.off("create",this.onCreate),this.app.vault.off("delete",this.onDelete),this.app.vault.off("rename",this.onRename),this.app.vault.off("modify",this.onModify)}};fn=R([(0,pc.singleton)()],fn);var Ke=class{constructor(){this.plugin=b(We);this.database=b(Vt);this.dataProvider=b(Oe);this.lexicalEngine=b(Ge);this.semanticEngine=b(Ve);this.semanticConfig=b(ae).semantic;this.shouldForceRefresh=!1;this.isLexicalEngineUpToDate=!1;this.isSemanticEngineUpToDate=!1;this.docOperationsHandler=async e=>{e.sort((t,r)=>t.time-r.time);for(let t of e)if(t instanceof dn)await this.addDocuments([t.file]);else if(t instanceof hn)await this.deleteDocuments([t.path]);else throw Error(wi)};this.docOperationsBuffer=new ns(this.docOperationsHandler,e=>e.path+e.type,3)}async initAsync(){await this.database.deleteOldDatabases(),await this.initLexicalEngine(),await this.initSemanticEngine(),this.shouldForceRefresh||(this.plugin.registerInterval(window.setInterval(()=>{this.isSemanticEngineUpToDate||this.initSemanticEngine()},3500)),$t.on(10,()=>this.docOperationsBuffer.forceFlush()),b(fn).start())}onunload(){b(fn).stop()}receiveDocOperation(e){this.docOperationsBuffer.add(e)}async refreshAllAsync(){let e=new ye(N("Reindexing..."));this.shouldForceRefresh=!0,await this.initAsync(),e.hide(),new ye(N("Indexing finished"),5e3),this.shouldForceRefresh=!1}async addDocuments(e,t=!1){if(e.length>0){let r=[];for(let s of e)s instanceof gc.TFile&&r.push(s);let i=await this.dataProvider.generateAllIndexedDocuments(r.filter(s=>this.dataProvider.isIndexable(s)));t?this.semanticConfig.isEnabled&&await this.semanticEngine.addDocuments(i):await this.lexicalEngine.addDocuments(i)}}async deleteDocuments(e,t=!1){if(e.length>0){let r=e.filter(i=>this.dataProvider.isIndexable(i));t?this.semanticConfig.isEnabled&&await this.semanticEngine.deleteDocuments(r):this.lexicalEngine.deleteDocuments(r)}}async initLexicalEngine(){A.trace("Init lexical engine...");let e;!ir.loadIndexFromDatabase||this.shouldForceRefresh?e=null:e=await this.database.getMiniSearchData(),e?(this.database.deleteMinisearchData(),A.trace("Previous minisearch data is found."),await this.lexicalEngine.reIndexAll(e)||(new ye(N("Database has been updated, a reindex is required"),7e3),await this.reindexLexicalEngineWithCurrFiles())):await this.reindexLexicalEngineWithCurrFiles(),this.isLexicalEngineUpToDate||await this.updateDocRefByMtime(!1),A.trace("Lexical engine is ready"),await this.database.setMiniSearchData(this.lexicalEngine.filesIndex.toJSON())}async reindexLexicalEngineWithCurrFiles(){A.trace("Indexing the whole vault...");let e=this.dataProvider.allFilesToBeIndexed(),t=0;for(let i of e)t+=i.stat.size;if(t/=1024,t>2e3){let i=(t/1024).toFixed(2)+" MB";new ye(`${i} ${N("files need to be indexed. Obsidian may freeze for a while")}`,7e3)}let r=await this.dataProvider.generateAllIndexedDocuments(e);await this.lexicalEngine.reIndexAll(r),this.isLexicalEngineUpToDate=!0}async updateDocRefByMtime(e){let t=new Map(this.dataProvider.allFilesToBeIndexed().map(a=>[a.path,a])),r=e?await this.database.getSemanticDocRefs():await this.database.getLexicalDocRefs(),i=new Map(r==null?void 0:r.map(a=>[a.path,a])),s=[],o=[];for(let[a,l]of t){let u=i.get(a);u?l.stat.mtime>u.updateTime&&(o.push(l.path),s.push(l)):s.push(l)}for(let a of i.keys())t.has(a)||o.push(a);A.trace(`docs to delete: ${o.length}`),A.trace(`docs to add: ${s.length}`),await this.deleteDocuments(o,e),await this.addDocuments(s,e),await this.saveDocRefs(Array.from(t.values()),e)}async saveDocRefs(e,t){let r=e.map(i=>({path:i.path,updateTime:i.stat.mtime}));t?(await this.database.setSemanticDocRefs(r),A.trace(`${r.length} semantic refs updated`)):(await this.database.setLexicalDocRefs(r),A.trace(`${r.length} lexical refs updated`))}async initSemanticEngine(){if(this.semanticConfig.isEnabled){let e=await this.semanticEngine.doesCollectionExist();if(e===null)return;if(e===!1||this.shouldForceRefresh){let t=null;this.semanticConfig.serverType==="local"&&(t=new ye(N("Semantic init time"),0));let r=this.dataProvider.allFilesToBeIndexed();await this.saveDocRefs(r,!0);let i=await this.dataProvider.generateAllIndexedDocuments(r);await this.semanticEngine.reindexAll(i),t&&t.hide(),new ye(N("Semantic init finished"),0),this.isSemanticEngineUpToDate=!0}this.isSemanticEngineUpToDate||(this.isSemanticEngineUpToDate=!0,await this.updateDocRefByMtime(!0)),A.trace("Semantic engine is ready")}}};R([Pe],Ke.prototype,"initAsync",1),Ke=R([(0,yc.singleton)()],Ke);var os=class{constructor(e,t){this.time=performance.now();this.type=e,typeof t=="string"?this.path=t:this.path=t.path}},dn=class extends os{constructor(t){super("add",t);this.file=t}},hn=class extends os{constructor(e){super("delete",e)}};var tt=class{constructor(){this.plugin=b(We);this.shouldReload=!1}async initAsync(){await this.loadSettings(),pn.container.register(ae,{useValue:this.setting}),this.plugin.addSettingTab(b(jr))}async saveSettings(){await this.plugin.saveData(this.setting)}async postSettingUpdated(){this.saveSettings(),this.shouldReload&&(this.shouldReload=!1,await this.downloadAndRefresh())}async loadSettings(){this.setting=dt.mergeDeep(Ol,await this.plugin.loadData()),A.setLevel(this.setting.logLevel)}async downloadAndRefresh(){b(De).refreshAll(),await b(ze).initAsync(),await b(st).initAsync(),b(Oe).init(),await b(Ke).refreshAllAsync()}};tt=R([(0,pn.singleton)()],tt);var jr=class extends G.PluginSettingTab{constructor(t){super(t.app,t);this.settingManager=b(tt);this.setting=b(ae)}hide(){this.settingManager.postSettingUpdated()}display(){let{containerEl:t}=this;t.empty(),new G.Setting(t).setName(N("Max items count")).setDesc(N("Max items count desc")).addSlider(a=>a.setLimits(1,300,1).setValue(this.setting.ui.maxItemResults).setDynamicTooltip().onChange(l=>{this.setting.ui.maxItemResults=l})),new G.Setting(t).setName(N("Floating window for in-file search")).setDesc(N("Floating window for in-file search desc")).addToggle(a=>a.setValue(this.setting.ui.floatingWindowForInFile).onChange(l=>this.setting.ui.floatingWindowForInFile=l)),new G.Setting(t).setName(N("English word blacklist")).setDesc(N("English word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsEn).onChange(l=>{this.setting.enableStopWordsEn=l,this.settingManager.shouldReload=!0})),new G.Setting(t).setName(N("Chinese patch")).setDesc(N("Chinese patch desc")).addToggle(a=>a.setValue(this.setting.enableChinesePatch).onChange(async l=>{this.setting.enableChinesePatch=l,A.info(`enable chinese: ${b(ae).enableChinesePatch}`),this.settingManager.shouldReload=!0})),new G.Setting(t).setName(N("Chinese word blacklist")).setDesc(N("Chinese word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsZh).onChange(async l=>{this.setting.enableStopWordsZh=l,this.settingManager.shouldReload=!0})),new G.Setting(t).setName(N("Advanced")).setDesc(N("Advanced.desc")),new G.Setting(t).setName(N("Semantic search")).addButton(a=>a.setButtonText(N("Manage")).onClick(()=>new Na(b(G.App)).open())),new G.Setting(t).setName(N("Excluded files")).addButton(a=>a.setButtonText(N("Manage")).onClick(()=>{new La(b(G.App)).open()})),new G.Setting(t).setName(N("Customize extensions")).addButton(a=>a.setButtonText(N("Manage")).onClick(()=>new Ra(b(G.App)).open())),new G.Setting(t).setName(N("Reindex the vault")).addButton(a=>{a.setButtonText(N("Reindex")).onClick(async()=>{await b(Ke).refreshAllAsync()})});let r=t.createDiv("cs-dev-setting-group");r.style.marginTop="1.5em";let i=r.createDiv({cls:"cs-setting-group-dev-title",text:N("For Development")}),s=r.createDiv({cls:"cs-setting-group-dev-content"}),o=this.setting.ui.collapseDevSettingByDefault;s.style.display=o?"none":"block",i.style.setProperty("--cs-dev-collapse-icon",o?eo:to),i.onclick=()=>{let a=s.style.display==="none";s.style.display=a?"block":"none",i.style.setProperty("--cs-dev-collapse-icon",a?to:eo)},new G.Setting(s).setName(N("Collapse development setting by default")).addToggle(a=>a.setValue(this.setting.ui.collapseDevSettingByDefault).onChange(l=>{this.setting.ui.collapseDevSettingByDefault=l})),new G.Setting(s).setName(N("Log level")).addDropdown(a=>a.addOptions({trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",none:"none"}).setValue(this.setting.logLevel.toLowerCase()).onChange(async l=>{let u=l;A.setLevel(u),this.setting.logLevel=u})),new G.Setting(s).setName(N("Reset floating window position")).setDesc(N("Reset floating window position desc")).addButton(a=>a.setButtonText(N("Reset position")).onClick(l=>{b(Ue).resetAllPositions()})),new G.Setting(s).setName(N("Support the Project")).setDesc(N("Support the Project desc")).addButton(a=>{a.setButtonText(N("Visit GitHub")).onClick(()=>{window.open("https://github.com/yan42685/obsidian-clever-search","_blank")})}),new G.Setting(s).setName("API provider1").setDesc("domain and key").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider1.domain).onChange(l=>{this.setting.apiProvider1.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider1.key).onChange(l=>{this.setting.apiProvider1.key=l})),new G.Setting(s).setName("API provider2").setDesc("description").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider2.domain).onChange(l=>{this.setting.apiProvider2.domain=l})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider2.key).onChange(l=>{this.setting.apiProvider2.key=l}))}};jr=R([(0,pn.singleton)(),Yr(0,(0,pn.inject)(We))],jr);var La=class extends G.Modal{constructor(t){super(t);this.settingManager=b(tt);this.setting=b(ae);this.excludedPaths=this.setting.excludedPaths;this.allPaths=new Set;this.allFolders=new Set;let r=b(G.Vault).getAllLoadedFiles();for(let i of r)this.allPaths.add(i.path),i instanceof G.TFolder&&this.allFolders.add(i.path)}onOpen(){var r;this.modalEl.style.width="48vw",this.modalEl.style.marginBottom="5em",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new G.Setting(t).setName(N("Follow Obsidian Excluded Files")).addToggle(i=>i.setValue(this.setting.followObsidianExcludedFiles).onChange(s=>{this.setting.followObsidianExcludedFiles=s,this.settingManager.shouldReload=!0})),t.createEl("h2",{text:N("Excluded files")}),this.excludesEl=t.createDiv(),this.renderExcludedList(this.excludesEl),new G.Setting(t).addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder(N("Enter path...")).onChange(s=>{this.suggester.close(),this.suggester.open()})}).addButton(i=>{i.setButtonText(N("Add")).onClick(()=>{this.addPath(this.inputEl.value)})}),this.suggester=new xi(this.inputEl,this.allFolders,i=>{this.addPath(i)}),setTimeout(()=>{this.inputEl.focus()},1)}renderExcludedList(t){t.empty(),this.excludedPaths.forEach((r,i)=>{let s=t.createDiv();s.style.overflow="auto",s.style.display="flex",s.style.margin="0.7em 0 0.7em 0",s.style.justifyContent="space-between";let o=s.createSpan();o.setText(r),o.style.width="90%",o.style.overflow="auto";let a=s.createSpan();a.setText("\u2715"),a.style.cursor="pointer",a.onClickEvent(()=>{this.excludedPaths.splice(i,1),this.settingManager.shouldReload=!0,this.renderExcludedList(t)})})}addPath(t){t&&!this.excludedPaths.includes(t)&&(this.allPaths.has(t)?(this.excludedPaths.push(t),this.settingManager.shouldReload=!0,this.renderExcludedList(this.excludesEl)):new ye(`Path doesn't exist: ${t}`,5e3))}},Ra=class extends G.Modal{constructor(){super(...arguments);this.setting=b(ae);this.settingManager=b(tt)}onOpen(){var r;this.modalEl.style.width="60vw",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new G.Setting(t).setDesc(N("extensionModal.desc")),new G.Setting(t).setName(N("extensionModal.plaintextName")).setDesc(N("extensionModal.plaintextDesc")).addTextArea(i=>{i.inputEl.style.minWidth="20vw",i.inputEl.style.minHeight="20vh",i.setValue(this.setting.customExtensions.plaintext.join(" ")),i.onChange(s=>{let o=s.split(/[\s\n]+/).map(a=>a.startsWith(".")?a.substring(1):a).filter(a=>a.length>0);this.setting.customExtensions.plaintext=o,this.settingManager.shouldReload=!0})}),new G.Setting(t).setName("Image").setDesc("Todo")}},Na=class extends G.Modal{constructor(){super(...arguments);this.semanticEngine=b(Ve);this.setting=b(ae).semantic;this.settingManager=b(tt);this.needInitSemanticEngine=!1}onOpen(){var r;this.modalEl.style.width="50vw",this.modalEl.style.height="55vh",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new G.Setting(t).setName(N("Introduction")).setDesc(N("Introduction.desc")),new G.Setting(t).setName(N("Enable")).addToggle(i=>i.setValue(this.setting.isEnabled).onChange(s=>{this.setting.isEnabled=s,s===!0&&(this.needInitSemanticEngine=!0)})),new G.Setting(t).setName(N("Server type")).setDesc(N("Server type.desc")).addDropdown(i=>i.addOptions({local:N("local")}).setValue(this.setting.serverType).onChange(s=>this.setting.serverType=s)),new G.Setting(t).setName(N("Utilities")).addButton(i=>i.setButtonText(N("Test connection")).onClick(()=>this.semanticEngine.testConnection())).addButton(i=>i.setButtonText(N("Download")).onClick(()=>b(ze).downloadAiHelper())),new G.Setting(t).setName(N("Additional Information")).setDesc(N("Additional Information.desc"))}onClose(){this.needInitSemanticEngine&&(this.needInitSemanticEngine=!1,b(Ke).initSemanticEngine())}};var Xa=ue(de());function Wt(){}function Va(n){return n()}function vc(){return Object.create(null)}function mt(n){n.forEach(Va)}function as(n){return typeof n=="function"}function bc(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function wc(n){return Object.keys(n).length===0}var xc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,zr=class{constructor(e){this.options=e,this._listeners="WeakMap"in xc?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(t=>{var r;for(let i of t)zr.entries.set(i.target,i),(r=this._listeners.get(i.target))===null||r===void 0||r(i)})}};zr.entries="WeakMap"in xc?new WeakMap:void 0;var Ec=!1;function lm(){Ec=!0}function um(){Ec=!1}function Ae(n,e){n.appendChild(e)}function Sc(n,e,t){let r=cm(n);if(!r.getElementById(e)){let i=_e("style");i.id=e,i.textContent=t,fm(r,i)}}function cm(n){if(!n)return document;let e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function fm(n,e){return Ae(n.head||n,e),e.sheet}function Xe(n,e,t){n.insertBefore(e,t||null)}function $e(n){n.parentNode&&n.parentNode.removeChild(n)}function Ka(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function _e(n){return document.createElement(n)}function dm(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function Ur(n){return document.createTextNode(n)}function Un(){return Ur(" ")}function Ua(){return Ur("")}function lt(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function be(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function hm(n){return Array.from(n.childNodes)}function $a(n,e){e=""+e,n.data!==e&&(n.data=e)}function Wa(n,e){n.value=e==null?"":e}function $r(n,e,t){n.classList[t?"add":"remove"](e)}var ls=class{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=dm(t.nodeName):this.e=_e(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)Xe(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach($e)}};var Vr;function Br(n){Vr=n}function pm(){if(!Vr)throw new Error("Function called outside component initialization");return Vr}function cs(n){pm().$$.on_destroy.push(n)}var Vn=[];var Kr=[],Kn=[],_c=[],Tc=Promise.resolve(),Ba=!1;function Ac(){Ba||(Ba=!0,Tc.then(Cc))}function Wr(){return Ac(),Tc}function za(n){Kn.push(n)}var ja=new Set,zn=0;function Cc(){if(zn!==0)return;let n=Vr;do{try{for(;zn<Vn.length;){let e=Vn[zn];zn++,Br(e),mm(e.$$)}}catch(e){throw Vn.length=0,zn=0,e}for(Br(null),Vn.length=0,zn=0;Kr.length;)Kr.pop()();for(let e=0;e<Kn.length;e+=1){let t=Kn[e];ja.has(t)||(ja.add(t),t())}Kn.length=0}while(Vn.length);for(;_c.length;)_c.pop()();Ba=!1,ja.clear(),Br(n)}function mm(n){if(n.fragment!==null){n.update(),mt(n.before_update);let e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(za)}}function gm(n){let e=[],t=[];Kn.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Kn=e}var ym=new Set;function vm(n,e){n&&n.i&&(ym.delete(n),n.i(e))}var _m=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],__=new Set([..._m]);function bm(n,e,t,r){let{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),r||za(()=>{let o=n.$$.on_mount.map(Va).filter(as);n.$$.on_destroy?n.$$.on_destroy.push(...o):mt(o),n.$$.on_mount=[]}),s.forEach(za)}function Fc(n,e){let t=n.$$;t.fragment!==null&&(gm(t.after_update),mt(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function wm(n,e){n.$$.dirty[0]===-1&&(Vn.push(n),Ac(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Pc(n,e,t,r,i,s,o,a=[-1]){let l=Vr;Br(n);let u=n.$$={fragment:null,ctx:[],props:s,update:Wt,not_equal:i,bound:vc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:vc(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let c=!1;if(u.ctx=t?t(n,e.props||{},(h,f,...d)=>{let m=d.length?d[0]:f;return u.ctx&&i(u.ctx[h],u.ctx[h]=m)&&(!u.skip_bound&&u.bound[h]&&u.bound[h](m),c&&wm(n,h)),f}):[],u.update(),c=!0,mt(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){lm();let h=hm(e.target);u.fragment&&u.fragment.l(h),h.forEach($e)}else u.fragment&&u.fragment.c();e.intro&&vm(n.$$.fragment),bm(n,e.target,e.anchor,e.customElement),um(),Cc()}Br(l)}var xm;typeof HTMLElement=="function"&&(xm=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:n}=this.$$;this.$$.on_disconnect=n.map(Va).filter(as);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(n,e,t){this[n]=t}disconnectedCallback(){mt(this.$$.on_disconnect)}$destroy(){Fc(this,1),this.$destroy=Wt}$on(n,e){if(!as(e))return Wt;let t=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return t.push(e),()=>{let r=t.indexOf(e);r!==-1&&t.splice(r,1)}}$set(n){this.$$set&&!wc(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}});var us=class{$destroy(){Fc(this,1),this.$destroy=Wt}$on(e,t){if(!as(t))return Wt;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!wc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};function mn(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,e||[])).next())})}var kc=require("obsidian");var Mc=ue(de());var Ic=ue(de());var $n=class{constructor(){this.lexicalEngine=b(Ge)}parseAll(e,t,r,i){return t.map(s=>{let o=Or.minInSet(s.positions),a=s.row,l=this.getTruncatedContext(e,a,o,r),u=l.matchedLineText,c=s.positions;s.row===l.lines[0].row&&(c=this.adjustPositionsByStartCol(c,l.firstLineStartCol));let h=this.highlightMatchedLine(u,c,i),f=l.lines.map(d=>d.row===a?h:d.text).join(ce.JOIN_EOL);return{row:s.row,col:o,text:f}})}parse(e,t,r,i){return this.parseAll(e,[t],r,i)[0]}async parseLineItems(e,t){let r=t.replace(/\s/g,""),i=[],s=await this.lexicalEngine.fzfMatch(r,e);for(let o of s){let a=o.row,l=Or.minInSet(o.positions),u=e[a].text,c=Math.max(l-30,0),h=Math.min(c+200,u.length),f=u.substring(c,h),d=this.adjustPositionsByStartCol(o.positions,c),m=this.highlightLineByCharPositions(f,d),p=await this.getLineHighlightedContext(e,a,l,t);i.push(new Bt({text:m,row:a,col:l},p))}return i}highlightMatchedLine(e,t,r){return r?`<span class="matched-line highlight-bg">${this.highlightLineByCharPositions(e,t)}</span>`:`<span class="matched-line">${this.highlightLineByCharPositions(e,t)}</span>`}highlightContextLine(e,t){let r=new RegExp(t,"gi");return e.replace(r,i=>`<mark>${i}</mark>`)}highlightLineByCharPositions(e,t){return e.split("").map((r,i)=>t.has(i)?`<mark>${r}</mark>`:r).join("")}adjustPositionsByStartCol(e,t){let r=new Set;return e.forEach(i=>{i>=t&&r.add(i-t)}),r}getTruncatedContext(e,t,r,i){if(e.length===0)return{lines:[],firstLineStartCol:0,matchedLineText:""};let s=i,o,a=0,l=0,u=e[t].text;if(r<s.maxPreChars){let c=this.extendContextAbove(e,t-1,s.maxPreChars-r,s.maxPreLines,s.boundaryLineMinChars);o=c.lines,a=c.firstLineStartCol;let h=Math.min(u.length-1,r+s.maxPostChars);h<u.length-1?(u=u.substring(0,h+1),o.push({text:u,row:t})):o.push(e[t]),l+=h-r}else{let c=r-s.maxPreChars;a=c;let h=Math.min(u.length-1,r+s.maxPostChars);h<u.length-1?u=u.substring(c,h+1):u=u.substring(c),o=[{text:u,row:t}],l+=h-r}return dt.append(o,this.extendContextBelow(e,t+1,s.maxPostChars-l,s.maxPostLines,s.boundaryLineMinChars)),{lines:o,firstLineStartCol:a,matchedLineText:u}}extendContextAbove(e,t,r,i,s){let o=0,a=t,l=0,u=[];for(;a>=0&&t-a<i;){let c=e[a].text;if(l+c.length<r)u.unshift(e[a]),l+=c.length,--a;else if(l+c.length==r){u.unshift(e[a]);break}else{let h=l+c.length-r;o=h;let f=e[a].text.substring(h);u.unshift({text:f,row:a});break}}return u.length>0&&u[0].text.length<s&&(o=0,u.shift()),{lines:u,firstLineStartCol:o}}extendContextBelow(e,t,r,i,s){let o=t,a=0,l=[];for(;o<=e.length-1&&o-t<i;){let u=e[o].text;if(a+u.length<r)l.push(e[o]),a+=u.length,++o;else if(a+u.length==r){l.push(e[o]);break}else{let c=u.length-(a+u.length-r)-1,h=e[o].text.substring(0,c+1);l.push({text:h,row:o});break}}return l.length>0&&l[0].text.length<s&&l.pop(),l}async getLineHighlightedContext(e,t,r,i){let s=dt.getCurrLanguage(),o=this.getTruncatedContext(e,t,r,Ze.forType("paragraph")),a=o.lines;return(await Promise.all(a.map(async(u,c)=>{if(u.row===t){let h=await this.lexicalEngine.fzfMatch(i,[u]);try{let d=h[0].positions;return c===0&&(d=this.adjustPositionsByStartCol(d,o.firstLineStartCol)),this.highlightMatchedLine(u.text,d,!0)}catch(f){A.warn("There might be inconsistency with previous search step, which lead to a missed match to target line"),A.error(f)}}else return this.highlightContextLine(u.text,i)}))).join(ce.JOIN_EOL)}};$n=R([(0,Ic.singleton)()],$n);var ut=class{constructor(){this.app=b(kc.App);this.dataProvider=b(Oe);this.lexicalEngine=b(Ge);this.semanticEngine=b(Ve);this.lineHighlighter=b($n);this.viewRegistry=b(De)}async searchInVault(e){var o;let t=new Ct("no result",[]);if(e.length===0)return t;let r=((o=this.app.workspace.getActiveFile())==null?void 0:o.path)||"no source path",i=await this.lexicalEngine.searchFiles(e),s=[];return i.length!==0?{sourcePath:r,items:i.map(a=>new zt(0,a.path,a.queryTerms,a.matchedTerms,[],"nothing"))}:(A.trace("lexical matched files count is 0"),t)}async searchInVaultSemantic(e){var r;let t=new Ct("no result",[]);if(e.length===0)return t;{let s={sourcePath:((r=this.app.workspace.getActiveFile())==null?void 0:r.path)||"no source path",items:await this.semanticEngine.search(e.trim(),"markdown")};return A.debug(s),s}}async getFileSubItems(e,t){let r=t.path;if(this.viewRegistry.viewTypeByPath(r)!=="markdown")return A.warn(`view type for path "${r}" is not supported for sub-items.`),[];let s=(await this.dataProvider.readPlainText(r)).split(ce.SPLIT_EOL).map((l,u)=>new Rn(l,u));A.debug("target file lines count: ",s.length);let o=await this.lexicalEngine.searchLinesByFileItem(s,"subItem",e,t,30);return this.lineHighlighter.parseAll(s,o,Ze.forType("subItem",e),!1).map(l=>({text:l.text,row:l.row,col:l.col}))}async searchInFile(e){let t=new Ct("",[]),r=this.app.workspace.getActiveFile();if(!e||!r)return t;if(this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return A.trace("Current file isn't PLAINT_TEXT"),t;let i=(await this.dataProvider.readPlainTextLines(r.path)).map((l,u)=>new Rn(l,u)),s=e.replace(/\s/g,""),a=(await this.lexicalEngine.fzfMatch(s,i)).map(l=>{let u=this.lineHighlighter.parse(i,l,Ze.forType("line"),!1),c=this.lineHighlighter.parse(i,l,Ze.forType("paragraph"),!0);return new Bt(u,c.text)});return{sourcePath:r.path,items:a}}async deprecatedSearchInFile(e){let t=new Ct("",[]),r=this.app.workspace.getActiveFile();if(!e||!r||this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return t;let i=r.path,s=(await this.dataProvider.readPlainTextLines(i)).map((a,l)=>new Rn(a,l)),o=await this.lineHighlighter.parseLineItems(s,e);return{sourcePath:i,items:o}}};R([Pe],ut.prototype,"searchInVault",1),R([Pe],ut.prototype,"getFileSubItems",1),R([Pe],ut.prototype,"searchInFile",1),R([Pe],ut.prototype,"deprecatedSearchInFile",1),ut=R([(0,Mc.singleton)()],ut);var Ht=require("obsidian");var Dc=ue(de());var Wn=class{constructor(){this.app=b(Ht.App);this.privateApi=b(Me);this.setting=b(ae)}updateSubItemIndex(e,t,r){let i=e[t],s=e.length-1;return this.scrollTo("center",i,"auto"),r==="next"?t<s?t+1:t:t>0?t-1:t}async handleConfirmAsync(e,t,r,i,s){if(e(),i)if(r===1){let o=i;await this.jumpInVaultAsync(t,o.line.row,o.line.col)}else if(r===2){let o=i,a=o.viewType;if(s!==-1){let l=o.subItems[s];if(a==="markdown")await this.jumpInVaultAsync(o.path,l.row,l.col);else throw Error("unsupported viewType to jump")}else await this.jumpInVaultAsync(o.path,0,0)}else throw Error(`unsupported search type to jump ${r}`)}scrollTo(e,t,r){setTimeout(()=>{t&&t.element&&t.element.scrollIntoView({behavior:r,block:e})},0)}focusInput(){setTimeout(()=>{let e=document.getElementById("cs-search-input");e==null||e.focus()},0)}showNoResult(e){if(e){if(!this.setting.semantic.isEnabled)return"Semantic search need to be enabled at the setting tab";let t=b(Ve).status;return t==="ready"?"No matched content":`Semantic engine is ${t}`}else return"No matched content"}insertFileLinkToActiveMarkdown(e){if(e){let t=this.app.workspace.getActiveViewOfType(Ht.MarkdownView);if(!(t!=null&&t.file)){A.info("No markdown view to insert file link");return}let r=b(Ht.Vault).getAbstractFileByPath(e),i=this.app.fileManager.generateMarkdownLink(r,t.file.path);t.editor.replaceSelection(i+`
`)}}async jumpInVaultAsync(e,t,r){let i=!1;this.app.workspace.iterateAllLeaves(s=>{var o;s.view instanceof Ht.MarkdownView&&((o=s.getViewState().state)==null?void 0:o.file)===e&&(this.app.workspace.setActiveLeaf(s,{focus:!0}),i=!0)}),i?this.scrollIntoViewForExistingView(t,r):(await this.app.workspace.openLinkText(e,"",this.setting.ui.openInNewPane),this.scrollIntoViewForExistingView(t,r))}scrollIntoViewForExistingView(e,t){this.privateApi.executeCommandById("editor:focus");let r=this.app.workspace.getActiveViewOfType(Ht.MarkdownView),i={line:e,ch:t};if(r){let s=r.getState();s.mode="source",r.setState(s,{history:!1}),r.editor.setCursor(i),this.app.workspace.onLayoutReady(()=>{r.editor.scrollIntoView({from:i,to:i},!0),setTimeout(()=>{r.editor.scrollIntoView({from:i,to:i},!0),this.privateApi.executeCommandById("editor:focus")},1)})}else A.info("No markdown view to jump")}};Wn=R([(0,Dc.singleton)()],Wn);function Em(n){Sc(n,"svelte-1k7yxfd",`div.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd,button.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{user-select:text}.search-container.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{display:flex;white-space:pre-wrap;overflow-wrap:break-word}.search-container mark{background-color:var(--cs-highlight-bgc, rgba(219, 204, 149, 0.9));color:var(--cs-highlight-char-color, #111)}.left-pane.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{display:flex;flex-direction:column;align-items:left;width:27.5vw}.search-bar.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{position:sticky;top:-0.2em;left:0;width:97%;height:30px}.search-bar.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd::after{content:attr(data-match-count);position:absolute;right:0.6em;top:1.4em;font-size:0.8em;transform:translateY(-50%);color:var(--cs-hint-char-color, grey)}.search-bar.svelte-1k7yxfd input.svelte-1k7yxfd.svelte-1k7yxfd{width:100%;padding:8px 12px;border:none;border-radius:10px;background-color:var(--cs-search-bar-bgc, #20202066);box-shadow:0 2px 4px rgba(0, 0, 0, 0.07),
			0 2px 3px rgba(0, 0, 0, 0.1)}.result-items.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{display:flex;flex-direction:column;height:70vh;margin-top:0.15em}.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd.svelte-1k7yxfd{padding:0 0.5em 0 0;margin-bottom:0;width:97%;overflow-x:hidden}.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd button.svelte-1k7yxfd{align-items:center;justify-content:left;padding:0.65em;margin:0.5em 0 0 0.15em;width:25.35vw;height:fit-content;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;cursor:pointer}.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd button.svelte-1k7yxfd:hover,.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd button.selected.svelte-1k7yxfd{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.result-items.svelte-1k7yxfd ul button .line-item.svelte-1k7yxfd.svelte-1k7yxfd,.result-items.svelte-1k7yxfd ul button .file-item.svelte-1k7yxfd.svelte-1k7yxfd{text-wrap:wrap;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.result-items.svelte-1k7yxfd ul button .file-item.svelte-1k7yxfd.svelte-1k7yxfd{-webkit-line-clamp:6}.result-items.svelte-1k7yxfd ul button .file-item span.filename.svelte-1k7yxfd.svelte-1k7yxfd{margin-top:-0.2em;display:block}.result-items.svelte-1k7yxfd ul button .file-item span.file-folder-path.svelte-1k7yxfd.svelte-1k7yxfd{color:var(--cs-secondary-font-color, #a29c9c);display:block}.right-pane.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{background-color:var(--cs-pane-bgc, #20202066);border-radius:6px;height:73.97vh;width:60%}.right-pane.svelte-1k7yxfd button.svelte-1k7yxfd.svelte-1k7yxfd{white-space:pre-wrap}.right-pane.svelte-1k7yxfd .preview-container.svelte-1k7yxfd.svelte-1k7yxfd{margin:0.7em 0 0 0.7em;height:72.5vh;overflow-y:auto}.right-pane.svelte-1k7yxfd .preview-container p.svelte-1k7yxfd.svelte-1k7yxfd,.right-pane.svelte-1k7yxfd .preview-container ul.svelte-1k7yxfd.svelte-1k7yxfd{margin:0;padding:0;overflow-x:hidden}.right-pane.svelte-1k7yxfd .preview-container p.svelte-1k7yxfd.svelte-1k7yxfd{width:39.7vw}.right-pane.svelte-1k7yxfd .preview-container ul button.file-sub-item.svelte-1k7yxfd.svelte-1k7yxfd{text-wrap:wrap;display:block;text-overflow:ellipsis;justify-content:left;margin-bottom:1em;height:fit-content;width:39.2vw;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;font-size:medium}.right-pane.svelte-1k7yxfd .preview-container ul button.file-sub-item.selected.svelte-1k7yxfd.svelte-1k7yxfd{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.right-pane.svelte-1k7yxfd .preview-container.svelte-1k7yxfd span.matched-line{display:inline-block;width:100%}.right-pane.svelte-1k7yxfd .preview-container.svelte-1k7yxfd span.matched-line.highlight-bg{background-color:var(--cs-hint-char-color, #468eeb33)}`)}function Oc(n,e,t){let r=n.slice();return r[40]=e[t],r[41]=e,r[42]=t,r}function Lc(n,e,t){let r=n.slice();return r[43]=e[t],r[44]=e,r[42]=t,r}function Sm(n){let e,t,r=n[43].basename+no+(n[43].extension==="md"?"":n[43].extension)+"",i,s,o=n[43].folderPath+"",a;return{c(){e=_e("span"),t=_e("span"),i=Un(),s=_e("span"),a=Ur(o),be(t,"class","filename svelte-1k7yxfd"),be(s,"class","file-folder-path svelte-1k7yxfd"),be(e,"class","file-item svelte-1k7yxfd")},m(l,u){Xe(l,e,u),Ae(e,t),t.innerHTML=r,Ae(e,i),Ae(e,s),Ae(s,a)},p(l,u){u[0]&16&&r!==(r=l[43].basename+no+(l[43].extension==="md"?"":l[43].extension)+"")&&(t.innerHTML=r),u[0]&16&&o!==(o=l[43].folderPath+"")&&$a(a,o)},d(l){l&&$e(e)}}}function Tm(n){let e,t=n[43].line.text+"";return{c(){e=_e("span"),be(e,"class","line-item svelte-1k7yxfd")},m(r,i){Xe(r,e,i),e.innerHTML=t},p(r,i){i[0]&16&&t!==(t=r[43].line.text+"")&&(e.innerHTML=t)},d(r){r&&$e(e)}}}function Rc(n){let e,t,r=n[44],i=n[42],s,o;function a(p,g){if(p[43]instanceof Bt)return Tm;if(p[43]instanceof zt)return Sm}let l=a(n,[-1,-1]),u=l&&l(n),c=()=>n[18](e,r,i),h=()=>n[18](null,r,i);function f(...p){return n[19](n[42],...p)}function d(...p){return n[20](n[42],...p)}function m(...p){return n[21](n[42],...p)}return{c(){e=_e("button"),u&&u.c(),t=Un(),be(e,"class","svelte-1k7yxfd"),$r(e,"selected",n[42]===n[5])},m(p,g){Xe(p,e,g),u&&u.m(e,null),Ae(e,t),c(),s||(o=[lt(e,"click",f),lt(e,"contextmenu",d),lt(e,"dblclick",m)],s=!0)},p(p,g){n=p,l===(l=a(n,g))&&u?u.p(n,g):(u&&u.d(1),u=l&&l(n),u&&(u.c(),u.m(e,t))),(r!==n[44]||i!==n[42])&&(h(),r=n[44],i=n[42],c()),g[0]&32&&$r(e,"selected",n[42]===n[5])},d(p){p&&$e(e),u&&u.d(),h(),s=!1,mt(o)}}}function Nc(n){let e,t;function r(o,a){if(o[3]===1)return Cm;if(o[3]===2)return Am}let i=r(n,[-1,-1]),s=i&&i(n);return{c(){e=_e("div"),t=_e("div"),s&&s.c(),be(t,"class","preview-container svelte-1k7yxfd"),be(e,"class","right-pane svelte-1k7yxfd")},m(o,a){Xe(o,e,a),Ae(e,t),s&&s.m(t,null)},p(o,a){i===(i=r(o,a))&&s?s.p(o,a):(s&&s.d(1),s=i&&i(o),s&&(s.c(),s.m(t,null)))},d(o){o&&$e(e),s&&s.d()}}}function Am(n){let e;function t(s,o){return s[7]&&s[7].viewType==="markdown"?Pm:Fm}let r=t(n,[-1,-1]),i=r(n);return{c(){i.c(),e=Ua()},m(s,o){i.m(s,o),Xe(s,e,o)},p(s,o){r===(r=t(s,o))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&$e(e)}}}function Cm(n){let e,t=n[6]&&Bc(n);return{c(){t&&t.c(),e=Ua()},m(r,i){t&&t.m(r,i),Xe(r,e,i)},p(r,i){r[6]?t?t.p(r,i):(t=Bc(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){t&&t.d(r),r&&$e(e)}}}function Fm(n){let e,t=n[11].showNoResult(n[0])+"",r;return{c(){e=_e("span"),r=Ur(t)},m(i,s){Xe(i,e,s),Ae(e,r)},p(i,s){s[0]&1&&t!==(t=i[11].showNoResult(i[0])+"")&&$a(r,t)},d(i){i&&$e(e)}}}function Pm(n){let e,t=n[8],r=[];for(let i=0;i<t.length;i+=1)r[i]=jc(Oc(n,t,i));return{c(){e=_e("ul");for(let i=0;i<r.length;i+=1)r[i].c();be(e,"class","svelte-1k7yxfd")},m(i,s){Xe(i,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null)},p(i,s){if(s[0]&49920){t=i[8];let o;for(o=0;o<t.length;o+=1){let a=Oc(i,t,o);r[o]?r[o].p(a,s):(r[o]=jc(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=t.length}},d(i){i&&$e(e),Ka(r,i)}}}function jc(n){let e,t,r=n[40].text+"",i,s=n[41],o=n[42],a,l;function u(...m){return n[24](n[42],...m)}function c(...m){return n[25](n[42],...m)}function h(...m){return n[26](n[42],...m)}let f=()=>n[27](e,s,o),d=()=>n[27](null,s,o);return{c(){e=_e("button"),t=new ls(!1),i=Un(),t.a=i,be(e,"class","file-sub-item svelte-1k7yxfd"),$r(e,"selected",n[42]===n[9])},m(m,p){Xe(m,e,p),t.m(r,e),Ae(e,i),f(),a||(l=[lt(e,"click",u),lt(e,"contextmenu",c),lt(e,"dblclick",h)],a=!0)},p(m,p){n=m,p[0]&256&&r!==(r=n[40].text+"")&&t.p(r),(s!==n[41]||o!==n[42])&&(d(),s=n[41],o=n[42],f()),p[0]&512&&$r(e,"selected",n[42]===n[9])},d(m){m&&$e(e),d(),a=!1,mt(l)}}}function Bc(n){let e,t,r;return{c(){e=_e("p"),be(e,"class","svelte-1k7yxfd")},m(i,s){Xe(i,e,s),e.innerHTML=n[6],t||(r=[lt(e,"contextmenu",n[22]),lt(e,"dblclick",n[23])],t=!0)},p(i,s){s[0]&64&&(e.innerHTML=i[6])},d(i){i&&$e(e),t=!1,mt(r)}}}function Im(n){let e,t,r,i,s,o,a,l,u,c,h=n[4].items,f=[];for(let m=0;m<h.length;m+=1)f[m]=Rc(Lc(n,h,m));let d=n[2]!=="floatingWindow"&&Nc(n);return{c(){e=_e("div"),t=_e("div"),r=_e("div"),i=_e("input"),s=Un(),o=_e("div"),a=_e("ul");for(let m=0;m<f.length;m+=1)f[m].c();l=Un(),d&&d.c(),be(i,"id","cs-search-input"),be(i,"class","svelte-1k7yxfd"),be(r,"class","search-bar svelte-1k7yxfd"),be(r,"data-match-count",n[10]),be(a,"class","svelte-1k7yxfd"),be(o,"class","result-items svelte-1k7yxfd"),be(t,"class","left-pane svelte-1k7yxfd"),be(e,"class","search-container svelte-1k7yxfd")},m(m,p){Xe(m,e,p),Ae(e,t),Ae(t,r),Ae(r,i),Wa(i,n[1]),Ae(t,s),Ae(t,o),Ae(o,a);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(a,null);Ae(e,l),d&&d.m(e,null),u||(c=[lt(i,"input",n[17]),lt(i,"input",n[12])],u=!0)},p(m,p){if(p[0]&2&&i.value!==m[1]&&Wa(i,m[1]),p[0]&1024&&be(r,"data-match-count",m[10]),p[0]&41012){h=m[4].items;let g;for(g=0;g<h.length;g+=1){let y=Lc(m,h,g);f[g]?f[g].p(y,p):(f[g]=Rc(y),f[g].c(),f[g].m(a,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=h.length}m[2]!=="floatingWindow"?d?d.p(m,p):(d=Nc(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:Wt,o:Wt,d(m){m&&$e(e),Ka(f,m),d&&d.d(),u=!1,mt(c)}}}function km(n,e,t){let r,i=b(ut),s=b(Wn),{uiType:o}=e,{onConfirmExternal:a}=e,{searchType:l}=e,{isSemantic:u}=e,{queryText:c}=e,h=new Map,f=new Ct("",[]),d=-1,m="",p=null,g=[],y,_=-1;function x(B){return mn(this,void 0,void 0,function*(){yield Wr();let ee=f.items;if(B>=0&&B<ee.length){if(t(5,d=B),l===1){let xe=ee[B];t(6,m=xe.context)}else if(l===2)t(7,p=ee[B]),u||t(7,p.subItems=yield i.getFileSubItems(c,p),p),t(8,g=p.subItems),t(9,_=g.length>0?0:-1),yield Wr(),s.scrollTo("start",g[_],"instant");else throw Error(`unsupported search type: ${l}`);yield Wr(),s.scrollTo("center",ee[B],"smooth")}else t(6,m=""),t(7,p=null),t(8,g=[]),t(5,d=-1),t(9,_=-1)})}let w=uc(100,()=>S());function S(){return mn(this,void 0,void 0,function*(){if(h.has(c)){t(4,f=h.get(c)),yield x(0);return}if(l===1)t(4,f=yield i.searchInFile(c));else if(l===2)t(4,f=u?yield i.searchInVaultSemantic(c):yield i.searchInVault(c));else throw Error(Sn);h.set(c,f),yield x(0)})}function T(B){return mn(this,void 0,void 0,function*(){yield x(B)})}function C(){return mn(this,void 0,void 0,function*(){yield x(Math.min(d+1,f.items.length-1)),o==="floatingWindow"&&O(null)})}function P(){return mn(this,void 0,void 0,function*(){yield x(Math.max(d-1,0)),o==="floatingWindow"&&O(null)})}function I(B){t(9,_=B)}function j(){t(9,_=s.updateSubItemIndex(g,_,"next"))}function M(){t(9,_=s.updateSubItemIndex(g,_,"prev"))}function O(B){return mn(this,void 0,void 0,function*(){B==null||B.preventDefault();let ee=f.items[d];yield s.handleConfirmAsync(a,f.sourcePath,l,ee,_)})}function D(){h.delete(c),t(0,u=!u),S()}function z(){s.insertFileLinkToActiveMarkdown(p==null?void 0:p.path)}cs(()=>{A.trace("mounted element has been destroyed.")});function H(B,ee){$t.on(B,ee),cs(()=>{$t.off(B,ee)})}o==="floatingWindow"?(H(3,C),H(6,P)):(H(2,C),H(5,P),H(4,j),H(7,M),H(8,O),H(9,D),H(11,z)),s.focusInput(),S();function Y(){c=this.value,t(1,c)}function te(B,ee,xe){Kr[B?"unshift":"push"](()=>{ee[xe].element=B,t(4,f)})}let ie=(B,ee)=>{T(B),o==="floatingWindow"&&O(null)},me=async(B,ee)=>{await T(B),await O(ee)},ct=async(B,ee)=>{await T(B),await O(ee)},ne=B=>O(B),$=B=>O(B),Z=(B,ee)=>I(B),q=(B,ee)=>{t(9,_=B),O(ee)},Ce=(B,ee)=>{t(9,_=B),O(ee)};function Le(B,ee,xe){Kr[B?"unshift":"push"](()=>{ee[xe].element=B,t(8,g)})}return n.$$set=B=>{"uiType"in B&&t(2,o=B.uiType),"onConfirmExternal"in B&&t(16,a=B.onConfirmExternal),"searchType"in B&&t(3,l=B.searchType),"isSemantic"in B&&t(0,u=B.isSemantic),"queryText"in B&&t(1,c=B.queryText)},n.$$.update=()=>{if(n.$$.dirty[0]&48){e:t(10,r=`${d+1} / ${f.items.length}`)}},[u,c,o,l,f,d,m,p,g,_,r,s,w,T,I,O,a,Y,te,ie,me,ct,ne,$,Z,q,Ce,Le]}var qa=class extends us{constructor(e){super(),Pc(this,e,km,Im,bc,{uiType:2,onConfirmExternal:16,searchType:3,isSemantic:0,queryText:1},Em,[-1,-1])}},fs=qa;var Ue=class{toggle(e){if(e==="inFile")b(Hn).toggle();else throw Error(Sn)}resetAllPositions(){let e=b(ae).ui;e.inFileFloatingWindowLeft="2.7em",e.inFileFloatingWindowTop="2.5em",b(Ue).toggle("inFile"),b(Ue).toggle("inFile")}onunload(){b(Hn).onClose()}};Ue=R([(0,Xa.singleton)()],Ue);var Ga=class{constructor(){this.isDragging=!1;this.dragStartX=0;this.dragStartY=0;this.uiSetting=b(ae).ui;this.mountedElement=null;this.onClose=()=>{var e,t;document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),(e=this.mountedElement)==null||e.$destroy(),this.mountedElement=null,(t=this.containerEl)==null||t.remove()};this.handleMouseDown=e=>{this.isDragging=!0,this.containerEl.style.opacity="0.75",this.dragStartX=e.pageX-this.containerEl.offsetLeft,this.dragStartY=e.pageY-this.containerEl.offsetTop,e.preventDefault()};this.handleMouseMove=e=>{this.isDragging&&(this.containerEl.style.left=`${e.pageX-this.dragStartX}px`,this.containerEl.style.top=`${e.pageY-this.dragStartY}px`)};this.handleMouseUp=()=>{this.isDragging=!1,this.containerEl.style.opacity="1",this.saveContainerElStates(),b(tt).postSettingUpdated()}}toggle(){if(this.mountedElement!==null)return this.onClose(),this;this.containerEl=document.body.createDiv(),this.frameEl=this.containerEl.createDiv(),this.contentEl=this.containerEl.createDiv(),this.frameEl.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.containerEl.addClass("cs-floating-window-container"),this.containerEl.style.position="fixed",this.loadContainerElStates(),this.containerEl.style.zIndex="20",this.containerEl.style.border="1px solid #454545",this.containerEl.style.borderRadius="10px",this.containerEl.style.overflow="hidden",this.containerEl.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",this.frameEl.style.width="100%",this.frameEl.style.height="20px",this.frameEl.style.backgroundColor="#333",this.frameEl.style.cursor="move",this.frameEl.style.color="#fff",this.frameEl.style.display="flex",this.frameEl.style.alignItems="center",this.frameEl.style.justifyContent="right",this.frameEl.style.padding="10px 0 10px 10px";let e=this.frameEl.createSpan();return e.innerText="\u2716",e.style.cursor="pointer",e.style.fontSize="13px",e.style.margin="5px",e.addEventListener("click",this.onClose),this.contentEl.style.padding="10px 0 10px 10px",this.mountComponent(),this}},Hn=class extends Ga{mountComponent(){this.mountedElement=new fs({target:this.contentEl,props:{uiType:"floatingWindow",onConfirmExternal:()=>{},searchType:1,isSemantic:!1,queryText:""}})}loadContainerElStates(){this.containerEl.style.top=this.uiSetting.inFileFloatingWindowTop,this.containerEl.style.left=this.uiSetting.inFileFloatingWindowLeft}saveContainerElStates(){this.uiSetting.inFileFloatingWindowLeft=this.containerEl.style.left,this.uiSetting.inFileFloatingWindowTop=this.containerEl.style.top}};Hn=R([(0,Xa.singleton)()],Hn);var zc=require("obsidian");var Vc=ue(de());var qn=class{async createChildThreads(){if(En)A.warn("web worker only enabled on dev environment now");else return;A.debug("init child threads...");let e=b(Me).obsidianFs,t=b(zc.Vault).configDir,r=Ee.join(t,"plugins/clever-search/dist/cs-search-worker.js");try{let i=await e.readBinary(r);A.debug(`worker script size (6x bigger than in production build): ${(i.byteLength/1e3).toFixed(2)} KB`);let s=new Blob([i],{type:"text/javascript"}),o=URL.createObjectURL(s);this.worker=new Worker(o),this.worker.addEventListener("message",a=>{console.log(`Received from worker:
`,a.data)})}catch(i){console.error("Error initializing worker:",i)}}async testImageSearch(){var e;(e=this.worker)==null||e.postMessage({type:"image-search"})}};qn=R([(0,Vc.singleton)()],qn);var Wc=ue(de());var Kc=ue(de());var qt=class{constructor(){this.privacyModeEnabled=!1;this.plugin=b(Gn)}togglePrivacyMode(){this.privacyModeEnabled=!this.privacyModeEnabled,this.privacyModeEnabled?document.body.classList.add("cs-privacy-blur"):document.body.classList.remove("cs-privacy-blur")}init(){this.watchSelectionAndAutoCopy()}watchSelectionAndAutoCopy(){this.plugin.registerDomEvent(document,"mousedown",e=>{Mm(e,["cs-modal","cs-floating-window-container"])&&document.addEventListener("mouseup",()=>{Dm()},{once:!0})})}};qt=R([(0,Kc.singleton)()],qt);function Mm(n,e){let t=n.target;for(;t;){if(e.some(r=>t==null?void 0:t.classList.contains(r)))return!0;t=t.parentElement}return!1}function Dm(){let n=window.getSelection();if(n&&n.rangeCount>0){let t=n.getRangeAt(0).toString();t&&navigator.clipboard.writeText(t).then(()=>A.debug(`selection copied: ${t}`))}}var Ja=require("obsidian");var Ya=require("obsidian");async function Om(){let n=b(Oe).allFilesToBeIndexed().filter(t=>t.basename.includes("Mysql")||t.basename.includes("Breath")),e=await b(Oe).generateAllIndexedDocuments(n);b(Ve).reindexAll(e)}async function Uc(){let n=b(ae);kl(()=>Om())}var $c=require("obsidian");var yn=class extends $c.Modal{constructor(t,r,i,s){var l;super(t);let o=((l=window.getSelection())==null?void 0:l.toString())||"",a=s||o;this.modalEl.replaceChildren(),this.modalEl.addClass("cs-modal"),this.mountedElement=new fs({target:this.modalEl,props:{uiType:"modal",onConfirmExternal:()=>this.close(),searchType:r,isSemantic:i,queryText:a||""}}),new hs(this.scope).registerAll()}onOpen(){}onClose(){this.mountedElement.$destroy()}};var Qa=ue(de());var vn="Ctrl",Lm="Alt";var Gt=class{constructor(){this.plugin=b(We);this.setting=b(ae);this.app=b(Ja.App);b(Xn).registerAll()}addDevCommands(){En&&(this.addCommand({id:"cs-in-file-search-floating-window",name:"In file search - floating window",callback:()=>b(Ue).toggle("inFile")}),this.addCommand({id:"clever-search-triggerTest",name:"clever-search-triggerTest",callback:async()=>await Uc()}))}addCommandsWithoutDependency(){this.addCommand({id:"clever-search-in-file",name:"Search in file",callback:()=>{this.setting.ui.floatingWindowForInFile?b(Ue).toggle("inFile"):new yn(this.app,1,!1).open()}}),this.addCommand({id:"cs-toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>b(qt).togglePrivacyMode()})}addInVaultCommands(){this.addCommand({id:"clever-search-in-vault",name:"Search in Vault",callback:()=>{$t.emit(10),new yn(this.app,2,!1).open()}}),this.addCommand({id:"cs-in-file-search-with-omnisearch-query",name:"Search in file with last Omnisearch query",callback:async()=>{new yn(this.app,1,!1,await b(at).getLastQuery()).open()}}),this.addCommand({id:"clever-search-in-vault-semantic",name:"Search in vault semantically",callback:async()=>new yn(this.app,2,!0).open()})}onunload(){b(Xn).unregisterAll()}addCommand(e){this.plugin.addCommand(e)}};Gt=R([(0,Qa.singleton)()],Gt);function Rm(n){return e=>{e.preventDefault(),$t.emit(n),console.log("emit...")}}var ps=class{constructor(e){this.handlers=[];this.scope=e}unregisterAll(){this.handlers.forEach(e=>{this.scope.unregister(e)}),this.handlers=[]}register(e,t,r){this.handlers.push(this.scope.register(e,t,Rm(r)))}},Xn=class extends ps{constructor(){super(b(Ja.App).scope)}registerAll(){this.handlers=[],this.register([vn],"J",3),this.register([vn],"K",6)}};Xn=R([(0,Qa.singleton)()],Xn);var hs=class extends ps{constructor(e){super(e)}registerAll(){this.register([vn],"J",2),this.register([vn],"K",5),this.register([],"ArrowDown",2),this.register([],"ArrowUp",5),this.register([],"Enter",8),this.register([vn],"N",4),this.register([vn],"P",7),this.register([vn],"S",9),this.register([Lm],"I",11)}};var _n=class{async onload(){await b(tt).initAsync(),b(De).init(),b(Gt).addCommandsWithoutDependency(),await b(ze).initAsync(),await b(st).initAsync(),await b(qn).createChildThreads(),b(qt).init()}async onLayoutReady(){let e=b(Gt);e.addInVaultCommands(),e.addDevCommands(),await b(Ke).initAsync(),await b(at).initAsync()}onunload(){b(Gt).onunload(),b(Ke).onunload(),b(Ue).onunload()}onAppQuit(){}};_n=R([(0,Wc.singleton)()],_n);var Gn=class extends Ye.Plugin{async onload(){ms.container.register(We,{useValue:this}),ms.container.register(Ye.App,{useValue:this.app}),ms.container.register(Ye.Vault,{useValue:this.app.vault});let e=b(_n);await e.onload(),this.app.workspace.onLayoutReady(()=>{e.onLayoutReady()}),this.registerEvent(this.app.workspace.on("quit",()=>e.onAppQuit(),this))}onunload(){document.body.classList.remove("cs-privacy-blur"),b(_n).onunload()}exampleCode(){this.registerDomEvent(document,"click",e=>{console.log("click",e)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}},ds=class extends Ye.Modal{constructor(t,r){super(t);this.mdContent=r}onOpen(){this.containerEl.empty(),this.containerEl.style.display="block",this.containerEl.style.overflow="auto",this.containerEl.style.backgroundColor="black",Ye.MarkdownRenderer.render(b(Ye.App),this.mdContent,this.containerEl,"",new Ye.Component)}onClose(){}};0&&(module.exports={RenderMarkdownModal});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

fzf/dist/fzf.es.js:
  (** @license
   * fzf v0.5.2
   * Copyright (c) 2021 Ajit
   * Licensed under BSD 3-Clause
   *)
*/
