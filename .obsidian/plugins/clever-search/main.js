/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var xd=Object.create;var Cr=Object.defineProperty;var oc=Object.getOwnPropertyDescriptor;var Ed=Object.getOwnPropertyNames;var Td=Object.getPrototypeOf,Sd=Object.prototype.hasOwnProperty;var Ad=(n,e)=>()=>(n&&(e=n(n=0)),e);var he=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ac=(n,e)=>{for(var t in e)Cr(n,t,{get:e[t],enumerable:!0})},lc=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ed(e))!Sd.call(n,i)&&i!==t&&Cr(n,i,{get:()=>e[i],enumerable:!(r=oc(e,i))||r.enumerable});return n};var pe=(n,e,t)=>(t=n!=null?xd(Td(n)):{},lc(e||!n||!n.__esModule?Cr(t,"default",{value:n,enumerable:!0}):t,n)),Pi=n=>lc(Cr({},"__esModule",{value:!0}),n),j=(n,e,t,r)=>{for(var i=r>1?void 0:r?oc(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Cr(e,t,i),i},Mi=(n,e)=>(t,r)=>e(t,r,n);var Di={};ac(Di,{__assign:()=>so,__asyncDelegator:()=>zd,__asyncGenerator:()=>Bd,__asyncValues:()=>jd,__await:()=>Fr,__awaiter:()=>Dd,__classPrivateFieldGet:()=>Kd,__classPrivateFieldSet:()=>Hd,__createBinding:()=>Rd,__decorate:()=>Id,__exportStar:()=>Ld,__extends:()=>Cd,__generator:()=>Od,__importDefault:()=>Vd,__importStar:()=>Wd,__makeTemplateObject:()=>Ud,__metadata:()=>Md,__param:()=>Pd,__read:()=>uc,__rest:()=>Fd,__spread:()=>kd,__spreadArrays:()=>Nd,__values:()=>oo});function Cd(n,e){io(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Fd(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Id(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Pd(n,e){return function(t,r){e(t,r,n)}}function Md(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function Dd(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}function Od(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Rd(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}function Ld(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function oo(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function uc(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function kd(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(uc(arguments[e]));return n}function Nd(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Fr(n){return this instanceof Fr?(this.v=n,this):new Fr(n)}function Bd(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(d){return new Promise(function(m,p){s.push([f,d,m,p])>1||a(f,d)})})}function a(f,d){try{l(r[f](d))}catch(m){h(s[0][3],m)}}function l(f){f.value instanceof Fr?Promise.resolve(f.value.v).then(c,u):h(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function zd(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Fr(n[i](o)),done:i==="return"}:s?s(o):o}:s}}function jd(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof oo=="function"?oo(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function Ud(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function Wd(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function Vd(n){return n&&n.__esModule?n:{default:n}}function Kd(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function Hd(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}var io,so,Oi=Ad(()=>{io=function(n,e){return io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},io(n,e)};so=function(){return so=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},so.apply(this,arguments)}});var co=he(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});var ao;(function(n){n[n.Transient=0]="Transient",n[n.Singleton=1]="Singleton",n[n.ResolutionScoped=2]="ResolutionScoped",n[n.ContainerScoped=3]="ContainerScoped"})(ao||(ao={}));lo.default=ao});var fc=he(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});var $d=co();Object.defineProperty(uo,"Lifecycle",{enumerable:!0,get:function(){return $d.default}})});var Cn=he(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.defineInjectionTokenMetadata=Ft.getParamInfo=Ft.INJECTION_TOKEN_METADATA_KEY=void 0;Ft.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function qd(n){let e=Reflect.getMetadata("design:paramtypes",n)||[],t=Reflect.getOwnMetadata(Ft.INJECTION_TOKEN_METADATA_KEY,n)||{};return Object.keys(t).forEach(r=>{e[+r]=t[r]}),e}Ft.getParamInfo=qd;function Gd(n,e){return function(t,r,i){let s=Reflect.getOwnMetadata(Ft.INJECTION_TOKEN_METADATA_KEY,t)||{};s[i]=e?{token:n,transform:e.transformToken,transformArgs:e.args||[]}:n,Reflect.defineMetadata(Ft.INJECTION_TOKEN_METADATA_KEY,s,t)}}Ft.defineInjectionTokenMetadata=Gd});var fo=he(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});Ri.isClassProvider=void 0;function Xd(n){return!!n.useClass}Ri.isClassProvider=Xd});var ho=he(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.isFactoryProvider=void 0;function Yd(n){return!!n.useFactory}Li.isFactoryProvider=Yd});var Ni=he(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.delay=Jn.DelayedConstructor=void 0;var ki=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},r=!1,i,s=()=>(r||(i=e(this.wrap()),r=!0),i);return new Proxy(t,this.createHandler(s))}createHandler(e){let t={},r=i=>{t[i]=(...s)=>{s[0]=e();let o=Reflect[i];return o(...s)}};return this.reflectMethods.forEach(r),t}};Jn.DelayedConstructor=ki;function Jd(n){if(typeof n=="undefined")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new ki(n)}Jn.delay=Jd});var Bi=he(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.isConstructorToken=Bt.isTransformDescriptor=Bt.isTokenDescriptor=Bt.isNormalToken=void 0;var Qd=Ni();function Zd(n){return typeof n=="string"||typeof n=="symbol"}Bt.isNormalToken=Zd;function eh(n){return typeof n=="object"&&"token"in n&&"multiple"in n}Bt.isTokenDescriptor=eh;function th(n){return typeof n=="object"&&"token"in n&&"transform"in n}Bt.isTransformDescriptor=th;function nh(n){return typeof n=="function"||n instanceof Qd.DelayedConstructor}Bt.isConstructorToken=nh});var po=he(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.isTokenProvider=void 0;function rh(n){return!!n.useToken}zi.isTokenProvider=rh});var mo=he(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.isValueProvider=void 0;function ih(n){return n.useValue!=null}ji.isValueProvider=ih});var go=he(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});var sh=fo();Object.defineProperty(Fn,"isClassProvider",{enumerable:!0,get:function(){return sh.isClassProvider}});var oh=ho();Object.defineProperty(Fn,"isFactoryProvider",{enumerable:!0,get:function(){return oh.isFactoryProvider}});var ah=Bi();Object.defineProperty(Fn,"isNormalToken",{enumerable:!0,get:function(){return ah.isNormalToken}});var lh=po();Object.defineProperty(Fn,"isTokenProvider",{enumerable:!0,get:function(){return lh.isTokenProvider}});var ch=mo();Object.defineProperty(Fn,"isValueProvider",{enumerable:!0,get:function(){return ch.isValueProvider}})});var dc=he(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.isProvider=void 0;var uh=fo(),fh=mo(),dh=po(),hh=ho();function ph(n){return uh.isClassProvider(n)||fh.isValueProvider(n)||dh.isTokenProvider(n)||hh.isFactoryProvider(n)}Ui.isProvider=ph});var _o=he(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});var yo=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};vo.default=yo});var hc=he(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});var mh=_o(),bo=class extends mh.default{};wo.default=bo});var pc=he(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});var xo=class{constructor(){this.scopedResolutions=new Map}};Eo.default=xo});var To=he(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});Wi.formatErrorCtor=void 0;function gh(n,e){return n===null?`at position #${e}`:`"${n.split(",")[e].trim()}" at position #${e}`}function yh(n,e,t="    "){return[n,...e.message.split(`
`).map(r=>t+r)].join(`
`)}function vh(n,e,t){let[,r=null]=n.toString().match(/constructor\(([\w, ]+)\)/)||[],i=gh(r,e);return yh(`Cannot inject the dependency ${i} of "${n.name}" constructor. Reason:`,t)}Wi.formatErrorCtor=vh});var mc=he(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.isDisposable=void 0;function _h(n){return!(typeof n.dispose!="function"||n.dispose.length>0)}Vi.isDisposable=_h});var yc=he(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.PostResolutionInterceptors=In.PreResolutionInterceptors=void 0;var gc=_o(),Ki=class extends gc.default{};In.PreResolutionInterceptors=Ki;var Hi=class extends gc.default{};In.PostResolutionInterceptors=Hi;var So=class{constructor(){this.preResolution=new Ki,this.postResolution=new Hi}};In.default=So});var Pn=he($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.instance=$t.typeInfo=void 0;var bh=(Oi(),Pi(Di)),Xe=go(),wh=dc(),$i=Bi(),xh=hc(),it=co(),vc=pc(),Eh=To(),Th=Ni(),Sh=mc(),Ah=yc();$t.typeInfo=new Map;var Ir=class{constructor(e){this.parent=e,this._registry=new xh.default,this.interceptors=new Ah.default,this.disposed=!1,this.disposables=new Set}register(e,t,r={lifecycle:it.default.Transient}){this.ensureNotDisposed();let i;if(wh.isProvider(t)?i=t:i={useClass:t},Xe.isTokenProvider(i)){let s=[e],o=i;for(;o!=null;){let a=o.useToken;if(s.includes(a))throw new Error(`Token registration cycle detected! ${[...s,a].join(" -> ")}`);s.push(a);let l=this._registry.get(a);l&&Xe.isTokenProvider(l.provider)?o=l.provider:o=null}}if((r.lifecycle===it.default.Singleton||r.lifecycle==it.default.ContainerScoped||r.lifecycle==it.default.ResolutionScoped)&&(Xe.isValueProvider(i)||Xe.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${it.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,t){return this.ensureNotDisposed(),Xe.isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),Xe.isNormalToken(e)){if(Xe.isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:it.default.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:it.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return t&&!Xe.isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:it.default.Singleton})}resolve(e,t=new vc.default){this.ensureNotDisposed();let r=this.getRegistration(e);if(!r&&Xe.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"Single"),r){let i=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if($i.isConstructorToken(e)){let i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,t);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,t,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,t,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===it.default.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let r=e.options.lifecycle===it.default.Singleton,i=e.options.lifecycle===it.default.ContainerScoped,s=r||i,o;return Xe.isValueProvider(e.provider)?o=e.provider.useValue:Xe.isTokenProvider(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Xe.isClassProvider(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Xe.isFactoryProvider(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===it.default.ResolutionScoped&&t.scopedResolutions.set(e,o),o}resolveAll(e,t=new vc.default){this.ensureNotDisposed();let r=this.getAllRegistrations(e);if(!r&&Xe.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"All"),r){let s=r.map(o=>this.resolveRegistration(o,t));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(r=>!Xe.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new Ir(this);for(let[t,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===it.default.ContainerScoped)&&e._registry.setAll(t,r.map(i=>i.options.lifecycle===it.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,t,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:r})}afterResolution(e,t,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:r})}dispose(){return bh.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let r=t.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof Th.DelayedConstructor)return e.createProxy(i=>this.resolve(i,t));let r=(()=>{let i=$t.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(t,e));return new e(...s)})();return Sh.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,t){return(r,i)=>{try{return $i.isTokenDescriptor(r)?$i.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):$i.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(Eh.formatErrorCtor(t,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};$t.instance=new Ir;$t.default=$t.instance});var _c=he(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});var Ch=Cn(),qt=Pn(),Ao=Bi(),Fh=To();function Ih(){return function(n){let e=Ch.getParamInfo(n);return class extends n{constructor(...t){super(...t.concat(e.slice(t.length).map((r,i)=>{try{return Ao.isTokenDescriptor(r)?Ao.isTransformDescriptor(r)?r.multiple?qt.instance.resolve(r.transform).transform(qt.instance.resolveAll(r.token),...r.transformArgs):qt.instance.resolve(r.transform).transform(qt.instance.resolve(r.token),...r.transformArgs):r.multiple?qt.instance.resolveAll(r.token):qt.instance.resolve(r.token):Ao.isTransformDescriptor(r)?qt.instance.resolve(r.transform).transform(qt.instance.resolve(r.token),...r.transformArgs):qt.instance.resolve(r)}catch(s){let o=i+t.length;throw new Error(Fh.formatErrorCtor(n,o,s))}})))}}}}Co.default=Ih});var bc=he(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});var Ph=Cn();function Mh(n){return Ph.defineInjectionTokenMetadata(n)}Fo.default=Mh});var qi=he(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});var Dh=Cn(),Oh=Pn();function Rh(){return function(n){Oh.typeInfo.set(n,Dh.getParamInfo(n))}}Io.default=Rh});var wc=he(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});var Lh=(Oi(),Pi(Di)),kh=Pn();function Nh(n=[]){return function(e){return n.forEach(t=>{var{token:r,options:i}=t,s=Lh.__rest(t,["token","options"]);return kh.instance.register(r,s,i)}),e}}Po.default=Nh});var xc=he(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});var Bh=qi(),zh=Pn();function jh(){return function(n){Bh.default()(n),zh.instance.registerSingleton(n)}}Mo.default=jh});var Ec=he(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});var Uh=Cn();function Wh(n){let e={token:n,multiple:!0};return Uh.defineInjectionTokenMetadata(e)}Do.default=Wh});var Tc=he(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});var Vh=Cn();function Kh(n,e,...t){let r={token:n,multiple:!0,transform:e,transformArgs:t};return Vh.defineInjectionTokenMetadata(r)}Oo.default=Kh});var Sc=he(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});var Hh=Cn();function $h(n,e,...t){return Hh.defineInjectionTokenMetadata(n,{transformToken:e,args:t})}Ro.default=$h});var Ac=he(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});var qh=qi(),Gh=Pn();function Xh(n,e){return function(t){qh.default()(t),Gh.instance.register(e||t,t,{lifecycle:n})}}Lo.default=Xh});var Cc=he(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});var Yh=_c();Object.defineProperty(It,"autoInjectable",{enumerable:!0,get:function(){return Yh.default}});var Jh=bc();Object.defineProperty(It,"inject",{enumerable:!0,get:function(){return Jh.default}});var Qh=qi();Object.defineProperty(It,"injectable",{enumerable:!0,get:function(){return Qh.default}});var Zh=wc();Object.defineProperty(It,"registry",{enumerable:!0,get:function(){return Zh.default}});var ep=xc();Object.defineProperty(It,"singleton",{enumerable:!0,get:function(){return ep.default}});var tp=Ec();Object.defineProperty(It,"injectAll",{enumerable:!0,get:function(){return tp.default}});var np=Tc();Object.defineProperty(It,"injectAllWithTransform",{enumerable:!0,get:function(){return np.default}});var rp=Sc();Object.defineProperty(It,"injectWithTransform",{enumerable:!0,get:function(){return rp.default}});var ip=Ac();Object.defineProperty(It,"scoped",{enumerable:!0,get:function(){return ip.default}})});var Fc=he(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});function sp(n){let e;return t=>(e==null&&(e=n(t)),e)}ko.default=sp});var Ic=he(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});function op(n){let e=new WeakMap;return t=>{let r=e.get(t);return r==null&&(r=n(t),e.set(t,r)),r}}No.default=op});var Pc=he(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});function ap(n,e,t,r=!0){let i,s;return o=>{let a=n(o);return(!r||s!==a)&&((s=a)?i=o.resolve(e):i=o.resolve(t)),i}}Bo.default=ap});var Mc=he(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});var lp=Fc();Object.defineProperty(Pr,"instanceCachingFactory",{enumerable:!0,get:function(){return lp.default}});var cp=Ic();Object.defineProperty(Pr,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return cp.default}});var up=Pc();Object.defineProperty(Pr,"predicateAwareClassFactory",{enumerable:!0,get:function(){return up.default}})});var ye=he(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});var zo=(Oi(),Pi(Di));if(typeof Reflect=="undefined"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var fp=fc();Object.defineProperty(rn,"Lifecycle",{enumerable:!0,get:function(){return fp.Lifecycle}});zo.__exportStar(Cc(),rn);zo.__exportStar(Mc(),rn);zo.__exportStar(go(),rn);var dp=Ni();Object.defineProperty(rn,"delay",{enumerable:!0,get:function(){return dp.delay}});var hp=Pn();Object.defineProperty(rn,"container",{enumerable:!0,get:function(){return hp.instance}})});var Zf=he((Xw,Qf)=>{"use strict";var{entries:qf,setPrototypeOf:zf,isFrozen:Qg,getPrototypeOf:Zg,getOwnPropertyDescriptor:ey}=Object,{freeze:et,seal:Et,create:Gf}=Object,{apply:kl,construct:Nl}=typeof Reflect!="undefined"&&Reflect;et||(et=function(e){return e});Et||(Et=function(e){return e});kl||(kl=function(e,t,r){return e.apply(t,r)});Nl||(Nl=function(e,t){return new e(...t)});var qs=yt(Array.prototype.forEach),jf=yt(Array.prototype.pop),Ti=yt(Array.prototype.push),Xs=yt(String.prototype.toLowerCase),Ml=yt(String.prototype.toString),Uf=yt(String.prototype.match),Si=yt(String.prototype.replace),ty=yt(String.prototype.indexOf),ny=yt(String.prototype.trim),Lt=yt(Object.prototype.hasOwnProperty),Ze=yt(RegExp.prototype.test),Ai=ry(TypeError);function yt(n){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return kl(n,e,r)}}function ry(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Nl(n,t)}}function ce(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Xs;zf&&zf(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){let s=t(i);s!==i&&(Qg(e)||(e[r]=s),i=s)}n[i]=!0}return n}function iy(n){for(let e=0;e<n.length;e++)Lt(n,e)||(n[e]=null);return n}function Hn(n){let e=Gf(null);for(let[t,r]of qf(n))Lt(n,t)&&(Array.isArray(r)?e[t]=iy(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Hn(r):e[t]=r);return e}function Ci(n,e){for(;n!==null;){let r=ey(n,e);if(r){if(r.get)return yt(r.get);if(typeof r.value=="function")return yt(r.value)}n=Zg(n)}function t(){return null}return t}var Wf=et(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Dl=et(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ol=et(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),sy=et(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Rl=et(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),oy=et(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Vf=et(["#text"]),Kf=et(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Ll=et(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Hf=et(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Gs=et(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ay=Et(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ly=Et(/<%[\w\W]*|[\w\W]*%>/gm),cy=Et(/\${[\w\W]*}/gm),uy=Et(/^data-[\-\w.\u00B7-\uFFFF]/),fy=Et(/^aria-[\-\w]+$/),Xf=Et(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),dy=Et(/^(?:\w+script|data):/i),hy=Et(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Yf=Et(/^html$/i),py=Et(/^[a-z][.\w]*(-[.\w]+)+$/i),$f=Object.freeze({__proto__:null,MUSTACHE_EXPR:ay,ERB_EXPR:ly,TMPLIT_EXPR:cy,DATA_ATTR:uy,ARIA_ATTR:fy,IS_ALLOWED_URI:Xf,IS_SCRIPT_OR_DATA:dy,ATTR_WHITESPACE:hy,DOCTYPE_NAME:Yf,CUSTOM_ELEMENT:py}),Fi={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},my=function(){return typeof window=="undefined"?null:window},gy=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null,i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(r=t.getAttribute(i));let s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch(o){return console.warn("TrustedTypes policy "+s+" could not be created."),null}};function Jf(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:my(),e=$=>Jf($);if(e.version="3.1.7",e.removed=[],!n||!n.document||n.document.nodeType!==Fi.document)return e.isSupported=!1,e;let{document:t}=n,r=t,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:d}=n,m=l.prototype,p=Ci(m,"cloneNode"),g=Ci(m,"remove"),v=Ci(m,"nextSibling"),x=Ci(m,"childNodes"),E=Ci(m,"parentNode");if(typeof o=="function"){let $=t.createElement("template");$.content&&$.content.ownerDocument&&(t=$.content.ownerDocument)}let b,S="",{implementation:C,createNodeIterator:I,createDocumentFragment:P,getElementsByTagName:R}=t,{importNode:U}=r,D={};e.isSupported=typeof qf=="function"&&typeof E=="function"&&C&&C.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:L,ERB_EXPR:k,TMPLIT_EXPR:V,DATA_ATTR:se,ARIA_ATTR:J,IS_SCRIPT_OR_DATA:ue,ATTR_WHITESPACE:fe,CUSTOM_ELEMENT:we}=$f,{IS_ALLOWED_URI:ft}=$f,X=null,Y=ce({},[...Wf,...Dl,...Ol,...Rl,...Vf]),H=null,Z=ce({},[...Kf,...Ll,...Hf,...Gs]),ae=Object.seal(Gf(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ee=null,ke=null,N=!0,ee=!0,He=!1,Tt=!0,St=!1,Tn=!0,tt=!1,$e=!1,Sn=!1,At=!1,dt=!1,nt=!1,Ct=!0,Vt=!1,Kt="user-content-",An=!0,_=!1,T={},F=null,O=ce({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),K=null,Se=ce({},["audio","video","img","source","image","track"]),te=null,ie=ce({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),q="http://www.w3.org/1998/Math/MathML",le="http://www.w3.org/2000/svg",re="http://www.w3.org/1999/xhtml",qe=re,Xn=!1,no=null,md=ce({},[q,le,re],Ml),Sr=null,gd=["application/xhtml+xml","text/html"],yd="text/html",Me=null,Yn=null,vd=t.createElement("form"),Hl=function(y){return y instanceof RegExp||y instanceof Function},ro=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Yn&&Yn===y)){if((!y||typeof y!="object")&&(y={}),y=Hn(y),Sr=gd.indexOf(y.PARSER_MEDIA_TYPE)===-1?yd:y.PARSER_MEDIA_TYPE,Me=Sr==="application/xhtml+xml"?Ml:Xs,X=Lt(y,"ALLOWED_TAGS")?ce({},y.ALLOWED_TAGS,Me):Y,H=Lt(y,"ALLOWED_ATTR")?ce({},y.ALLOWED_ATTR,Me):Z,no=Lt(y,"ALLOWED_NAMESPACES")?ce({},y.ALLOWED_NAMESPACES,Ml):md,te=Lt(y,"ADD_URI_SAFE_ATTR")?ce(Hn(ie),y.ADD_URI_SAFE_ATTR,Me):ie,K=Lt(y,"ADD_DATA_URI_TAGS")?ce(Hn(Se),y.ADD_DATA_URI_TAGS,Me):Se,F=Lt(y,"FORBID_CONTENTS")?ce({},y.FORBID_CONTENTS,Me):O,Ee=Lt(y,"FORBID_TAGS")?ce({},y.FORBID_TAGS,Me):{},ke=Lt(y,"FORBID_ATTR")?ce({},y.FORBID_ATTR,Me):{},T=Lt(y,"USE_PROFILES")?y.USE_PROFILES:!1,N=y.ALLOW_ARIA_ATTR!==!1,ee=y.ALLOW_DATA_ATTR!==!1,He=y.ALLOW_UNKNOWN_PROTOCOLS||!1,Tt=y.ALLOW_SELF_CLOSE_IN_ATTR!==!1,St=y.SAFE_FOR_TEMPLATES||!1,Tn=y.SAFE_FOR_XML!==!1,tt=y.WHOLE_DOCUMENT||!1,At=y.RETURN_DOM||!1,dt=y.RETURN_DOM_FRAGMENT||!1,nt=y.RETURN_TRUSTED_TYPE||!1,Sn=y.FORCE_BODY||!1,Ct=y.SANITIZE_DOM!==!1,Vt=y.SANITIZE_NAMED_PROPS||!1,An=y.KEEP_CONTENT!==!1,_=y.IN_PLACE||!1,ft=y.ALLOWED_URI_REGEXP||Xf,qe=y.NAMESPACE||re,ae=y.CUSTOM_ELEMENT_HANDLING||{},y.CUSTOM_ELEMENT_HANDLING&&Hl(y.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ae.tagNameCheck=y.CUSTOM_ELEMENT_HANDLING.tagNameCheck),y.CUSTOM_ELEMENT_HANDLING&&Hl(y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ae.attributeNameCheck=y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),y.CUSTOM_ELEMENT_HANDLING&&typeof y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ae.allowCustomizedBuiltInElements=y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),St&&(ee=!1),dt&&(At=!0),T&&(X=ce({},Vf),H=[],T.html===!0&&(ce(X,Wf),ce(H,Kf)),T.svg===!0&&(ce(X,Dl),ce(H,Ll),ce(H,Gs)),T.svgFilters===!0&&(ce(X,Ol),ce(H,Ll),ce(H,Gs)),T.mathMl===!0&&(ce(X,Rl),ce(H,Hf),ce(H,Gs))),y.ADD_TAGS&&(X===Y&&(X=Hn(X)),ce(X,y.ADD_TAGS,Me)),y.ADD_ATTR&&(H===Z&&(H=Hn(H)),ce(H,y.ADD_ATTR,Me)),y.ADD_URI_SAFE_ATTR&&ce(te,y.ADD_URI_SAFE_ATTR,Me),y.FORBID_CONTENTS&&(F===O&&(F=Hn(F)),ce(F,y.FORBID_CONTENTS,Me)),An&&(X["#text"]=!0),tt&&ce(X,["html","head","body"]),X.table&&(ce(X,["tbody"]),delete Ee.tbody),y.TRUSTED_TYPES_POLICY){if(typeof y.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ai('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof y.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ai('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');b=y.TRUSTED_TYPES_POLICY,S=b.createHTML("")}else b===void 0&&(b=gy(d,i)),b!==null&&typeof S=="string"&&(S=b.createHTML(""));et&&et(y),Yn=y}},$l=ce({},["mi","mo","mn","ms","mtext"]),ql=ce({},["annotation-xml"]),_d=ce({},["title","style","font","a","script"]),Gl=ce({},[...Dl,...Ol,...sy]),Xl=ce({},[...Rl,...oy]),bd=function(y){let M=E(y);(!M||!M.tagName)&&(M={namespaceURI:qe,tagName:"template"});let W=Xs(y.tagName),ge=Xs(M.tagName);return no[y.namespaceURI]?y.namespaceURI===le?M.namespaceURI===re?W==="svg":M.namespaceURI===q?W==="svg"&&(ge==="annotation-xml"||$l[ge]):Boolean(Gl[W]):y.namespaceURI===q?M.namespaceURI===re?W==="math":M.namespaceURI===le?W==="math"&&ql[ge]:Boolean(Xl[W]):y.namespaceURI===re?M.namespaceURI===le&&!ql[ge]||M.namespaceURI===q&&!$l[ge]?!1:!Xl[W]&&(_d[W]||!Gl[W]):!!(Sr==="application/xhtml+xml"&&no[y.namespaceURI]):!1},kt=function(y){Ti(e.removed,{element:y});try{E(y).removeChild(y)}catch(M){g(y)}},Ii=function(y,M){try{Ti(e.removed,{attribute:M.getAttributeNode(y),from:M})}catch(W){Ti(e.removed,{attribute:null,from:M})}if(M.removeAttribute(y),y==="is"&&!H[y])if(At||dt)try{kt(M)}catch(W){}else try{M.setAttribute(y,"")}catch(W){}},Yl=function(y){let M=null,W=null;if(Sn)y="<remove></remove>"+y;else{let Oe=Uf(y,/^[\r\n\t ]+/);W=Oe&&Oe[0]}Sr==="application/xhtml+xml"&&qe===re&&(y='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+y+"</body></html>");let ge=b?b.createHTML(y):y;if(qe===re)try{M=new f().parseFromString(ge,Sr)}catch(Oe){}if(!M||!M.documentElement){M=C.createDocument(qe,"template",null);try{M.documentElement.innerHTML=Xn?S:ge}catch(Oe){}}let Ne=M.body||M.documentElement;return y&&W&&Ne.insertBefore(t.createTextNode(W),Ne.childNodes[0]||null),qe===re?R.call(M,tt?"html":"body")[0]:tt?M.documentElement:Ne},Jl=function(y){return I.call(y.ownerDocument||y,y,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Ql=function(y){return y instanceof h&&(typeof y.nodeName!="string"||typeof y.textContent!="string"||typeof y.removeChild!="function"||!(y.attributes instanceof u)||typeof y.removeAttribute!="function"||typeof y.setAttribute!="function"||typeof y.namespaceURI!="string"||typeof y.insertBefore!="function"||typeof y.hasChildNodes!="function")},Zl=function(y){return typeof a=="function"&&y instanceof a},Ht=function(y,M,W){D[y]&&qs(D[y],ge=>{ge.call(e,M,W,Yn)})},ec=function(y){let M=null;if(Ht("beforeSanitizeElements",y,null),Ql(y))return kt(y),!0;let W=Me(y.nodeName);if(Ht("uponSanitizeElement",y,{tagName:W,allowedTags:X}),y.hasChildNodes()&&!Zl(y.firstElementChild)&&Ze(/<[/\w]/g,y.innerHTML)&&Ze(/<[/\w]/g,y.textContent)||y.nodeType===Fi.progressingInstruction||Tn&&y.nodeType===Fi.comment&&Ze(/<[/\w]/g,y.data))return kt(y),!0;if(!X[W]||Ee[W]){if(!Ee[W]&&nc(W)&&(ae.tagNameCheck instanceof RegExp&&Ze(ae.tagNameCheck,W)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(W)))return!1;if(An&&!F[W]){let ge=E(y)||y.parentNode,Ne=x(y)||y.childNodes;if(Ne&&ge){let Oe=Ne.length;for(let rt=Oe-1;rt>=0;--rt){let Nt=p(Ne[rt],!0);Nt.__removalCount=(y.__removalCount||0)+1,ge.insertBefore(Nt,v(y))}}}return kt(y),!0}return y instanceof l&&!bd(y)||(W==="noscript"||W==="noembed"||W==="noframes")&&Ze(/<\/no(script|embed|frames)/i,y.innerHTML)?(kt(y),!0):(St&&y.nodeType===Fi.text&&(M=y.textContent,qs([L,k,V],ge=>{M=Si(M,ge," ")}),y.textContent!==M&&(Ti(e.removed,{element:y.cloneNode()}),y.textContent=M)),Ht("afterSanitizeElements",y,null),!1)},tc=function(y,M,W){if(Ct&&(M==="id"||M==="name")&&(W in t||W in vd))return!1;if(!(ee&&!ke[M]&&Ze(se,M))){if(!(N&&Ze(J,M))){if(!H[M]||ke[M]){if(!(nc(y)&&(ae.tagNameCheck instanceof RegExp&&Ze(ae.tagNameCheck,y)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(y))&&(ae.attributeNameCheck instanceof RegExp&&Ze(ae.attributeNameCheck,M)||ae.attributeNameCheck instanceof Function&&ae.attributeNameCheck(M))||M==="is"&&ae.allowCustomizedBuiltInElements&&(ae.tagNameCheck instanceof RegExp&&Ze(ae.tagNameCheck,W)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(W))))return!1}else if(!te[M]){if(!Ze(ft,Si(W,fe,""))){if(!((M==="src"||M==="xlink:href"||M==="href")&&y!=="script"&&ty(W,"data:")===0&&K[y])){if(!(He&&!Ze(ue,Si(W,fe,"")))){if(W)return!1}}}}}}return!0},nc=function(y){return y!=="annotation-xml"&&Uf(y,we)},rc=function(y){Ht("beforeSanitizeAttributes",y,null);let{attributes:M}=y;if(!M)return;let W={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H},ge=M.length;for(;ge--;){let Ne=M[ge],{name:Oe,namespaceURI:rt,value:Nt}=Ne,Ar=Me(Oe),Ge=Oe==="value"?Nt:ny(Nt);if(W.attrName=Ar,W.attrValue=Ge,W.keepAttr=!0,W.forceKeepAttr=void 0,Ht("uponSanitizeAttribute",y,W),Ge=W.attrValue,W.forceKeepAttr||(Ii(Oe,y),!W.keepAttr))continue;if(!Tt&&Ze(/\/>/i,Ge)){Ii(Oe,y);continue}St&&qs([L,k,V],sc=>{Ge=Si(Ge,sc," ")});let ic=Me(y.nodeName);if(tc(ic,Ar,Ge)){if(Vt&&(Ar==="id"||Ar==="name")&&(Ii(Oe,y),Ge=Kt+Ge),Tn&&Ze(/((--!?|])>)|<\/(style|title)/i,Ge)){Ii(Oe,y);continue}if(b&&typeof d=="object"&&typeof d.getAttributeType=="function"&&!rt)switch(d.getAttributeType(ic,Ar)){case"TrustedHTML":{Ge=b.createHTML(Ge);break}case"TrustedScriptURL":{Ge=b.createScriptURL(Ge);break}}try{rt?y.setAttributeNS(rt,Oe,Ge):y.setAttribute(Oe,Ge),Ql(y)?kt(y):jf(e.removed)}catch(sc){}}}Ht("afterSanitizeAttributes",y,null)},wd=function $(y){let M=null,W=Jl(y);for(Ht("beforeSanitizeShadowDOM",y,null);M=W.nextNode();)Ht("uponSanitizeShadowNode",M,null),!ec(M)&&(M.content instanceof s&&$(M.content),rc(M));Ht("afterSanitizeShadowDOM",y,null)};return e.sanitize=function($){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=null,W=null,ge=null,Ne=null;if(Xn=!$,Xn&&($="<!-->"),typeof $!="string"&&!Zl($))if(typeof $.toString=="function"){if($=$.toString(),typeof $!="string")throw Ai("dirty is not a string, aborting")}else throw Ai("toString is not a function");if(!e.isSupported)return $;if($e||ro(y),e.removed=[],typeof $=="string"&&(_=!1),_){if($.nodeName){let Nt=Me($.nodeName);if(!X[Nt]||Ee[Nt])throw Ai("root node is forbidden and cannot be sanitized in-place")}}else if($ instanceof a)M=Yl("<!---->"),W=M.ownerDocument.importNode($,!0),W.nodeType===Fi.element&&W.nodeName==="BODY"||W.nodeName==="HTML"?M=W:M.appendChild(W);else{if(!At&&!St&&!tt&&$.indexOf("<")===-1)return b&&nt?b.createHTML($):$;if(M=Yl($),!M)return At?null:nt?S:""}M&&Sn&&kt(M.firstChild);let Oe=Jl(_?$:M);for(;ge=Oe.nextNode();)ec(ge)||(ge.content instanceof s&&wd(ge.content),rc(ge));if(_)return $;if(At){if(dt)for(Ne=P.call(M.ownerDocument);M.firstChild;)Ne.appendChild(M.firstChild);else Ne=M;return(H.shadowroot||H.shadowrootmode)&&(Ne=U.call(r,Ne,!0)),Ne}let rt=tt?M.outerHTML:M.innerHTML;return tt&&X["!doctype"]&&M.ownerDocument&&M.ownerDocument.doctype&&M.ownerDocument.doctype.name&&Ze(Yf,M.ownerDocument.doctype.name)&&(rt="<!DOCTYPE "+M.ownerDocument.doctype.name+`>
`+rt),St&&qs([L,k,V],Nt=>{rt=Si(rt,Nt," ")}),b&&nt?b.createHTML(rt):rt},e.setConfig=function(){let $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ro($),$e=!0},e.clearConfig=function(){Yn=null,$e=!1},e.isValidAttribute=function($,y,M){Yn||ro({});let W=Me($),ge=Me(y);return tc(W,ge,M)},e.addHook=function($,y){typeof y=="function"&&(D[$]=D[$]||[],Ti(D[$],y))},e.removeHook=function($){if(D[$])return jf(D[$])},e.removeHooks=function($){D[$]&&(D[$]=[])},e.removeAllHooks=function(){D={}},e}var yy=Jf();Qf.exports=yy});var Dy={};ac(Dy,{RenderMarkdownModal:()=>Js,default:()=>xr});module.exports=Pi(Dy);var vt=require("obsidian");var cc;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect=="undefined"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,c={create:o?function(){return An(Object.create(null))}:a?function(){return An({__proto__:null})}:function(){return An({})},has:l?function(_,T){return t.call(_,T)}:function(_,T){return T in _},get:l?function(_,T){return t.call(_,T)?_[T]:void 0}:function(_,T){return _[T]}},u=Object.getPrototypeOf(Function),h=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!h&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ct(),d=!h&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Vt(),m=!h&&typeof WeakMap=="function"?WeakMap:Kt(),p=new m;function g(_,T,F,O){if(X(F)){if(!He(_))throw new TypeError;if(!St(T))throw new TypeError;return U(_,T)}else{if(!He(_))throw new TypeError;if(!Z(T))throw new TypeError;if(!Z(O)&&!X(O)&&!Y(O))throw new TypeError;return Y(O)&&(O=void 0),F=ee(F),D(_,T,F,O)}}e("decorate",g);function v(_,T){function F(O,K){if(!Z(O))throw new TypeError;if(!X(K)&&!Tn(K))throw new TypeError;ue(_,T,O,K)}return F}e("metadata",v);function x(_,T,F,O){if(!Z(F))throw new TypeError;return X(O)||(O=ee(O)),ue(_,T,F,O)}e("defineMetadata",x);function E(_,T,F){if(!Z(T))throw new TypeError;return X(F)||(F=ee(F)),k(_,T,F)}e("hasMetadata",E);function b(_,T,F){if(!Z(T))throw new TypeError;return X(F)||(F=ee(F)),V(_,T,F)}e("hasOwnMetadata",b);function S(_,T,F){if(!Z(T))throw new TypeError;return X(F)||(F=ee(F)),se(_,T,F)}e("getMetadata",S);function C(_,T,F){if(!Z(T))throw new TypeError;return X(F)||(F=ee(F)),J(_,T,F)}e("getOwnMetadata",C);function I(_,T){if(!Z(_))throw new TypeError;return X(T)||(T=ee(T)),fe(_,T)}e("getMetadataKeys",I);function P(_,T){if(!Z(_))throw new TypeError;return X(T)||(T=ee(T)),we(_,T)}e("getOwnMetadataKeys",P);function R(_,T,F){if(!Z(T))throw new TypeError;X(F)||(F=ee(F));var O=L(T,F,!1);if(X(O)||!O.delete(_))return!1;if(O.size>0)return!0;var K=p.get(T);return K.delete(F),K.size>0||p.delete(T),!0}e("deleteMetadata",R);function U(_,T){for(var F=_.length-1;F>=0;--F){var O=_[F],K=O(T);if(!X(K)&&!Y(K)){if(!St(K))throw new TypeError;T=K}}return T}function D(_,T,F,O){for(var K=_.length-1;K>=0;--K){var Se=_[K],te=Se(T,F,O);if(!X(te)&&!Y(te)){if(!Z(te))throw new TypeError;O=te}}return O}function L(_,T,F){var O=p.get(_);if(X(O)){if(!F)return;O=new f,p.set(_,O)}var K=O.get(T);if(X(K)){if(!F)return;K=new f,O.set(T,K)}return K}function k(_,T,F){var O=V(_,T,F);if(O)return!0;var K=nt(T);return Y(K)?!1:k(_,K,F)}function V(_,T,F){var O=L(T,F,!1);return X(O)?!1:ke(O.has(_))}function se(_,T,F){var O=V(_,T,F);if(O)return J(_,T,F);var K=nt(T);if(!Y(K))return se(_,K,F)}function J(_,T,F){var O=L(T,F,!1);if(!X(O))return O.get(_)}function ue(_,T,F,O){var K=L(F,O,!0);K.set(_,T)}function fe(_,T){var F=we(_,T),O=nt(_);if(O===null)return F;var K=fe(O,T);if(K.length<=0)return F;if(F.length<=0)return K;for(var Se=new d,te=[],ie=0,q=F;ie<q.length;ie++){var le=q[ie],re=Se.has(le);re||(Se.add(le),te.push(le))}for(var qe=0,Xn=K;qe<Xn.length;qe++){var le=Xn[qe],re=Se.has(le);re||(Se.add(le),te.push(le))}return te}function we(_,T){var F=[],O=L(_,T,!1);if(X(O))return F;for(var K=O.keys(),Se=$e(K),te=0;;){var ie=At(Se);if(!ie)return F.length=te,F;var q=Sn(ie);try{F[te]=q}catch(le){try{dt(Se)}finally{throw le}}te++}}function ft(_){if(_===null)return 1;switch(typeof _){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return _===null?1:6;default:return 6}}function X(_){return _===void 0}function Y(_){return _===null}function H(_){return typeof _=="symbol"}function Z(_){return typeof _=="object"?_!==null:typeof _=="function"}function ae(_,T){switch(ft(_)){case 0:return _;case 1:return _;case 2:return _;case 3:return _;case 4:return _;case 5:return _}var F=T===3?"string":T===5?"number":"default",O=tt(_,i);if(O!==void 0){var K=O.call(_,F);if(Z(K))throw new TypeError;return K}return Ee(_,F==="default"?"number":F)}function Ee(_,T){if(T==="string"){var F=_.toString;if(Tt(F)){var O=F.call(_);if(!Z(O))return O}var K=_.valueOf;if(Tt(K)){var O=K.call(_);if(!Z(O))return O}}else{var K=_.valueOf;if(Tt(K)){var O=K.call(_);if(!Z(O))return O}var Se=_.toString;if(Tt(Se)){var O=Se.call(_);if(!Z(O))return O}}throw new TypeError}function ke(_){return!!_}function N(_){return""+_}function ee(_){var T=ae(_,3);return H(T)?T:N(T)}function He(_){return Array.isArray?Array.isArray(_):_ instanceof Object?_ instanceof Array:Object.prototype.toString.call(_)==="[object Array]"}function Tt(_){return typeof _=="function"}function St(_){return typeof _=="function"}function Tn(_){switch(ft(_)){case 3:return!0;case 4:return!0;default:return!1}}function tt(_,T){var F=_[T];if(F!=null){if(!Tt(F))throw new TypeError;return F}}function $e(_){var T=tt(_,s);if(!Tt(T))throw new TypeError;var F=T.call(_);if(!Z(F))throw new TypeError;return F}function Sn(_){return _.value}function At(_){var T=_.next();return T.done?!1:T}function dt(_){var T=_.return;T&&T.call(_)}function nt(_){var T=Object.getPrototypeOf(_);if(typeof _!="function"||_===u||T!==u)return T;var F=_.prototype,O=F&&Object.getPrototypeOf(F);if(O==null||O===Object.prototype)return T;var K=O.constructor;return typeof K!="function"||K===_?T:K}function Ct(){var _={},T=[],F=function(){function te(ie,q,le){this._index=0,this._keys=ie,this._values=q,this._selector=le}return te.prototype["@@iterator"]=function(){return this},te.prototype[s]=function(){return this},te.prototype.next=function(){var ie=this._index;if(ie>=0&&ie<this._keys.length){var q=this._selector(this._keys[ie],this._values[ie]);return ie+1>=this._keys.length?(this._index=-1,this._keys=T,this._values=T):this._index++,{value:q,done:!1}}return{value:void 0,done:!0}},te.prototype.throw=function(ie){throw this._index>=0&&(this._index=-1,this._keys=T,this._values=T),ie},te.prototype.return=function(ie){return this._index>=0&&(this._index=-1,this._keys=T,this._values=T),{value:ie,done:!0}},te}();return function(){function te(){this._keys=[],this._values=[],this._cacheKey=_,this._cacheIndex=-2}return Object.defineProperty(te.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),te.prototype.has=function(ie){return this._find(ie,!1)>=0},te.prototype.get=function(ie){var q=this._find(ie,!1);return q>=0?this._values[q]:void 0},te.prototype.set=function(ie,q){var le=this._find(ie,!0);return this._values[le]=q,this},te.prototype.delete=function(ie){var q=this._find(ie,!1);if(q>=0){for(var le=this._keys.length,re=q+1;re<le;re++)this._keys[re-1]=this._keys[re],this._values[re-1]=this._values[re];return this._keys.length--,this._values.length--,ie===this._cacheKey&&(this._cacheKey=_,this._cacheIndex=-2),!0}return!1},te.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=_,this._cacheIndex=-2},te.prototype.keys=function(){return new F(this._keys,this._values,O)},te.prototype.values=function(){return new F(this._keys,this._values,K)},te.prototype.entries=function(){return new F(this._keys,this._values,Se)},te.prototype["@@iterator"]=function(){return this.entries()},te.prototype[s]=function(){return this.entries()},te.prototype._find=function(ie,q){return this._cacheKey!==ie&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ie)),this._cacheIndex<0&&q&&(this._cacheIndex=this._keys.length,this._keys.push(ie),this._values.push(void 0)),this._cacheIndex},te}();function O(te,ie){return te}function K(te,ie){return ie}function Se(te,ie){return[te,ie]}}function Vt(){return function(){function _(){this._map=new f}return Object.defineProperty(_.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),_.prototype.has=function(T){return this._map.has(T)},_.prototype.add=function(T){return this._map.set(T,T),this},_.prototype.delete=function(T){return this._map.delete(T)},_.prototype.clear=function(){this._map.clear()},_.prototype.keys=function(){return this._map.keys()},_.prototype.values=function(){return this._map.values()},_.prototype.entries=function(){return this._map.entries()},_.prototype["@@iterator"]=function(){return this.keys()},_.prototype[s]=function(){return this.keys()},_}()}function Kt(){var _=16,T=c.create(),F=O();return function(){function q(){this._key=O()}return q.prototype.has=function(le){var re=K(le,!1);return re!==void 0?c.has(re,this._key):!1},q.prototype.get=function(le){var re=K(le,!1);return re!==void 0?c.get(re,this._key):void 0},q.prototype.set=function(le,re){var qe=K(le,!0);return qe[this._key]=re,this},q.prototype.delete=function(le){var re=K(le,!1);return re!==void 0?delete re[this._key]:!1},q.prototype.clear=function(){this._key=O()},q}();function O(){var q;do q="@@WeakMap@@"+ie();while(c.has(T,q));return T[q]=!0,q}function K(q,le){if(!t.call(q,F)){if(!le)return;Object.defineProperty(q,F,{value:c.create()})}return q[F]}function Se(q,le){for(var re=0;re<le;++re)q[re]=Math.random()*255|0;return q}function te(q){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(q)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(q)):Se(new Uint8Array(q),q):Se(new Array(q),q)}function ie(){var q=te(_);q[6]=q[6]&79|64,q[8]=q[8]&191|128;for(var le="",re=0;re<_;++re){var qe=q[re];(re===4||re===6||re===8)&&(le+="-"),qe<16&&(le+="0"),le+=qe.toString(16).toLowerCase()}return le}}function An(_){return _.__=void 0,delete _.__,_}})})(cc||(cc={}));var to=pe(ye());var Ye="CleverSearch",jo='"\u25B6"',Uo='"\u25BC"';var Wo="&nbsp;&nbsp;&nbsp;&nbsp;";var _p={},Be,Dc=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Dc.decode();var Gi=null;function Ji(){return(Gi===null||Gi.buffer!==Be.memory.buffer)&&(Gi=new Uint8Array(Be.memory.buffer)),Gi}function Vo(n,e){return Dc.decode(Ji().subarray(n,n+e))}var Gt=new Array(32).fill(void 0);Gt.push(void 0,null,!0,!1);var Or=Gt.length;function Mr(n){Or===Gt.length&&Gt.push(Gt.length+1);let e=Or;return Or=Gt[e],Gt[e]=n,e}function Qi(n){return Gt[n]}function pp(n){n<36||(Gt[n]=Or,Or=n)}function Dr(n){let e=Qi(n);return pp(n),e}function Ko(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=Ko(n[0]));for(let o=1;o<i;o++)s+=", "+Ko(n[o]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch(i){return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}var es=0,Zi=new TextEncoder("utf-8"),mp=typeof Zi.encodeInto=="function"?function(n,e){return Zi.encodeInto(n,e)}:function(n,e){let t=Zi.encode(n);return e.set(t),{read:n.length,written:t.length}};function Oc(n,e,t){if(t===void 0){let a=Zi.encode(n),l=e(a.length);return Ji().subarray(l,l+a.length).set(a),es=a.length,l}let r=n.length,i=e(r),s=Ji(),o=0;for(;o<r;o++){let a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3);let a=Ji().subarray(i+o,i+r),l=mp(n,a);o+=l.written}return es=o,i}var Xi=null;function ts(){return(Xi===null||Xi.buffer!==Be.memory.buffer)&&(Xi=new Int32Array(Be.memory.buffer)),Xi}var Yi=null;function gp(){return(Yi===null||Yi.buffer!==Be.memory.buffer)&&(Yi=new Uint32Array(Be.memory.buffer)),Yi}function yp(n,e){let r=gp().subarray(n/4,n/4+e),i=[];for(let s=0;s<r.length;s++)i.push(Dr(r[s]));return i}function Ho(n,e){try{let a=Be.__wbindgen_add_to_stack_pointer(-16);var t=Oc(n,Be.__wbindgen_malloc,Be.__wbindgen_realloc),r=es;Be.cut_for_search(a,t,r,e);var i=ts()[a/4+0],s=ts()[a/4+1],o=yp(i,s).slice();return Be.__wbindgen_free(i,s*4),o}finally{Be.__wbindgen_add_to_stack_pointer(16)}}async function vp(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}async function Rc(n){typeof n=="undefined"&&(n=new URL("jieba_rs_wasm_bg.wasm",_p.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var o=Vo(i,s);return Mr(o)},e.wbg.__wbindgen_object_drop_ref=function(i){Dr(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return Mr(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return Mr(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,o){Qi(i)[Dr(s)]=Dr(o)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=Qi(i);return Mr(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var o=new Error(Vo(i,s));return Mr(o)},e.wbg.__wbindgen_debug_string=function(i,s){var o=Ko(Qi(s)),a=Oc(o,Be.__wbindgen_malloc,Be.__wbindgen_realloc),l=es;ts()[i/4+1]=l,ts()[i/4+0]=a},e.wbg.__wbindgen_throw=function(i,s){throw new Error(Vo(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw Dr(i)},(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await vp(await n,e);return Be=t.exports,Rc.__wbindgen_wasm_module=r,Be}var Lc=Rc;var Rr=(r=>(r.other="Other Language",r.en="English",r.zh="\u7B80\u4F53\u4E2D\u6587",r))(Rr||{});var kc=pe(ye());var Lr={traceLog:!1,loadIndexFromDatabase:!0};var $o=class{constructor(){this.logLevel="debug";this.levelWeights={trace:1,debug:2,info:3,warn:4,error:5,none:6}}getLevel(){return this.logLevel}setLevel(e){this.logLevel=e}trace(...e){this.shouldLog("trace")&&(Lr.traceLog?(console.groupCollapsed(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.log(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;",...e))}debug(...e){this.shouldLog("debug")&&(Lr.traceLog?(console.groupCollapsed(`%c[debug] ${this.getCallerName()}
`,"color: #379237;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.debug(`%c[debug] ${this.getCallerName()}
`,"color: #379237",...e))}info(...e){this.shouldLog("info")&&console.info(`%c[info] ${this.getCallerName()}
`,"color: blue;",...e)}warn(...e){this.shouldLog("warn")&&console.warn(`%c[warn] ${this.getCallerName()}
`,"color: orange;",...e)}error(...e){this.shouldLog("error")&&console.error(`%c[error] ${this.getCallerName()}
`,"color: red;",...e)}getCallerName(){var i;let e=(i=new Error().stack)==null?void 0:i.split(`
`),t=e==null?void 0:e.slice(3).find(s=>!s.includes("eval")&&!s.includes("Array.map"));if(t!=null&&t.startsWith("    at blob:"))return"child-thread";let r=t==null?void 0:t.match(/at (\S+)/);return r?`<${r[1]}> `:"failed to parse caller"}shouldLog(e){return this.levelWeights[e]>=this.levelWeights[this.logLevel]}},A=new $o;var sn=!1,Qn="This branch hasn't been implemented",ns="this branch shouldn't be reached by design",zt=class{static extractDomainFromHttpsUrl(e){if(e.startsWith("http://"))return A.error("Only support https, current url starts with http"),"";let t=/^(https?:\/\/)?([\w.-]+)(?:\/|$)/,r=e.match(t);return r&&r[2]?r[2]:""}static append(e,t){for(let r of t)e.push(r);return e}static mergeDeep(e,...t){if(!t.length)return e;let r=t.shift();if(qo(e)&&qo(r))for(let i in r)qo(r[i])?(e[i]||Object.assign(e,{[i]:{}}),zt.mergeDeep(e[i],r[i])):Object.assign(e,{[i]:r[i]});return zt.mergeDeep(e,...t)}static getCurrLanguage(){let e=window.localStorage.getItem("language")||"en";return e in Rr?Rr[e]:"Other Language"}static sleep(e){return new Promise(t=>setTimeout(t,e))}};async function Nc(n,...e){let t=Date.now();await n(...e);let r=Date.now(),i=Bc(r-t);A.debug(`<${n.name.replace(/^bound /,"")}> Execution time: ${i}`)}function ze(n,e,t){let r=t.value;return t.value=function(...i){let s=Date.now(),o=r.apply(this,i),a=()=>{let l=Date.now();A.trace(`<${n.constructor.name}-${e}> Execution time: ${Bc(l-s)}`)};return o instanceof Promise?o.then(l=>(a(),l)):(a(),o)},t}function Bc(n){if(n<1e3)return`${n} ms`;if(n<6e4){let e=Math.floor(n/1e3),t=n%1e3;return`${e} s ${t} ms`}else{let e=Math.floor(n/6e4),t=Math.floor(n%6e4/1e3),r=n%1e3;return`${e} min ${t} s ${r} ms`}}function w(n){try{return kc.container.resolve(n)}catch(e){let t=`CleverSearch for developer:
There might be wrong usages for tsyringe:
1. Inject an instance for static field
2. Cycle dependencies without delay
3. Unknown error`;return A.warn(t),A.error(e),alert(t),-1}}function qo(n){return n&&typeof n=="object"&&!Array.isArray(n)}var de=class{},zc=window.localStorage.getItem("language")==="zh",jc={customExtensions:{plaintext:["md"]},followObsidianExcludedFiles:!0,excludedPaths:[],logLevel:sn?"trace":"info",isCaseSensitive:!1,isPrefixMatch:!0,isFuzzy:!0,enableStopWordsEn:!0,enableChinesePatch:!!zc,enableStopWordsZh:!!zc,apiProvider1:{domain:"",key:""},apiProvider2:{domain:"",key:""},ui:{openInNewPane:!0,maxItemResults:30,floatingWindowForInFile:!0,showedExtension:"except md",collapseDevSettingByDefault:!1,inFileFloatingWindowTop:"2.7em",inFileFloatingWindowLeft:"2.5em"},semantic:{isEnabled:!1,serverType:"local"}},Uc={search:{fuzzyProportion:.2,minTermLengthForPrefixSearch:2,weightFilename:3,weightFolder:2,weightTagText:1.15,weightHeading:1.27}};var Gc=require("obsidian");var Zn=require("obsidian");var Ae=class extends Zn.Notice{constructor(e,t=0){super(e+`
(clever-search)`,t)}},rs=class extends Zn.AbstractInputSuggest{constructor(t,r,i){super(w(Zn.App),t);this.inputEl=t;this.onSelectCb=i;this.content=r}getSuggestions(t){return[...this.content].filter(r=>r.toLowerCase().contains(t.toLowerCase()))}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t,r){this.onSelectCb(t),this.inputEl.value="",this.close()}},Go=class{},Av=new Go;var $c=require("obsidian");var bp=pe(require("fs")),wp=pe(require("path")),Wc=pe(ye());var er=bp,De=wp,ve=class{static getBasename(e){return De.basename(e,De.extname(e))}static getExtension(e){return De.extname(e).slice(1)}static getFolderPath(e){let t=De.dirname(e);return t==="."||t===De.sep||t==="/"?"./":t.replace(new RegExp("\\"+De.sep,"g"),"/")+"/"}static countFileByExtensions(e){let t=new Map;e.forEach(i=>{let s=i.extension||"no_extension";t.set(s,(t.get(s)||0)+1)});let r=Object.fromEntries(t);return A.trace(r),r}};ve.SPLIT_EOL=`
`,ve.JOIN_EOL=`
`,ve=j([(0,Wc.singleton)()],ve);var Vc=require("electron"),xp=(Vc.app||Vc.remote.app).getPath("userData"),Ep=De.join(xp,"clever-search"),Xo=De.join(Ep,"stop-words-en.txt"),Yo={"Reindexing...":"Reindexing...","Indexing finished":"Indexing finished","files need to be indexed. Obsidian may freeze for a while":"files need to be indexed. Obsidian may freeze for a while","Omnisearch isn't installed":"Omnisearch isn't installed","Omnisearch is installed but not enabled":"Omnisearch is installed but not enabled","Database has been updated, a reindex is required":"Database has been updated, a reindex is required","Semantic init time":"The local model indexes at a speed of approximately 100-500 words per second. During this time, please do not close Obsidian.","Semantic init finished":"Semantic engine is ready","Downloading aiHelper":"Downloading clever-search-ai-helper.zip (972 MB)...","Download success":"Successfully downloaded","Download failure":"Failed to download clever-search-ai-helper.zip  ","Download manually":"Download manually","Max items count":"Max items count","Max items count desc":"Due to renderer's limited capabilities, this plugin can find thousands of results, but cannot display them all at once","Floating window for in-file search":"Floating window for in-file search","Floating window for in-file search desc":"Execute 'in-file search' command again will close the existing floating window. Disable this option to use classic modal UI","Case sensitive":"Case sensitive","Prefix match":"Prefix match","Character fuzzy allowed":"Character fuzzy allowed","English word blacklist":"English word blacklist","English word blacklist desc":`Exclude some meaningless English words like "do", "and", "them" from indexing, enhancing search and indexing speed. Modify the file at ${Xo} to tailor the list to your needs.`,"Chinese patch":"Chinese patch","Chinese patch desc":"Better search result for Chinese","Chinese word blacklist":"Chinese word blacklist","Chinese word blacklist desc":`Activates only if the Chinese Patch is enabled. This excludes some meaningless Chinese words like "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" listed in 'stop-words-zh.txt', improving search efficiency and speed. More details are listed in "English word blacklist" option`,Advanced:"Advanced","Advanced.desc":"The previous settings cover most needs. For further customization, adjust the following options","Semantic search":"Semantic search",Introduction:"Introduction","Introduction.desc":"Semantic search is only supported on the Windows system. It is only recommended for small and medium-sized vault. If a vault has more than 8 million words, the initial indexing may take dozens of hours. You need to extract the .cache folder from the downloaded archive and place it in C:\\Users\\<current user>. Then, run clever-search-ai-helper.exe to start the semantic engine. Semantic search is intended to complement lexical search and is not as effective in exact matching as lexical search.",Enable:"Enable","Server type":"Server type","Server type.desc":"For local server, Clever Search AI Helper needs to run in the background. For remote server, it will not be implemented in the short term.",local:"local",Utilities:"Utilities","Test connection":"Test connection",Download:"Download","Additional Information":"Additional Information","Additional Information.desc":"When semantic search is turned on and ai-helper is running, Reindex will be applied to both lexical and semantic engine; each time this plugin is loaded, the semantic engine will automatically perform an incremental index, and subsequent file modifications will not update the index to avoid blocking semantic search.","Excluded files":"Excluded files",Manage:"Manage","Follow Obsidian Excluded Files":"Follow Obsidian Excluded Files","Enter path...":"Enter path...",Add:"Add","Customize extensions":"Customize extensions","extensionModal.desc":"Customize the file extensions you would like to index. By default, file types not natively supported by Obsidian, such as 'txt', will be opened with an external program. To open these files within Obsidian, you may need to install plugins like 'obsidian-custom-file-extension-plugin' or 'obsidian-vscode-editor'.","extensionModal.plaintextName":"Plaintext","extensionModal.plaintextDesc":"Extensions should be separated by a space or a newline character. Please do not include binary filetypes like 'pdf', 'jpg', 'mp4', etc, that can't be opened with notepad. Including them might cause indexing issues. Additionally, the indexing and searching of HTML files may be slower because they require conversion to clean Markdown format first. Furthermore, due to the extremely limited API, it seems impossible to automatically scroll to specific locations within HTML files.","For Development":"For Development","Collapse development setting by default":"Collapse development setting by default","Reindex the vault":"Reindex the vault",Reindex:"Reindex","Log level":"Log level","Reset floating window position":"Reset floating window position","Reset floating window position desc":"In case the window is moved outside the visible area","Reset position":"Reset position","Support the Project":"Support the Project","Support the Project desc":"Enjoying this plugin? Show your support with a star on GitHub!","Visit GitHub":"Visit GitHub"};var Kc={"Reindexing...":"\u91CD\u5EFA\u7D22\u5F15\u4E2D...","Indexing finished":"\u7D22\u5F15\u5B8C\u6210","files need to be indexed. Obsidian may freeze for a while":"\u6587\u4EF6\u9700\u8981\u88AB\u7D22\u5F15, Obsidian \u53EF\u80FD\u4F1A\u5361\u987F\u4E00\u4F1A\u513F","Omnisearch isn't installed":"\u672A\u5B89\u88C5 Omnisearch","Omnisearch is installed but not enabled":"\u5B89\u88C5\u4E86 Omnisearch \u4F46\u662F\u6CA1\u6709\u542F\u7528","Database has been updated, a reindex is required":"\u6570\u636E\u5E93\u5DF2\u66F4\u65B0\uFF0C\u9700\u8981\u91CD\u5EFA\u7D22\u5F15","Semantic init time":"\u672C\u5730\u6A21\u578B\u7D22\u5F15\u901F\u5EA6\u5927\u7EA6\u662F 200-800 \u5B57\u6BCF\u79D2\uFF0C\u5728\u6B64\u671F\u95F4\u8BF7\u4E0D\u8981\u5173\u95ED Obsidian","Semantic init finished":"\u8BED\u4E49\u5F15\u64CE\u5DF2\u5C31\u7EEA","Downloading aiHelper":"\u6B63\u5728\u4E0B\u8F7D clever-search-ai-helper.zip (972 MB)...","Download success":"\u4E0B\u8F7D\u6210\u529F","Download failure":"clever-search-ai-helper.zip \u4E0B\u8F7D\u5931\u8D25  ","Download manually":"\u70B9\u6B64\u624B\u52A8\u4E0B\u8F7D","Max items count":"\u6700\u5927\u5019\u9009\u9879\u6570","Max items count desc":"\u867D\u7136\u672C\u63D2\u4EF6\u53EF\u4EE5\u641C\u7D22\u5230\u6210\u5343\u4E0A\u4E07\u4E2A\u7ED3\u679C\uFF0C\u4F46\u7531\u4E8E\u5E95\u5C42\u6E32\u67D3\u5668\u6027\u80FD\u9650\u5236\uFF0C\u4E0D\u80FD\u5373\u65F6\u6E32\u67D3\u6240\u6709\u7ED3\u679C","Floating window for in-file search":"\u6587\u4EF6\u5185\u641C\u7D22\u4F7F\u7528\u60AC\u6D6E\u7A97\u53E3 UI","Floating window for in-file search desc":"\u518D\u6B21\u6267\u884C '\u6587\u4EF6\u5185\u641C\u7D22' \u547D\u4EE4\u4F1A\u5173\u95ED\u5DF2\u6709\u7684\u60AC\u6D6E\u7A97\u53E3\u3002\u5173\u95ED\u8FD9\u4E2A\u9009\u9879\u5C06\u4F7F\u7528\u6A21\u6001\u6846 UI","Case sensitive":"\u533A\u5206\u5927\u5C0F\u5199","Prefix match":"\u5355\u8BCD\u524D\u7F00\u5339\u914D","Character fuzzy allowed":"\u5141\u8BB8\u5B57\u7B26\u6A21\u7CCA","English word blacklist":"\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355","English word blacklist desc":`\u5EFA\u7ACB\u7D22\u5F15\u65F6\uFF0C\u5FFD\u7565\u4E00\u4E9B\u542B\u4E49\u6A21\u7CCA\u7684\u5355\u8BCD\uFF0C\u6BD4\u5982 "do", "and", "them", \u53EF\u4EE5\u52A0\u5FEB\u7D22\u5F15\u548C\u641C\u7D22\u901F\u5EA6\uFF0C\u4F46\u662F\u8FD9\u4E9B\u5355\u8BCD\u4E0D\u4F1A\u88AB\u641C\u7D22\u5230. \u53EF\u4EE5\u5728 ${Xo} \u6309\u9700\u4FEE\u6539\u5355\u8BCD\u9ED1\u540D\u5355`,"Chinese patch":"\u4E2D\u6587\u641C\u7D22\u4F18\u5316","Chinese patch desc":"\u66F4\u597D\u7684\u4E2D\u6587\u641C\u7D22\u7ED3\u679C","Chinese word blacklist":"\u4E2D\u6587\u8BCD\u8BED\u9ED1\u540D\u5355","Chinese word blacklist desc":'\u53EA\u5728\u5F00\u542F\u4E2D\u6587\u641C\u7D22\u4F18\u5316\u65F6\u751F\u6548\u3002\u5FFD\u7565 "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" \u7B49\u8BCD\u8BED\uFF0C\u8BE6\u7EC6\u5217\u8868\u5728 "stop-words-zh.txt"\u3002\u8BE6\u89C1 "\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355" \u9009\u9879',Advanced:"\u8FDB\u9636\u8BBE\u7F6E","Advanced.desc":"\u4E4B\u524D\u7684\u8BBE\u7F6E\u901A\u5E38\u80FD\u6EE1\u8DB3\u5927\u591A\u6570\u4F7F\u7528\u573A\u666F\uFF0C\u5982\u679C\u4F60\u60F3\u6709\u66F4\u4E2A\u6027\u5316\u7684\u8BBE\u7F6E\uFF0C\u53EF\u4EE5\u8C03\u6574\u4E0B\u9762\u7684\u9009\u9879","Semantic search":"\u8BED\u4E49\u641C\u7D22",Introduction:"\u4ECB\u7ECD","Introduction.desc":"\u8BED\u4E49\u641C\u7D22\u53EA\u652F\u6301 Windows \u7CFB\u7EDF\u3002\u4EC5\u63A8\u8350\u4E2D\u5C0F\u578B\u8D44\u6599\u5E93\u4F7F\u7528, \u5982\u679C\u67D0\u4E2A\u4ED3\u5E93\u6709\u8D85\u8FC71500\u4E07\u5B57, \u521D\u6B21\u7D22\u5F15\u53EF\u80FD\u9700\u8981\u51E0\u5341\u4E2A\u5C0F\u65F6\u3002\u5C06\u4E0B\u8F7D\u7684\u538B\u7F29\u5305\u89E3\u538B\u51FA\u7684 .cache \u6587\u4EF6\u5939\u653E\u5728 C:\\Users\\<current user>, \u7136\u540E\u8FD0\u884C clever-search-ai-helper.exe \u6765\u542F\u52A8\u8BED\u4E49\u5F15\u64CE\u3002\u8BED\u4E49\u641C\u7D22\u65E8\u5728\u4F5C\u4E3A\u8BCD\u6C47\u641C\u7D22\u7684\u8865\u5145\uFF0C\u5728\u7CBE\u786E\u5339\u914D\u4E0A\u6548\u679C\u662F\u4E0D\u5982\u8BCD\u6C47\u641C\u7D22\u7684",Enable:"\u542F\u7528","Server type":"\u670D\u52A1\u5668\u7C7B\u578B","Server type.desc":"\u5BF9\u4E8E\u672C\u5730\u670D\u52A1\u5668\uFF0Cclever-search-ai-helper.exe \u9700\u8981\u5728\u540E\u53F0\u8FD0\u884C; \u8FDC\u7A0B\u670D\u52A1\u5668\u77ED\u671F\u5185\u4E0D\u4F1A\u5B9E\u73B0",local:"\u672C\u5730",Utilities:"\u5B9E\u7528\u529F\u80FD","Test connection":"\u6D4B\u8BD5\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Additional Information":"\u8865\u5145\u4FE1\u606F","Additional Information.desc":"\u5728\u5F00\u542F\u8BED\u4E49\u641C\u7D22\u5E76\u8FD0\u884C ai-helper \u7684\u60C5\u51B5\u4E0B\uFF0C\u91CD\u65B0\u7D22\u5F15 \u4F1A\u540C\u65F6\u5E94\u7528\u4E8E\u8BCD\u6C47\u5F15\u64CE\u548C\u8BED\u4E49\u5F15\u64CE\uFF1B\u6BCF\u6B21\u52A0\u8F7D\u63D2\u4EF6\u7684\u65F6\u5019\uFF0C\u8BED\u4E49\u5F15\u64CE\u4F1A\u81EA\u52A8\u8FDB\u884C\u4E00\u6B21\u589E\u91CF\u7D22\u5F15\uFF0C\u4E4B\u540E\u4FEE\u6539\u6587\u4EF6\u4E0D\u4F1A\u66F4\u65B0\u7D22\u5F15\u4EE5\u907F\u514D\u963B\u585E\u8BED\u4E49\u641C\u7D22\u3002","Excluded files":"\u5FFD\u7565\u6587\u4EF6",Manage:"\u7BA1\u7406","Follow Obsidian Excluded Files":"\u8DDF\u968F Obsidian \u5FFD\u7565\u6587\u4EF6\u8BBE\u7F6E","Enter path...":"\u8BF7\u8F93\u5165\u8DEF\u5F84...",Add:"\u6DFB\u52A0","Customize extensions":"\u81EA\u5B9A\u4E49\u540E\u7F00\u540D","extensionModal.desc":"\u81EA\u5B9A\u4E49\u5E0C\u671B\u7D22\u5F15\u7684\u6587\u4EF6\u540E\u7F00\u540D\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B Obsidian \u4E0D\u539F\u751F\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B\uFF0C\u5982 'txt'\uFF0C\u5C06\u901A\u8FC7\u5916\u90E8\u7A0B\u5E8F\u6253\u5F00\u3002\u8981\u5728 Obsidian \u5185\u6253\u5F00\u8FD9\u4E9B\u6587\u4EF6\uFF0C\u53EF\u80FD\u9700\u8981\u5B89\u88C5\u63D2\u4EF6\uFF0C\u5982 'obsidian-custom-file-extension-plugin' \u6216 'obsidian-vscode-editor'\u3002","extensionModal.plaintextName":"\u7EAF\u6587\u672C","extensionModal.plaintextDesc":"\u540E\u7F00\u540D\u4F7F\u7528\u7A7A\u683C\u6216\u6362\u884C\u7B26\u5206\u9694\u3002\u8BF7\u4E0D\u8981\u5728\u6B64\u5904\u5305\u542B 'pdf'\u3001'jpg'\u3001'mp4' \u7B49\u65E0\u6CD5\u7528\u8BB0\u4E8B\u672C\u6253\u5F00\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u7D22\u5F15\u95EE\u9898\u3002\u53E6\u5916\uFF0C\u7D22\u5F15\u548C\u641C\u7D22 HTML \u6587\u4EF6\u53EF\u80FD\u4F1A\u66F4\u6162\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u9996\u5148\u9700\u8981\u8F6C\u6362\u4E3A\u5E72\u51C0\u7684 Markdown \u683C\u5F0F\u3002\u6B64\u5916\uFF0C\u53D7 API \u9650\u5236, \u81EA\u52A8\u6EDA\u52A8\u5230 HTML \u6587\u4EF6\u4E2D\u7684\u7279\u5B9A\u4F4D\u7F6E\u4F3C\u4E4E\u4E0D\u53EF\u884C\u3002","For Development":"\u5F00\u53D1\u8BBE\u7F6E","Collapse development setting by default":"\u9ED8\u8BA4\u6298\u53E0\u5F00\u53D1\u8BBE\u7F6E","Reindex the vault":"\u91CD\u65B0\u7D22\u5F15\u5168\u5E93",Reindex:"\u91CD\u65B0\u7D22\u5F15","Log level":"\u65E5\u5FD7\u7B49\u7EA7","Reset floating window position":"\u91CD\u7F6E\u60AC\u6D6E\u7A97\u53E3\u4F4D\u7F6E","Reset floating window position desc":"\u5982\u679C\u7A97\u53E3\u88AB\u62D6\u5230\u770B\u4E0D\u89C1\u7684\u4F4D\u7F6E, \u53EF\u4EE5\u70B9\u6B64\u6309\u94AE\u91CD\u7F6E","Reset position":"\u91CD\u7F6E\u4F4D\u7F6E","Support the Project":"\u652F\u6301\u8FD9\u4E2A\u9879\u76EE","Support the Project desc":"\u5982\u679C\u89C9\u5F97\u672C\u63D2\u4EF6\u5BF9\u4F60\u6709\u5E2E\u52A9\uFF0C\u5E0C\u671B\u80FD\u5230 GitHub \u70B9\u4E2A star","Visit GitHub":"\u8BBF\u95EE GitHub"};var Tp={en:Yo,"zh-cn":Kc},Hc=Tp[$c.moment.locale()];function B(n){return Hc&&Hc[n]||Yo[n]}var Xc=pe(ye());var qc=require("electron"),Sp=(qc.app||qc.remote.app).getPath("userData"),ta=De.join(Sp,"clever-search"),Ap="https://bitbucket.org/alexclifton37/obsidian-clever-search/raw/dev/assets/for-program/",Cp="https://raw.githubusercontent.com/yan42685/obsidian-clever-search/dev/assets/for-program/",Fp="https://bitbucket.org/alexclifton37/shared-assets/raw/master/",Ip="https://unpkg.com/",Kv=Ip+"@dqbd/tiktoken@1.0.7/tiktoken_bg.wasm",Hv=De.join(ta,"tiktoken_bg.wasm"),Jo="jieba_rs_wasm_bg.wasm",Qo="stop-words-en.txt",Zo="stop-words-zh.txt",ea="clever-search-ai-helper.zip",st=class{constructor(){this.setting=w(de);this._assets=Pp}get assets(){return this._assets}async initAsync(){A.trace("preparing assets..."),A.trace(`target dir: ${ta}`);try{await this.initHelper(Ap)}catch(e){try{await this.initHelper(Cp),A.info("download successfully")}catch(t){throw A.warn("failed to download assets"),t}}}async downloadAiHelper(){let e=new Ae(B("Downloading aiHelper"));try{await this.downloadFile(this.targetPath(ea),Fp+ea),new Ae(B("Download success"),5e3);let{shell:t}=require("electron");t.showItemInFolder(this.targetPath(ea)),t.openPath(require("os").userInfo().homedir)}catch(t){A.error(t);let r=document.createDocumentFragment(),i=document.createTextNode(B("Download failure")),s=document.createElement("button");s.textContent=B("Download manually"),s.onclick=()=>window.open("https://bitbucket.org/alexclifton37/shared-assets/raw/master/clever-search-ai-helper.zip"),r.appendChild(i),r.appendChild(s),new Gc.Notice(r,0)}finally{e.hide()}}async initHelper(e){this.setting.enableChinesePatch&&(await this.downloadFile(this.targetPath(Jo),e+Jo),await this.downloadFile(this.targetPath(Zo),e+Zo),this._assets.jiebaBinary=er.promises.readFile(this.targetPath(Jo)),this._assets.stopWordsZh=await this.readLinesAsSet(this.targetPath(Zo))),await this.downloadFile(this.targetPath(Qo),e+Qo),this._assets.stopWordsEn=await this.readLinesAsSet(this.targetPath(Qo))}targetPath(e){return De.join(ta,e)}async readLinesAsSet(e){return new Set((await er.promises.readFile(e,{encoding:"utf-8"})).split(ve.SPLIT_EOL))}async downloadFile(e,t){try{await er.promises.access(e),A.trace("file exists:",e);return}catch(s){if(s.code!=="ENOENT")throw s}let r=De.dirname(e);await er.promises.mkdir(r,{recursive:!0}).catch(s=>{if(s.code!=="EEXIST")throw s});let i=await fetch(t);if(!i.ok)throw new Error(`unexpected response ${i.statusText}`);try{await er.promises.writeFile(e,Buffer.from(await i.arrayBuffer()),"utf-8"),A.info(`successfully download from ${t}`)}catch(s){throw A.error(`failed to download ${t}`),s}}};st=j([(0,Xc.singleton)()],st);var Pp={stopWordsZh:null,stopWordsEn:null,jiebaBinary:new Promise(()=>null)};var Yc=pe(ye());var Pt=class{constructor(){this.isReady=!1;this.reportedError=!1}async initAsync(){if(w(de).enableChinesePatch){let e=w(st).assets.jiebaBinary;await Lc(e),Ho("",!1),this.isReady=!0}}cut(e,t){return!this.isReady&&!this.reportedError?(A.error("jieba segmenter isn't ready"),this.reportedError=!0,[e]):Ho(e,t)}};Pt=j([(0,Yc.singleton)()],Pt);var be=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,Ce=Object.keys,Ue=Array.isArray;typeof Promise!="undefined"&&!be.Promise&&(be.Promise=Promise);function Qe(n,e){return typeof e!="object"||Ce(e).forEach(function(t){n[t]=e[t]}),n}var Ur=Object.getPrototypeOf,Mp={}.hasOwnProperty;function pt(n,e){return Mp.call(n,e)}function sr(n,e){typeof e=="function"&&(e=e(Ur(n))),(typeof Reflect=="undefined"?Ce:Reflect.ownKeys)(e).forEach(t=>{en(n,t,e[t])})}var cu=Object.defineProperty;function en(n,e,t,r){cu(n,e,Qe(t&&pt(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function or(n){return{from:function(e){return n.prototype=Object.create(e.prototype),en(n.prototype,"constructor",n),{extend:sr.bind(null,n.prototype)}}}}var Dp=Object.getOwnPropertyDescriptor;function ka(n,e){let t=Dp(n,e),r;return t||(r=Ur(n))&&ka(r,e)}var Op=[].slice;function Ss(n,e,t){return Op.call(n,e,t)}function uu(n,e){return e(n)}function kr(n){if(!n)throw new Error("Assertion Failed")}function fu(n){be.setImmediate?setImmediate(n):setTimeout(n,0)}function du(n,e){return n.reduce((t,r,i)=>{var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function Rp(n,e,t){try{n.apply(null,t)}catch(r){e&&e(r)}}function Zt(n,e){if(pt(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=Zt(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a===void 0?void 0:Zt(a,e.substr(o+1))}}function Mt(n,e,t){if(!(!n||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){kr(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)Mt(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")t===void 0?Ue(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var l=n[o];(!l||!pt(n,o))&&(l=n[o]={}),Mt(l,a,t)}}else t===void 0?Ue(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function Lp(n,e){typeof e=="string"?Mt(n,e,void 0):"length"in e&&[].map.call(e,function(t){Mt(n,t,void 0)})}function hu(n){var e={};for(var t in n)pt(n,t)&&(e[t]=n[t]);return e}var kp=[].concat;function pu(n){return kp.apply([],n)}var mu="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(pu([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>be[n]),Np=mu.map(n=>be[n]);du(mu,n=>[n,!0]);var an=null;function Gr(n){an=typeof WeakMap!="undefined"&&new WeakMap;let e=la(n);return an=null,e}function la(n){if(!n||typeof n!="object")return n;let e=an&&an.get(n);if(e)return e;if(Ue(n)){e=[],an&&an.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(la(n[t]))}else if(Np.indexOf(n.constructor)>=0)e=n;else{let s=Ur(n);e=s===Object.prototype?{}:Object.create(s),an&&an.set(n,e);for(var i in n)pt(n,i)&&(e[i]=la(n[i]))}return e}var{toString:Bp}={};function ca(n){return Bp.call(n).slice(8,-1)}var ua=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",zp=typeof ua=="symbol"?function(n){var e;return n!=null&&(e=n[ua])&&e.apply(n)}:function(){return null},rr={};function Jt(n){var e,t,r,i;if(arguments.length===1){if(Ue(n))return n.slice();if(this===rr&&typeof n=="string")return[n];if(i=zp(n)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(n==null)return[n];if(e=n.length,typeof e=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}var Na=typeof Symbol!="undefined"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1,Ut=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function gu(n,e){Ut=n,yu=e}var yu=()=>!0,jp=!new Error("").stack;function Nn(){if(jp)try{throw Nn.arguments,new Error}catch(n){return n}return new Error}function fa(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(yu).map(r=>`
`+r).join("")):""}var Up=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],vu=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ba=Up.concat(vu),Wp={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ar(n,e){this._e=Nn(),this.name=n,this.message=e}or(ar).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+fa(this._e,2))}},toString:function(){return this.name+": "+this.message}});function _u(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,r,i)=>i.indexOf(t)===r).join(`
`)}function ms(n,e,t,r){this._e=Nn(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=_u(n,e)}or(ms).from(ar);function Br(n,e){this._e=Nn(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=_u(n,e)}or(Br).from(ar);var za=Ba.reduce((n,e)=>(n[e]=e+"Error",n),{}),Vp=ar,Q=Ba.reduce((n,e)=>{var t=e+"Error";function r(i,s){this._e=Nn(),this.name=t,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Wp[e]||t,this.inner=null)}return or(r).from(Vp),n[e]=r,n},{});Q.Syntax=SyntaxError;Q.Type=TypeError;Q.Range=RangeError;var Jc=vu.reduce((n,e)=>(n[e+"Error"]=Q[e],n),{});function Kp(n,e){if(!n||n instanceof ar||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Jc[n.name])return n;var t=new Jc[n.name](e||n.message,n);return"stack"in n&&en(t,"stack",{get:function(){return this.inner.stack}}),t}var As=Ba.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=Q[e]),n),{});As.ModifyError=ms;As.DexieError=ar;As.BulkError=Br;function me(){}function Xr(n){return n}function Hp(n,e){return n==null||n===Xr?e:function(t){return e(n(t))}}function Ln(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function $p(n,e){return n===me?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Ln(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ln(i,this.onerror):i),s!==void 0?s:t}}function qp(n,e){return n===me?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?Ln(t,this.onsuccess):t),r&&(this.onerror=this.onerror?Ln(r,this.onerror):r)}}function Gp(n,e){return n===me?e:function(t){var r=n.apply(this,arguments);Qe(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ln(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Ln(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Qe(r,o)}}function Xp(n,e){return n===me?e:function(){return e.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function ja(n,e){return n===me?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var Wr={},Yp=100,Jp=20,bu=100,[da,gs,ha]=typeof Promise=="undefined"?[]:(()=>{let n=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[n,Ur(n),n];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ur(e),n]})(),wu=gs&&gs.then,cs=da&&da.constructor,Ua=!!ha,pa=!1,Qp=ha?()=>{ha.then(is)}:be.setImmediate?setImmediate.bind(null,is):be.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{is(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(is,0)},Vr=function(n,e){Nr.push([n,e]),ys&&(Qp(),ys=!1)},ma=!0,ys=!0,On=[],us=[],ga=null,ya=Xr,ir={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:eu,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{eu(n[0],n[1])}catch(e){}})}},G=ir,Nr=[],Rn=0,fs=[];function z(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=me,this._lib=!1;var e=this._PSD=G;if(Ut&&(this._stackHolder=Nn(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==Wr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&_a(this,this._value);return}this._state=null,this._value=null,++e.ref,Eu(this,n)}var va={get:function(){var n=G,e=vs;function t(r,i){var s=!n.global&&(n!==G||e!==vs);let o=s&&!tn();var a=new z((l,c)=>{Wa(this,new xu(bs(r,n,s,o),bs(i,n,s,o),l,c,n))});return Ut&&Au(a,this),a}return t.prototype=Wr,t},set:function(n){en(this,"then",n&&n.prototype===Wr?va:{get:function(){return n},set:va.set})}};sr(z.prototype,{then:va,_then:function(n,e){Wa(this,new xu(null,null,n,e,G))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?t(r):ds(r)):this.then(null,r=>r&&r.name===e?t(r):ds(r))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),ds(e)))},stack:{get:function(){if(this._stack)return this._stack;try{pa=!0;var n=Su(this,[],Jp),e=n.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{pa=!1}}},timeout:function(n,e){return n<1/0?new z((t,r)=>{var i=setTimeout(()=>r(new Q.Timeout(e)),n);this.then(t,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&en(z.prototype,Symbol.toStringTag,"Dexie.Promise");ir.env=Cu();function xu(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}sr(z,{all:function(){var n=Jt.apply(null,arguments).map(_s);return new z(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach((i,s)=>z.resolve(i).then(o=>{n[s]=o,--r||e(n)},t))})},resolve:n=>{if(n instanceof z)return n;if(n&&typeof n.then=="function")return new z((t,r)=>{n.then(t,r)});var e=new z(Wr,!0,n);return Au(e,ga),e},reject:ds,race:function(){var n=Jt.apply(null,arguments).map(_s);return new z((e,t)=>{n.map(r=>z.resolve(r).then(e,t))})},PSD:{get:()=>G,set:n=>G=n},totalEchoes:{get:()=>vs},newPSD:cn,usePSD:cr,scheduler:{get:()=>Vr,set:n=>{Vr=n}},rejectionMapper:{get:()=>ya,set:n=>{ya=n}},follow:(n,e)=>new z((t,r)=>cn((i,s)=>{var o=G;o.unhandleds=[],o.onunhandled=s,o.finalize=Ln(function(){em(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),n()},e,t,r))});cs&&(cs.allSettled&&en(z,"allSettled",function(){let n=Jt.apply(null,arguments).map(_s);return new z(e=>{n.length===0&&e([]);let t=n.length,r=new Array(t);n.forEach((i,s)=>z.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--t||e(r)))})}),cs.any&&typeof AggregateError!="undefined"&&en(z,"any",function(){let n=Jt.apply(null,arguments).map(_s);return new z((e,t)=>{n.length===0&&t(new AggregateError([]));let r=n.length,i=new Array(r);n.forEach((s,o)=>z.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||t(new AggregateError(i))}))})}));function Eu(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&Yr();t&&typeof t.then=="function"?Eu(n,(i,s)=>{t instanceof z?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,Tu(n)),r&&Jr()}},_a.bind(null,n))}catch(t){_a(n,t)}}function _a(n,e){if(us.push(e),n._state===null){var t=n._lib&&Yr();e=ya(e),n._state=!1,n._value=e,Ut&&e!==null&&typeof e=="object"&&!e._promise&&Rp(()=>{var r=ka(e,"stack");e._promise=n,en(e,"stack",{get:()=>pa?r&&(r.get?r.get.apply(e):r.value):n.stack})}),tm(n),Tu(n),t&&Jr()}}function Tu(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)Wa(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),Rn===0&&(++Rn,Vr(()=>{--Rn===0&&Va()},[]))}function Wa(n,e){if(n._state===null){n._listeners.push(e);return}var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++Rn,Vr(Zp,[t,n,e])}function Zp(n,e,t){try{ga=e;var r,i=e._value;e._state?r=n(i):(us.length&&(us=[]),r=n(i),us.indexOf(i)===-1&&nm(e)),t.resolve(r)}catch(s){t.reject(s)}finally{ga=null,--Rn===0&&Va(),--t.psd.ref||t.psd.finalize()}}function Su(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i=n._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=fa(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return Ut&&(r=fa(n._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),n._prev&&Su(n._prev,e,t)),e}function Au(n,e){var t=e?e._numPrev+1:0;t<Yp&&(n._prev=e,n._numPrev=t)}function is(){Yr()&&Jr()}function Yr(){var n=ma;return ma=!1,ys=!1,n}function Jr(){var n,e,t;do for(;Nr.length>0;)for(n=Nr,Nr=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(Nr.length>0);ma=!0,ys=!0}function Va(){var n=On;On=[],n.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=fs.slice(0),t=e.length;t;)e[--t]()}function em(n){function e(){n(),fs.splice(fs.indexOf(e),1)}fs.push(e),++Rn,Vr(()=>{--Rn===0&&Va()},[])}function tm(n){On.some(e=>e._value===n._value)||On.push(n)}function nm(n){for(var e=On.length;e;)if(On[--e]._value===n._value){On.splice(e,1);return}}function ds(n){return new z(Wr,!1,n)}function xe(n,e){var t=G;return function(){var r=Yr(),i=G;try{return un(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{un(i,!1),r&&Jr()}}}var je={awaits:0,echoes:0,id:0},rm=0,hs=[],na=0,vs=0,im=0;function cn(n,e,t,r){var i=G,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++im;var o=ir.env;s.env=Ua?{Promise:z,PromiseProp:{value:z,configurable:!0,writable:!0},all:z.all,race:z.race,allSettled:z.allSettled,any:z.any,resolve:z.resolve,reject:z.reject,nthen:Qc(o.nthen,s),gthen:Qc(o.gthen,s)}:{},e&&Qe(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=cr(s,n,t,r);return s.ref===0&&s.finalize(),a}function lr(){return je.id||(je.id=++rm),++je.awaits,je.echoes+=bu,je.id}function tn(){return je.awaits?(--je.awaits===0&&(je.id=0),je.echoes=je.awaits*bu,!0):!1}(""+wu).indexOf("[native code]")===-1&&(lr=tn=me);function _s(n){return je.echoes&&n&&n.constructor===cs?(lr(),n.then(e=>(tn(),e),e=>(tn(),Pe(e)))):n}function sm(n){++vs,(!je.echoes||--je.echoes===0)&&(je.echoes=je.id=0),hs.push(G),un(n,!0)}function om(){var n=hs[hs.length-1];hs.pop(),un(n,!1)}function un(n,e){var t=G;if((e?je.echoes&&(!na++||n!==G):na&&(!--na||n!==G))&&Fu(e?sm.bind(null,n):om),n!==G&&(G=n,t===ir&&(ir.env=Cu()),Ua)){var r=ir.env.Promise,i=n.env;gs.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(be,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Cu(){var n=be.Promise;return Ua?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(be,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:gs.then,gthen:n.prototype.then}:{}}function cr(n,e,t,r,i){var s=G;try{return un(n,!0),e(t,r,i)}finally{un(s,!1)}}function Fu(n){wu.call(da,n)}function bs(n,e,t,r){return typeof n!="function"?n:function(){var i=G;t&&lr(),un(e,!0);try{return n.apply(this,arguments)}finally{un(i,!1),r&&Fu(tn)}}}function Qc(n,e){return function(t,r){return n.call(this,bs(t,e),bs(r,e))}}var Zc="unhandledrejection";function eu(n,e){var t;try{t=e.onuncatched(n)}catch(s){}if(t!==!1)try{var r,i={promise:e,reason:n};if(be.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Zc,!0,!0),Qe(r,i)):be.CustomEvent&&(r=new CustomEvent(Zc,{detail:i}),Qe(r,i)),r&&be.dispatchEvent&&(dispatchEvent(r),!be.PromiseRejectionEvent&&be.onunhandledrejection))try{be.onunhandledrejection(r)}catch(s){}Ut&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch(s){}}var Pe=z.reject;function ba(n,e,t,r){if(!n.idbdb||!n._state.openComplete&&!G.letThrough&&!n._vip){if(n._state.openComplete)return Pe(new Q.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return Pe(new Q.DatabaseClosed);n.open().catch(me)}return n._state.dbReadyPromise.then(()=>ba(n,e,t,r))}else{var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(s){return s.name===za.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>ba(n,e,t,r))):Pe(s)}return i._promise(e,(s,o)=>cn(()=>(G.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var tu="3.2.4",Dn=String.fromCharCode(65535),wa=-1/0,Xt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Iu="String expected.",zr=[],Cs=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),am=Cs,lm=Cs,Pu=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),Fs="__dbnames",ra="readonly",ia="readwrite";function kn(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}var Mu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ss(n){return typeof n=="string"&&!/\./.test(n)?e=>(e[n]===void 0&&n in e&&(e=Gr(e),delete e[n]),e):e=>e}var xa=class{_trans(e,t,r){let i=this._tx||G.trans,s=this.name;function o(l,c,u){if(!u.schema[s])throw new Q.NotFound("Table "+s+" not part of transaction");return t(u.idbtrans,u)}let a=Yr();try{return i&&i.db===this.db?i===G.trans?i._promise(e,o,r):cn(()=>i._promise(e,o,r),{trans:i,transless:G.transless||G}):ba(this.db,e,[this.name],o)}finally{a&&Jr()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ue(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let t=Ce(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);let r=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&t.every(u=>c.keyPath.indexOf(u)>=0)&&c.keyPath.every(u=>t.indexOf(u)>=0))[0];if(r&&this.db._maxKey!==Dn)return this.where(r.name).equals(r.keyPath.map(c=>e[c]));!r&&Ut&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(c,u){try{return s.cmp(c,u)===0}catch(h){return!1}}let[a,l]=t.reduce(([c,u],h)=>{let f=i[h],d=e[h];return[c||f,c||!f?kn(u,f&&f.multi?m=>{let p=Zt(m,h);return Ue(p)&&p.some(g=>o(d,g))}:m=>o(d,Zt(m,h))):u]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ue(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let t=r=>{if(!r)return r;let i=Object.create(e.prototype);for(var s in r)if(pt(r,s))try{i[s]=r[s]}catch(o){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){function e(t){Qe(this,t)}return this.mapToClass(e)}add(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=ss(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[s]})).then(o=>o.numFailures?z.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Mt(e,i,o)}catch(a){}return o})}update(e,t){if(typeof e=="object"&&!Ue(e)){let r=Zt(e,this.schema.primKey.keyPath);if(r===void 0)return Pe(new Q.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?Ce(t).forEach(i=>{Mt(e,i,t[i])}):t(e,{value:e,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(e).modify(t)}put(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=ss(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:t!=null?[t]:null})).then(o=>o.numFailures?z.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Mt(e,i,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?z.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Mu})).then(e=>e.numFailures?z.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new Q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");let c=e.length,u=l&&a?e.map(ss(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:u,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:m})=>{let p=s?f:d;if(h===0)return p;throw new Br(`${this.name}.bulkAdd(): ${h} of ${c} operations failed`,m)})})}bulkPut(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new Q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");let c=e.length,u=l&&a?e.map(ss(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:u,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:m})=>{let p=s?f:d;if(h===0)return p;throw new Br(`${this.name}.bulkPut(): ${h} of ${c} operations failed`,m)})})}bulkDelete(e){let t=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new Br(`${this.name}.bulkDelete(): ${r} of ${t} operations failed`,s)})}};function Qr(n){var e={},t=function(a,l){if(l){for(var c=arguments.length,u=new Array(c-1);--c;)u[c-1]=arguments[c];return e[a].subscribe.apply(null,u),n}else if(typeof a=="string")return e[a]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(a,l,c){if(typeof a=="object")return o(a);l||(l=Xp),c||(c=me);var u={subscribers:[],fire:c,subscribe:function(h){u.subscribers.indexOf(h)===-1&&(u.subscribers.push(h),u.fire=l(u.fire,h))},unsubscribe:function(h){u.subscribers=u.subscribers.filter(function(f){return f!==h}),u.fire=u.subscribers.reduce(l,c)}};return e[a]=t[a]=u,u}function o(a){Ce(a).forEach(function(l){var c=a[l];if(Ue(c))s(l,a[l][0],a[l][1]);else if(c==="asap")var u=s(l,Xr,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];u.subscribers.forEach(function(m){fu(function(){m.apply(null,d)})})});else throw new Q.InvalidArgument("Invalid event config")})}}function Zr(n,e){return or(e).from({prototype:n}),e}function cm(n){return Zr(xa.prototype,function(t,r,i){this.db=n,this._tx=i,this.name=t,this.schema=r,this.hook=n._allTables[t]?n._allTables[t].hook:Qr(null,{creating:[$p,me],reading:[Hp,Xr],updating:[Gp,me],deleting:[qp,me]})})}function tr(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function sa(n,e){n.filter=kn(n.filter,e)}function oa(n,e,t){var r=n.replayFilter;n.replayFilter=r?()=>kn(r(),e()):e,n.justLimit=t&&!r}function um(n,e){n.isMatch=kn(n.isMatch,e)}function ps(n,e){if(n.isPrimKey)return e.primaryKey;let t=e.getIndexByKeyPath(n.index);if(!t)throw new Q.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function nu(n,e,t){let r=ps(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function os(n,e,t,r){let i=n.replayFilter?kn(n.filter,n.replayFilter()):n.filter;if(n.or){let s={},o=(a,l,c)=>{if(!i||i(l,c,f=>l.stop(f),f=>l.fail(f))){var u=l.primaryKey,h=""+u;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(u)),pt(s,h)||(s[h]=!0,e(a,l,c))}};return Promise.all([n.or._iterate(o,t),ru(nu(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}else return ru(nu(n,r,t),kn(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function ru(n,e,t,r){var i=r?(o,a,l)=>t(r(o),a,l):t,s=xe(i);return n.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=me},l=>{o.fail(l),a=me}))&&s(o.value,o,l=>a=l),a()})})}function Je(n,e){try{let t=iu(n),r=iu(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return dm(su(n),su(e));case"Array":return fm(n,e)}}catch(t){}return NaN}function fm(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s){let o=Je(n[s],e[s]);if(o!==0)return o}return t===r?0:t<r?-1:1}function dm(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s)if(n[s]!==e[s])return n[s]<e[s]?-1:1;return t===r?0:t<r?-1:1}function iu(n){let e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";let t=ca(n);return t==="ArrayBuffer"?"binary":t}function su(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var Ea=class{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,Pe.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Pe.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=kn(t.algorithm,e)}_iterate(e,t){return os(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Qe(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(r=>os(t,e,r,t.table.core))}count(e){return this._read(t=>{let r=this._ctx,i=r.table.core;if(tr(r,!0))return i.count({trans:t,query:{index:ps(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return os(r,()=>(++s,!1),t,i).then(()=>s)}).then(e)}sortBy(e,t){let r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(c,u){return u?o(c[r[u]],u-1):c[i]}var a=this._ctx.dir==="next"?1:-1;function l(c,u){var h=o(c,s),f=o(u,s);return h<f?-a:h>f?a:0}return this.toArray(function(c){return c.sort(l)}).then(t)}toArray(e){return this._read(t=>{var r=this._ctx;if(r.dir==="next"&&tr(r,!0)&&r.limit>0){let{valueMapper:i}=r,s=ps(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return os(r,s=>i.push(s),t,r.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0?this:(t.offset+=e,tr(t)?oa(t,()=>{var r=e;return(i,s)=>r===0?!0:r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1)}):oa(t,()=>{var r=e;return()=>--r<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),oa(this._ctx,()=>{var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this}until(e,t){return sa(this._ctx,function(r,i,s){return e(r.value)?(i(s),t):!0}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return sa(this._ctx,function(t){return e(t.value)}),um(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&tr(t,!0)&&t.limit>0)return this._read(i=>{var s=ps(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return sa(this._ctx,function(i){var s=i.primaryKey.toString(),o=pt(r,s);return r[s]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=Ce(e),o=s.length;i=function(p){for(var g=!1,v=0;v<o;++v){var x=s[v],E=e[x];Zt(p,x)!==E&&(Mt(p,x,E),g=!0)}return g}}let a=t.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,u=this.db._options.modifyChunkSize||200,h=[],f=0,d=[],m=(p,g)=>{let{failures:v,numFailures:x}=g;f+=p-x;for(let E of Ce(v))h.push(v[E])};return this.clone().primaryKeys().then(p=>{let g=v=>{let x=Math.min(u,p.length-v);return a.getMany({trans:r,keys:p.slice(v,v+x),cache:"immutable"}).then(E=>{let b=[],S=[],C=l?[]:null,I=[];for(let R=0;R<x;++R){let U=E[R],D={value:Gr(U),primKey:p[v+R]};i.call(D,D.value,D)!==!1&&(D.value==null?I.push(p[v+R]):!l&&Je(c(U),c(D.value))!==0?(I.push(p[v+R]),b.push(D.value)):(S.push(D.value),l&&C.push(p[v+R])))}let P=tr(t)&&t.limit===1/0&&(typeof e!="function"||e===aa)&&{index:t.index,range:t.range};return Promise.resolve(b.length>0&&a.mutate({trans:r,type:"add",values:b}).then(R=>{for(let U in R.failures)I.splice(parseInt(U),1);m(b.length,R)})).then(()=>(S.length>0||P&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:C,values:S,criteria:P,changeSpec:typeof e!="function"&&e}).then(R=>m(S.length,R))).then(()=>(I.length>0||P&&e===aa)&&a.mutate({trans:r,type:"delete",keys:I,criteria:P}).then(R=>m(I.length,R))).then(()=>p.length>v+x&&g(v+u))})};return g(0).then(()=>{if(h.length>0)throw new ms("Error modifying one or more objects",h,f,d);return p.length})})})}delete(){var e=this._ctx,t=e.range;return tr(e)&&(e.isPrimKey&&!lm||t.type===3)?this._write(r=>{let{primaryKey:i}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:c,numFailures:u})=>{if(u)throw new ms("Could not delete some values",Object.keys(a).map(h=>a[h]),o-u);return o-u}))}):this.modify(aa)}},aa=(n,e)=>e.value=null;function hm(n){return Zr(Ea.prototype,function(t,r){this.db=n;let i=Mu,s=null;if(r)try{i=r()}catch(c){s=c}let o=t._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==Xr?l:null}})}function pm(n,e){return n<e?-1:n===e?0:1}function mm(n,e){return n>e?-1:n===e?0:1}function ht(n,e,t){var r=n instanceof ws?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function nr(n){return new n.Collection(n,()=>Du("")).limit(0)}function gm(n){return n==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function ym(n){return n==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function vm(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),a=-1,l=0;l<o;++l){var c=e[l];if(c!==r[l])return i(n[l],t[l])<0?n.substr(0,l)+t[l]+t.substr(l+1):i(n[l],r[l])<0?n.substr(0,l)+r[l]+t.substr(l+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;i(n[l],c)<0&&(a=l)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+r[a]+t.substr(a+1)}function as(n,e,t,r){var i,s,o,a,l,c,u,h=t.length;if(!t.every(p=>typeof p=="string"))return ht(n,Iu);function f(p){i=gm(p),s=ym(p),o=p==="next"?pm:mm;var g=t.map(function(v){return{lower:s(v),upper:i(v)}}).sort(function(v,x){return o(v.lower,x.lower)});a=g.map(function(v){return v.upper}),l=g.map(function(v){return v.lower}),c=p,u=p==="next"?"":r}f("next");var d=new n.Collection(n,()=>on(a[0],l[h-1]+r));d._ondirectionchange=function(p){f(p)};var m=0;return d._addAlgorithm(function(p,g,v){var x=p.key;if(typeof x!="string")return!1;var E=s(x);if(e(E,l,m))return!0;for(var b=null,S=m;S<h;++S){var C=vm(x,E,a[S],l[S],o,c);C===null&&b===null?m=S+1:(b===null||o(b,C)>0)&&(b=C)}return g(b!==null?function(){p.continue(b+u)}:v),!1}),d}function on(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function Du(n){return{type:1,lower:n,upper:n}}var ws=class{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&!(r&&i)?nr(this):new this.Collection(this,()=>on(e,t,!r,!i))}catch(s){return ht(this,Xt)}}equals(e){return e==null?ht(this,Xt):new this.Collection(this,()=>Du(e))}above(e){return e==null?ht(this,Xt):new this.Collection(this,()=>on(e,void 0,!0))}aboveOrEqual(e){return e==null?ht(this,Xt):new this.Collection(this,()=>on(e,void 0,!1))}below(e){return e==null?ht(this,Xt):new this.Collection(this,()=>on(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ht(this,Xt):new this.Collection(this,()=>on(void 0,e))}startsWith(e){return typeof e!="string"?ht(this,Iu):this.between(e,e+Dn,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):as(this,(t,r)=>t.indexOf(r[0])===0,[e],Dn)}equalsIgnoreCase(e){return as(this,(t,r)=>t===r[0],[e],"")}anyOfIgnoreCase(){var e=Jt.apply(rr,arguments);return e.length===0?nr(this):as(this,(t,r)=>r.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Jt.apply(rr,arguments);return e.length===0?nr(this):as(this,(t,r)=>r.some(i=>t.indexOf(i)===0),e,Dn)}anyOf(){let e=Jt.apply(rr,arguments),t=this._cmp;try{e.sort(t)}catch(s){return ht(this,Xt)}if(e.length===0)return nr(this);let r=new this.Collection(this,()=>on(e[0],e[e.length-1]));r._ondirectionchange=s=>{t=s==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return r._addAlgorithm((s,o,a)=>{let l=s.key;for(;t(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return t(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[wa,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=Jt.apply(rr,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return ht(this,Xt)}let t=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[wa,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){let r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return nr(this);if(!e.every(b=>b[0]!==void 0&&b[1]!==void 0&&i(b[0],b[1])<=0))return ht(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Q.InvalidArgument);let l=!t||t.includeLowers!==!1,c=t&&t.includeUppers===!0;function u(b,S){let C=0,I=b.length;for(;C<I;++C){let P=b[C];if(r(S[0],P[1])<0&&r(S[1],P[0])>0){P[0]=o(P[0],S[0]),P[1]=a(P[1],S[1]);break}}return C===I&&b.push(S),b}let h=i;function f(b,S){return h(b[0],S[0])}let d;try{d=e.reduce(u,[]),d.sort(f)}catch(b){return ht(this,Xt)}let m=0,p=c?b=>i(b,d[m][1])>0:b=>i(b,d[m][1])>=0,g=l?b=>s(b,d[m][0])>0:b=>s(b,d[m][0])>=0;function v(b){return!p(b)&&!g(b)}let x=p,E=new this.Collection(this,()=>on(d[0][0],d[d.length-1][1],!l,!c));return E._ondirectionchange=b=>{b==="next"?(x=p,h=i):(x=g,h=s),d.sort(f)},E._addAlgorithm((b,S,C)=>{for(var I=b.key;x(I);)if(++m,m===d.length)return S(C),!1;return v(I)?!0:(this._cmp(I,d[m][1])===0||this._cmp(I,d[m][0])===0||S(()=>{h===i?b.continue(d[m][0]):b.continue(d[m][1])}),!1)}),E}startsWithAnyOf(){let e=Jt.apply(rr,arguments);return e.every(t=>typeof t=="string")?e.length===0?nr(this):this.inAnyRange(e.map(t=>[t,t+Dn])):ht(this,"startsWithAnyOf() only works with strings")}};function _m(n){return Zr(ws.prototype,function(t,r,i){this.db=n,this._ctx={table:t,index:r===":id"?null:r,or:i};let s=n._deps.indexedDB;if(!s)throw new Q.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=n._deps.IDBKeyRange})}function jt(n){return xe(function(e){return Kr(e),n(e.target.error),!1})}function Kr(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Hr="storagemutated",ln="x-storagemutated-1",fn=Qr(null,Hr),Ta=class{_lock(){return kr(!G.global),++this._reculock,this._reculock===1&&!G.global&&(G.lockOwnerFor=this),this}_unlock(){if(kr(!G.global),--this._reculock===0)for(G.global||(G.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{cr(e[1],e[0])}catch(t){}}return this}_locked(){return this._reculock&&G.lockOwnerFor!==this}create(e){if(!this.mode)return this;let t=this.db.idbdb,r=this.db._state.dbOpenError;if(kr(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new Q.DatabaseClosed(r);case"MissingAPIError":throw new Q.MissingAPI(r.message,r);default:throw new Q.OpenFailed(r)}if(!this.active)throw new Q.TransactionInactive;return kr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=xe(i=>{Kr(i),this._reject(e.error)}),e.onabort=xe(i=>{Kr(i),this.active&&this._reject(new Q.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=xe(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&fn.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,r){if(e==="readwrite"&&this.mode!=="readwrite")return Pe(new Q.ReadOnly("Transaction is readonly"));if(!this.active)return Pe(new Q.TransactionInactive);if(this._locked())return new z((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(s,o)},G])});if(r)return cn(()=>{var s=new z((o,a)=>{this._lock();let l=t(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new z((s,o)=>{var a=t(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();let r=z.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>r);else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new z((o,a)=>{r.then(l=>t._waitingQueue.push(xe(o.bind(null,l))),l=>t._waitingQueue.push(xe(a.bind(null,l)))).finally(()=>{t._waitingFor===s&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Q.Abort))}table(e){let t=this._memoizedTables||(this._memoizedTables={});if(pt(t,e))return t[e];let r=this.schema[e];if(!r)throw new Q.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i}};function bm(n){return Zr(Ta.prototype,function(t,r,i,s,o){this.db=n,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Qr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new z((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),Pe(a)})})}function Sa(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Ou(e)}}function Ou(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Ru(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:du(t,r=>[r.name,r])}}function wm(n){return n.length===1?n[0]:n}var $r=n=>{try{return n.only([[]]),$r=()=>[[]],[[]]}catch(e){return $r=()=>Dn,Dn}};function Aa(n){return n==null?()=>{}:typeof n=="string"?xm(n):e=>Zt(e,n)}function xm(n){return n.split(".").length===1?t=>t[n]:t=>Zt(t,n)}function ou(n){return[].slice.call(n)}var Em=0;function jr(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Tm(n,e,t){function r(u,h){let f=ou(u.objectStoreNames);return{schema:{name:u.name,tables:f.map(d=>h.objectStore(d)).map(d=>{let{keyPath:m,autoIncrement:p}=d,g=Ue(m),v=m==null,x={},E={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:v,compound:g,keyPath:m,autoIncrement:p,unique:!0,extractKey:Aa(m)},indexes:ou(d.indexNames).map(b=>d.index(b)).map(b=>{let{name:S,unique:C,multiEntry:I,keyPath:P}=b,R=Ue(P),U={name:S,compound:R,keyPath:P,unique:C,multiEntry:I,extractKey:Aa(P)};return x[jr(P)]=U,U}),getIndexByKeyPath:b=>x[jr(b)]};return x[":id"]=E.primaryKey,m!=null&&(x[jr(m)]=E.primaryKey),E})},hasGetAll:f.length>0&&"getAll"in h.objectStore(f[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:f,lowerOpen:d,upperOpen:m}=u;return h===void 0?f===void 0?null:e.upperBound(f,!!m):f===void 0?e.lowerBound(h,!!d):e.bound(h,f,!!d,!!m)}function s(u){let h=u.name;function f({trans:p,type:g,keys:v,values:x,range:E}){return new Promise((b,S)=>{b=xe(b);let C=p.objectStore(h),I=C.keyPath==null,P=g==="put"||g==="add";if(!P&&g!=="delete"&&g!=="deleteRange")throw new Error("Invalid operation type: "+g);let{length:R}=v||x||{length:1};if(v&&x&&v.length!==x.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let U,D=[],L=[],k=0,V=J=>{++k,Kr(J)};if(g==="deleteRange"){if(E.type===4)return b({numFailures:k,failures:L,results:[],lastResult:void 0});E.type===3?D.push(U=C.clear()):D.push(U=C.delete(i(E)))}else{let[J,ue]=P?I?[x,v]:[x,null]:[v,null];if(P)for(let fe=0;fe<R;++fe)D.push(U=ue&&ue[fe]!==void 0?C[g](J[fe],ue[fe]):C[g](J[fe])),U.onerror=V;else for(let fe=0;fe<R;++fe)D.push(U=C[g](J[fe])),U.onerror=V}let se=J=>{let ue=J.target.result;D.forEach((fe,we)=>fe.error!=null&&(L[we]=fe.error)),b({numFailures:k,failures:L,results:g==="delete"?v:D.map(fe=>fe.result),lastResult:ue})};U.onerror=J=>{V(J),se(J)},U.onsuccess=se})}function d({trans:p,values:g,query:v,reverse:x,unique:E}){return new Promise((b,S)=>{b=xe(b);let{index:C,range:I}=v,P=p.objectStore(h),R=C.isPrimaryKey?P:P.index(C.name),U=x?E?"prevunique":"prev":E?"nextunique":"next",D=g||!("openKeyCursor"in R)?R.openCursor(i(I),U):R.openKeyCursor(i(I),U);D.onerror=jt(S),D.onsuccess=xe(L=>{let k=D.result;if(!k){b(null);return}k.___id=++Em,k.done=!1;let V=k.continue.bind(k),se=k.continuePrimaryKey;se&&(se=se.bind(k));let J=k.advance.bind(k),ue=()=>{throw new Error("Cursor not started")},fe=()=>{throw new Error("Cursor not stopped")};k.trans=p,k.stop=k.continue=k.continuePrimaryKey=k.advance=ue,k.fail=xe(S),k.next=function(){let we=1;return this.start(()=>we--?this.continue():this.stop()).then(()=>this)},k.start=we=>{let ft=new Promise((Y,H)=>{Y=xe(Y),D.onerror=jt(H),k.fail=H,k.stop=Z=>{k.stop=k.continue=k.continuePrimaryKey=k.advance=fe,Y(Z)}}),X=()=>{if(D.result)try{we()}catch(Y){k.fail(Y)}else k.done=!0,k.start=()=>{throw new Error("Cursor behind last entry")},k.stop()};return D.onsuccess=xe(Y=>{D.onsuccess=X,X()}),k.continue=V,k.continuePrimaryKey=se,k.advance=J,X(),ft},b(k)},S)})}function m(p){return g=>new Promise((v,x)=>{v=xe(v);let{trans:E,values:b,limit:S,query:C}=g,I=S===1/0?void 0:S,{index:P,range:R}=C,U=E.objectStore(h),D=P.isPrimaryKey?U:U.index(P.name),L=i(R);if(S===0)return v({result:[]});if(p){let k=b?D.getAll(L,I):D.getAllKeys(L,I);k.onsuccess=V=>v({result:V.target.result}),k.onerror=jt(x)}else{let k=0,V=b||!("openKeyCursor"in D)?D.openCursor(L):D.openKeyCursor(L),se=[];V.onsuccess=J=>{let ue=V.result;if(!ue)return v({result:se});if(se.push(b?ue.value:ue.primaryKey),++k===S)return v({result:se});ue.continue()},V.onerror=jt(x)}})}return{name:h,schema:u,mutate:f,getMany({trans:p,keys:g}){return new Promise((v,x)=>{v=xe(v);let E=p.objectStore(h),b=g.length,S=new Array(b),C=0,I=0,P,R=D=>{let L=D.target;(S[L._pos]=L.result)!=null,++I===C&&v(S)},U=jt(x);for(let D=0;D<b;++D)g[D]!=null&&(P=E.get(g[D]),P._pos=D,P.onsuccess=R,P.onerror=U,++C);C===0&&v(S)})},get({trans:p,key:g}){return new Promise((v,x)=>{v=xe(v);let b=p.objectStore(h).get(g);b.onsuccess=S=>v(S.target.result),b.onerror=jt(x)})},query:m(a),openCursor:d,count({query:p,trans:g}){let{index:v,range:x}=p;return new Promise((E,b)=>{let S=g.objectStore(h),C=v.isPrimaryKey?S:S.index(v.name),I=i(x),P=I?C.count(I):C.count();P.onsuccess=xe(R=>E(R.target.result)),P.onerror=jt(b)})}}}let{schema:o,hasGetAll:a}=r(n,t),l=o.tables.map(u=>s(u)),c={};return l.forEach(u=>c[u.name]=u),{stack:"dbcore",transaction:n.transaction.bind(n),table(u){if(!c[u])throw new Error(`Table '${u}' not found`);return c[u]},MIN_KEY:-1/0,MAX_KEY:$r(e),schema:o}}function Sm(n,e){return e.reduce((t,{create:r})=>({...t,...r(t)}),n)}function Am(n,e,{IDBKeyRange:t,indexedDB:r},i){return{dbcore:Sm(Tm(e,t,i),n.dbcore)}}function Ka({_novip:n},e){let t=e.db,r=Am(n._middlewares,t,n._deps,e);n.core=r.dbcore,n.tables.forEach(i=>{let s=i.name;n.core.schema.tables.some(o=>o.name===s)&&(i.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=i.core))})}function xs({_novip:n},e,t,r){t.forEach(i=>{let s=r[i];e.forEach(o=>{let a=ka(o,i);(!a||"value"in a&&a.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?en(o,i,{get(){return this.table(i)},set(l){cu(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,s))})})}function Ca({_novip:n},e){e.forEach(t=>{for(let r in t)t[r]instanceof n.Table&&delete t[r]})}function Cm(n,e){return n._cfg.version-e._cfg.version}function Fm(n,e,t,r){let i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);let o=s._reject.bind(s),a=G.transless||G;cn(()=>{G.trans=s,G.transless=a,e===0?(Ce(i).forEach(l=>{Ha(t,l,i[l].primKey,i[l].indexes)}),Ka(n,t),z.follow(()=>n.on.populate.fire(s)).catch(o)):Im(n,e,s,t).catch(o)})}function Im({_novip:n},e,t,r){let i=[],s=n._versions,o=n._dbSchema=$a(n,n.idbdb,r),a=!1;s.filter(u=>u._cfg.version>=e).forEach(u=>{i.push(()=>{let h=o,f=u._cfg.dbschema;Ia(n,h,r),Ia(n,f,r),o=n._dbSchema=f;let d=Lu(h,f);d.add.forEach(p=>{Ha(r,p[0],p[1].primKey,p[1].indexes)}),d.change.forEach(p=>{if(p.recreate)throw new Q.Upgrade("Not yet support for changing primary key");{let g=r.objectStore(p.name);p.add.forEach(v=>Fa(g,v)),p.change.forEach(v=>{g.deleteIndex(v.name),Fa(g,v)}),p.del.forEach(v=>g.deleteIndex(v))}});let m=u._cfg.contentUpgrade;if(m&&u._cfg.version>e){Ka(n,r),t._memoizedTables={},a=!0;let p=hu(f);d.del.forEach(E=>{p[E]=h[E]}),Ca(n,[n.Transaction.prototype]),xs(n,[n.Transaction.prototype],Ce(p),p),t.schema=p;let g=Na(m);g&&lr();let v,x=z.follow(()=>{if(v=m(t),v&&g){var E=tn.bind(null,null);v.then(E,E)}});return v&&typeof v.then=="function"?z.resolve(v):x.then(()=>v)}}),i.push(h=>{if(!a||!am){let f=u._cfg.dbschema;Mm(f,h)}Ca(n,[n.Transaction.prototype]),xs(n,[n.Transaction.prototype],n._storeNames,n._dbSchema),t.schema=n._dbSchema})});function c(){return i.length?z.resolve(i.shift()(t.idbtrans)).then(c):z.resolve()}return c().then(()=>{Pm(o,r)})}function Lu(n,e){let t={del:[],add:[],change:[]},r;for(r in n)e[r]||t.del.push(r);for(r in e){let i=n[r],s=e[r];if(!i)t.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!Cs)o.recreate=!0,t.change.push(o);else{let a=i.idxByName,l=s.idxByName,c;for(c in a)l[c]||o.del.push(c);for(c in l){let u=a[c],h=l[c];u?u.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}}return t}function Ha(n,e,t,r){let i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(s=>Fa(i,s)),i}function Pm(n,e){Ce(n).forEach(t=>{e.db.objectStoreNames.contains(t)||Ha(e,t,n[t].primKey,n[t].indexes)})}function Mm(n,e){[].slice.call(e.db.objectStoreNames).forEach(t=>n[t]==null&&e.db.deleteObjectStore(t))}function Fa(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function $a(n,e,t){let r={};return Ss(e.objectStoreNames,0).forEach(s=>{let o=t.objectStore(s),a=o.keyPath,l=Sa(Ou(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),c=[];for(let h=0;h<o.indexNames.length;++h){let f=o.index(o.indexNames[h]);a=f.keyPath;var u=Sa(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);c.push(u)}r[s]=Ru(s,l,c)}),r}function Dm({_novip:n},e,t){n.verno=e.version/10;let r=n._dbSchema=$a(n,e,t);n._storeNames=Ss(e.objectStoreNames,0),xs(n,[n._allTables],Ce(r),r)}function Om(n,e){let t=$a(n,n.idbdb,e),r=Lu(t,n._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function Ia({_novip:n},e,t){let r=t.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=t.objectStore(s);n._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],c=o.index(l).keyPath,u=typeof c=="string"?c:"["+Ss(c).join("+")+"]";if(e[s]){let h=e[s].idxByName[u];h&&(h.name=l,delete e[s].idxByName[u],e[s].idxByName[l]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&be.WorkerGlobalScope&&be instanceof be.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function Rm(n){return n.split(",").map((e,t)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Sa(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Ue(i),t===0)})}var Pa=class{_parseStoresSpec(e,t){Ce(e).forEach(r=>{if(e[r]!==null){var i=Rm(e[r]),s=i.shift();if(s.multi)throw new Q.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new Q.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new Q.Schema("Index must have a name and cannot be an empty string")}),t[r]=Ru(r,s,i)}})}stores(e){let t=this.db;this._cfg.storesSource=this._cfg.storesSource?Qe(this._cfg.storesSource,e):e;let r=t._versions,i={},s={};return r.forEach(o=>{Qe(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,Ca(t,[t._allTables,t,t.Transaction.prototype]),xs(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],Ce(s),s),t._storeNames=Ce(s),this}upgrade(e){return this._cfg.contentUpgrade=ja(this._cfg.contentUpgrade||me,e),this}};function Lm(n){return Zr(Pa.prototype,function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function qa(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new _t(Fs,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function Ga(n){return n&&typeof n.databases=="function"}function km({indexedDB:n,IDBKeyRange:e}){return Ga(n)?Promise.resolve(n.databases()).then(t=>t.map(r=>r.name).filter(r=>r!==Fs)):qa(n,e).toCollection().primaryKeys()}function Nm({indexedDB:n,IDBKeyRange:e},t){!Ga(n)&&t!==Fs&&qa(n,e).put({name:t}).catch(me)}function Bm({indexedDB:n,IDBKeyRange:e},t){!Ga(n)&&t!==Fs&&qa(n,e).delete(t).catch(me)}function Ma(n){return cn(function(){return G.letThrough=!0,n()})}function zm(){var n=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!n||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function jm(n){let e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Pe(e.dbOpenError):n);Ut&&(e.openCanceller._stackHolder=Nn()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new Q.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;return z.race([r,(typeof navigator=="undefined"?z.resolve():zm()).then(()=>new z((l,c)=>{if(i(),!t)throw new Q.MissingAPI;let u=n.name,h=e.autoSchema?t.open(u):t.open(u,Math.round(n.verno*10));if(!h)throw new Q.MissingAPI;h.onerror=jt(c),h.onblocked=xe(n._fireOnBlocked),h.onupgradeneeded=xe(f=>{if(o=h.transaction,e.autoSchema&&!n._options.allowEmptyDB){h.onerror=Kr,o.abort(),h.result.close();let m=t.deleteDatabase(u);m.onsuccess=m.onerror=xe(()=>{c(new Q.NoSuchDatabase(`Database ${u} doesnt exist`))})}else{o.onerror=jt(c);var d=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=d<1,n._novip.idbdb=h.result,Fm(n,d/10,o,c)}},c),h.onsuccess=xe(()=>{o=null;let f=n._novip.idbdb=h.result,d=Ss(f.objectStoreNames);if(d.length>0)try{let m=f.transaction(wm(d),"readonly");e.autoSchema?Dm(n,f,m):(Ia(n,n._dbSchema,m),Om(n,m)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ka(n,m)}catch(m){}zr.push(n),f.onversionchange=xe(m=>{e.vcFired=!0,n.on("versionchange").fire(m)}),f.onclose=xe(m=>{n.on("close").fire(m)}),a&&Nm(n._deps,u),l()},c)}))]).then(()=>(i(),e.onReadyBeingFired=[],z.resolve(Ma(()=>n.on.ready.fire(n.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(ja,me);return e.onReadyBeingFired=[],z.resolve(Ma(()=>c(n.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch(c){}return r===e.openCanceller&&n._close(),Pe(l)}).finally(()=>{e.openComplete=!0,s()})}function Da(n){var e=o=>n.next(o),t=o=>n.throw(o),r=s(e),i=s(t);function s(o){return a=>{var l=o(a),c=l.value;return l.done?c:!c||typeof c.then!="function"?Ue(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return s(e)()}function Um(n,e,t){var r=arguments.length;if(r<2)throw new Q.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var s=pu(i);return[n,s,t]}function ku(n,e,t,r,i){return z.resolve().then(()=>{let s=G.transless||G,o=n._createTransaction(e,t,n._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(h){return h.name===za.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>ku(n,e,t,null,i))):Pe(h)}let l=Na(i);l&&lr();let c,u=z.follow(()=>{if(c=i.call(o,o),c)if(l){var h=tn.bind(null,null);c.then(h,h)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Da(c))},a);return(c&&typeof c.then=="function"?z.resolve(c).then(h=>o.active?h:Pe(new Q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(h=>(r&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),Pe(h)))})}function ls(n,e,t){let r=Ue(n)?n.slice():[n];for(let i=0;i<t;++i)r.push(e);return r}function Wm(n){return{...n,table(e){let t=n.table(e),{schema:r}=t,i={},s=[];function o(f,d,m){let p=jr(f),g=i[p]=i[p]||[],v=f==null?0:typeof f=="string"?1:f.length,x=d>0,E={...m,isVirtual:x,keyTail:d,keyLength:v,extractKey:Aa(f),unique:!x&&m.unique};if(g.push(E),E.isPrimaryKey||s.push(E),v>1){let b=v===2?f[0]:f.slice(0,v-1);o(b,d+1,m)}return g.sort((b,S)=>b.keyTail-S.keyTail),E}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let f of r.indexes)o(f.keyPath,0,f);function l(f){let d=i[jr(f)];return d&&d[0]}function c(f,d){return{type:f.type===1?2:f.type,lower:ls(f.lower,f.lowerOpen?n.MAX_KEY:n.MIN_KEY,d),lowerOpen:!0,upper:ls(f.upper,f.upperOpen?n.MIN_KEY:n.MAX_KEY,d),upperOpen:!0}}function u(f){let d=f.query.index;return d.isVirtual?{...f,query:{index:d,range:c(f.query.range,d.keyTail)}}:f}return{...t,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:l},count(f){return t.count(u(f))},query(f){return t.query(u(f))},openCursor(f){let{keyTail:d,isVirtual:m,keyLength:p}=f.query.index;if(!m)return t.openCursor(f);function g(v){function x(b){b!=null?v.continue(ls(b,f.reverse?n.MAX_KEY:n.MIN_KEY,d)):f.unique?v.continue(v.key.slice(0,p).concat(f.reverse?n.MIN_KEY:n.MAX_KEY,d)):v.continue()}return Object.create(v,{continue:{value:x},continuePrimaryKey:{value(b,S){v.continuePrimaryKey(ls(b,n.MAX_KEY,d),S)}},primaryKey:{get(){return v.primaryKey}},key:{get(){let b=v.key;return p===1?b[0]:b.slice(0,p)}},value:{get(){return v.value}}})}return t.openCursor(u(f)).then(v=>v&&g(v))}}}}}var Vm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Wm};function Xa(n,e,t,r){return t=t||{},r=r||"",Ce(n).forEach(i=>{if(!pt(e,i))t[r+i]=void 0;else{var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=ca(s),l=ca(o);a!==l?t[r+i]=e[i]:a==="Object"?Xa(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}}),Ce(e).forEach(i=>{pt(n,i)||(t[r+i]=e[i])}),t}function Km(n,e){return e.type==="delete"?e.keys:e.keys||e.values.map(n.extractKey)}var Hm={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){let t=n.table(e),{primaryKey:r}=t.schema;return{...t,mutate(s){let o=G.trans,{deleting:a,creating:l,updating:c}=o.table(e).hook;switch(s.type){case"add":if(l.fire===me)break;return o._promise("readwrite",()=>u(s),!0);case"put":if(l.fire===me&&c.fire===me)break;return o._promise("readwrite",()=>u(s),!0);case"delete":if(a.fire===me)break;return o._promise("readwrite",()=>u(s),!0);case"deleteRange":if(a.fire===me)break;return o._promise("readwrite",()=>h(s),!0)}return t.mutate(s);function u(d){let m=G.trans,p=d.keys||Km(r,d);if(!p)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?{...d,keys:p}:{...d},d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),$m(t,d,p).then(g=>{let v=p.map((x,E)=>{let b=g[E],S={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(S,x,b,m);else if(d.type==="add"||b===void 0){let C=l.fire.call(S,x,d.values[E],m);x==null&&C!=null&&(x=C,d.keys[E]=x,r.outbound||Mt(d.values[E],r.keyPath,x))}else{let C=Xa(b,d.values[E]),I=c.fire.call(S,C,x,b,m);if(I){let P=d.values[E];Object.keys(I).forEach(R=>{pt(P,R)?P[R]=I[R]:Mt(P,R,I[R])})}}return S});return t.mutate(d).then(({failures:x,results:E,numFailures:b,lastResult:S})=>{for(let C=0;C<p.length;++C){let I=E?E[C]:p[C],P=v[C];I==null?P.onerror&&P.onerror(x[C]):P.onsuccess&&P.onsuccess(d.type==="put"&&g[C]?d.values[C]:I)}return{failures:x,results:E,numFailures:b,lastResult:S}}).catch(x=>(v.forEach(E=>E.onerror&&E.onerror(x)),Promise.reject(x)))})}function h(d){return f(d.trans,d.range,1e4)}function f(d,m,p){return t.query({trans:d,values:!1,query:{index:r,range:m},limit:p}).then(({result:g})=>u({type:"delete",keys:g,trans:d}).then(v=>v.numFailures>0?Promise.reject(v.failures[0]):g.length<p?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...m,lower:g[g.length-1],lowerOpen:!0},p)))}}}}})};function $m(n,e,t){return e.type==="add"?Promise.resolve([]):n.getMany({trans:e.trans,keys:t,cache:"immutable"})}function Nu(n,e,t){try{if(!e||e.keys.length<n.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<n.length;++i)Je(e.keys[i],n[s])===0&&(r.push(t?Gr(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch(r){return null}}var qm={stack:"dbcore",level:-1,create:n=>({table:e=>{let t=n.table(e);return{...t,getMany:r=>{if(!r.cache)return t.getMany(r);let i=Nu(r.keys,r.trans._cache,r.cache==="clone");return i?z.resolve(i):t.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Gr(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),t.mutate(r))}}})};function Ya(n){return!("from"in n)}var Yt=function(n,e){if(this)Qe(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0});else{let t=new Yt;return n&&"d"in n&&Qe(t,n),t}};sr(Yt.prototype,{add(n){return Es(this,n),this},addKey(n){return qr(this,n,n),this},addKeys(n){return n.forEach(e=>qr(this,e,e)),this},[ua](){return Oa(this)}});function qr(n,e,t){let r=Je(e,t);if(isNaN(r))return;if(r>0)throw RangeError();if(Ya(n))return Qe(n,{from:e,to:t,d:1});let i=n.l,s=n.r;if(Je(t,n.from)<0)return i?qr(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},au(n);if(Je(e,n.to)>0)return s?qr(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},au(n);Je(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),Je(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);let o=!n.r;i&&!n.l&&Es(n,i),s&&o&&Es(n,s)}function Es(n,e){function t(r,{from:i,to:s,l:o,r:a}){qr(r,i,s),o&&t(r,o),a&&t(r,a)}Ya(e)||t(n,e)}function Gm(n,e){let t=Oa(e),r=t.next();if(r.done)return!1;let i=r.value,s=Oa(n),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Je(a.from,i.to)<=0&&Je(a.to,i.from)>=0)return!0;Je(i.from,a.from)<0?i=(r=t.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Oa(n){let e=Ya(n)?null:{s:0,n};return{next(t){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Je(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Je(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function au(n){var e,t;let r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...n},a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],o[i]=a[s],n[s]=o,o.d=lu(o)}n.d=lu(n)}function lu({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}var Xm={stack:"dbcore",level:0,create:n=>{let e=n.schema.name,t=new Yt(n.MIN_KEY,n.MAX_KEY);return{...n,table:r=>{let i=n.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:f=>{let d=f.trans,m=d.mutatedParts||(d.mutatedParts={}),p=C=>{let I=`idb://${e}/${r}/${C}`;return m[I]||(m[I]=new Yt)},g=p(""),v=p(":dels"),{type:x}=f,[E,b]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],S=f.trans._cache;return i.mutate(f).then(C=>{if(Ue(E)){x!=="delete"&&(E=C.results),g.addKeys(E);let I=Nu(E,S);!I&&x!=="add"&&v.addKeys(E),(I||b)&&Ym(p,s,I,b)}else if(E){let I={from:E.lower,to:E.upper};v.add(I),g.add(I)}else g.add(t),v.add(t),s.indexes.forEach(I=>p(I.name).add(t));return C})}},u=({query:{index:f,range:d}})=>{var m,p;return[f,new Yt((m=d.lower)!==null&&m!==void 0?m:n.MIN_KEY,(p=d.upper)!==null&&p!==void 0?p:n.MAX_KEY)]},h={get:f=>[o,new Yt(f.key)],getMany:f=>[o,new Yt().addKeys(f.keys)],count:u,query:u,openCursor:u};return Ce(h).forEach(f=>{c[f]=function(d){let{subscr:m}=G;if(m){let p=b=>{let S=`idb://${e}/${r}/${b}`;return m[S]||(m[S]=new Yt)},g=p(""),v=p(":dels"),[x,E]=h[f](d);if(p(x.name||"").add(E),!x.isPrimaryKey)if(f==="count")v.add(t);else{let b=f==="query"&&l&&d.values&&i.query({...d,values:!1});return i[f].apply(this,arguments).then(S=>{if(f==="query"){if(l&&d.values)return b.then(({result:I})=>(g.addKeys(I),S));let C=d.values?S.result.map(a):S.result;d.values?g.addKeys(C):v.addKeys(C)}else if(f==="openCursor"){let C=S,I=d.values;return C&&Object.create(C,{key:{get(){return v.addKey(C.primaryKey),C.key}},primaryKey:{get(){let P=C.primaryKey;return v.addKey(P),P}},value:{get(){return I&&g.addKey(C.primaryKey),C.value}}})}return S})}}return i[f].apply(this,arguments)}}),c}}}};function Ym(n,e,t,r){function i(s){let o=n(s.name||"");function a(c){return c!=null?s.extractKey(c):null}let l=c=>s.multiEntry&&Ue(c)?c.forEach(u=>o.addKey(u)):o.addKey(c);(t||r).forEach((c,u)=>{let h=t&&a(t[u]),f=r&&a(r[u]);Je(h,f)!==0&&(h!=null&&l(h),f!=null&&l(f))})}e.indexes.forEach(i)}var _t=class{constructor(e,t){this._middlewares={},this.verno=0;let r=_t.dependencies;this._options=t={addons:_t.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};let{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new z(o=>{s.dbReadyResolve=o}),s.openCanceller=new z((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=Qr(this,"populate","blocked","versionchange","close",{ready:[ja,me]}),this.on.ready.subscribe=uu(this.on.ready.subscribe,o=>(a,l)=>{_t.vip(()=>{let c=this._state;if(c.openComplete)c.dbOpenError||z.resolve().then(a),l&&o(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),l&&o(a);else{o(a);let u=this;l||o(function h(){u.on.ready.unsubscribe(a),u.on.ready.unsubscribe(h)})}})}),this.Collection=hm(this),this.Table=cm(this),this.Transaction=bm(this),this.Version=Lm(this),this.WhereClause=_m(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=$r(t.IDBKeyRange),this._createTransaction=(o,a,l,c)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,c),this._fireOnBlocked=o=>{this.on("blocked").fire(o),zr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Vm),this.use(Hm),this.use(Xm),this.use(qm),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new Q.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new Q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let t=this._versions;var r=t.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),t.push(r),t.sort(Cm),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||G.letThrough||this._vip)?e():new z((t,r)=>{if(this._state.openComplete)return r(new Q.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new Q.DatabaseClosed);return}this.open().catch(me)}this._state.dbReadyPromise.then(t,r)}).then(e)}use({stack:e,create:t,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:r==null?10:r,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:t?i.name!==t:!1)),this}open(){return jm(this)}_close(){let e=this._state,t=zr.indexOf(this);if(t>=0&&zr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}e.dbReadyPromise=new z(r=>{e.dbReadyResolve=r}),e.openCanceller=new z((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new Q.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,t=this._state;return new z((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=xe(()=>{Bm(this._deps,this.name),r()}),o.onerror=jt(i),o.onblocked=this._fireOnBlocked};if(e)throw new Q.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Ce(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Um.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let i=G.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=t.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===ra)o=ra;else if(e=="rw"||e==ia)o=ia;else throw new Q.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===ra&&o===ia)if(s)i=null;else throw new Q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(c=>{if(i&&i.storeNames.indexOf(c)===-1)if(s)i=null;else throw new Q.SubTransaction("Table "+c+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(u,h)=>{h(c)}):Pe(c)}let l=ku.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):G.trans?cr(G.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!pt(this._allTables,e))throw new Q.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},Jm=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Ra=class{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:t,complete:r}:e)}[Jm](){return this}};function Bu(n,e){return Ce(e).forEach(t=>{let r=n[t]||(n[t]=new Yt);Es(r,e[t])}),n}function Qm(n){let e=!1,t,r=new Ra(i=>{let s=Na(n);function o(g){s&&lr();let v=()=>cn(n,{subscr:g,trans:null}),x=G.trans?cr(G.transless,v):v();return s&&x.then(tn,tn),x}let a=!1,l={},c={},u={get closed(){return a},unsubscribe:()=>{a=!0,fn.storagemutated.unsubscribe(m)}};i.start&&i.start(u);let h=!1,f=!1;function d(){return Ce(c).some(g=>l[g]&&Gm(l[g],c[g]))}let m=g=>{Bu(l,g),d()&&p()},p=()=>{if(h||a)return;l={};let g={},v=o(g);f||(fn(Hr,m),f=!0),h=!0,Promise.resolve(v).then(x=>{e=!0,t=x,h=!1,!a&&(d()?p():(l={},c=g,i.next&&i.next(x)))},x=>{h=!1,e=!1,i.error&&i.error(x),u.unsubscribe()})};return p(),u});return r.hasValue=()=>e,r.getValue=()=>t,r}var La;try{La={indexedDB:be.indexedDB||be.mozIndexedDB||be.webkitIndexedDB||be.msIndexedDB,IDBKeyRange:be.IDBKeyRange||be.webkitIDBKeyRange}}catch(n){La={indexedDB:null,IDBKeyRange:null}}var Mn=_t;sr(Mn,{...As,delete(n){return new Mn(n,{addons:[]}).delete()},exists(n){return new Mn(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(n){try{return km(Mn.dependencies).then(n)}catch(e){return Pe(new Q.MissingAPI)}},defineClass(){function n(e){Qe(this,e)}return n},ignoreTransaction(n){return G.trans?cr(G.transless,n):n()},vip:Ma,async:function(n){return function(){try{var e=Da(n.apply(this,arguments));return!e||typeof e.then!="function"?z.resolve(e):e}catch(t){return Pe(t)}}},spawn:function(n,e,t){try{var r=Da(n.apply(t,e||[]));return!r||typeof r.then!="function"?z.resolve(r):r}catch(i){return Pe(i)}},currentTransaction:{get:()=>G.trans||null},waitFor:function(n,e){let t=z.resolve(typeof n=="function"?Mn.ignoreTransaction(n):n).timeout(e||6e4);return G.trans?G.trans.waitFor(t):t},Promise:z,debug:{get:()=>Ut,set:n=>{gu(n,n==="dexie"?()=>!0:Pu)}},derive:or,extend:Qe,props:sr,override:uu,Events:Qr,on:fn,liveQuery:Qm,extendObservabilitySet:Bu,getByKeyPath:Zt,setByKeyPath:Mt,delByKeyPath:Lp,shallowClone:hu,deepClone:Gr,getObjectDiff:Xa,cmp:Je,asap:fu,minKey:wa,addons:[],connections:zr,errnames:za,dependencies:La,semVer:tu,version:tu.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,t*2))});Mn.maxKey=$r(Mn.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(fn(Hr,n=>{if(!Qt){let e;Cs?(e=document.createEvent("CustomEvent"),e.initCustomEvent(ln,!0,!0,n)):e=new CustomEvent(ln,{detail:n}),Qt=!0,dispatchEvent(e),Qt=!1}}),addEventListener(ln,({detail:n})=>{Qt||Ts(n)}));function Ts(n){let e=Qt;try{Qt=!0,fn.storagemutated.fire(n)}finally{Qt=e}}var Qt=!1;if(typeof BroadcastChannel!="undefined"){let n=new BroadcastChannel(ln);typeof n.unref=="function"&&n.unref(),fn(Hr,e=>{Qt||n.postMessage(e)}),n.onmessage=e=>{e.data&&Ts(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){fn(Hr,e=>{try{Qt||(typeof localStorage!="undefined"&&localStorage.setItem(ln,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:ln,changedParts:e})))}catch(t){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===ln){let t=JSON.parse(e.newValue);t&&Ts(t.changedParts)}});let n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",Zm)}function Zm({data:n}){n&&n.type===ln&&Ts(n.changedParts)}z.rejectionMapper=Kp;gu(Ut,Pu);var Uu=require("obsidian");var zu=require("obsidian");var ju=pe(ye());var We=class{constructor(){this.app=w(zu.App);this.plugin=w(Ye);this.obsidianFs=this.app.vault.adapter}getVaultAbsolutePath(){return this.obsidianFs.getBasePath().replace(/\\/g,"/")+"/"}getAbsolutePath(e){return De.join(this.getVaultAbsolutePath(),e)}getFileBacklinks(e){this.app.metadataCache.getBacklinksForFile(e)}getAppId(){return this.app.appId}executeCommandById(e){this.app.commands.executeCommandById(e)}isNotObsidianExcludedPath(e){return!(this.app.metadataCache.isUserIgnored&&this.app.metadataCache.isUserIgnored(e))}};We=j([(0,ju.singleton)()],We);var Wu=pe(ye());var Dt=class{constructor(){this.app=w(Uu.App);this.privateApi=w(We)}async initAsync(){if(this.app.plugins.plugins.omnisearch){let e="omnisearch/cache/"+this.privateApi.getAppId(),t=new _t(e);t.version(Dt.DB_VERSION).stores({searchHistory:"++id",minisearch:"date"}),this.db=t}}async getLastQuery(){let e="";if(this.checkOmnisearchStatus()){let t=await this.db.searchHistory.toArray();e=t.length!==0?t[t.length-1].query:""}return e}checkOmnisearchStatus(){let e=this.app.plugins.plugins.omnisearch,t=!0;return e?e._loaded||(new Ae(B("Omnisearch is installed but not enabled")),t=!1):(new Ae(B("Omnisearch isn't installed")),t=!1),t}};Dt.DB_VERSION=8,Dt=j([(0,Wu.singleton)()],Dt);var ne=require("obsidian");var Kn=pe(ye());var Vu=pe(ye());var Ve=class{constructor(){this.setting=w(de);this.extensionViewMap=new Map;this.plugin=w(Ye)}init(){this.fillMap(this.setting.customExtensions.plaintext,Bn.MARKDOWN);try{}catch(e){}}viewTypeByPath(e){let t=this.extensionViewMap.get(ve.getExtension(e));return t===void 0?Bn.UNSUPPORTED:t}refreshAll(){this.extensionViewMap.clear(),this.init()}fillMap(e,t){for(let r of e)this.extensionViewMap.set(r,t)}};Ve=j([(0,Vu.singleton)()],Ve);var Bn=(a=>(a.UNSUPPORTED="unsupported",a.MARKDOWN="markdown",a.PDF="pdf",a.CANVAS="canvas",a.IMAGE="image",a.AUDIO="audio",a.VIDEO="video",a))(Bn||{});var ur=class{constructor(e,t){this.text=e,this.row=t}},nn=class{constructor(e,t){this.sourcePath=e,this.items=t}};var ei=class{},dn=class extends ei{constructor(t,r){super();this.line=t,this.context=r}},hn=class extends ei{constructor(t,r,i,s,o,a){super();this.engineType=t,this.path=r,this.queryTerms=i,this.matchedTerms=s,this.subItems=o,this.previewContent=a}get viewType(){return w(Ve).viewTypeByPath(this.path)}get basename(){return ve.getBasename(this.path)}get extension(){return ve.getExtension(this.path)}get folderPath(){return ve.getFolderPath(this.path)}},Is=class extends ei{constructor(t,r,i){super();this.text=t,this.row=r,this.col=i}};var Ku=require("obsidian");var Ps=class{constructor(e){this.option=e}async get(e,t){return this.request("GET",e,t,void 0)}async post(e,t,r){return this.request("POST",e,t,r)}async put(e,t,r){return this.request("PUT",e,t,r)}async delete(e,t){return this.request("DELETE",e,t,void 0)}async request(e,t,r,i){return t=this.buildUrlWithParams(t,r),this.option.responseProcessor(await(0,Ku.requestUrl)({url:t,method:e,contentType:"application/json",body:i?JSON.stringify(i):void 0,headers:this.option.headers}))}buildUrlWithParams(e,t){e=`${this.option.protocol}://${this.option.baseUrl}/${e}`;let r=t?this.serializeParams(t):"";return r?`${e}?${r}`:e}serializeParams(e){return Object.keys(e).map(t=>{let r=e[t];return`${encodeURIComponent(t)}=${encodeURIComponent(this.stringifyParam(r))}`}).join("&")}stringifyParam(e){return typeof e=="object"?JSON.stringify(e):String(e)}};var Ja=pe(ye());var ot=class{constructor(){this.request=w(ti);this.viewRegistry=w(Ve);this._status="stopped"}get status(){return this._status}async testConnection(){await this.request.testConnection()?new Ae("Connected",5e3):new Ae("Failed to connect",5e3)}async doesCollectionExist(){try{let e=await this.request.doesCollectionExist();return this._status="ready",e}catch(e){return this._status="stopped",A.warn("failed to connect to ai-helper. launch clever-search-ai-helper or disable semantic search in the setting to avoid this warning."),A.error(e),null}}async reindexAll(e){this._status="indexing";let t=this.convertToDocuments(e);try{await this.request.reindexAll(t),this._status="ready"}catch(r){A.error(r),this._status="stopped"}}async addDocuments(e){this._status="indexing";let t=this.convertToDocuments(e);try{let r=await this.request.addDocuments(t);return this._status="ready",r}catch(r){return A.error(r),this._status="stopped",!1}}async deleteDocuments(e){this._status="indexing";try{let t=await this.request.deleteDocuments(e);return this._status="ready",t}catch(t){return A.error(t),this._status="stopped",!1}}async search(e,t){try{let r=await this.request.search(e,t);return this._status="ready",r.map(i=>{let s=i.subItems.map(o=>new Is(o.text,o.row,o.col));return new hn(i.engineType,i.path,i.queryTerms,i.matchedTerms,s,i.previewContent)})}catch(r){return A.error(r),this._status="stopped",[]}}async docsCount(){return this.request.docsCount()}convertToDocuments(e){return e.map(t=>({path:t.path,view_type:this.viewRegistry.viewTypeByPath(t.path),content:t.content}))}};ot=j([(0,Ja.singleton)()],ot);var ti=class{constructor(){this.responseProcessor=e=>{if(e.status===200){let t=e.json;if(t.code===0)return t.data;if(t.code===-1)return A.error(`KnownException: ${t.message}`),null;if(t.code===-2)return A.error(`UnknownException: ${t.message}`),null;throw Error(ns)}else return A.error(e.text),null};this.client=new Ps({baseUrl:"localhost:19528/api",protocol:"http",responseProcessor:this.responseProcessor,headers:{"X-vaultId":w(We).getAppId()}})}async testConnection(){try{return!!await this.client.get("testConnection")}catch(e){return A.error(e),!1}}async doesCollectionExist(){return await this.client.get("doesCollectionExist",void 0)}async reindexAll(e){await this.client.post("reindexAll",void 0,e)}async docsCount(){try{return await this.client.get("docsCount")}catch(e){return A.error(e),null}}async addDocuments(e){return await this.client.post("addDocuments",void 0,e)}async deleteDocuments(e){return await this.client.post("deleteDocuments",void 0,e)}async search(e,t){return await this.client.get("search",{queryText:e,viewType:t})}};ti=j([(0,Ja.singleton)()],ti);var xf=require("obsidian");var ni=pe(ye());var pn=class{constructor(){this.db=w(bt)}async deleteMinisearchData(){this.db.minisearch.clear()}async setMiniSearchData(e){this.db.transaction("rw",this.db.minisearch,async()=>{await this.db.minisearch.clear(),await this.db.minisearch.add({data:e}),A.trace("minisearch data saved")})}async getMiniSearchData(){var e;return((e=(await this.db.minisearch.toArray())[0])==null?void 0:e.data)||null}async setLexicalDocRefs(e){this.db.transaction("rw",this.db.lexicalDocRefs,async()=>{await this.db.lexicalDocRefs.clear(),await this.db.lexicalDocRefs.bulkAdd(e)})}async getLexicalDocRefs(){return await this.db.lexicalDocRefs.toArray()||null}async setSemanticDocRefs(e){this.db.transaction("rw",this.db.semanticDocRefs,async()=>{await this.db.semanticDocRefs.clear(),await this.db.semanticDocRefs.bulkAdd(e)})}async getSemanticDocRefs(){return await this.db.semanticDocRefs.toArray()||null}async setPluginSetting(e){try{return await this.db.transaction("rw",this.db.pluginSetting,()=>{this.db.pluginSetting.clear(),this.db.pluginSetting.add({data:e})}),A.trace("settings have been saved to database"),!0}catch(t){return A.trace(`settings failed to be saved: ${t}`),!1}}async deleteOldDatabases(){let e=(await indexedDB.databases()).filter(t=>t.name===this.db.dbName&&t.version!==this.db.dbVersion*10);if(e.length){A.info("Old version databases will be deleted");for(let t of e)t.name&&indexedDB.deleteDatabase(t.name)}}};j([ze],pn.prototype,"getMiniSearchData",1),j([ze],pn.prototype,"getLexicalDocRefs",1),pn=j([(0,ni.singleton)()],pn);var bt=class extends _t{constructor(t){super(bt.dbNamePrefix+t.getAppId());this.privateApi=t,this.version(bt._dbVersion).stores({pluginSetting:"++id",minisearch:"++id",lexicalDocRefs:"++id",semanticDocRefs:"++id"})}get dbVersion(){return bt._dbVersion}get dbName(){return bt.dbNamePrefix+this.privateApi.getAppId()}};bt._dbVersion=2,bt.dbNamePrefix="clever-search/",bt=j([(0,ni.singleton)(),Mi(0,(0,ni.inject)(We))],bt);var nl={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let n="\u0300".codePointAt(0);n<="\u036F".codePointAt(0);++n){let e=String.fromCodePoint(n);for(let t of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let i=(t+e).normalize().codePointAt(0);i>126&&(nl[i]=t)}}var Qa={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(let n of Object.keys(Qa)){let e=n.toUpperCase();for(let t=Qa[n][0];t<=Qa[n][1];++t)nl[t]=t%2===0?e:n}function li(n){if(n<192||n>8580)return n;let e=nl[n];return e!==void 0?e.codePointAt(0):n}function mn(n,e){return n>e?n:e}var qu=n=>n.split("").map(e=>e.codePointAt(0));var eg=new Set(` \f
\r	\v\xA0\u1680\u2028\u2029\u202F\u205F\u3000\uFEFF`.split("").map(n=>n.codePointAt(0)));for(let n="\u2000".codePointAt(0);n<="\u200A".codePointAt(0);n++)eg.add(n);var dr="\x7F".codePointAt(0),ii="A".codePointAt(0),si="Z".codePointAt(0),Gu="a".codePointAt(0),Xu="z".codePointAt(0),tg="0".codePointAt(0),ng="9".codePointAt(0);function fr(n,e,t){return t?n:e-n-1}var oi=16,Ms=-3,ai=-1,zn=oi/2,rg=oi/2,ig=zn+ai,Yu=-(Ms+ai),Ju=2;function Za(n){return n?new Set:null}function ri(n,e,t){if(e!==null&&e.i16.length>n+t){let r=e.i16.subarray(n,n+t);return[n+t,r]}return[n,new Int16Array(t)]}function Hu(n,e,t){if(e!==null&&e.i32.length>n+t){let r=e.i32.subarray(n,n+t);return[n+t,r]}return[n,new Int32Array(t)]}function Qu(n){return n>=Gu&&n<=Xu?1:n>=ii&&n<=si?2:n>=tg&&n<=ng?4:0}function Zu(n){let e=String.fromCodePoint(n);return e!==e.toUpperCase()?1:e!==e.toLowerCase()?2:e.match(/\p{Number}/gu)!==null?4:e.match(/\p{Letter}/gu)!==null?3:0}function Ds(n){return n<=dr?Qu(n):Zu(n)}function rl(n,e){return n===0&&e!==0?zn:n===1&&e===2||n!==4&&e===4?ig:e===0?rg:0}function sg(n,e){return e===0?zn:rl(Ds(n[e-1]),Ds(n[e]))}function og(n,e,t,r){let i=n.slice(r),s=i.indexOf(t);if(s===0)return r;if(!e&&t>=Gu&&t<=Xu){s>0&&(i=i.slice(0,s));let o=i.indexOf(t-32);o>=0&&(s=o)}return s<0?-1:r+s}function $u(n){for(let e of n)if(e>=128)return!1;return!0}function il(n,e,t){if(!$u(n))return 0;if(!$u(e))return-1;let r=0,i=0;for(let s=0;s<e.length;s++){if(i=og(n,t,e[s],i),i<0)return-1;s===0&&i>0&&(r=i-1),i++}return r}var ag=(n,e,t,r,i,s,o)=>{let a=i.length;if(a===0)return[{start:0,end:0,score:0},Za(s)];let l=r.length;if(o!==null&&l*a>o.i16.length)return tf(n,e,t,r,i,s);let c=il(r,i,n);if(c<0)return[{start:-1,end:-1,score:0},null];let u=0,h=0,f=null,d=null,m=null,p=null;[u,f]=ri(u,o,l),[u,d]=ri(u,o,l),[u,m]=ri(u,o,l),[h,p]=Hu(h,o,a);let[,g]=Hu(h,o,l);for(let Y=0;Y<g.length;Y++)g[Y]=r[Y];let v=0,x=0,E=0,b=0,S=i[0],C=i[0],I=0,P=0,R=!1,U=g.subarray(c),D=f.subarray(c).subarray(0,U.length),L=d.subarray(c).subarray(0,U.length),k=m.subarray(c).subarray(0,U.length);for(let[Y,H]of U.entries()){let Z=null;H<=dr?(Z=Qu(H),!n&&Z===2&&(H+=32)):(Z=Zu(H),!n&&Z===2&&(H=String.fromCodePoint(H).toLowerCase().codePointAt(0)),e&&(H=li(H))),U[Y]=H;let ae=rl(P,Z);if(k[Y]=ae,P=Z,H===C&&(E<a&&(p[E]=c+Y,E++,C=i[Math.min(E,a-1)]),b=c+Y),H===S){let Ee=oi+ae*Ju;if(D[Y]=Ee,L[Y]=1,a===1&&(t&&Ee>v||!t&&Ee>=v)&&(v=Ee,x=c+Y,t&&ae===zn))break;R=!1}else R?D[Y]=mn(I+ai,0):D[Y]=mn(I+Ms,0),L[Y]=0,R=!0;I=D[Y]}if(E!==a)return[{start:-1,end:-1,score:0},null];if(a===1){let Y={start:x,end:x+1,score:v};if(!s)return[Y,null];let H=new Set;return H.add(x),[Y,H]}let V=p[0],se=b-V+1,J=null;[u,J]=ri(u,o,se*a);{let Y=f.subarray(V,b+1);for(let[H,Z]of Y.entries())J[H]=Z}let[,ue]=ri(u,o,se*a);{let Y=d.subarray(V,b+1);for(let[H,Z]of Y.entries())ue[H]=Z}let fe=p.subarray(1),we=i.slice(1).slice(0,fe.length);for(let[Y,H]of fe.entries()){let Z=!1,ae=we[Y],Ee=Y+1,ke=Ee*se,N=g.subarray(H,b+1),ee=m.subarray(H).subarray(0,N.length),He=ue.subarray(ke+H-V).subarray(0,N.length),Tt=ue.subarray(ke+H-V-1-se).subarray(0,N.length),St=J.subarray(ke+H-V).subarray(0,N.length),Tn=J.subarray(ke+H-V-1-se).subarray(0,N.length),tt=J.subarray(ke+H-V-1).subarray(0,N.length);tt[0]=0;for(let[$e,Sn]of N.entries()){let At=$e+H,dt=0,nt=0,Ct=0;if(Z?nt=tt[$e]+ai:nt=tt[$e]+Ms,ae===Sn){dt=Tn[$e]+oi;let Kt=ee[$e];Ct=Tt[$e]+1,Kt===zn?Ct=1:Ct>1&&(Kt=mn(Kt,mn(Yu,m[At-Ct+1]))),dt+Kt<nt?(dt+=ee[$e],Ct=0):dt+=Kt}He[$e]=Ct,Z=dt<nt;let Vt=mn(mn(dt,nt),0);Ee===a-1&&(t&&Vt>v||!t&&Vt>=v)&&(v=Vt,x=At),St[$e]=Vt}}let ft=Za(s),X=V;if(s&&ft!==null){let Y=a-1;X=x;let H=!0;for(;;){let Z=Y*se,ae=X-V,Ee=J[Z+ae],ke=0,N=0;if(Y>0&&X>=p[Y]&&(ke=J[Z-se+ae-1]),X>p[Y]&&(N=J[Z+ae-1]),Ee>ke&&(Ee>N||Ee===N&&H)){if(ft.add(X),Y===0)break;Y--}H=ue[Z+ae]>1||Z+se+ae+1<ue.length&&ue[Z+se+ae+1]>0,X--}}return[{start:X,end:x+1,score:v},ft]};function ef(n,e,t,r,i,s,o){let a=0,l=0,c=!1,u=0,h=0,f=Za(o),d=0;i>0&&(d=Ds(t[i-1]));for(let m=i;m<s;m++){let p=t[m],g=Ds(p);if(n||(p>=ii&&p<=si?p+=32:p>dr&&(p=String.fromCodePoint(p).toLowerCase().codePointAt(0))),e&&(p=li(p)),p===r[a]){o&&f!==null&&f.add(m),l+=oi;let v=rl(d,g);u===0?h=v:(v===zn&&(h=v),v=mn(mn(v,h),Yu)),a===0?l+=v*Ju:l+=v,c=!1,u++,a++}else c?l+=ai:l+=Ms,c=!0,u=0,h=0;d=g}return[l,f]}var tf=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];if(il(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let a=0,l=-1,c=-1,u=r.length,h=i.length;for(let f=0;f<u;f++){let d=r[fr(f,u,t)];n||(d>=ii&&d<=si?d+=32:d>dr&&(d=String.fromCodePoint(d).toLowerCase().codePointAt(0))),e&&(d=li(d));let m=i[fr(a,h,t)];if(d===m&&(l<0&&(l=f),a++,a===h)){c=f+1;break}}if(l>=0&&c>=0){a--;for(let m=c-1;m>=l;m--){let p=fr(m,u,t),g=r[p];n||(g>=ii&&g<=si?g+=32:g>dr&&(g=String.fromCodePoint(g).toLowerCase().codePointAt(0)));let v=fr(a,h,t),x=i[v];if(g===x&&(a--,a<0)){l=m;break}}if(!t){let m=l;l=u-c,c=u-m}let[f,d]=ef(n,e,r,i,l,c,s);return[{start:l,end:c,score:f},d]}return[{start:-1,end:-1,score:0},null]},lg=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];let a=r.length,l=i.length;if(a<l)return[{start:-1,end:-1,score:0},null];if(il(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let c=0,u=-1,h=0,f=-1;for(let d=0;d<a;d++){let m=fr(d,a,t),p=r[m];n||(p>=ii&&p<=si?p+=32:p>dr&&(p=String.fromCodePoint(p).toLowerCase().codePointAt(0))),e&&(p=li(p));let g=fr(c,l,t);if(i[g]===p){if(g===0&&(h=sg(r,m)),c++,c===l){if(h>f&&(u=d,f=h),h===zn)break;d-=c-1,c=0,h=0}}else d-=c,c=0,h=0}if(u>=0){let d=0,m=0;t?(d=u-l+1,m=u+1):(d=a-(u+1),m=a-(u-l+1));let[p]=ef(n,e,r,i,d,m,!1);return[{start:d,end:m,score:p},null]}return[{start:-1,end:-1,score:0},null]};var cg=100*1024,ug=2048;function fg(n,e){return{i16:new Int16Array(n),i32:new Int32Array(e)}}var dg=fg(cg,ug);var nf=(n,e,t)=>{let r=!1;switch(e){case"smart-case":n.toLowerCase()!==n&&(r=!0);break;case"case-sensitive":r=!0;break;case"case-insensitive":n=n.toLowerCase(),r=!1;break}let i=qu(n);return t&&(i=i.map(li)),{queryRunes:i,caseSensitive:r}};function rf(n,e){let t=Object.keys(n).map(i=>parseInt(i,10)).sort((i,s)=>s-i),r=[];for(let i of t)if(r=r.concat(n[i]),r.length>=e)break;return r}function sf(n,e,t){return r=>{let i=this.runesList[r];if(e.length>i.length)return;let[s,o]=this.algoFn(t,this.opts.normalize,this.opts.forward,i,e,!0,dg);if(s.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let l=s.start;l<s.end;++l)o.add(l)}let a=this.opts.sort?s.score:0;n[a]===void 0&&(n[a]=[]),n[a].push({item:this.items[r],...s,positions:o!=null?o:new Set})}}function hg(n){let{queryRunes:e,caseSensitive:t}=nf(n,this.opts.casing,this.opts.normalize),r={},i=sf.bind(this)(r,e,t);for(let s=0,o=this.runesList.length;s<o;++s)i(s);return rf(r,this.opts.limit)}var pg=typeof require!="undefined"&&typeof window=="undefined";function mg(n,e,t,r){return new Promise((i,s)=>{let a=0,l=Math.min(1e3,e),c=()=>{if(n.cancelled)return s("search cancelled");for(;a<l;++a)t(a);l<e?(l=Math.min(l+1e3,e),pg?setImmediate(c):setTimeout(c)):i(r())};c()})}function gg(n,e){let{queryRunes:t,caseSensitive:r}=nf(n,this.opts.casing,this.opts.normalize),i={};return mg(e,this.runesList.length,sf.bind(this)(i,t,r),()=>rf(i,this.opts.limit))}var sl={limit:1/0,selector:n=>n,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0},el=class{constructor(e,...t){switch(this.opts={...sl,...t[0]},this.items=e,this.runesList=e.map(r=>qu(this.opts.selector(r).normalize())),this.algoFn=lg,this.opts.fuzzy){case"v2":this.algoFn=ag;break;case"v1":this.algoFn=tf;break}}},W_={...sl,match:hg};var yg={...sl,match:gg},tl=class extends el{constructor(e,...t){super(e,...t),this.opts={...yg,...t[0]},this.token={cancelled:!1}}async find(e){if(this.token.cancelled=!0,this.token={cancelled:!1},e.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(vg);e=e.normalize();let t=await this.opts.match.bind(this)(e,this.token);return _g(t,this.opts)}},vg=n=>({item:n,start:-1,end:-1,score:0,positions:new Set});function _g(n,e){if(e.sort){let{selector:t}=e;n.sort((r,i)=>{if(r.score===i.score)for(let s of e.tiebreakers){let o=s(r,i,t);if(o!==0)return o}return 0})}return Number.isFinite(e.limit)&&n.splice(e.limit),n}var Os=class{constructor(e,...t){this.finder=new tl(e,...t),this.find=this.finder.find.bind(this.finder)}};var _e=function(){return _e=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},_e.apply(this,arguments)};function bg(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}function wg(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function oe(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}var xg="ENTRIES",uf="KEYS",ff="VALUES",Re="",ol=function(){function n(e,t){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:r,keys:i}]:[]}return n.prototype.next=function(){var e=this.dive();return this.backtrack(),e},n.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=hr(this._path),t=e.node,r=e.keys;if(hr(r)===Re)return{done:!1,value:this.result()};var i=t.get(hr(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},n.prototype.backtrack=function(){if(this._path.length!==0){var e=hr(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},n.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var t=e.keys;return hr(t)}).filter(function(e){return e!==Re}).join("")},n.prototype.value=function(){return hr(this._path).node.get(Re)},n.prototype.result=function(){switch(this._type){case ff:return this.value();case uf:return this.key();default:return[this.key(),this.value()]}},n.prototype[Symbol.iterator]=function(){return this},n}(),hr=function(n){return n[n.length-1]},Eg=function(n,e,t){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,s=i+t,o=new Uint8Array(s*i).fill(t+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return df(n,e,t,r,o,1,i,""),r},df=function(n,e,t,r,i,s,o,a){var l,c,u=s*o;try{e:for(var h=oe(n.keys()),f=h.next();!f.done;f=h.next()){var d=f.value;if(d===Re){var m=i[u-1];m<=t&&r.set(a,[n.get(d),m])}else{for(var p=s,g=0;g<d.length;++g,++p){for(var v=d[g],x=o*p,E=x-o,b=i[x],S=Math.max(0,p-t-1),C=Math.min(o-1,p+t),I=S;I<C;++I){var P=v!==e[I],R=i[E+I]+ +P,U=i[E+I+1]+1,D=i[x+I]+1,L=i[x+I+1]=Math.min(R,U,D);L<b&&(b=L)}if(b>t)continue e}df(n.get(d),e,t,r,i,p,o,a+d)}}}catch(k){l={error:k}}finally{try{f&&!f.done&&(c=h.return)&&c.call(h)}finally{if(l)throw l.error}}},al=function(){function n(e,t){e===void 0&&(e=new Map),t===void 0&&(t=""),this._size=void 0,this._tree=e,this._prefix=t}return n.prototype.atPrefix=function(e){var t,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=Te(Ls(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=Te(ml(o),2),l=a[0],c=a[1];try{for(var u=oe(l.keys()),h=u.next();!h.done;h=u.next()){var f=h.value;if(f!==Re&&f.startsWith(c)){var d=new Map;return d.set(f.slice(c.length),l.get(f)),new n(d,e)}}}catch(m){t={error:m}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}}return new n(s,e)},n.prototype.clear=function(){this._size=void 0,this._tree.clear()},n.prototype.delete=function(e){return this._size=void 0,Tg(this._tree,e)},n.prototype.entries=function(){return new ol(this,xg)},n.prototype.forEach=function(e){var t,r;try{for(var i=oe(this),s=i.next();!s.done;s=i.next()){var o=Te(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.fuzzyGet=function(e,t){return Eg(this._tree,e,t)},n.prototype.get=function(e){var t=dl(this._tree,e);return t!==void 0?t.get(Re):void 0},n.prototype.has=function(e){var t=dl(this._tree,e);return t!==void 0&&t.has(Re)},n.prototype.keys=function(){return new ol(this,uf)},n.prototype.set=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=ll(this._tree,e);return r.set(Re,t),this},Object.defineProperty(n.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),n.prototype.update=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=ll(this._tree,e);return r.set(Re,t(r.get(Re))),this},n.prototype.fetch=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=ll(this._tree,e),i=r.get(Re);return i===void 0&&r.set(Re,i=t()),i},n.prototype.values=function(){return new ol(this,ff)},n.prototype[Symbol.iterator]=function(){return this.entries()},n.from=function(e){var t,r,i=new n;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=Te(o.value,2),l=a[0],c=a[1];i.set(l,c)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},n.fromObject=function(e){return n.from(Object.entries(e))},n}(),Ls=function(n,e,t){var r,i;if(t===void 0&&(t=[]),e.length===0||n==null)return[n,t];try{for(var s=oe(n.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==Re&&e.startsWith(a))return t.push([n,a]),Ls(n.get(a),e.slice(a.length),t)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return t.push([n,e]),Ls(void 0,"",t)},dl=function(n,e){var t,r;if(e.length===0||n==null)return n;try{for(var i=oe(n.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==Re&&e.startsWith(o))return dl(n.get(o),e.slice(o.length))}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},ll=function(n,e){var t,r,i=e.length;e:for(var s=0;n&&s<i;){try{for(var o=(t=void 0,oe(n.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==Re&&e[s]===l[0]){for(var c=Math.min(i-s,l.length),u=1;u<c&&e[s+u]===l[u];)++u;var h=n.get(l);if(u===l.length)n=h;else{var f=new Map;f.set(l.slice(u),h),n.set(e.slice(s,s+u),f),n.delete(l),n=f}s+=u;continue e}}}catch(m){t={error:m}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}var d=new Map;return n.set(e.slice(s),d),d}return n},Tg=function(n,e){var t=Te(Ls(n,e),2),r=t[0],i=t[1];if(r!==void 0){if(r.delete(Re),r.size===0)hf(i);else if(r.size===1){var s=Te(r.entries().next().value,2),o=s[0],a=s[1];pf(i,o,a)}}},hf=function(n){if(n.length!==0){var e=Te(ml(n),2),t=e[0],r=e[1];if(t.delete(r),t.size===0)hf(n.slice(0,-1));else if(t.size===1){var i=Te(t.entries().next().value,2),s=i[0],o=i[1];s!==Re&&pf(n.slice(0,-1),s,o)}}},pf=function(n,e,t){if(n.length!==0){var r=Te(ml(n),2),i=r[0],s=r[1];i.set(s+e,t),i.delete(s)}},ml=function(n){return n[n.length-1]},ci,gl="or",mf="and",Sg="and_not",ks=function(){function n(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var t=e.autoVacuum==null||e.autoVacuum===!0?fl:e.autoVacuum;this._options=_e(_e(_e({},ul),e),{autoVacuum:t,searchOptions:_e(_e({},of),e.searchOptions||{}),autoSuggestOptions:_e(_e({},Pg),e.autoSuggestOptions||{})}),this._index=new al,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=pl,this.addFields(this._options.fields)}return n.prototype.add=function(e){var t,r,i,s,o,a,l=this._options,c=l.extractField,u=l.tokenize,h=l.processTerm,f=l.fields,d=l.idField,m=c(e,d);if(m==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(m))throw new Error("MiniSearch: duplicate ID ".concat(m));var p=this.addDocumentId(m);this.saveStoredFields(p,e);try{for(var g=oe(f),v=g.next();!v.done;v=g.next()){var x=v.value,E=c(e,x);if(E!=null){var b=u(E.toString(),x),S=this._fieldIds[x],C=new Set(b).size;this.addFieldLength(p,S,this._documentCount-1,C);try{for(var I=(i=void 0,oe(b)),P=I.next();!P.done;P=I.next()){var R=P.value,U=h(R,x);if(Array.isArray(U))try{for(var D=(o=void 0,oe(U)),L=D.next();!L.done;L=D.next()){var k=L.value;this.addTerm(S,p,k)}}catch(V){o={error:V}}finally{try{L&&!L.done&&(a=D.return)&&a.call(D)}finally{if(o)throw o.error}}else U&&this.addTerm(S,p,U)}}catch(V){i={error:V}}finally{try{P&&!P.done&&(s=I.return)&&s.call(I)}finally{if(i)throw i.error}}}}}catch(V){t={error:V}}finally{try{v&&!v.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}},n.prototype.addAll=function(e){var t,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.addAllAsync=function(e,t){var r=this;t===void 0&&(t={});var i=t.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(u,h,f){var d=u.chunk,m=u.promise;return d.push(h),(f+1)%s===0?{chunk:[],promise:m.then(function(){return new Promise(function(p){return setTimeout(p,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:m}},o),l=a.chunk,c=a.promise;return c.then(function(){return r.addAll(l)})},n.prototype.remove=function(e){var t,r,i,s,o,a,l=this._options,c=l.tokenize,u=l.processTerm,h=l.extractField,f=l.fields,d=l.idField,m=h(e,d);if(m==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var p=this._idToShortId.get(m);if(p==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(m,": it is not in the index"));try{for(var g=oe(f),v=g.next();!v.done;v=g.next()){var x=v.value,E=h(e,x);if(E!=null){var b=c(E.toString(),x),S=this._fieldIds[x],C=new Set(b).size;this.removeFieldLength(p,S,this._documentCount,C);try{for(var I=(i=void 0,oe(b)),P=I.next();!P.done;P=I.next()){var R=P.value,U=u(R,x);if(Array.isArray(U))try{for(var D=(o=void 0,oe(U)),L=D.next();!L.done;L=D.next()){var k=L.value;this.removeTerm(S,p,k)}}catch(V){o={error:V}}finally{try{L&&!L.done&&(a=D.return)&&a.call(D)}finally{if(o)throw o.error}}else U&&this.removeTerm(S,p,U)}}catch(V){i={error:V}}finally{try{P&&!P.done&&(s=I.return)&&s.call(I)}finally{if(i)throw i.error}}}}}catch(V){t={error:V}}finally{try{v&&!v.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}this._storedFields.delete(p),this._documentIds.delete(p),this._idToShortId.delete(m),this._fieldLength.delete(p),this._documentCount-=1},n.prototype.removeAll=function(e){var t,r;if(e)try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new al,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},n.prototype.discard=function(e){var t=this,r=this._idToShortId.get(e);if(r==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(r),this._storedFields.delete(r),(this._fieldLength.get(r)||[]).forEach(function(i,s){t.removeFieldLength(r,s,t._documentCount,i)}),this._fieldLength.delete(r),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},n.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,t=e.minDirtFactor,r=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:r,minDirtFactor:t})}},n.prototype.discardAll=function(e){var t,r,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},n.prototype.replace=function(e){var t=this._options,r=t.idField,i=t.extractField,s=i(e,r);this.discard(s),this.add(e)},n.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},n.prototype.conditionalVacuum=function(e,t){var r=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=r._enqueuedVacuumConditions;return r._enqueuedVacuumConditions=pl,r.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},n.prototype.performVacuuming=function(e,t){return bg(this,void 0,void 0,function(){var r,i,s,o,a,l,c,u,h,f,d,m,p,g,v,x,E,b,S,C,I,P,R,U,D;return wg(this,function(L){switch(L.label){case 0:if(r=this._dirtCount,!this.vacuumConditionsMet(t))return[3,10];i=e.batchSize||hl.batchSize,s=e.batchWait||hl.batchWait,o=1,L.label=1;case 1:L.trys.push([1,7,8,9]),a=oe(this._index),l=a.next(),L.label=2;case 2:if(l.done)return[3,6];c=Te(l.value,2),u=c[0],h=c[1];try{for(f=(P=void 0,oe(h)),d=f.next();!d.done;d=f.next()){m=Te(d.value,2),p=m[0],g=m[1];try{for(v=(U=void 0,oe(g)),x=v.next();!x.done;x=v.next())E=Te(x.value,1),b=E[0],!this._documentIds.has(b)&&(g.size<=1?h.delete(p):g.delete(b))}catch(k){U={error:k}}finally{try{x&&!x.done&&(D=v.return)&&D.call(v)}finally{if(U)throw U.error}}}}catch(k){P={error:k}}finally{try{d&&!d.done&&(R=f.return)&&R.call(f)}finally{if(P)throw P.error}}return this._index.get(u).size===0&&this._index.delete(u),o%i!==0?[3,4]:[4,new Promise(function(k){return setTimeout(k,s)})];case 3:L.sent(),L.label=4;case 4:o+=1,L.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return S=L.sent(),C={error:S},[3,9];case 8:try{l&&!l.done&&(I=a.return)&&I.call(a)}finally{if(C)throw C.error}return[7];case 9:this._dirtCount-=r,L.label=10;case 10:return[4,null];case 11:return L.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},n.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var t=e.minDirtCount,r=e.minDirtFactor;return t=t||fl.minDirtCount,r=r||fl.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=r},Object.defineProperty(n.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),n.prototype.has=function(e){return this._idToShortId.has(e)},n.prototype.getStoredFields=function(e){var t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)},n.prototype.search=function(e,t){var r,i;t===void 0&&(t={});var s=this.executeQuery(e,t),o=[];try{for(var a=oe(s),l=a.next();!l.done;l=a.next()){var c=Te(l.value,2),u=c[0],h=c[1],f=h.score,d=h.terms,m=h.match,p=d.length||1,g={id:this._documentIds.get(u),score:f*p,terms:Object.keys(m),queryTerms:d,match:m};Object.assign(g,this._storedFields.get(u)),(t.filter==null||t.filter(g))&&o.push(g)}}catch(v){r={error:v}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return e===n.wildcard&&t.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(lf),o},n.prototype.autoSuggest=function(e,t){var r,i,s,o;t===void 0&&(t={}),t=_e(_e({},this._options.autoSuggestOptions),t);var a=new Map;try{for(var l=oe(this.search(e,t)),c=l.next();!c.done;c=l.next()){var u=c.value,h=u.score,f=u.terms,d=f.join(" "),m=a.get(d);m!=null?(m.score+=h,m.count+=1):a.set(d,{score:h,terms:f,count:1})}}catch(S){r={error:S}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var p=[];try{for(var g=oe(a),v=g.next();!v.done;v=g.next()){var x=Te(v.value,2),m=x[0],E=x[1],h=E.score,f=E.terms,b=E.count;p.push({suggestion:m,terms:f,score:h/b})}}catch(S){s={error:S}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(s)throw s.error}}return p.sort(lf),p},Object.defineProperty(n.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),n.loadJSON=function(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)},n.getDefault=function(e){if(ul.hasOwnProperty(e))return cl(ul,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},n.loadJS=function(e,t){var r,i,s,o,a,l,c=e.index,u=e.documentCount,h=e.nextId,f=e.documentIds,d=e.fieldIds,m=e.fieldLength,p=e.averageFieldLength,g=e.storedFields,v=e.dirtCount,x=e.serializationVersion;if(x!==1&&x!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var E=new n(t);E._documentCount=u,E._nextId=h,E._documentIds=Rs(f),E._idToShortId=new Map,E._fieldIds=d,E._fieldLength=Rs(m),E._avgFieldLength=p,E._storedFields=Rs(g),E._dirtCount=v||0,E._index=new al;try{for(var b=oe(E._documentIds),S=b.next();!S.done;S=b.next()){var C=Te(S.value,2),I=C[0],P=C[1];E._idToShortId.set(P,I)}}catch(we){r={error:we}}finally{try{S&&!S.done&&(i=b.return)&&i.call(b)}finally{if(r)throw r.error}}try{for(var R=oe(c),U=R.next();!U.done;U=R.next()){var D=Te(U.value,2),L=D[0],k=D[1],V=new Map;try{for(var se=(a=void 0,oe(Object.keys(k))),J=se.next();!J.done;J=se.next()){var ue=J.value,fe=k[ue];x===1&&(fe=fe.ds),V.set(parseInt(ue,10),Rs(fe))}}catch(we){a={error:we}}finally{try{J&&!J.done&&(l=se.return)&&l.call(se)}finally{if(a)throw a.error}}E._index.set(L,V)}}catch(we){s={error:we}}finally{try{U&&!U.done&&(o=R.return)&&o.call(R)}finally{if(s)throw s.error}}return E},n.prototype.executeQuery=function(e,t){var r=this;if(t===void 0&&(t={}),e===n.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){var i=_e(_e(_e({},t),e),{queries:void 0}),s=e.queries.map(function(g){return r.executeQuery(g,i)});return this.combineResults(s,i.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,c=o.searchOptions,u=_e(_e({tokenize:a,processTerm:l},c),t),h=u.tokenize,f=u.processTerm,d=h(e).flatMap(function(g){return f(g)}).filter(function(g){return!!g}),m=d.map(Ig(u)),p=m.map(function(g){return r.executeQuerySpec(g,u)});return this.combineResults(p,u.combineWith)},n.prototype.executeQuerySpec=function(e,t){var r,i,s,o,a=_e(_e({},this._options.searchOptions),t),l=(a.fields||this._options.fields).reduce(function(ue,fe){var we;return _e(_e({},ue),(we={},we[fe]=cl(a.boost,fe)||1,we))},{}),c=a.boostDocument,u=a.weights,h=a.maxFuzzy,f=a.bm25,d=_e(_e({},of.weights),u),m=d.fuzzy,p=d.prefix,g=this._index.get(e.term),v=this.termResults(e.term,e.term,1,g,l,c,f),x,E;if(e.prefix&&(x=this._index.atPrefix(e.term)),e.fuzzy){var b=e.fuzzy===!0?.2:e.fuzzy,S=b<1?Math.min(h,Math.round(e.term.length*b)):b;S&&(E=this._index.fuzzyGet(e.term,S))}if(x)try{for(var C=oe(x),I=C.next();!I.done;I=C.next()){var P=Te(I.value,2),R=P[0],U=P[1],D=R.length-e.term.length;if(D){E==null||E.delete(R);var L=p*R.length/(R.length+.3*D);this.termResults(e.term,R,L,U,l,c,f,v)}}}catch(ue){r={error:ue}}finally{try{I&&!I.done&&(i=C.return)&&i.call(C)}finally{if(r)throw r.error}}if(E)try{for(var k=oe(E.keys()),V=k.next();!V.done;V=k.next()){var R=V.value,se=Te(E.get(R),2),J=se[0],D=se[1];if(D){var L=m*R.length/(R.length+D);this.termResults(e.term,R,L,J,l,c,f,v)}}}catch(ue){s={error:ue}}finally{try{V&&!V.done&&(o=k.return)&&o.call(k)}finally{if(s)throw s.error}}return v},n.prototype.executeWildcardQuery=function(e){var t,r,i=new Map,s=_e(_e({},this._options.searchOptions),e);try{for(var o=oe(this._documentIds),a=o.next();!a.done;a=o.next()){var l=Te(a.value,2),c=l[0],u=l[1],h=s.boostDocument?s.boostDocument(u,"",this._storedFields.get(c)):1;i.set(c,{score:h,terms:[],match:{}})}}catch(f){t={error:f}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},n.prototype.combineResults=function(e,t){if(t===void 0&&(t=gl),e.length===0)return new Map;var r=t.toLowerCase();return e.reduce(Ag[r])||new Map},n.prototype.toJSON=function(){var e,t,r,i,s=[];try{for(var o=oe(this._index),a=o.next();!a.done;a=o.next()){var l=Te(a.value,2),c=l[0],u=l[1],h={};try{for(var f=(r=void 0,oe(u)),d=f.next();!d.done;d=f.next()){var m=Te(d.value,2),p=m[0],g=m[1];h[p]=Object.fromEntries(g)}}catch(v){r={error:v}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}s.push([c,h])}}catch(v){e={error:v}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},n.prototype.termResults=function(e,t,r,i,s,o,a,l){var c,u,h,f,d;if(l===void 0&&(l=new Map),i==null)return l;try{for(var m=oe(Object.keys(s)),p=m.next();!p.done;p=m.next()){var g=p.value,v=s[g],x=this._fieldIds[g],E=i.get(x);if(E!=null){var b=E.size,S=this._avgFieldLength[x];try{for(var C=(h=void 0,oe(E.keys())),I=C.next();!I.done;I=C.next()){var P=I.value;if(!this._documentIds.has(P)){this.removeTerm(x,P,t),b-=1;continue}var R=o?o(this._documentIds.get(P),t,this._storedFields.get(P)):1;if(R){var U=E.get(P),D=this._fieldLength.get(P)[x],L=Fg(U,b,this._documentCount,D,S,a),k=r*v*R*L,V=l.get(P);if(V){V.score+=k,Mg(V.terms,e);var se=cl(V.match,t);se?se.push(g):V.match[t]=[g]}else l.set(P,{score:k,terms:[e],match:(d={},d[t]=[g],d)})}}}catch(J){h={error:J}}finally{try{I&&!I.done&&(f=C.return)&&f.call(C)}finally{if(h)throw h.error}}}}}catch(J){c={error:J}}finally{try{p&&!p.done&&(u=m.return)&&u.call(m)}finally{if(c)throw c.error}}return l},n.prototype.addTerm=function(e,t,r){var i=this._index.fetch(r,cf),s=i.get(e);if(s==null)s=new Map,s.set(t,1),i.set(e,s);else{var o=s.get(t);s.set(t,(o||0)+1)}},n.prototype.removeTerm=function(e,t,r){if(!this._index.has(r)){this.warnDocumentChanged(t,e,r);return}var i=this._index.fetch(r,cf),s=i.get(e);s==null||s.get(t)==null?this.warnDocumentChanged(t,e,r):s.get(t)<=1?s.size<=1?i.delete(e):s.delete(t):s.set(t,s.get(t)-1),this._index.get(r).size===0&&this._index.delete(r)},n.prototype.warnDocumentChanged=function(e,t,r){var i,s;try{for(var o=oe(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===t){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype.addDocumentId=function(e){var t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t},n.prototype.addFields=function(e){for(var t=0;t<e.length;t++)this._fieldIds[e[t]]=t},n.prototype.addFieldLength=function(e,t,r,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[t]=i;var o=this._avgFieldLength[t]||0,a=o*r+i;this._avgFieldLength[t]=a/(r+1)},n.prototype.removeFieldLength=function(e,t,r,i){if(r===1){this._avgFieldLength[t]=0;return}var s=this._avgFieldLength[t]*r-i;this._avgFieldLength[t]=s/(r-1)},n.prototype.saveStoredFields=function(e,t){var r,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var c=oe(o),u=c.next();!u.done;u=c.next()){var h=u.value,f=a(t,h);f!==void 0&&(l[h]=f)}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}},n.wildcard=Symbol("*"),n}(),cl=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0},Ag=(ci={},ci[gl]=function(n,e){var t,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=n.get(o);if(a==null)n.set(o,e.get(o));else{var l=e.get(o),c=l.score,u=l.terms,h=l.match;a.score=a.score+c,a.match=Object.assign(a.match,h),af(a.terms,u)}}}catch(f){t={error:f}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},ci[mf]=function(n,e){var t,r,i=new Map;try{for(var s=oe(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=n.get(a);if(l!=null){var c=e.get(a),u=c.score,h=c.terms,f=c.match;af(l.terms,h),i.set(a,{score:l.score+u,terms:l.terms,match:Object.assign(l.match,f)})}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},ci[Sg]=function(n,e){var t,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;n.delete(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},ci),Cg={k:1.2,b:.7,d:.5},Fg=function(n,e,t,r,i,s){var o=s.k,a=s.b,l=s.d,c=Math.log(1+(t-e+.5)/(e+.5));return c*(l+n*(o+1)/(n+o*(1-a+a*r/i)))},Ig=function(n){return function(e,t,r){var i=typeof n.fuzzy=="function"?n.fuzzy(e,t,r):n.fuzzy||!1,s=typeof n.prefix=="function"?n.prefix(e,t,r):n.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},ul={idField:"id",extractField:function(n,e){return n[e]},tokenize:function(n){return n.split(Dg)},processTerm:function(n){return n.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(n,e){typeof(console==null?void 0:console[n])=="function"&&console[n](e)},autoVacuum:!0},of={combineWith:gl,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Cg},Pg={combineWith:mf,prefix:function(n,e,t){return e===t.length-1}},hl={batchSize:1e3,batchWait:10},pl={minDirtFactor:.1,minDirtCount:20},fl=_e(_e({},hl),pl),Mg=function(n,e){n.includes(e)||n.push(e)},af=function(n,e){var t,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;n.includes(o)||n.push(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},lf=function(n,e){var t=n.score,r=e.score;return r-t},cf=function(){return new Map},Rs=function(n){var e,t,r=new Map;try{for(var i=oe(Object.keys(n)),s=i.next();!s.done;s=i.next()){var o=s.value;r.set(parseInt(o,10),n[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},Dg=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;function ui(n,e,t){var r=t||{},i=r.noTrailing,s=i===void 0?!1:i,o=r.noLeading,a=o===void 0?!1:o,l=r.debounceMode,c=l===void 0?void 0:l,u,h=!1,f=0;function d(){u&&clearTimeout(u)}function m(g){var v=g||{},x=v.upcomingOnly,E=x===void 0?!1:x;d(),h=!E}function p(){for(var g=arguments.length,v=new Array(g),x=0;x<g;x++)v[x]=arguments[x];var E=this,b=Date.now()-f;if(h)return;function S(){f=Date.now(),e.apply(E,v)}function C(){u=void 0}!a&&c&&!u&&S(),d(),c===void 0&&b>n?a?(f=Date.now(),s||(u=setTimeout(c?C:S,n))):S():s!==!0&&(u=setTimeout(c?C:S,c===void 0?n-b:n))}return p.cancel=m,p}function Ns(n,e,t){var r=t||{},i=r.atBegin,s=i===void 0?!1:i;return ui(n,e,{debounceMode:s!==!1})}var fi=class{static minInSet(e){let t=Number.MAX_VALUE;for(let r of e)r<t&&(t=r);return t}},Bs=class{constructor(e,t,r){this.flushThrottled=ui(1e4,()=>this.forceFlush());this.elementsMap=new Map,this.handler=e,this.identifier=t,this.autoFlushThreshold=r}add(e){let t=this.identifier(e);this.elementsMap.set(t,e),this.elementsMap.size>=this.autoFlushThreshold&&this.flushThrottled()}async forceFlush(){if(this.elementsMap.size===0)return;let e=Array.from(this.elementsMap.values());this.elementsMap.clear(),await this.handler(e),A.debug("flushed")}},zs=class{constructor(e,t=Number.MAX_VALUE){this.heap=[],this.compare=e,this.capacity=t}values(){return this.heap}push(e){this.size()<this.capacity?(this.heap.push(e),this.heapifyUp()):this.compare(e,this.heap[0])>0&&(this.heap[0]=e,this.heapifyDown())}clear(){this.heap=[]}pop(){if(this.isEmpty())return;let e=this.heap[0];return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.heapifyDown(),e}peek(){return this.heap[0]}isEmpty(){return this.heap.length===0}size(){return this.heap.length}getLeftChildIndex(e){return 2*e+1}getRightChildIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}heapifyUp(){let e=this.heap.length-1;for(;this.getParentIndex(e)>=0&&this.compare(this.heap[this.getParentIndex(e)],this.heap[e])>0;)this.swap(this.getParentIndex(e),e),e=this.getParentIndex(e)}heapifyDown(){let e=0;for(;this.getLeftChildIndex(e)<this.heap.length;){let t=this.getLeftChildIndex(e);if(this.getRightChildIndex(e)<this.heap.length&&this.compare(this.heap[this.getRightChildIndex(e)],this.heap[t])<0&&(t=this.getRightChildIndex(e)),this.compare(this.heap[e],this.heap[t])<0)break;this.swap(e,t),e=t}}};var yl=pe(ye());var Og=/[\u4e00-\u9fa5]/,gf=/[\u4e00-\u9fa5]/g,yf=/[\u4e00-\u9fa5]/,js=class{static isLargeCharset(e){return(e.match(gf)||[]).length>=Math.ceil(e.length*.35)}static testWideChar(e){return Og.test(e)}static wideCharProportion(e){return(e.match(gf)||[]).length/e.length}};var vf=pe(ye());var Rg=/[\[\]{}()<>\s]+/u,Lg=/[\^=#%\/\*,\.`:;\?@\s\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,kg=/[-_]|([a-z](?=[A-Z]))/g,gn=class{constructor(){this.setting=w(de);this.chsSegmenter=w(Pt);this.logThrottled=ui(300,e=>A.info(e));this.assetsProvider=w(st);this.stopWordsZh=this.assetsProvider.assets.stopWordsZh;this.stopWordsEn=this.assetsProvider.assets.stopWordsEn}tokenize(e,t){var s,o;let r=new Set,i=e.split(Rg);for(let a of i)if(a)if(this.setting.enableChinesePatch&&yf.test(a)){let l=this.chsSegmenter.cut(a,!0);for(let c of l){if(this.setting.enableStopWordsZh&&((s=this.stopWordsZh)!=null&&s.has(c))){t==="search"&&c.length>1&&A.debug(`excluded: ${c}`);continue}r.add(c)}}else{let l=a.split(Lg);for(let c of l)if(!(c.length<2||this.setting.enableStopWordsEn&&((o=this.stopWordsEn)!=null&&o.has(c)))&&(r.add(c),c.length>3)){let u=c.replace(kg,"$1 ").split(" ");for(let h of u)h.length>1&&r.add(h)}}return Array.from(r).filter(a=>a.length<30)}};gn=j([(0,vf.singleton)()],gn);var jn=class{static forType(e,t){return t&&js.testWideChar(t)?this.limitsByLanguage["\u7B80\u4F53\u4E2D\u6587"][e]:this.limitsByLanguage["English"][e]}},wt=jn;wt.default={line:{maxPreLines:0,maxPostLines:0,maxPreChars:30,maxPostChars:230,boundaryLineMinChars:4},paragraph:{maxPreLines:4,maxPostLines:7,maxPreChars:220,maxPostChars:600,boundaryLineMinChars:4},subItem:{maxPreLines:3,maxPostLines:3,maxPreChars:180,maxPostChars:200,boundaryLineMinChars:4}},wt.limitsByLanguage={["Other Language"]:jn.default,["English"]:jn.default,["\u7B80\u4F53\u4E2D\u6587"]:{line:{...jn.default.line,maxPreChars:30,maxPostChars:230},paragraph:{...jn.default.paragraph,maxPreChars:220,maxPostChars:600},subItem:{...jn.default.subItem,maxPreChars:60,maxPostChars:80}}};var mt=class{constructor(){this.option=w(di);this.outerSetting=w(de);this.filesIndex=new ks(this.option.fileIndexOption);this.linesIndex=new ks(this.option.lineIndexOption);this.tokenizer=w(gn);this._isReady=!1}async reIndexAll(e){if(this._isReady=!1,this.filesIndex.removeAll(),Array.isArray(e))A.trace("Indexing all documents..."),await this.addDocuments(e);else{A.trace("Loading indexed data...");try{this.filesIndex=ks.loadJS(e,this.option.fileIndexOption)}catch(t){return A.error(t),!1}}return this._isReady=!0,A.trace(this.filesIndex),!0}get isReady(){return this._isReady}async addDocuments(e){let t=e.filter(r=>!this.filesIndex.has(r.path));await this.filesIndex.addAllAsync(t,{chunkSize:this.option.documentChunkSize}),A.debug(`added ${t.length}`)}deleteDocuments(e){let t=e.filter(r=>this.filesIndex.has(r));this.filesIndex.discardAll(t),A.debug(`deleted ${t.length}`)}async fzfMatch(e,t){return(await new Os(t,{selector:i=>i.text}).find(e)).slice(0,this.outerSetting.ui.maxItemResults).map(i=>({text:i.item.text,row:i.item.row,positions:i.positions}))}async searchFiles(e){let t=new pi(e),r=this.filesIndex.search(t.text,this.option.getFileSearchOption(t.userOption));return A.debug(`maxFileItems: ${this.outerSetting.ui.maxItemResults}`),r.slice(0,this.outerSetting.ui.maxItemResults).map(i=>({path:i.id,queryTerms:i.queryTerms,matchedTerms:i.terms}))}async searchLinesByFileItem(e,t,r,i,s){A.debug(i.queryTerms),A.debug(i.matchedTerms);let o=50;return A.debug(`max subItems: ${o}`),new hi(e,t,r,i.queryTerms,i.matchedTerms,s).parse()}async searchLinesForSmallCharset(e,t,r){this.linesIndex.removeAll(),this.linesIndex.addAll(e);let i=this.linesIndex.search(t,this.option.getLineSearchOption());return A.debug(`matched lines count: ${i.length}`),A.debug(`only parse top ${r} matched lines per file`),i.slice(0,r).map(s=>{let o=e[s.id].text;return{text:o,row:s.id,positions:this.findAllTermPositions(o,s.terms)}})}findAllTermPositions(e,t){let r=new RegExp(t.join("|"),"gi"),i=new Set,s,o=-1;for(;(s=r.exec(e))!==null;){if(s.index===o||s[0].length===0){r.lastIndex++;continue}for(let a=0;a<s[0].length;a++)i.add(s.index+a);o=s.index}return i}};j([ze],mt.prototype,"reIndexAll",1),j([ze],mt.prototype,"searchFiles",1),j([ze],mt.prototype,"searchLinesForSmallCharset",1),mt=j([(0,yl.singleton)()],mt);var di=class{constructor(){this.outerSetting=w(de);this.inSetting=Uc.search;this.tokenizer=w(gn);this.tokenizeIndex=e=>this.tokenizer.tokenize(e,"index");this.tokenizeSearch=e=>this.tokenizer.tokenize(e,"search");this.fileIndexOption={tokenize:this.tokenizeIndex,idField:"path",fields:["basename","aliases","folder","headings","content"],storeFields:["tags"],processTerm:e=>this.outerSetting.isCaseSensitive?e:e.toLocaleLowerCase()};this.lineIndexOption={tokenize:this.tokenizeIndex,idField:"row",fields:["text"]}}getFileSearchOption(e){return{tokenize:this.tokenizeSearch,prefix:t=>e.isPrefixMatch?t.length>=this.inSetting.minTermLengthForPrefixSearch:!1,fuzzy:t=>e.isFuzzy?t.length<=3?0:this.inSetting.fuzzyProportion:!1,boost:{basename:this.inSetting.weightFilename,aliases:this.inSetting.weightFilename,folder:this.inSetting.weightFolder,tags:this.inSetting.weightTagText,headings:this.inSetting.weightHeading},combineWith:"and"}}getLineSearchOption(){return{prefix:e=>e.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:e=>e.length<=3?0:this.inSetting.fuzzyProportion,combineWith:"or"}}};di=j([(0,yl.singleton)()],di);var hi=class{constructor(e,t,r,i,s,o){this.outerSetting=w(de);let a=new pi(r);this.userOption=a.userOption,this.lines=e,this.matchedTerms=this.filterMatchedTerms(i,s),this.maxParsedLines=o;let l=wt.forType(t,a.text);this.preChars=l.maxPreChars,this.postChars=l.maxPostChars,A.debug(`doc matchedTerms: ${this.matchedTerms.join(" ")}`)}parse(){return this.highlightLines(this.getTopRelevantLines(this.lines,this.maxParsedLines))}filterMatchedTerms(e,t){let r=e.filter(s=>!e.some(o=>o.length>s.length&&o.includes(s))&&t.includes(s)),i;if(r.length===0)i=t.filter(s=>!t.some(o=>o.length>s.length&&o.includes(s)));else{i=r;for(let s of t)!r.includes(s)&&!this.isSubstringOrSuperString(s,t)&&i.push(s)}return i}isSubstringOrSuperString(e,t){return t.some(r=>r.length>e.length&&r.includes(e)||e.length>r.length&&e.includes(r))}getTopRelevantLines(e,t){let r=new RegExp(this.matchedTerms.join("|"),"i"),i=this.matchedTerms.map(l=>this.generateRegExpForTerm(l)),s=new zs((l,c)=>l-c,t);s.push(0);let o=new Map,a=new Map;for(let l of e){if(!r.test(l.text))continue;a.clear();let c=0;for(let u of i){u.lastIndex=0;let h;for(;(h=u.exec(l.text))!==null;){let f=h[0],d=(a.get(f)||0)+1;a.set(f,d),c+=d===1?f.length:.01}}c>s.peek()&&(s.push(c),o.set(l,c))}return Array.from(o.entries()).sort((l,c)=>c[1]-l[1]).slice(0,t).map(l=>l[0])}highlightLines(e){let t=new Map;for(let r of this.matchedTerms)t.set(r,this.generateRegExpForTerm(r));return e.map(r=>{let i=new Set,s=-1,o=-1;for(let a=this.matchedTerms.length-1;a>=0;a--){let l=this.matchedTerms[a],c=r.text.search(t.get(l));if(c!==-1){s=Math.max(0,c-this.preChars),o=Math.min(r.text.length,c+l.length+this.postChars);break}}if(s!==-1&&o!==-1){let a=r.text.slice(s,o);for(let l of this.matchedTerms){let c=t.get(l),u;for(;(u=c.exec(a))!==null;){let h=u.index+s,f=h+u[0].length;for(let d=h;d<f;d++)i.add(d)}}}return{text:r.text,row:r.row,positions:i}})}generateRegExpForTerm(e){let t=this.outerSetting.isCaseSensitive?"g":"gi",r=this.userOption.isPrefixMatch?e:`${e}(?![a-zA-Z])`;return new RegExp(r,t)}};j([ze],hi.prototype,"getTopRelevantLines",1),j([ze],hi.prototype,"highlightLines",1);var Us=class{constructor(){this.outerSetting=w(de);this.isPrefixMatch=this.outerSetting.isPrefixMatch,this.isFuzzy=this.outerSetting.isFuzzy}},pi=class{constructor(e){this.userOption=new Us;this.parse(e)}parse(e){let t=e.split(" "),r=[];if(t[0].startsWith("/")){let i=t.shift();r.push(...i.split("/"))}if(t.length>0&&t[t.length-1].startsWith("/")){let i=t.pop();r.push(...i.split("/"))}this.text=t.join(" ");for(let i of r)if(i!=="")if(i==="ap")this.userOption.isPrefixMatch=!0;else if(i==="np")this.userOption.isPrefixMatch=!1;else if(i==="af")this.userOption.isFuzzy=!0;else if(i==="nf")this.userOption.isFuzzy=!1;else{this.userOption=new Us,A.info("invalid command: /"+i);break}}};pi.registeredCommands=new Set(["ap","np","af","nf"]);var vl=class{constructor(){this.listeners=new Map}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(t)}off(e,t){let r=this.listeners.get(e);if(r){let i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){var r;(r=this.listeners.get(e))==null||r.forEach(i=>{i(...t)})}},yn=new vl;var Ef=pe(ye());var xt=require("obsidian");var _l=pe(ye());var Ke=class{constructor(){this.vault=w(xt.Vault);this.app=w(xt.App);this.setting=w(de);this.privateApi=w(We);this.viewRegistry=w(Ve);this.htmlParser=w(mi);this.init()}init(){this.excludedPaths=new Set(this.setting.excludedPaths),this.supportedExtensions=new Set(this.setting.customExtensions.plaintext)}async generateAllIndexedDocuments(e){return Promise.all(e.map(async t=>{if(this.isContentIndexable(t)){let r=this.app.metadataCache.getFileCache(t);if(this.viewRegistry.viewTypeByPath(t.path)==="markdown")return{path:t.path,basename:t.basename,folder:ve.getFolderPath(t.path),aliases:this.parseAliases(r),tags:this.parseTags(r),headings:this.parseHeadings(r),content:await this.readPlainText(t)};throw new Error(Qn)}else return{path:t.path,basename:t.basename,folder:ve.getFolderPath(t.path)}}))}allFilesToBeIndexed(){let e=this.vault.getFiles();A.debug(`all files: ${e.length}`),ve.countFileByExtensions(e);let t=e.filter(r=>this.isIndexable(r));return A.debug(`indexable files: ${t.length}`),ve.countFileByExtensions(t),t}isIndexable(e){if(e instanceof xt.TFolder)return!1;let t;return typeof e=="string"?t=e:t=e.path,this.supportedExtensions.has(ve.getExtension(t))&&t.lastIndexOf("excalidraw.md")===-1&&(this.setting.followObsidianExcludedFiles?this.privateApi.isNotObsidianExcludedPath(t):!0)&&(this.excludedPaths.size===0?!0:this.isNotCustomExcludedPath(t))}async readPlainText(e){let t=typeof e=="string"?this.vault.getAbstractFileByPath(e):e;if(t instanceof xt.TFile)if(this.viewRegistry.viewTypeByPath(t.path)==="markdown"){let r=await this.vault.cachedRead(t);return t.extension==="html"?this.htmlParser.toMarkdown(r):r}else throw Error(`unsupported file extension as plain text to read, path: ${t.path}`);else return""}async readPlainTextLines(e){return(await this.readPlainText(e)).split(ve.SPLIT_EOL)}parseAliases(e){return((0,xt.parseFrontMatterAliases)(e==null?void 0:e.frontmatter)||[]).join(" ")}parseTags(e){var t;return((t=e==null?void 0:e.tags)==null?void 0:t.map(r=>r.tag.slice(1)).join(" "))||""}parseHeadings(e){var t;return((t=e==null?void 0:e.headings)==null?void 0:t.map(r=>r.heading).join(" "))||""}isContentIndexable(e){return Ke.contentIndexableViewTypes.has(this.viewRegistry.viewTypeByPath(e.path))}isNotCustomExcludedPath(e){let t=e.split("/"),r="";for(let i of t)if(r+=(r?"/":"")+i,this.excludedPaths.has(r))return!1;return!0}};Ke.contentIndexableViewTypes=new Set(["markdown"]),Ke=j([(0,_l.singleton)()],Ke);var mi=class{constructor(){this.MARKDOWN_LINK_REGEX=/\[([^[\]]+)\]\([^()]*\)/g;this.MARKDOWN_ASTERISK_REGEX=/\*\*(.*?)\*\*/g;this.MARKDOWN_BACKTICK_REGEX=/`(.*?)`/g}toMarkdown(e){let t=(0,xt.htmlToMarkdown)(e);return t=t.replace(this.MARKDOWN_LINK_REGEX,"$1"),t=t.replace(this.MARKDOWN_ASTERISK_REGEX,"$1"),t=t.replace(this.MARKDOWN_BACKTICK_REGEX,"$1"),t}};mi=j([(0,_l.singleton)()],mi);var _f=require("obsidian");var bf=pe(ye());var Un=class{constructor(){this.dataManager=w(at);this.app=w(_f.App);this.onCreate=e=>{A.debug(`created: ${e.path}`),this.dataManager.receiveDocOperation(new Wn(e))};this.onDelete=e=>{A.debug(`deleted: ${e.path}`),this.dataManager.receiveDocOperation(new Vn(e.path))};this.onRename=(e,t)=>{A.debug(`renamed: ${t} => ${e.path}`),this.dataManager.receiveDocOperation(new Vn(t)),this.dataManager.receiveDocOperation(new Wn(e))};this.onModify=e=>{A.debug(`modified: ${e.path}`),this.dataManager.receiveDocOperation(new Vn(e.path)),this.dataManager.receiveDocOperation(new Wn(e))}}start(){this.stop(),this.app.vault.on("create",this.onCreate),this.app.vault.on("delete",this.onDelete),this.app.vault.on("rename",this.onRename),this.app.vault.on("modify",this.onModify),A.trace("FileWatcher started")}stop(){this.app.vault.off("create",this.onCreate),this.app.vault.off("delete",this.onDelete),this.app.vault.off("rename",this.onRename),this.app.vault.off("modify",this.onModify)}};Un=j([(0,bf.singleton)()],Un);var at=class{constructor(){this.plugin=w(Ye);this.database=w(pn);this.dataProvider=w(Ke);this.lexicalEngine=w(mt);this.semanticEngine=w(ot);this.semanticConfig=w(de).semantic;this.shouldForceRefresh=!1;this.isLexicalEngineUpToDate=!1;this.isSemanticEngineUpToDate=!1;this.docOperationsHandler=async e=>{e.sort((t,r)=>t.time-r.time);for(let t of e)if(t instanceof Wn)await this.addDocuments([t.file]);else if(t instanceof Vn)await this.deleteDocuments([t.path]);else throw Error(ns)};this.docOperationsBuffer=new Bs(this.docOperationsHandler,e=>e.path+e.type,3)}async initAsync(){await this.database.deleteOldDatabases(),await this.initLexicalEngine(),await this.initSemanticEngine(),this.shouldForceRefresh||(this.plugin.registerInterval(window.setInterval(()=>{this.isSemanticEngineUpToDate||this.initSemanticEngine()},3500)),yn.on(11,()=>this.docOperationsBuffer.forceFlush()),w(Un).start())}onunload(){w(Un).stop()}receiveDocOperation(e){this.docOperationsBuffer.add(e)}async refreshAllAsync(){let e=new Ae(B("Reindexing..."));this.shouldForceRefresh=!0,await this.initAsync(),e.hide(),new Ae(B("Indexing finished"),5e3),this.shouldForceRefresh=!1}async addDocuments(e,t=!1){if(e.length>0){let r=[];for(let s of e)s instanceof xf.TFile&&r.push(s);let i=await this.dataProvider.generateAllIndexedDocuments(r.filter(s=>this.dataProvider.isIndexable(s)));t?this.semanticConfig.isEnabled&&await this.semanticEngine.addDocuments(i):await this.lexicalEngine.addDocuments(i)}}async deleteDocuments(e,t=!1){if(e.length>0){let r=e.filter(i=>this.dataProvider.isIndexable(i));t?this.semanticConfig.isEnabled&&await this.semanticEngine.deleteDocuments(r):this.lexicalEngine.deleteDocuments(r)}}async initLexicalEngine(){A.trace("Init lexical engine...");let e;!Lr.loadIndexFromDatabase||this.shouldForceRefresh?e=null:e=await this.database.getMiniSearchData(),e?(this.database.deleteMinisearchData(),A.trace("Previous minisearch data is found."),await this.lexicalEngine.reIndexAll(e)||(new Ae(B("Database has been updated, a reindex is required"),7e3),await this.reindexLexicalEngineWithCurrFiles())):await this.reindexLexicalEngineWithCurrFiles(),this.isLexicalEngineUpToDate||await this.updateDocRefByMtime(!1),A.trace("Lexical engine is ready"),await this.database.setMiniSearchData(this.lexicalEngine.filesIndex.toJSON())}async reindexLexicalEngineWithCurrFiles(){A.trace("Indexing the whole vault...");let e=this.dataProvider.allFilesToBeIndexed(),t=0;for(let i of e)t+=i.stat.size;if(t/=1024,t>2e3){let i=(t/1024).toFixed(2)+" MB";new Ae(`${i} ${B("files need to be indexed. Obsidian may freeze for a while")}`,7e3)}let r=await this.dataProvider.generateAllIndexedDocuments(e);await this.lexicalEngine.reIndexAll(r),this.isLexicalEngineUpToDate=!0}async updateDocRefByMtime(e){let t=new Map(this.dataProvider.allFilesToBeIndexed().map(a=>[a.path,a])),r=e?await this.database.getSemanticDocRefs():await this.database.getLexicalDocRefs(),i=new Map(r==null?void 0:r.map(a=>[a.path,a])),s=[],o=[];for(let[a,l]of t){let c=i.get(a);c?l.stat.mtime>c.updateTime&&(o.push(l.path),s.push(l)):s.push(l)}for(let a of i.keys())t.has(a)||o.push(a);A.trace(`docs to delete: ${o.length}`),A.trace(`docs to add: ${s.length}`),await this.deleteDocuments(o,e),await this.addDocuments(s,e),await this.saveDocRefs(Array.from(t.values()),e)}async saveDocRefs(e,t){let r=e.map(i=>({path:i.path,updateTime:i.stat.mtime}));t?(await this.database.setSemanticDocRefs(r),A.trace(`${r.length} semantic refs updated`)):(await this.database.setLexicalDocRefs(r),A.trace(`${r.length} lexical refs updated`))}async initSemanticEngine(){if(this.semanticConfig.isEnabled){let e=await this.semanticEngine.doesCollectionExist();if(e===null)return;if(e===!1||this.shouldForceRefresh){let t=null;this.semanticConfig.serverType==="local"&&(t=new Ae(B("Semantic init time"),0));let r=this.dataProvider.allFilesToBeIndexed();await this.saveDocRefs(r,!0);let i=await this.dataProvider.generateAllIndexedDocuments(r);await this.semanticEngine.reindexAll(i),t&&t.hide(),new Ae(B("Semantic init finished"),0),this.isSemanticEngineUpToDate=!0}this.isSemanticEngineUpToDate||(this.isSemanticEngineUpToDate=!0,await this.updateDocRefByMtime(!0)),A.trace("Semantic engine is ready")}}};j([ze],at.prototype,"initAsync",1),at=j([(0,Ef.singleton)()],at);var Ws=class{constructor(e,t){this.time=performance.now();this.type=e,typeof t=="string"?this.path=t:this.path=t.path}},Wn=class extends Ws{constructor(t){super("add",t);this.file=t}},Vn=class extends Ws{constructor(e){super("delete",e)}};var lt=class{constructor(){this.plugin=w(Ye);this.shouldReload=!1}async initAsync(){await this.loadSettings(),Kn.container.register(de,{useValue:this.setting}),this.plugin.addSettingTab(w(gi))}async saveSettings(){await this.plugin.saveData(this.setting)}async postSettingUpdated(){this.saveSettings(),this.shouldReload&&(this.shouldReload=!1,await this.downloadAndRefresh())}async loadSettings(){this.setting=zt.mergeDeep(jc,await this.plugin.loadData()),A.setLevel(this.setting.logLevel)}async downloadAndRefresh(){w(Ve).refreshAll(),await w(st).initAsync(),await w(Pt).initAsync(),w(Ke).init(),await w(at).refreshAllAsync()}};lt=j([(0,Kn.singleton)()],lt);var gi=class extends ne.PluginSettingTab{constructor(t){super(t.app,t);this.settingManager=w(lt);this.setting=w(de)}hide(){this.settingManager.postSettingUpdated()}display(){let{containerEl:t}=this;t.empty(),new ne.Setting(t).setName(B("Max items count")).setDesc(B("Max items count desc")).addSlider(a=>a.setLimits(1,300,1).setValue(this.setting.ui.maxItemResults).setDynamicTooltip().onChange(l=>{this.setting.ui.maxItemResults=l})),new ne.Setting(t).setName(B("Floating window for in-file search")).setDesc(B("Floating window for in-file search desc")).addToggle(a=>a.setValue(this.setting.ui.floatingWindowForInFile).onChange(l=>this.setting.ui.floatingWindowForInFile=l)),new ne.Setting(t).setName(B("Case sensitive")).addToggle(a=>a.setValue(this.setting.isCaseSensitive).onChange(l=>{this.setting.isCaseSensitive=l,this.settingManager.shouldReload=!0})),new ne.Setting(t).setName(B("Prefix match")).addToggle(a=>a.setValue(this.setting.isPrefixMatch).onChange(l=>this.setting.isPrefixMatch=l)),new ne.Setting(t).setName(B("Character fuzzy allowed")).addToggle(a=>a.setValue(this.setting.isFuzzy).onChange(l=>this.setting.isFuzzy=l)),new ne.Setting(t).setName(B("English word blacklist")).setDesc(B("English word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsEn).onChange(l=>{this.setting.enableStopWordsEn=l,this.settingManager.shouldReload=!0})),new ne.Setting(t).setName(B("Chinese patch")).setDesc(B("Chinese patch desc")).addToggle(a=>a.setValue(this.setting.enableChinesePatch).onChange(async l=>{this.setting.enableChinesePatch=l,A.info(`enable chinese: ${w(de).enableChinesePatch}`),this.settingManager.shouldReload=!0})),new ne.Setting(t).setName(B("Chinese word blacklist")).setDesc(B("Chinese word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsZh).onChange(async l=>{this.setting.enableStopWordsZh=l,this.settingManager.shouldReload=!0})),new ne.Setting(t).setName(B("Advanced")).setDesc(B("Advanced.desc")),new ne.Setting(t).setName(B("Semantic search")).addButton(a=>a.setButtonText(B("Manage")).onClick(()=>new xl(w(ne.App)).open())),new ne.Setting(t).setName(B("Excluded files")).addButton(a=>a.setButtonText(B("Manage")).onClick(()=>{new bl(w(ne.App)).open()})),new ne.Setting(t).setName(B("Customize extensions")).addButton(a=>a.setButtonText(B("Manage")).onClick(()=>new wl(w(ne.App)).open())),new ne.Setting(t).setName(B("Reindex the vault")).addButton(a=>{a.setButtonText(B("Reindex")).onClick(async()=>{await w(at).refreshAllAsync()})});let r=t.createDiv("cs-dev-setting-group");r.style.marginTop="1.5em";let i=r.createDiv({cls:"cs-setting-group-dev-title",text:B("For Development")}),s=r.createDiv({cls:"cs-setting-group-dev-content"}),o=this.setting.ui.collapseDevSettingByDefault;s.style.display=o?"none":"block",i.style.setProperty("--cs-dev-collapse-icon",o?jo:Uo),i.onclick=()=>{let a=s.style.display==="none";s.style.display=a?"block":"none",i.style.setProperty("--cs-dev-collapse-icon",a?Uo:jo)},new ne.Setting(s).setName(B("Collapse development setting by default")).addToggle(a=>a.setValue(this.setting.ui.collapseDevSettingByDefault).onChange(l=>{this.setting.ui.collapseDevSettingByDefault=l})),new ne.Setting(s).setName(B("Log level")).addDropdown(a=>a.addOptions({trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",none:"none"}).setValue(this.setting.logLevel.toLowerCase()).onChange(async l=>{let c=l;A.setLevel(c),this.setting.logLevel=c})),new ne.Setting(s).setName(B("Reset floating window position")).setDesc(B("Reset floating window position desc")).addButton(a=>a.setButtonText(B("Reset position")).onClick(l=>{w(ct).resetAllPositions()})),new ne.Setting(s).setName(B("Support the Project")).setDesc(B("Support the Project desc")).addButton(a=>{a.setButtonText(B("Visit GitHub")).onClick(()=>{window.open("https://github.com/yan42685/obsidian-clever-search","_blank")})}),new ne.Setting(s).setName("API provider1").setDesc("domain and key").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider1.domain).onChange(l=>{this.setting.apiProvider1.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider1.key).onChange(l=>{this.setting.apiProvider1.key=l})),new ne.Setting(s).setName("API provider2").setDesc("description").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider2.domain).onChange(l=>{this.setting.apiProvider2.domain=l})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider2.key).onChange(l=>{this.setting.apiProvider2.key=l}))}};gi=j([(0,Kn.singleton)(),Mi(0,(0,Kn.inject)(Ye))],gi);var bl=class extends ne.Modal{constructor(t){super(t);this.settingManager=w(lt);this.setting=w(de);this.excludedPaths=this.setting.excludedPaths;this.allPaths=new Set;this.allFolders=new Set;let r=w(ne.Vault).getAllLoadedFiles();for(let i of r)this.allPaths.add(i.path),i instanceof ne.TFolder&&this.allFolders.add(i.path)}onOpen(){var r;this.modalEl.style.width="48vw",this.modalEl.style.marginBottom="5em",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new ne.Setting(t).setName(B("Follow Obsidian Excluded Files")).addToggle(i=>i.setValue(this.setting.followObsidianExcludedFiles).onChange(s=>{this.setting.followObsidianExcludedFiles=s,this.settingManager.shouldReload=!0})),t.createEl("h2",{text:B("Excluded files")}),this.excludesEl=t.createDiv(),this.renderExcludedList(this.excludesEl),new ne.Setting(t).addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder(B("Enter path...")).onChange(s=>{this.suggester.close(),this.suggester.open()})}).addButton(i=>{i.setButtonText(B("Add")).onClick(()=>{this.addPath(this.inputEl.value)})}),this.suggester=new rs(this.inputEl,this.allFolders,i=>{this.addPath(i)}),setTimeout(()=>{this.inputEl.focus()},1)}renderExcludedList(t){t.empty(),this.excludedPaths.forEach((r,i)=>{let s=t.createDiv();s.style.overflow="auto",s.style.display="flex",s.style.margin="0.7em 0 0.7em 0",s.style.justifyContent="space-between";let o=s.createSpan();o.setText(r),o.style.width="90%",o.style.overflow="auto";let a=s.createSpan();a.setText("\u2715"),a.style.cursor="pointer",a.onClickEvent(()=>{this.excludedPaths.splice(i,1),this.settingManager.shouldReload=!0,this.renderExcludedList(t)})})}addPath(t){t&&!this.excludedPaths.includes(t)&&(this.allPaths.has(t)?(this.excludedPaths.push(t),this.settingManager.shouldReload=!0,this.renderExcludedList(this.excludesEl)):new Ae(`Path doesn't exist: ${t}`,5e3))}},wl=class extends ne.Modal{constructor(){super(...arguments);this.setting=w(de);this.settingManager=w(lt)}onOpen(){var r;this.modalEl.style.width="60vw",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new ne.Setting(t).setDesc(B("extensionModal.desc")),new ne.Setting(t).setName(B("extensionModal.plaintextName")).setDesc(B("extensionModal.plaintextDesc")).addTextArea(i=>{i.inputEl.style.minWidth="20vw",i.inputEl.style.minHeight="20vh",i.setValue(this.setting.customExtensions.plaintext.join(" ")),i.onChange(s=>{let o=s.split(/[\s\n]+/).map(a=>a.startsWith(".")?a.substring(1):a).filter(a=>a.length>0);this.setting.customExtensions.plaintext=o,this.settingManager.shouldReload=!0})}),new ne.Setting(t).setName("Image").setDesc("Todo")}},xl=class extends ne.Modal{constructor(){super(...arguments);this.semanticEngine=w(ot);this.setting=w(de).semantic;this.settingManager=w(lt);this.needInitSemanticEngine=!1}onOpen(){var r;this.modalEl.style.width="50vw",this.modalEl.style.height="55vh",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new ne.Setting(t).setName(B("Introduction")).setDesc(B("Introduction.desc")),new ne.Setting(t).setName(B("Enable")).addToggle(i=>i.setValue(this.setting.isEnabled).onChange(s=>{this.setting.isEnabled=s,s===!0&&(this.needInitSemanticEngine=!0)})),new ne.Setting(t).setName(B("Server type")).setDesc(B("Server type.desc")).addDropdown(i=>i.addOptions({local:B("local")}).setValue(this.setting.serverType).onChange(s=>this.setting.serverType=s)),new ne.Setting(t).setName(B("Utilities")).addButton(i=>i.setButtonText(B("Test connection")).onClick(()=>this.semanticEngine.testConnection())).addButton(i=>i.setButtonText(B("Download")).onClick(()=>w(st).downloadAiHelper())),new ne.Setting(t).setName(B("Additional Information")).setDesc(B("Additional Information.desc"))}onClose(){this.needInitSemanticEngine&&(this.needInitSemanticEngine=!1,w(at).initSemanticEngine())}};var Ul=pe(ye());function vn(){}function Al(n){return n()}function Tf(){return Object.create(null)}function Wt(n){n.forEach(Al)}function Vs(n){return typeof n=="function"}function Af(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function Cf(n){return Object.keys(n).length===0}var Ff=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,vi=class{constructor(e){this.options=e,this._listeners="WeakMap"in Ff?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(t=>{var r;for(let i of t)vi.entries.set(i.target,i),(r=this._listeners.get(i.target))===null||r===void 0||r(i)})}};vi.entries="WeakMap"in Ff?new WeakMap:void 0;var If=!1;function Ng(){If=!0}function Bg(){If=!1}function Le(n,e){n.appendChild(e)}function Pf(n,e,t){let r=zg(n);if(!r.getElementById(e)){let i=Fe("style");i.id=e,i.textContent=t,jg(r,i)}}function zg(n){if(!n)return document;let e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function jg(n,e){return Le(n.head||n,e),e.sheet}function gt(n,e,t){n.insertBefore(e,t||null)}function ut(n){n.parentNode&&n.parentNode.removeChild(n)}function Cl(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function Fe(n){return document.createElement(n)}function Ug(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function wi(n){return document.createTextNode(n)}function yr(){return wi(" ")}function Fl(){return wi("")}function Ot(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function Ie(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Wg(n){return Array.from(n.childNodes)}function Il(n,e){e=""+e,n.data!==e&&(n.data=e)}function Pl(n,e){n.value=e==null?"":e}function xi(n,e,t){n.classList[t?"add":"remove"](e)}var Ks=class{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Ug(t.nodeName):this.e=Fe(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)gt(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(ut)}};var _i;function yi(n){_i=n}function Vg(){if(!_i)throw new Error("Function called outside component initialization");return _i}function $s(n){Vg().$$.on_destroy.push(n)}var mr=[];var bi=[],gr=[],Sf=[],Mf=Promise.resolve(),Tl=!1;function Df(){Tl||(Tl=!0,Mf.then(Of))}function Ei(){return Df(),Mf}function Sl(n){gr.push(n)}var El=new Set,pr=0;function Of(){if(pr!==0)return;let n=_i;do{try{for(;pr<mr.length;){let e=mr[pr];pr++,yi(e),Kg(e.$$)}}catch(e){throw mr.length=0,pr=0,e}for(yi(null),mr.length=0,pr=0;bi.length;)bi.pop()();for(let e=0;e<gr.length;e+=1){let t=gr[e];El.has(t)||(El.add(t),t())}gr.length=0}while(mr.length);for(;Sf.length;)Sf.pop()();Tl=!1,El.clear(),yi(n)}function Kg(n){if(n.fragment!==null){n.update(),Wt(n.before_update);let e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Sl)}}function Hg(n){let e=[],t=[];gr.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),gr=e}var $g=new Set;function qg(n,e){n&&n.i&&($g.delete(n),n.i(e))}var Gg=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],dw=new Set([...Gg]);function Xg(n,e,t,r){let{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),r||Sl(()=>{let o=n.$$.on_mount.map(Al).filter(Vs);n.$$.on_destroy?n.$$.on_destroy.push(...o):Wt(o),n.$$.on_mount=[]}),s.forEach(Sl)}function Rf(n,e){let t=n.$$;t.fragment!==null&&(Hg(t.after_update),Wt(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Yg(n,e){n.$$.dirty[0]===-1&&(mr.push(n),Df(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Lf(n,e,t,r,i,s,o,a=[-1]){let l=_i;yi(n);let c=n.$$={fragment:null,ctx:[],props:s,update:vn,not_equal:i,bound:Tf(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Tf(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=t?t(n,e.props||{},(h,f,...d)=>{let m=d.length?d[0]:f;return c.ctx&&i(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&Yg(n,h)),f}):[],c.update(),u=!0,Wt(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){Ng();let h=Wg(e.target);c.fragment&&c.fragment.l(h),h.forEach(ut)}else c.fragment&&c.fragment.c();e.intro&&qg(n.$$.fragment),Xg(n,e.target,e.anchor,e.customElement),Bg(),Of()}yi(l)}var Jg;typeof HTMLElement=="function"&&(Jg=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:n}=this.$$;this.$$.on_disconnect=n.map(Al).filter(Vs);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(n,e,t){this[n]=t}disconnectedCallback(){Wt(this.$$.on_disconnect)}$destroy(){Rf(this,1),this.$destroy=vn}$on(n,e){if(!Vs(e))return vn;let t=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return t.push(e),()=>{let r=t.indexOf(e);r!==-1&&t.splice(r,1)}}$set(n){this.$$set&&!Cf(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}});var Hs=class{$destroy(){Rf(this,1),this.$destroy=vn}$on(e,t){if(!Vs(t))return vn;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Cf(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};function _n(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}var Nf=require("obsidian");var Bf=pe(ye());var kf=pe(ye());var vr=class{constructor(){this.lexicalEngine=w(mt)}parseAll(e,t,r,i){return t.map(s=>{let o=fi.minInSet(s.positions),a=s.row,l=this.getTruncatedContext(e,a,o,r),c=l.matchedLineText,u=s.positions;s.row===l.lines[0].row&&(u=this.adjustPositionsByStartCol(u,l.firstLineStartCol));let h=this.highlightMatchedLine(c,u,i),f=l.lines.map(d=>d.row===a?h:d.text).join(ve.JOIN_EOL);return{row:s.row,col:o,text:f}})}parse(e,t,r,i){return this.parseAll(e,[t],r,i)[0]}async parseLineItems(e,t){let r=t.replace(/\s/g,""),i=[],s=await this.lexicalEngine.fzfMatch(r,e);for(let o of s){let a=o.row,l=fi.minInSet(o.positions),c=e[a].text,u=Math.max(l-30,0),h=Math.min(u+200,c.length),f=c.substring(u,h),d=this.adjustPositionsByStartCol(o.positions,u),m=this.highlightLineByCharPositions(f,d),p=await this.getLineHighlightedContext(e,a,l,t);i.push(new dn({text:m,row:a,col:l},p))}return i}highlightMatchedLine(e,t,r){return r?`<span class="matched-line highlight-bg">${this.highlightLineByCharPositions(e,t)}</span>`:`<span class="matched-line">${this.highlightLineByCharPositions(e,t)}</span>`}highlightContextLine(e,t){let r=new RegExp(t,"gi");return e.replace(r,i=>`<mark>${i}</mark>`)}highlightLineByCharPositions(e,t){let r="",i=0;for(;i<e.length;)if(t.has(i)){let s=i;for(;i<e.length&&t.has(i);)i++;r+=`<mark>${e.slice(s,i)}</mark>`}else r+=e[i],i++;return r}adjustPositionsByStartCol(e,t){let r=new Set;return e.forEach(i=>{i>=t&&r.add(i-t)}),r}getTruncatedContext(e,t,r,i){if(e.length===0)return{lines:[],firstLineStartCol:0,matchedLineText:""};let s=i,o,a=0,l=0,c=e[t].text;if(r<s.maxPreChars){let u=this.extendContextAbove(e,t-1,s.maxPreChars-r,s.maxPreLines,s.boundaryLineMinChars);o=u.lines,a=u.firstLineStartCol;let h=Math.min(c.length-1,r+s.maxPostChars);h<c.length-1?(c=c.substring(0,h+1),o.push({text:c,row:t})):o.push(e[t]),l+=h-r}else{let u=r-s.maxPreChars;a=u;let h=Math.min(c.length-1,r+s.maxPostChars);h<c.length-1?c=c.substring(u,h+1):c=c.substring(u),o=[{text:c,row:t}],l+=h-r}return zt.append(o,this.extendContextBelow(e,t+1,s.maxPostChars-l,s.maxPostLines,s.boundaryLineMinChars)),{lines:o,firstLineStartCol:a,matchedLineText:c}}extendContextAbove(e,t,r,i,s){let o=0,a=t,l=0,c=[];for(;a>=0&&t-a<i;){let u=e[a].text;if(l+u.length<r)c.unshift(e[a]),l+=u.length,--a;else if(l+u.length==r){c.unshift(e[a]);break}else{let h=l+u.length-r;o=h;let f=e[a].text.substring(h);c.unshift({text:f,row:a});break}}return c.length>0&&c[0].text.length<s&&(o=0,c.shift()),{lines:c,firstLineStartCol:o}}extendContextBelow(e,t,r,i,s){let o=t,a=0,l=[];for(;o<=e.length-1&&o-t<i;){let c=e[o].text;if(a+c.length<r)l.push(e[o]),a+=c.length,++o;else if(a+c.length==r){l.push(e[o]);break}else{let u=c.length-(a+c.length-r)-1,h=e[o].text.substring(0,u+1);l.push({text:h,row:o});break}}return l.length>0&&l[0].text.length<s&&l.pop(),l}async getLineHighlightedContext(e,t,r,i){let s=zt.getCurrLanguage(),o=this.getTruncatedContext(e,t,r,wt.forType("paragraph")),a=o.lines;return(await Promise.all(a.map(async(c,u)=>{if(c.row===t){let h=await this.lexicalEngine.fzfMatch(i,[c]);try{let d=h[0].positions;return u===0&&(d=this.adjustPositionsByStartCol(d,o.firstLineStartCol)),this.highlightMatchedLine(c.text,d,!0)}catch(f){A.warn("There might be inconsistency with previous search step, which lead to a missed match to target line"),A.error(f)}}else return this.highlightContextLine(c.text,i)}))).join(ve.JOIN_EOL)}};vr=j([(0,kf.singleton)()],vr);var Rt=class{constructor(){this.app=w(Nf.App);this.dataProvider=w(Ke);this.lexicalEngine=w(mt);this.semanticEngine=w(ot);this.lineHighlighter=w(vr);this.viewRegistry=w(Ve)}async searchInVault(e){var o;let t=new nn("no result",[]);if(e.length===0)return t;let r=((o=this.app.workspace.getActiveFile())==null?void 0:o.path)||"no source path",i=await this.lexicalEngine.searchFiles(e),s=[];return i.length!==0?{sourcePath:r,items:i.map(a=>new hn(0,a.path,a.queryTerms,a.matchedTerms,[],"nothing"))}:(A.trace("lexical matched files count is 0"),t)}async searchInVaultSemantic(e){var r;let t=new nn("no result",[]);if(e.length===0)return t;{let s={sourcePath:((r=this.app.workspace.getActiveFile())==null?void 0:r.path)||"no source path",items:await this.semanticEngine.search(e.trim(),"markdown")};return A.debug(s),s}}async getFileSubItems(e,t){let r=t.path;if(this.viewRegistry.viewTypeByPath(r)!=="markdown")return A.warn(`view type for path "${r}" is not supported for sub-items.`),[];let s=(await this.dataProvider.readPlainText(r)).split(ve.SPLIT_EOL).map((l,c)=>new ur(l,c));A.debug("target file lines count: ",s.length);let o=await this.lexicalEngine.searchLinesByFileItem(s,"subItem",e,t,30);return this.lineHighlighter.parseAll(s,o,wt.forType("subItem",e),!1).map(l=>({text:l.text,row:l.row,col:l.col}))}async searchInFile(e){let t=new nn("",[]),r=this.app.workspace.getActiveFile();if(!e||!r)return t;if(this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return A.trace("Current file isn't PLAINT_TEXT"),t;let i=(await this.dataProvider.readPlainTextLines(r.path)).map((l,c)=>new ur(l,c)),s=e.replace(/\s/g,""),a=(await this.lexicalEngine.fzfMatch(s,i)).map(l=>{let c=this.lineHighlighter.parse(i,l,wt.forType("line"),!1),u=this.lineHighlighter.parse(i,l,wt.forType("paragraph"),!0);return new dn(c,u.text)});return{sourcePath:r.path,items:a}}async deprecatedSearchInFile(e){let t=new nn("",[]),r=this.app.workspace.getActiveFile();if(!e||!r||this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return t;let i=r.path,s=(await this.dataProvider.readPlainTextLines(i)).map((a,l)=>new ur(a,l)),o=await this.lineHighlighter.parseLineItems(s,e);return{sourcePath:i,items:o}}};j([ze],Rt.prototype,"searchInVault",1),j([ze],Rt.prototype,"getFileSubItems",1),j([ze],Rt.prototype,"searchInFile",1),j([ze],Rt.prototype,"deprecatedSearchInFile",1),Rt=j([(0,Bf.singleton)()],Rt);var bn=require("obsidian");var ed=pe(ye()),td=pe(Zf());var _r=class{constructor(){this.app=w(bn.App);this.privateApi=w(We);this.setting=w(de)}purifyHTML(e){return td.default.sanitize(e,{USE_PROFILES:{html:!0}})}updateSubItemIndex(e,t,r){let i=e[t],s=e.length-1;return this.scrollTo("center",i,"auto"),r==="next"?t<s?t+1:t:t>0?t-1:t}async handleConfirmAsync(e,t,r,i,s,o){if(e(),i)if(r===1){let a=i;await this.jumpInVaultAsync(t,a.line.row,a.line.col,o)}else if(r===2){let a=i,l=a.viewType;if(s!==-1){let c=a.subItems[s];if(l==="markdown")await this.jumpInVaultAsync(a.path,c.row,c.col,o);else throw Error("unsupported viewType to jump")}else await this.jumpInVaultAsync(a.path,0,0,o)}else throw Error(`unsupported search type to jump ${r}`)}scrollTo(e,t,r){setTimeout(()=>{t&&t.element&&t.element.scrollIntoView({behavior:r,block:e})},0)}focusInput(){setTimeout(()=>{let e=document.getElementById("cs-search-input");e==null||e.focus()},0)}showNoResult(e){if(e){if(!this.setting.semantic.isEnabled)return"Semantic search need to be enabled at the setting tab";let t=w(ot).status;return t==="ready"?"No matched content":`Semantic engine is ${t}`}else return"No matched content"}insertFileLinkToActiveMarkdown(e){if(e){let t=this.app.workspace.getActiveViewOfType(bn.MarkdownView);if(!(t!=null&&t.file)){A.info("No markdown view to insert file link");return}let r=w(bn.Vault).getAbstractFileByPath(e),i=this.app.fileManager.generateMarkdownLink(r,t.file.path);t.editor.replaceSelection(i+`
`)}}async jumpInVaultAsync(e,t,r,i){let s=!1;this.app.workspace.iterateAllLeaves(o=>{var a;o.view instanceof bn.MarkdownView&&((a=o.getViewState().state)==null?void 0:a.file)===e&&(this.app.workspace.setActiveLeaf(o,{focus:!0}),s=!0)}),s?this.scrollIntoViewForExistingView(t,r,i):(await this.app.workspace.openLinkText(e,"",this.setting.ui.openInNewPane),this.scrollIntoViewForExistingView(t,r,i))}scrollIntoViewForExistingView(e,t,r){this.privateApi.executeCommandById("editor:focus");let i=this.app.workspace.getActiveViewOfType(bn.MarkdownView),s={line:e,ch:t};if(i){let o=i.getState();o.mode="source",i.setState(o,{history:!1}),i.editor.setCursor(s),this.app.workspace.onLayoutReady(()=>{i.editor.scrollIntoView({from:s,to:s},!0),setTimeout(()=>{i.editor.scrollIntoView({from:s,to:s},!0);let a=i.editor.getLine(e),l=r.length,c=a.indexOf(r,t);c!==-1&&i.editor.setSelection({line:e,ch:c},{line:e,ch:c+l}),this.privateApi.executeCommandById("editor:focus")},1)})}else A.info("No markdown view to jump")}};_r=j([(0,ed.singleton)()],_r);function vy(n){Pf(n,"svelte-1dbevw",`div.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw,button.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw{user-select:text}.search-container.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw{display:flex;white-space:pre-wrap;overflow-wrap:break-word}.search-container mark{background-color:var(--cs-highlight-bgc, rgba(219, 204, 149, 0.9));color:var(--cs-highlight-char-color, #111)}.left-pane.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw{display:flex;flex-direction:column;align-items:left;width:27.5vw}.search-bar.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw{position:sticky;top:-0.2em;left:0;width:97%;height:30px}.search-bar.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw::after{content:attr(data-match-count);position:absolute;right:0.6em;top:1.4em;font-size:0.8em;transform:translateY(-50%);color:var(--cs-hint-char-color, grey)}.search-bar.svelte-1dbevw input.svelte-1dbevw.svelte-1dbevw{width:100%;padding:8px 12px;border:none;border-radius:10px;background-color:var(--cs-search-bar-bgc, #20202066);box-shadow:0 2px 4px rgba(0, 0, 0, 0.07),
			0 2px 3px rgba(0, 0, 0, 0.1)}.result-items.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw{display:flex;flex-direction:column;height:70vh;margin-top:0.15em;overflow-y:auto}.result-items.svelte-1dbevw ul.svelte-1dbevw.svelte-1dbevw{padding:0 0.5em 0 0;margin-bottom:0;width:97%;overflow-x:hidden}.result-items.svelte-1dbevw ul.svelte-1dbevw button.svelte-1dbevw{align-items:center;justify-content:left;padding:0.65em;margin:0.5em 0 0 0.15em;width:25.35vw;height:fit-content;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;cursor:pointer}.result-items.svelte-1dbevw ul.svelte-1dbevw button.svelte-1dbevw:hover,.result-items.svelte-1dbevw ul.svelte-1dbevw button.selected.svelte-1dbevw{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.result-items.svelte-1dbevw ul button .line-item.svelte-1dbevw.svelte-1dbevw,.result-items.svelte-1dbevw ul button .file-item.svelte-1dbevw.svelte-1dbevw{text-wrap:wrap;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.result-items.svelte-1dbevw ul button .file-item.svelte-1dbevw.svelte-1dbevw{-webkit-line-clamp:6}.result-items.svelte-1dbevw ul button .file-item span.filename.svelte-1dbevw.svelte-1dbevw{margin-top:-0.2em;display:block}.result-items.svelte-1dbevw ul button .file-item span.file-folder-path.svelte-1dbevw.svelte-1dbevw{color:var(--cs-secondary-font-color, #a29c9c);display:block}.right-pane.svelte-1dbevw.svelte-1dbevw.svelte-1dbevw{background-color:var(--cs-pane-bgc, #20202066);border-radius:6px;height:73.97vh;width:60%}.right-pane.svelte-1dbevw button.svelte-1dbevw.svelte-1dbevw{white-space:pre-wrap}.right-pane.svelte-1dbevw .preview-container.svelte-1dbevw.svelte-1dbevw{margin:0.7em 0 0 0.7em;height:72.5vh;overflow-y:auto}.right-pane.svelte-1dbevw .preview-container p.svelte-1dbevw.svelte-1dbevw,.right-pane.svelte-1dbevw .preview-container ul.svelte-1dbevw.svelte-1dbevw{margin:0;padding:0;overflow-x:hidden}.right-pane.svelte-1dbevw .preview-container p.svelte-1dbevw.svelte-1dbevw{width:39.7vw}.right-pane.svelte-1dbevw .preview-container ul button.file-sub-item.svelte-1dbevw.svelte-1dbevw{text-wrap:wrap;display:block;text-overflow:ellipsis;justify-content:left;margin-bottom:1em;height:fit-content;width:39.2vw;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;font-size:medium}.right-pane.svelte-1dbevw .preview-container ul button.file-sub-item.selected.svelte-1dbevw.svelte-1dbevw{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.right-pane.svelte-1dbevw .preview-container.svelte-1dbevw span.matched-line{display:inline-block;width:100%}.right-pane.svelte-1dbevw .preview-container.svelte-1dbevw span.matched-line.highlight-bg{background-color:var(--cs-hint-char-color, #468eeb33)}`)}function nd(n,e,t){let r=n.slice();return r[41]=e[t],r[42]=e,r[43]=t,r}function rd(n,e,t){let r=n.slice();return r[44]=e[t],r[45]=e,r[43]=t,r}function _y(n){let e,t,r=n[44].basename+Wo+(n[44].extension==="md"?"":n[44].extension)+"",i,s,o=n[44].folderPath+"",a;return{c(){e=Fe("span"),t=Fe("span"),i=yr(),s=Fe("span"),a=wi(o),Ie(t,"class","filename svelte-1dbevw"),Ie(s,"class","file-folder-path svelte-1dbevw"),Ie(e,"class","file-item svelte-1dbevw")},m(l,c){gt(l,e,c),Le(e,t),t.innerHTML=r,Le(e,i),Le(e,s),Le(s,a)},p(l,c){c[0]&16&&r!==(r=l[44].basename+Wo+(l[44].extension==="md"?"":l[44].extension)+"")&&(t.innerHTML=r),c[0]&16&&o!==(o=l[44].folderPath+"")&&Il(a,o)},d(l){l&&ut(e)}}}function by(n){let e,t=n[11].purifyHTML(n[44].line.text)+"";return{c(){e=Fe("span"),Ie(e,"class","line-item svelte-1dbevw")},m(r,i){gt(r,e,i),e.innerHTML=t},p(r,i){i[0]&16&&t!==(t=r[11].purifyHTML(r[44].line.text)+"")&&(e.innerHTML=t)},d(r){r&&ut(e)}}}function id(n){let e,t,r=n[45],i=n[43],s,o;function a(p,g){if(p[44]instanceof dn)return by;if(p[44]instanceof hn)return _y}let l=a(n,[-1,-1]),c=l&&l(n),u=()=>n[18](e,r,i),h=()=>n[18](null,r,i);function f(...p){return n[19](n[43],...p)}function d(...p){return n[20](n[43],...p)}function m(...p){return n[21](n[43],...p)}return{c(){e=Fe("button"),c&&c.c(),t=yr(),Ie(e,"class","svelte-1dbevw"),xi(e,"selected",n[43]===n[5])},m(p,g){gt(p,e,g),c&&c.m(e,null),Le(e,t),u(),s||(o=[Ot(e,"click",f),Ot(e,"contextmenu",d),Ot(e,"dblclick",m)],s=!0)},p(p,g){n=p,l===(l=a(n,g))&&c?c.p(n,g):(c&&c.d(1),c=l&&l(n),c&&(c.c(),c.m(e,t))),(r!==n[45]||i!==n[43])&&(h(),r=n[45],i=n[43],u()),g[0]&32&&xi(e,"selected",n[43]===n[5])},d(p){p&&ut(e),c&&c.d(),h(),s=!1,Wt(o)}}}function sd(n){let e,t;function r(o,a){if(o[3]===1)return xy;if(o[3]===2)return wy}let i=r(n,[-1,-1]),s=i&&i(n);return{c(){e=Fe("div"),t=Fe("div"),s&&s.c(),Ie(t,"class","preview-container svelte-1dbevw"),Ie(e,"class","right-pane svelte-1dbevw")},m(o,a){gt(o,e,a),Le(e,t),s&&s.m(t,null)},p(o,a){i===(i=r(o,a))&&s?s.p(o,a):(s&&s.d(1),s=i&&i(o),s&&(s.c(),s.m(t,null)))},d(o){o&&ut(e),s&&s.d()}}}function wy(n){let e;function t(s,o){return s[7]&&s[7].viewType==="markdown"?Ty:Ey}let r=t(n,[-1,-1]),i=r(n);return{c(){i.c(),e=Fl()},m(s,o){i.m(s,o),gt(s,e,o)},p(s,o){r===(r=t(s,o))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&ut(e)}}}function xy(n){let e,t=n[6]&&ad(n);return{c(){t&&t.c(),e=Fl()},m(r,i){t&&t.m(r,i),gt(r,e,i)},p(r,i){r[6]?t?t.p(r,i):(t=ad(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){t&&t.d(r),r&&ut(e)}}}function Ey(n){let e,t=n[11].showNoResult(n[0])+"",r;return{c(){e=Fe("span"),r=wi(t)},m(i,s){gt(i,e,s),Le(e,r)},p(i,s){s[0]&1&&t!==(t=i[11].showNoResult(i[0])+"")&&Il(r,t)},d(i){i&&ut(e)}}}function Ty(n){let e,t=n[8],r=[];for(let i=0;i<t.length;i+=1)r[i]=od(nd(n,t,i));return{c(){e=Fe("ul");for(let i=0;i<r.length;i+=1)r[i].c();Ie(e,"class","svelte-1dbevw")},m(i,s){gt(i,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null)},p(i,s){if(s[0]&51968){t=i[8];let o;for(o=0;o<t.length;o+=1){let a=nd(i,t,o);r[o]?r[o].p(a,s):(r[o]=od(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=t.length}},d(i){i&&ut(e),Cl(r,i)}}}function od(n){let e,t,r=n[11].purifyHTML(n[41].text)+"",i,s=n[42],o=n[43],a,l;function c(...m){return n[24](n[43],...m)}function u(...m){return n[25](n[43],...m)}function h(...m){return n[26](n[43],...m)}let f=()=>n[27](e,s,o),d=()=>n[27](null,s,o);return{c(){e=Fe("button"),t=new Ks(!1),i=yr(),t.a=i,Ie(e,"class","file-sub-item svelte-1dbevw"),xi(e,"selected",n[43]===n[9])},m(m,p){gt(m,e,p),t.m(r,e),Le(e,i),f(),a||(l=[Ot(e,"click",c),Ot(e,"contextmenu",u),Ot(e,"dblclick",h)],a=!0)},p(m,p){n=m,p[0]&256&&r!==(r=n[11].purifyHTML(n[41].text)+"")&&t.p(r),(s!==n[42]||o!==n[43])&&(d(),s=n[42],o=n[43],f()),p[0]&512&&xi(e,"selected",n[43]===n[9])},d(m){m&&ut(e),d(),a=!1,Wt(l)}}}function ad(n){let e,t=n[11].purifyHTML(n[6])+"",r,i;return{c(){e=Fe("p"),Ie(e,"class","svelte-1dbevw")},m(s,o){gt(s,e,o),e.innerHTML=t,r||(i=[Ot(e,"contextmenu",n[22]),Ot(e,"dblclick",n[23])],r=!0)},p(s,o){o[0]&64&&t!==(t=s[11].purifyHTML(s[6])+"")&&(e.innerHTML=t)},d(s){s&&ut(e),r=!1,Wt(i)}}}function Sy(n){let e,t,r,i,s,o,a,l,c,u,h=n[4].items,f=[];for(let m=0;m<h.length;m+=1)f[m]=id(rd(n,h,m));let d=n[2]!=="floatingWindow"&&sd(n);return{c(){e=Fe("div"),t=Fe("div"),r=Fe("div"),i=Fe("input"),s=yr(),o=Fe("div"),a=Fe("ul");for(let m=0;m<f.length;m+=1)f[m].c();l=yr(),d&&d.c(),Ie(i,"id","cs-search-input"),Ie(i,"class","svelte-1dbevw"),Ie(r,"class","search-bar svelte-1dbevw"),Ie(r,"data-match-count",n[10]),Ie(a,"class","svelte-1dbevw"),Ie(o,"class","result-items svelte-1dbevw"),Ie(t,"class","left-pane svelte-1dbevw"),Ie(e,"class","search-container svelte-1dbevw")},m(m,p){gt(m,e,p),Le(e,t),Le(t,r),Le(r,i),Pl(i,n[1]),Le(t,s),Le(t,o),Le(o,a);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(a,null);Le(e,l),d&&d.m(e,null),c||(u=[Ot(i,"input",n[17]),Ot(i,"input",n[12])],c=!0)},p(m,p){if(p[0]&2&&i.value!==m[1]&&Pl(i,m[1]),p[0]&1024&&Ie(r,"data-match-count",m[10]),p[0]&43060){h=m[4].items;let g;for(g=0;g<h.length;g+=1){let v=rd(m,h,g);f[g]?f[g].p(v,p):(f[g]=id(v),f[g].c(),f[g].m(a,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=h.length}m[2]!=="floatingWindow"?d?d.p(m,p):(d=sd(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:vn,o:vn,d(m){m&&ut(e),Cl(f,m),d&&d.d(),c=!1,Wt(u)}}}function Ay(n,e,t){let r,i=w(Rt),s=w(_r),{uiType:o}=e,{onConfirmExternal:a}=e,{searchType:l}=e,{isSemantic:c}=e,{queryText:u}=e,h=new Map,f=new nn("",[]),d=-1,m="",p=null,g=[],v,x=-1;function E(N){return _n(this,void 0,void 0,function*(){yield Ei();let ee=f.items;if(N>=0&&N<ee.length){if(t(5,d=N),l===1){let He=ee[N];t(6,m=He.context)}else if(l===2)t(7,p=ee[N]),c||t(7,p.subItems=yield i.getFileSubItems(u,p),p),t(8,g=p.subItems),t(9,x=g.length>0?0:-1),yield Ei(),s.scrollTo("start",g[x],"instant");else throw Error(`unsupported search type: ${l}`);yield Ei(),s.scrollTo("center",ee[N],"smooth")}else t(6,m=""),t(7,p=null),t(8,g=[]),t(5,d=-1),t(9,x=-1)})}let b=Ns(100,()=>S());function S(){return _n(this,void 0,void 0,function*(){if(h.has(u)){t(4,f=h.get(u)),yield E(0);return}if(l===1)t(4,f=yield i.searchInFile(u));else if(l===2)t(4,f=c?yield i.searchInVaultSemantic(u):yield i.searchInVault(u));else throw Error(Qn);h.set(u,f),yield E(0)})}function C(N){return _n(this,void 0,void 0,function*(){yield E(N),o==="floatingWindow"&&(yield L(null,!1))})}function I(){return _n(this,void 0,void 0,function*(){yield E(Math.min(d+1,f.items.length-1)),o==="floatingWindow"&&(yield L(null,!1))})}function P(){return _n(this,void 0,void 0,function*(){yield E(Math.max(d-1,0)),o==="floatingWindow"&&(yield L(null,!1))})}function R(N){t(9,x=N)}function U(){t(9,x=s.updateSubItemIndex(g,x,"next"))}function D(){t(9,x=s.updateSubItemIndex(g,x,"prev"))}function L(N,ee){return _n(this,void 0,void 0,function*(){N==null||N.preventDefault();let He=f.items[d];yield s.handleConfirmAsync(ee?()=>{}:a,f.sourcePath,l,He,x,u)})}function k(){return _n(this,void 0,void 0,function*(){L(null,!0)})}function V(){h.delete(u),t(0,c=!c),S()}function se(){s.insertFileLinkToActiveMarkdown(p==null?void 0:p.path)}$s(()=>{A.trace("mounted element has been destroyed.")});function J(N,ee){yn.on(N,ee),$s(()=>{yn.off(N,ee)})}o==="floatingWindow"?(J(3,I),J(6,P)):(J(2,I),J(5,P),J(4,U),J(7,D),J(8,L),J(9,k),J(10,V),J(12,se)),s.focusInput(),S();function ue(){u=this.value,t(1,u)}function fe(N,ee,He){bi[N?"unshift":"push"](()=>{ee[He].element=N,t(4,f)})}let we=(N,ee)=>{C(N),o==="floatingWindow"&&L(null,!1)},ft=async(N,ee)=>{await C(N),await L(ee,ee.ctrlKey)},X=async(N,ee)=>{await C(N),await L(ee,ee.ctrlKey)},Y=N=>L(N,N.ctrlKey),H=N=>L(N,N.ctrlKey),Z=(N,ee)=>R(N),ae=(N,ee)=>{t(9,x=N),L(ee,ee.ctrlKey)},Ee=(N,ee)=>{t(9,x=N),L(ee,ee.ctrlKey)};function ke(N,ee,He){bi[N?"unshift":"push"](()=>{ee[He].element=N,t(8,g)})}return n.$$set=N=>{"uiType"in N&&t(2,o=N.uiType),"onConfirmExternal"in N&&t(16,a=N.onConfirmExternal),"searchType"in N&&t(3,l=N.searchType),"isSemantic"in N&&t(0,c=N.isSemantic),"queryText"in N&&t(1,u=N.queryText)},n.$$.update=()=>{if(n.$$.dirty[0]&48){e:t(10,r=`${d+1} / ${f.items.length}`)}},[c,u,o,l,f,d,m,p,g,x,r,s,b,C,R,L,a,ue,fe,we,ft,X,Y,H,Z,ae,Ee,ke]}var zl=class extends Hs{constructor(e){super(),Lf(this,e,Ay,Sy,Af,{uiType:2,onConfirmExternal:16,searchType:3,isSemantic:0,queryText:1},vy,[-1,-1])}},Ys=zl;var ct=class{toggle(e){if(e==="inFile")w(br).toggle();else throw Error(Qn)}resetAllPositions(){let e=w(de).ui;e.inFileFloatingWindowLeft="2.7em",e.inFileFloatingWindowTop="2.5em",w(ct).toggle("inFile"),w(ct).toggle("inFile")}onunload(){w(br).onClose()}};ct=j([(0,Ul.singleton)()],ct);var jl=class{constructor(){this.isDragging=!1;this.dragStartX=0;this.dragStartY=0;this.isResizing=!1;this.resizeStartX=0;this.resizeStartY=0;this.resizeStartWidth=0;this.resizeStartHeight=0;this.uiSetting=w(de).ui;this.mountedElement=null;this.onClose=()=>{var e,t;document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.handleResizeEnd),window.removeEventListener("resize",this.handleWindowResize),(e=this.mountedElement)==null||e.$destroy(),this.mountedElement=null,(t=this.containerEl)==null||t.remove()};this.handleMouseDown=e=>{this.isDragging=!0,this.containerEl.style.opacity="0.75",this.dragStartX=e.pageX-this.containerEl.offsetLeft,this.dragStartY=e.pageY-this.containerEl.offsetTop,e.preventDefault()};this.handleMouseMove=e=>{if(this.isDragging){let t=e.pageX-this.dragStartX,r=e.pageY-this.dragStartY;this.containerEl.style.left=`${t}px`,this.containerEl.style.top=`${r}px`,this.adjustPosition()}};this.handleMouseUp=()=>{this.isDragging=!1,this.containerEl.style.opacity="1",this.saveContainerElStates(),w(lt).postSettingUpdated()};this.handleResizeStart=e=>{this.isResizing=!0,this.resizeStartX=e.pageX,this.resizeStartY=e.pageY,this.resizeStartWidth=this.containerEl.offsetWidth,this.resizeStartHeight=this.containerEl.offsetHeight,e.preventDefault()};this.handleResize=e=>{if(!this.isResizing)return;let t=this.resizeStartWidth+(e.pageX-this.resizeStartX),r=this.resizeStartHeight+(e.pageY-this.resizeStartY),i=Math.max(200,t),s=Math.max(100,r),o=window.innerWidth,a=window.innerHeight,l=this.containerEl.getBoundingClientRect(),c=.5;l.left*c+i<=o&&(this.containerEl.style.width=`${i}px`),l.top*c+s<=a&&(this.containerEl.style.height=`${s}px`)};this.handleResizeEnd=()=>{this.isResizing&&(this.isResizing=!1,this.saveContainerElStates(),w(lt).postSettingUpdated())};this.handleWindowResize=()=>{this.containerEl&&this.adjustPosition()}}toggle(){if(this.mountedElement!==null)return this.onClose(),this;this.containerEl=document.body.createDiv(),this.frameEl=this.containerEl.createDiv(),this.frameEl.addClass("cs-floating-window-header"),this.contentEl=this.containerEl.createDiv(),this.frameEl.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.containerEl.addClass("cs-floating-window-container"),this.containerEl.style.position="fixed",this.containerEl.style.minWidth="200px",this.containerEl.style.minHeight="100px",this.loadContainerElStates(),this.containerEl.style.zIndex="20",this.containerEl.style.border="1px solid #454545",this.containerEl.style.borderRadius="10px",this.containerEl.style.overflow="hidden",this.containerEl.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",this.frameEl.style.width="100%",this.frameEl.style.height="20px",this.frameEl.style.backgroundColor="#333",this.frameEl.style.cursor="move",this.frameEl.style.color="#fff",this.frameEl.style.display="flex",this.frameEl.style.alignItems="center",this.frameEl.style.justifyContent="right",this.frameEl.style.padding="10px 0 10px 10px";let e=this.frameEl.createSpan();e.addClass("cs-close-btn"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<line x1="18" y1="6" x2="6" y2="18"></line>
			<line x1="6" y1="6" x2="18" y2="18"></line>
		</svg>`,e.style.cursor="pointer",e.style.padding="2px",e.style.margin="5px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.borderRadius="4px",e.style.transition="background-color 0.2s ease",e.addEventListener("mouseover",()=>{e.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),e.addEventListener("mouseout",()=>{e.style.backgroundColor="transparent"}),e.addEventListener("click",this.onClose),this.frameEl.appendChild(e),this.contentEl.style.padding="10px 0 10px 10px",this.contentEl.style.boxSizing="border-box";let t=this.containerEl.createDiv();return t.addClass("cs-resize-handle"),t.style.position="absolute",t.style.right="0",t.style.bottom="0",t.style.width="10px",t.style.height="10px",t.style.cursor="se-resize",t.addEventListener("mousedown",this.handleResizeStart),document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.handleResizeEnd),window.addEventListener("resize",this.handleWindowResize),this.mountComponent(),this}adjustPosition(){let e=this.containerEl.getBoundingClientRect(),t=window.innerWidth,r=window.innerHeight,i=parseInt(this.containerEl.style.left),s=parseInt(this.containerEl.style.top),o=.5;e.right-e.width*o>t&&(i=t-e.width*o),e.bottom-e.height*o>r&&(s=r-e.height*o),e.left<0&&(i=0),e.top<0&&(s=0),this.containerEl.style.left=`${i}px`,this.containerEl.style.top=`${s}px`,this.saveContainerElStates(),w(lt).postSettingUpdated()}},br=class extends jl{mountComponent(){let e=window.getSelection(),t=e?e.toString().trim():"";this.mountedElement=new Ys({target:this.contentEl,props:{uiType:"floatingWindow",onConfirmExternal:()=>{},searchType:1,isSemantic:!1,queryText:t}})}loadContainerElStates(){this.containerEl.style.top=this.uiSetting.inFileFloatingWindowTop,this.containerEl.style.left=this.uiSetting.inFileFloatingWindowLeft,this.containerEl.style.width=this.uiSetting.inFileFloatingWindowWidth||"300px",this.containerEl.style.height=this.uiSetting.inFileFloatingWindowHeight||"200px"}saveContainerElStates(){this.uiSetting.inFileFloatingWindowLeft=this.containerEl.style.left,this.uiSetting.inFileFloatingWindowTop=this.containerEl.style.top,this.uiSetting.inFileFloatingWindowWidth=this.containerEl.style.width,this.uiSetting.inFileFloatingWindowHeight=this.containerEl.style.height}};br=j([(0,Ul.singleton)()],br);var ld=require("obsidian");var cd=pe(ye());var wr=class{async createChildThreads(){if(sn)A.warn("web worker only enabled on dev environment now");else return;A.debug("init child threads...");let e=w(We).obsidianFs,t=w(ld.Vault).configDir,r=De.join(t,"plugins/clever-search/dist/cs-search-worker.js");try{let i=await e.readBinary(r);A.debug(`worker script size (6x bigger than in production build): ${(i.byteLength/1e3).toFixed(2)} KB`);let s=new Blob([i],{type:"text/javascript"}),o=URL.createObjectURL(s);this.worker=new Worker(o),this.worker.addEventListener("message",a=>{console.log(`Received from worker:
`,a.data)})}catch(i){console.error("Error initializing worker:",i)}}async testImageSearch(){var e;(e=this.worker)==null||e.postMessage({type:"image-search"})}};wr=j([(0,cd.singleton)()],wr);var pd=pe(ye());var ud=pe(ye());var wn=class{constructor(){this.privacyModeEnabled=!1;this.plugin=w(xr)}togglePrivacyMode(){this.privacyModeEnabled=!this.privacyModeEnabled,this.privacyModeEnabled?document.body.classList.add("cs-privacy-blur"):document.body.classList.remove("cs-privacy-blur")}init(){this.watchSelectionAndAutoCopy()}watchSelectionAndAutoCopy(){this.plugin.registerDomEvent(document,"mousedown",e=>{Cy(e,["cs-modal","cs-floating-window-container"])&&document.addEventListener("mouseup",()=>{Fy()},{once:!0})})}};wn=j([(0,ud.singleton)()],wn);function Cy(n,e){let t=n.target;for(;t;){if(e.some(r=>t==null?void 0:t.classList.contains(r)))return!0;t=t.parentElement}return!1}function Fy(){let n=window.getSelection();if(n&&n.rangeCount>0){let t=n.getRangeAt(0).toString();t&&navigator.clipboard.writeText(t).then(()=>A.debug(`selection copied: ${t}`))}}var Vl=require("obsidian");var Wl=require("obsidian");async function Iy(){let n=w(Ke).allFilesToBeIndexed().filter(t=>t.basename.includes("Mysql")||t.basename.includes("Breath")),e=await w(Ke).generateAllIndexedDocuments(n);w(ot).reindexAll(e)}async function fd(){let n=w(de);Nc(()=>Iy())}var dd=require("obsidian");var qn=class extends dd.Modal{constructor(t,r,i,s){var l;super(t);let o=((l=window.getSelection())==null?void 0:l.toString())||"",a=s||o;this.modalEl.replaceChildren(),this.modalEl.addClass("cs-modal"),this.mountedElement=new Ys({target:this.modalEl,props:{uiType:"modal",onConfirmExternal:()=>this.close(),searchType:r,isSemantic:i,queryText:a||""}}),new Qs(this.scope).registerAll()}onOpen(){}onClose(){this.mountedElement.$destroy()}};var Kl=pe(ye());var xn="Ctrl",Py="Alt";var En=class{constructor(){this.plugin=w(Ye);this.setting=w(de);this.app=w(Vl.App);w(Er).registerAll()}addDevCommands(){sn&&(this.addCommand({id:"cs-in-file-search-floating-window",name:"In file search - floating window",callback:()=>w(ct).toggle("inFile")}),this.addCommand({id:"clever-search-triggerTest",name:"clever-search-triggerTest",callback:async()=>await fd()}))}addCommandsWithoutDependency(){this.addCommand({id:"clever-search-in-file",name:"Search in file",callback:()=>{this.setting.ui.floatingWindowForInFile?w(ct).toggle("inFile"):new qn(this.app,1,!1).open()}}),this.addCommand({id:"cs-toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>w(wn).togglePrivacyMode()})}addInVaultCommands(){this.addCommand({id:"clever-search-in-vault",name:"Search in Vault",callback:()=>{yn.emit(11),new qn(this.app,2,!1).open()}}),this.addCommand({id:"cs-in-file-search-with-omnisearch-query",name:"Search in file with last Omnisearch query",callback:async()=>{new qn(this.app,1,!1,await w(Dt).getLastQuery()).open()}}),this.addCommand({id:"clever-search-in-vault-semantic",name:"Search in vault semantically",callback:async()=>new qn(this.app,2,!0).open()})}onunload(){w(Er).unregisterAll()}addCommand(e){this.plugin.addCommand(e)}};En=j([(0,Kl.singleton)()],En);function My(n){return e=>{e.preventDefault(),yn.emit(n),console.log("emit...")}}var Zs=class{constructor(e){this.handlers=[];this.scope=e}unregisterAll(){this.handlers.forEach(e=>{this.scope.unregister(e)}),this.handlers=[]}register(e,t,r){this.handlers.push(this.scope.register(e,t,My(r)))}},Er=class extends Zs{constructor(){super(w(Vl.App).scope)}registerAll(){this.handlers=[],this.register([xn],"J",3),this.register([xn],"K",6)}};Er=j([(0,Kl.singleton)()],Er);var Qs=class extends Zs{constructor(e){super(e)}registerAll(){this.register([xn],"J",2),this.register([xn],"K",5),this.register([],"ArrowDown",2),this.register([],"ArrowUp",5),this.register([],"Enter",8),this.register([xn],"Enter",9),this.register([xn],"N",4),this.register([xn],"P",7),this.register([xn],"S",10),this.register([Py],"I",12)}};var eo=require("obsidian");var hd=pe(ye());var Tr=class{constructor(){this.plugin=w(Ye);this.app=w(eo.App);this.scrollElement=null;this.handleScroll=()=>{var r;let e=((r=this.scrollElement)==null?void 0:r.scrollTop)||0;console.log("curr scrollTop:",e);let t={top:e,left:0}};this.handleScrollDebounced=Ns(1e3,()=>this.handleScroll())}init(){this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",async e=>{e&&e.view instanceof eo.MarkdownView&&(this.scrollElement&&(A.info("remove listener..."),this.scrollElement.removeEventListener("scroll",this.handleScrollDebounced,!0)),this.scrollElement=e.view.containerEl.querySelector(".cm-scroller"),this.scrollElement?(A.info("add listener..."),this.scrollElement.addEventListener("scroll",this.handleScrollDebounced)):A.error("can't find scrollElement"))}))}onAppQuit(){}};Tr=j([(0,hd.singleton)()],Tr);var Gn=class{async onload(){await w(lt).initAsync(),w(Ve).init(),sn&&(A.warn("\u4EC5\u5728\u5F00\u53D1\u6A21\u5F0F\u5F00\u542FRecentFileManager"),w(Tr).init()),w(En).addCommandsWithoutDependency(),await w(st).initAsync(),await w(Pt).initAsync(),await w(wr).createChildThreads(),w(wn).init()}async onLayoutReady(){let e=w(En);e.addInVaultCommands(),e.addDevCommands(),await w(at).initAsync(),await w(Dt).initAsync()}onunload(){w(En).onunload(),w(at).onunload(),w(ct).onunload()}onAppQuit(){}};Gn=j([(0,pd.singleton)()],Gn);var xr=class extends vt.Plugin{async onload(){to.container.register(Ye,{useValue:this}),to.container.register(vt.App,{useValue:this.app}),to.container.register(vt.Vault,{useValue:this.app.vault});let e=w(Gn);await e.onload(),this.app.workspace.onLayoutReady(()=>{e.onLayoutReady()}),this.registerEvent(this.app.workspace.on("quit",()=>e.onAppQuit(),this))}onunload(){document.body.classList.remove("cs-privacy-blur"),w(Gn).onunload()}exampleCode(){this.registerDomEvent(document,"click",e=>{console.log("click",e)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}},Js=class extends vt.Modal{constructor(t,r){super(t);this.mdContent=r}onOpen(){this.containerEl.empty(),this.containerEl.style.display="block",this.containerEl.style.overflow="auto",this.containerEl.style.backgroundColor="black",vt.MarkdownRenderer.render(w(vt.App),this.mdContent,this.containerEl,"",new vt.Component)}onClose(){}};0&&(module.exports={RenderMarkdownModal});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

dompurify/dist/purify.cjs.js:
  (*! @license DOMPurify 3.1.7 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.7/LICENSE *)

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

fzf/dist/fzf.es.js:
  (** @license
   * fzf v0.5.2
   * Copyright (c) 2021 Ajit
   * Licensed under BSD 3-Clause
   *)
*/
