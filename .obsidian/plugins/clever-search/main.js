/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _d=Object.create;var Ar=Object.defineProperty;var rc=Object.getOwnPropertyDescriptor;var bd=Object.getOwnPropertyNames;var wd=Object.getPrototypeOf,xd=Object.prototype.hasOwnProperty;var Ed=(n,e)=>()=>(n&&(e=n(n=0)),e);var he=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ic=(n,e)=>{for(var t in e)Ar(n,t,{get:e[t],enumerable:!0})},sc=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of bd(e))!xd.call(n,i)&&i!==t&&Ar(n,i,{get:()=>e[i],enumerable:!(r=rc(e,i))||r.enumerable});return n};var pe=(n,e,t)=>(t=n!=null?_d(wd(n)):{},sc(e||!n||!n.__esModule?Ar(t,"default",{value:n,enumerable:!0}):t,n)),Ii=n=>sc(Ar({},"__esModule",{value:!0}),n),U=(n,e,t,r)=>{for(var i=r>1?void 0:r?rc(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Ar(e,t,i),i},Pi=(n,e)=>(t,r)=>e(t,r,n);var Mi={};ic(Mi,{__assign:()=>no,__asyncDelegator:()=>Ld,__asyncGenerator:()=>Rd,__asyncValues:()=>Nd,__await:()=>Cr,__awaiter:()=>Id,__classPrivateFieldGet:()=>Ud,__classPrivateFieldSet:()=>Vd,__createBinding:()=>Md,__decorate:()=>Ad,__exportStar:()=>Dd,__extends:()=>Td,__generator:()=>Pd,__importDefault:()=>zd,__importStar:()=>Bd,__makeTemplateObject:()=>jd,__metadata:()=>Fd,__param:()=>Cd,__read:()=>ac,__rest:()=>Sd,__spread:()=>kd,__spreadArrays:()=>Od,__values:()=>ro});function Td(n,e){to(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Sd(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Ad(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Cd(n,e){return function(t,r){e(t,r,n)}}function Fd(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function Id(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}function Pd(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Md(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}function Dd(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function ro(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ac(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function kd(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(ac(arguments[e]));return n}function Od(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Cr(n){return this instanceof Cr?(this.v=n,this):new Cr(n)}function Rd(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(d){return new Promise(function(m,p){s.push([f,d,m,p])>1||a(f,d)})})}function a(f,d){try{l(r[f](d))}catch(m){h(s[0][3],m)}}function l(f){f.value instanceof Cr?Promise.resolve(f.value.v).then(c,u):h(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Ld(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Cr(n[i](o)),done:i==="return"}:s?s(o):o}:s}}function Nd(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof ro=="function"?ro(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function jd(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function Bd(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function zd(n){return n&&n.__esModule?n:{default:n}}function Ud(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function Vd(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}var to,no,Di=Ed(()=>{to=function(n,e){return to=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},to(n,e)};no=function(){return no=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},no.apply(this,arguments)}});var oo=he(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});var io;(function(n){n[n.Transient=0]="Transient",n[n.Singleton=1]="Singleton",n[n.ResolutionScoped=2]="ResolutionScoped",n[n.ContainerScoped=3]="ContainerScoped"})(io||(io={}));so.default=io});var lc=he(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});var Wd=oo();Object.defineProperty(ao,"Lifecycle",{enumerable:!0,get:function(){return Wd.default}})});var Tn=he(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.defineInjectionTokenMetadata=Ct.getParamInfo=Ct.INJECTION_TOKEN_METADATA_KEY=void 0;Ct.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function Kd(n){let e=Reflect.getMetadata("design:paramtypes",n)||[],t=Reflect.getOwnMetadata(Ct.INJECTION_TOKEN_METADATA_KEY,n)||{};return Object.keys(t).forEach(r=>{e[+r]=t[r]}),e}Ct.getParamInfo=Kd;function $d(n,e){return function(t,r,i){let s=Reflect.getOwnMetadata(Ct.INJECTION_TOKEN_METADATA_KEY,t)||{};s[i]=e?{token:n,transform:e.transformToken,transformArgs:e.args||[]}:n,Reflect.defineMetadata(Ct.INJECTION_TOKEN_METADATA_KEY,s,t)}}Ct.defineInjectionTokenMetadata=$d});var lo=he(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.isClassProvider=void 0;function Hd(n){return!!n.useClass}ki.isClassProvider=Hd});var co=he(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.isFactoryProvider=void 0;function qd(n){return!!n.useFactory}Oi.isFactoryProvider=qd});var Li=he(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.delay=Yn.DelayedConstructor=void 0;var Ri=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},r=!1,i,s=()=>(r||(i=e(this.wrap()),r=!0),i);return new Proxy(t,this.createHandler(s))}createHandler(e){let t={},r=i=>{t[i]=(...s)=>{s[0]=e();let o=Reflect[i];return o(...s)}};return this.reflectMethods.forEach(r),t}};Yn.DelayedConstructor=Ri;function Gd(n){if(typeof n=="undefined")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new Ri(n)}Yn.delay=Gd});var Ni=he(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.isConstructorToken=Nt.isTransformDescriptor=Nt.isTokenDescriptor=Nt.isNormalToken=void 0;var Xd=Li();function Yd(n){return typeof n=="string"||typeof n=="symbol"}Nt.isNormalToken=Yd;function Jd(n){return typeof n=="object"&&"token"in n&&"multiple"in n}Nt.isTokenDescriptor=Jd;function Qd(n){return typeof n=="object"&&"token"in n&&"transform"in n}Nt.isTransformDescriptor=Qd;function Zd(n){return typeof n=="function"||n instanceof Xd.DelayedConstructor}Nt.isConstructorToken=Zd});var uo=he(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.isTokenProvider=void 0;function eh(n){return!!n.useToken}ji.isTokenProvider=eh});var fo=he(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.isValueProvider=void 0;function th(n){return n.useValue!=null}Bi.isValueProvider=th});var ho=he(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});var nh=lo();Object.defineProperty(Sn,"isClassProvider",{enumerable:!0,get:function(){return nh.isClassProvider}});var rh=co();Object.defineProperty(Sn,"isFactoryProvider",{enumerable:!0,get:function(){return rh.isFactoryProvider}});var ih=Ni();Object.defineProperty(Sn,"isNormalToken",{enumerable:!0,get:function(){return ih.isNormalToken}});var sh=uo();Object.defineProperty(Sn,"isTokenProvider",{enumerable:!0,get:function(){return sh.isTokenProvider}});var oh=fo();Object.defineProperty(Sn,"isValueProvider",{enumerable:!0,get:function(){return oh.isValueProvider}})});var cc=he(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.isProvider=void 0;var ah=lo(),lh=fo(),ch=uo(),uh=co();function fh(n){return ah.isClassProvider(n)||lh.isValueProvider(n)||ch.isTokenProvider(n)||uh.isFactoryProvider(n)}zi.isProvider=fh});var go=he(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});var po=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};mo.default=po});var uc=he(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});var dh=go(),yo=class extends dh.default{};vo.default=yo});var fc=he(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});var _o=class{constructor(){this.scopedResolutions=new Map}};bo.default=_o});var wo=he(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.formatErrorCtor=void 0;function hh(n,e){return n===null?`at position #${e}`:`"${n.split(",")[e].trim()}" at position #${e}`}function ph(n,e,t="    "){return[n,...e.message.split(`
`).map(r=>t+r)].join(`
`)}function mh(n,e,t){let[,r=null]=n.toString().match(/constructor\(([\w, ]+)\)/)||[],i=hh(r,e);return ph(`Cannot inject the dependency ${i} of "${n.name}" constructor. Reason:`,t)}Ui.formatErrorCtor=mh});var dc=he(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.isDisposable=void 0;function gh(n){return!(typeof n.dispose!="function"||n.dispose.length>0)}Vi.isDisposable=gh});var pc=he(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.PostResolutionInterceptors=An.PreResolutionInterceptors=void 0;var hc=go(),Wi=class extends hc.default{};An.PreResolutionInterceptors=Wi;var Ki=class extends hc.default{};An.PostResolutionInterceptors=Ki;var xo=class{constructor(){this.preResolution=new Wi,this.postResolution=new Ki}};An.default=xo});var Cn=he($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.instance=$t.typeInfo=void 0;var yh=(Di(),Ii(Mi)),Ge=ho(),vh=cc(),$i=Ni(),_h=uc(),nt=oo(),mc=fc(),bh=wo(),wh=Li(),xh=dc(),Eh=pc();$t.typeInfo=new Map;var Fr=class{constructor(e){this.parent=e,this._registry=new _h.default,this.interceptors=new Eh.default,this.disposed=!1,this.disposables=new Set}register(e,t,r={lifecycle:nt.default.Transient}){this.ensureNotDisposed();let i;if(vh.isProvider(t)?i=t:i={useClass:t},Ge.isTokenProvider(i)){let s=[e],o=i;for(;o!=null;){let a=o.useToken;if(s.includes(a))throw new Error(`Token registration cycle detected! ${[...s,a].join(" -> ")}`);s.push(a);let l=this._registry.get(a);l&&Ge.isTokenProvider(l.provider)?o=l.provider:o=null}}if((r.lifecycle===nt.default.Singleton||r.lifecycle==nt.default.ContainerScoped||r.lifecycle==nt.default.ResolutionScoped)&&(Ge.isValueProvider(i)||Ge.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${nt.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,t){return this.ensureNotDisposed(),Ge.isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),Ge.isNormalToken(e)){if(Ge.isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:nt.default.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:nt.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return t&&!Ge.isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:nt.default.Singleton})}resolve(e,t=new mc.default){this.ensureNotDisposed();let r=this.getRegistration(e);if(!r&&Ge.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"Single"),r){let i=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if($i.isConstructorToken(e)){let i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,t);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,t,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,t,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===nt.default.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let r=e.options.lifecycle===nt.default.Singleton,i=e.options.lifecycle===nt.default.ContainerScoped,s=r||i,o;return Ge.isValueProvider(e.provider)?o=e.provider.useValue:Ge.isTokenProvider(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Ge.isClassProvider(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Ge.isFactoryProvider(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===nt.default.ResolutionScoped&&t.scopedResolutions.set(e,o),o}resolveAll(e,t=new mc.default){this.ensureNotDisposed();let r=this.getAllRegistrations(e);if(!r&&Ge.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"All"),r){let s=r.map(o=>this.resolveRegistration(o,t));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(r=>!Ge.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new Fr(this);for(let[t,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===nt.default.ContainerScoped)&&e._registry.setAll(t,r.map(i=>i.options.lifecycle===nt.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,t,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:r})}afterResolution(e,t,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:r})}dispose(){return yh.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let r=t.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof wh.DelayedConstructor)return e.createProxy(i=>this.resolve(i,t));let r=(()=>{let i=$t.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(t,e));return new e(...s)})();return xh.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,t){return(r,i)=>{try{return $i.isTokenDescriptor(r)?$i.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):$i.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(bh.formatErrorCtor(t,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};$t.instance=new Fr;$t.default=$t.instance});var gc=he(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});var Th=Tn(),Ht=Cn(),Eo=Ni(),Sh=wo();function Ah(){return function(n){let e=Th.getParamInfo(n);return class extends n{constructor(...t){super(...t.concat(e.slice(t.length).map((r,i)=>{try{return Eo.isTokenDescriptor(r)?Eo.isTransformDescriptor(r)?r.multiple?Ht.instance.resolve(r.transform).transform(Ht.instance.resolveAll(r.token),...r.transformArgs):Ht.instance.resolve(r.transform).transform(Ht.instance.resolve(r.token),...r.transformArgs):r.multiple?Ht.instance.resolveAll(r.token):Ht.instance.resolve(r.token):Eo.isTransformDescriptor(r)?Ht.instance.resolve(r.transform).transform(Ht.instance.resolve(r.token),...r.transformArgs):Ht.instance.resolve(r)}catch(s){let o=i+t.length;throw new Error(Sh.formatErrorCtor(n,o,s))}})))}}}}To.default=Ah});var yc=he(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});var Ch=Tn();function Fh(n){return Ch.defineInjectionTokenMetadata(n)}So.default=Fh});var Hi=he(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});var Ih=Tn(),Ph=Cn();function Mh(){return function(n){Ph.typeInfo.set(n,Ih.getParamInfo(n))}}Ao.default=Mh});var vc=he(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});var Dh=(Di(),Ii(Mi)),kh=Cn();function Oh(n=[]){return function(e){return n.forEach(t=>{var{token:r,options:i}=t,s=Dh.__rest(t,["token","options"]);return kh.instance.register(r,s,i)}),e}}Co.default=Oh});var _c=he(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});var Rh=Hi(),Lh=Cn();function Nh(){return function(n){Rh.default()(n),Lh.instance.registerSingleton(n)}}Fo.default=Nh});var bc=he(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});var jh=Tn();function Bh(n){let e={token:n,multiple:!0};return jh.defineInjectionTokenMetadata(e)}Io.default=Bh});var wc=he(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});var zh=Tn();function Uh(n,e,...t){let r={token:n,multiple:!0,transform:e,transformArgs:t};return zh.defineInjectionTokenMetadata(r)}Po.default=Uh});var xc=he(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});var Vh=Tn();function Wh(n,e,...t){return Vh.defineInjectionTokenMetadata(n,{transformToken:e,args:t})}Mo.default=Wh});var Ec=he(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});var Kh=Hi(),$h=Cn();function Hh(n,e){return function(t){Kh.default()(t),$h.instance.register(e||t,t,{lifecycle:n})}}Do.default=Hh});var Tc=he(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});var qh=gc();Object.defineProperty(Ft,"autoInjectable",{enumerable:!0,get:function(){return qh.default}});var Gh=yc();Object.defineProperty(Ft,"inject",{enumerable:!0,get:function(){return Gh.default}});var Xh=Hi();Object.defineProperty(Ft,"injectable",{enumerable:!0,get:function(){return Xh.default}});var Yh=vc();Object.defineProperty(Ft,"registry",{enumerable:!0,get:function(){return Yh.default}});var Jh=_c();Object.defineProperty(Ft,"singleton",{enumerable:!0,get:function(){return Jh.default}});var Qh=bc();Object.defineProperty(Ft,"injectAll",{enumerable:!0,get:function(){return Qh.default}});var Zh=wc();Object.defineProperty(Ft,"injectAllWithTransform",{enumerable:!0,get:function(){return Zh.default}});var ep=xc();Object.defineProperty(Ft,"injectWithTransform",{enumerable:!0,get:function(){return ep.default}});var tp=Ec();Object.defineProperty(Ft,"scoped",{enumerable:!0,get:function(){return tp.default}})});var Sc=he(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});function np(n){let e;return t=>(e==null&&(e=n(t)),e)}ko.default=np});var Ac=he(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});function rp(n){let e=new WeakMap;return t=>{let r=e.get(t);return r==null&&(r=n(t),e.set(t,r)),r}}Oo.default=rp});var Cc=he(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});function ip(n,e,t,r=!0){let i,s;return o=>{let a=n(o);return(!r||s!==a)&&((s=a)?i=o.resolve(e):i=o.resolve(t)),i}}Ro.default=ip});var Fc=he(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});var sp=Sc();Object.defineProperty(Ir,"instanceCachingFactory",{enumerable:!0,get:function(){return sp.default}});var op=Ac();Object.defineProperty(Ir,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return op.default}});var ap=Cc();Object.defineProperty(Ir,"predicateAwareClassFactory",{enumerable:!0,get:function(){return ap.default}})});var _e=he(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});var Lo=(Di(),Ii(Mi));if(typeof Reflect=="undefined"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var lp=lc();Object.defineProperty(nn,"Lifecycle",{enumerable:!0,get:function(){return lp.Lifecycle}});Lo.__exportStar(Tc(),nn);Lo.__exportStar(Fc(),nn);Lo.__exportStar(ho(),nn);var cp=Li();Object.defineProperty(nn,"delay",{enumerable:!0,get:function(){return cp.delay}});var up=Cn();Object.defineProperty(nn,"container",{enumerable:!0,get:function(){return up.instance}})});var Jf=he((Hw,Yf)=>{"use strict";var{entries:$f,setPrototypeOf:Nf,isFrozen:Xg,getPrototypeOf:Yg,getOwnPropertyDescriptor:Jg}=Object,{freeze:Qe,seal:xt,create:Hf}=Object,{apply:kl,construct:Ol}=typeof Reflect!="undefined"&&Reflect;Qe||(Qe=function(e){return e});xt||(xt=function(e){return e});kl||(kl=function(e,t,r){return e.apply(t,r)});Ol||(Ol=function(e,t){return new e(...t)});var $s=mt(Array.prototype.forEach),jf=mt(Array.prototype.pop),Ei=mt(Array.prototype.push),qs=mt(String.prototype.toLowerCase),Fl=mt(String.prototype.toString),Bf=mt(String.prototype.match),Ti=mt(String.prototype.replace),Qg=mt(String.prototype.indexOf),Zg=mt(String.prototype.trim),Ot=mt(Object.prototype.hasOwnProperty),Je=mt(RegExp.prototype.test),Si=ey(TypeError);function mt(n){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return kl(n,e,r)}}function ey(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Ol(n,t)}}function ce(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qs;Nf&&Nf(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){let s=t(i);s!==i&&(Xg(e)||(e[r]=s),i=s)}n[i]=!0}return n}function ty(n){for(let e=0;e<n.length;e++)Ot(n,e)||(n[e]=null);return n}function Wn(n){let e=Hf(null);for(let[t,r]of $f(n))Ot(n,t)&&(Array.isArray(r)?e[t]=ty(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Wn(r):e[t]=r);return e}function Ai(n,e){for(;n!==null;){let r=Jg(n,e);if(r){if(r.get)return mt(r.get);if(typeof r.value=="function")return mt(r.value)}n=Yg(n)}function t(){return null}return t}var zf=Qe(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Il=Qe(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Pl=Qe(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ny=Qe(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ml=Qe(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ry=Qe(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Uf=Qe(["#text"]),Vf=Qe(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Dl=Qe(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Wf=Qe(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Hs=Qe(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),iy=xt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),sy=xt(/<%[\w\W]*|[\w\W]*%>/gm),oy=xt(/\${[\w\W]*}/gm),ay=xt(/^data-[\-\w.\u00B7-\uFFFF]/),ly=xt(/^aria-[\-\w]+$/),qf=xt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),cy=xt(/^(?:\w+script|data):/i),uy=xt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Gf=xt(/^html$/i),fy=xt(/^[a-z][.\w]*(-[.\w]+)+$/i),Kf=Object.freeze({__proto__:null,MUSTACHE_EXPR:iy,ERB_EXPR:sy,TMPLIT_EXPR:oy,DATA_ATTR:ay,ARIA_ATTR:ly,IS_ALLOWED_URI:qf,IS_SCRIPT_OR_DATA:cy,ATTR_WHITESPACE:uy,DOCTYPE_NAME:Gf,CUSTOM_ELEMENT:fy}),Ci={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},dy=function(){return typeof window=="undefined"?null:window},hy=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null,i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(r=t.getAttribute(i));let s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch(o){return console.warn("TrustedTypes policy "+s+" could not be created."),null}};function Xf(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:dy(),e=H=>Xf(H);if(e.version="3.1.7",e.removed=[],!n||!n.document||n.document.nodeType!==Ci.document)return e.isSupported=!1,e;let{document:t}=n,r=t,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:d}=n,m=l.prototype,p=Ai(m,"cloneNode"),g=Ai(m,"remove"),v=Ai(m,"nextSibling"),w=Ai(m,"childNodes"),E=Ai(m,"parentNode");if(typeof o=="function"){let H=t.createElement("template");H.content&&H.content.ownerDocument&&(t=H.content.ownerDocument)}let b,S="",{implementation:A,createNodeIterator:I,createDocumentFragment:P,getElementsByTagName:O}=t,{importNode:z}=r,D={};e.isSupported=typeof $f=="function"&&typeof E=="function"&&A&&A.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:L,ERB_EXPR:R,TMPLIT_EXPR:W,DATA_ATTR:Q,ARIA_ATTR:re,IS_SCRIPT_OR_DATA:ue,ATTR_WHITESPACE:fe,CUSTOM_ELEMENT:we}=Kf,{IS_ALLOWED_URI:lt}=Kf,X=null,Y=ce({},[...zf,...Il,...Pl,...Ml,...Uf]),$=null,Z=ce({},[...Vf,...Dl,...Wf,...Hs]),ae=Object.seal(Hf(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Te=null,B=null,se=!0,Ee=!0,bn=!1,Et=!0,Tt=!1,wn=!0,Ze=!1,$e=!1,xn=!1,St=!1,ct=!1,et=!1,At=!0,Vt=!1,Wt="user-content-",En=!0,_=!1,T={},C=null,k=ce({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),K=null,Ae=ce({},["audio","video","img","source","image","track"]),ee=null,ie=ce({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),q="http://www.w3.org/1998/Math/MathML",le="http://www.w3.org/2000/svg",ne="http://www.w3.org/1999/xhtml",He=ne,Gn=!1,Zs=null,dd=ce({},[q,le,ne],Fl),Tr=null,hd=["application/xhtml+xml","text/html"],pd="text/html",De=null,Xn=null,md=t.createElement("form"),Vl=function(y){return y instanceof RegExp||y instanceof Function},eo=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Xn&&Xn===y)){if((!y||typeof y!="object")&&(y={}),y=Wn(y),Tr=hd.indexOf(y.PARSER_MEDIA_TYPE)===-1?pd:y.PARSER_MEDIA_TYPE,De=Tr==="application/xhtml+xml"?Fl:qs,X=Ot(y,"ALLOWED_TAGS")?ce({},y.ALLOWED_TAGS,De):Y,$=Ot(y,"ALLOWED_ATTR")?ce({},y.ALLOWED_ATTR,De):Z,Zs=Ot(y,"ALLOWED_NAMESPACES")?ce({},y.ALLOWED_NAMESPACES,Fl):dd,ee=Ot(y,"ADD_URI_SAFE_ATTR")?ce(Wn(ie),y.ADD_URI_SAFE_ATTR,De):ie,K=Ot(y,"ADD_DATA_URI_TAGS")?ce(Wn(Ae),y.ADD_DATA_URI_TAGS,De):Ae,C=Ot(y,"FORBID_CONTENTS")?ce({},y.FORBID_CONTENTS,De):k,Te=Ot(y,"FORBID_TAGS")?ce({},y.FORBID_TAGS,De):{},B=Ot(y,"FORBID_ATTR")?ce({},y.FORBID_ATTR,De):{},T=Ot(y,"USE_PROFILES")?y.USE_PROFILES:!1,se=y.ALLOW_ARIA_ATTR!==!1,Ee=y.ALLOW_DATA_ATTR!==!1,bn=y.ALLOW_UNKNOWN_PROTOCOLS||!1,Et=y.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Tt=y.SAFE_FOR_TEMPLATES||!1,wn=y.SAFE_FOR_XML!==!1,Ze=y.WHOLE_DOCUMENT||!1,St=y.RETURN_DOM||!1,ct=y.RETURN_DOM_FRAGMENT||!1,et=y.RETURN_TRUSTED_TYPE||!1,xn=y.FORCE_BODY||!1,At=y.SANITIZE_DOM!==!1,Vt=y.SANITIZE_NAMED_PROPS||!1,En=y.KEEP_CONTENT!==!1,_=y.IN_PLACE||!1,lt=y.ALLOWED_URI_REGEXP||qf,He=y.NAMESPACE||ne,ae=y.CUSTOM_ELEMENT_HANDLING||{},y.CUSTOM_ELEMENT_HANDLING&&Vl(y.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ae.tagNameCheck=y.CUSTOM_ELEMENT_HANDLING.tagNameCheck),y.CUSTOM_ELEMENT_HANDLING&&Vl(y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ae.attributeNameCheck=y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),y.CUSTOM_ELEMENT_HANDLING&&typeof y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ae.allowCustomizedBuiltInElements=y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Tt&&(Ee=!1),ct&&(St=!0),T&&(X=ce({},Uf),$=[],T.html===!0&&(ce(X,zf),ce($,Vf)),T.svg===!0&&(ce(X,Il),ce($,Dl),ce($,Hs)),T.svgFilters===!0&&(ce(X,Pl),ce($,Dl),ce($,Hs)),T.mathMl===!0&&(ce(X,Ml),ce($,Wf),ce($,Hs))),y.ADD_TAGS&&(X===Y&&(X=Wn(X)),ce(X,y.ADD_TAGS,De)),y.ADD_ATTR&&($===Z&&($=Wn($)),ce($,y.ADD_ATTR,De)),y.ADD_URI_SAFE_ATTR&&ce(ee,y.ADD_URI_SAFE_ATTR,De),y.FORBID_CONTENTS&&(C===k&&(C=Wn(C)),ce(C,y.FORBID_CONTENTS,De)),En&&(X["#text"]=!0),Ze&&ce(X,["html","head","body"]),X.table&&(ce(X,["tbody"]),delete Te.tbody),y.TRUSTED_TYPES_POLICY){if(typeof y.TRUSTED_TYPES_POLICY.createHTML!="function")throw Si('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof y.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Si('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');b=y.TRUSTED_TYPES_POLICY,S=b.createHTML("")}else b===void 0&&(b=hy(d,i)),b!==null&&typeof S=="string"&&(S=b.createHTML(""));Qe&&Qe(y),Xn=y}},Wl=ce({},["mi","mo","mn","ms","mtext"]),Kl=ce({},["annotation-xml"]),gd=ce({},["title","style","font","a","script"]),$l=ce({},[...Il,...Pl,...ny]),Hl=ce({},[...Ml,...ry]),yd=function(y){let M=E(y);(!M||!M.tagName)&&(M={namespaceURI:He,tagName:"template"});let V=qs(y.tagName),ge=qs(M.tagName);return Zs[y.namespaceURI]?y.namespaceURI===le?M.namespaceURI===ne?V==="svg":M.namespaceURI===q?V==="svg"&&(ge==="annotation-xml"||Wl[ge]):Boolean($l[V]):y.namespaceURI===q?M.namespaceURI===ne?V==="math":M.namespaceURI===le?V==="math"&&Kl[ge]:Boolean(Hl[V]):y.namespaceURI===ne?M.namespaceURI===le&&!Kl[ge]||M.namespaceURI===q&&!Wl[ge]?!1:!Hl[V]&&(gd[V]||!$l[V]):!!(Tr==="application/xhtml+xml"&&Zs[y.namespaceURI]):!1},Rt=function(y){Ei(e.removed,{element:y});try{E(y).removeChild(y)}catch(M){g(y)}},Fi=function(y,M){try{Ei(e.removed,{attribute:M.getAttributeNode(y),from:M})}catch(V){Ei(e.removed,{attribute:null,from:M})}if(M.removeAttribute(y),y==="is"&&!$[y])if(St||ct)try{Rt(M)}catch(V){}else try{M.setAttribute(y,"")}catch(V){}},ql=function(y){let M=null,V=null;if(xn)y="<remove></remove>"+y;else{let Oe=Bf(y,/^[\r\n\t ]+/);V=Oe&&Oe[0]}Tr==="application/xhtml+xml"&&He===ne&&(y='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+y+"</body></html>");let ge=b?b.createHTML(y):y;if(He===ne)try{M=new f().parseFromString(ge,Tr)}catch(Oe){}if(!M||!M.documentElement){M=A.createDocument(He,"template",null);try{M.documentElement.innerHTML=Gn?S:ge}catch(Oe){}}let Ne=M.body||M.documentElement;return y&&V&&Ne.insertBefore(t.createTextNode(V),Ne.childNodes[0]||null),He===ne?O.call(M,Ze?"html":"body")[0]:Ze?M.documentElement:Ne},Gl=function(y){return I.call(y.ownerDocument||y,y,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Xl=function(y){return y instanceof h&&(typeof y.nodeName!="string"||typeof y.textContent!="string"||typeof y.removeChild!="function"||!(y.attributes instanceof u)||typeof y.removeAttribute!="function"||typeof y.setAttribute!="function"||typeof y.namespaceURI!="string"||typeof y.insertBefore!="function"||typeof y.hasChildNodes!="function")},Yl=function(y){return typeof a=="function"&&y instanceof a},Kt=function(y,M,V){D[y]&&$s(D[y],ge=>{ge.call(e,M,V,Xn)})},Jl=function(y){let M=null;if(Kt("beforeSanitizeElements",y,null),Xl(y))return Rt(y),!0;let V=De(y.nodeName);if(Kt("uponSanitizeElement",y,{tagName:V,allowedTags:X}),y.hasChildNodes()&&!Yl(y.firstElementChild)&&Je(/<[/\w]/g,y.innerHTML)&&Je(/<[/\w]/g,y.textContent)||y.nodeType===Ci.progressingInstruction||wn&&y.nodeType===Ci.comment&&Je(/<[/\w]/g,y.data))return Rt(y),!0;if(!X[V]||Te[V]){if(!Te[V]&&Zl(V)&&(ae.tagNameCheck instanceof RegExp&&Je(ae.tagNameCheck,V)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(V)))return!1;if(En&&!C[V]){let ge=E(y)||y.parentNode,Ne=w(y)||y.childNodes;if(Ne&&ge){let Oe=Ne.length;for(let tt=Oe-1;tt>=0;--tt){let Lt=p(Ne[tt],!0);Lt.__removalCount=(y.__removalCount||0)+1,ge.insertBefore(Lt,v(y))}}}return Rt(y),!0}return y instanceof l&&!yd(y)||(V==="noscript"||V==="noembed"||V==="noframes")&&Je(/<\/no(script|embed|frames)/i,y.innerHTML)?(Rt(y),!0):(Tt&&y.nodeType===Ci.text&&(M=y.textContent,$s([L,R,W],ge=>{M=Ti(M,ge," ")}),y.textContent!==M&&(Ei(e.removed,{element:y.cloneNode()}),y.textContent=M)),Kt("afterSanitizeElements",y,null),!1)},Ql=function(y,M,V){if(At&&(M==="id"||M==="name")&&(V in t||V in md))return!1;if(!(Ee&&!B[M]&&Je(Q,M))){if(!(se&&Je(re,M))){if(!$[M]||B[M]){if(!(Zl(y)&&(ae.tagNameCheck instanceof RegExp&&Je(ae.tagNameCheck,y)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(y))&&(ae.attributeNameCheck instanceof RegExp&&Je(ae.attributeNameCheck,M)||ae.attributeNameCheck instanceof Function&&ae.attributeNameCheck(M))||M==="is"&&ae.allowCustomizedBuiltInElements&&(ae.tagNameCheck instanceof RegExp&&Je(ae.tagNameCheck,V)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(V))))return!1}else if(!ee[M]){if(!Je(lt,Ti(V,fe,""))){if(!((M==="src"||M==="xlink:href"||M==="href")&&y!=="script"&&Qg(V,"data:")===0&&K[y])){if(!(bn&&!Je(ue,Ti(V,fe,"")))){if(V)return!1}}}}}}return!0},Zl=function(y){return y!=="annotation-xml"&&Bf(y,we)},ec=function(y){Kt("beforeSanitizeAttributes",y,null);let{attributes:M}=y;if(!M)return;let V={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$},ge=M.length;for(;ge--;){let Ne=M[ge],{name:Oe,namespaceURI:tt,value:Lt}=Ne,Sr=De(Oe),qe=Oe==="value"?Lt:Zg(Lt);if(V.attrName=Sr,V.attrValue=qe,V.keepAttr=!0,V.forceKeepAttr=void 0,Kt("uponSanitizeAttribute",y,V),qe=V.attrValue,V.forceKeepAttr||(Fi(Oe,y),!V.keepAttr))continue;if(!Et&&Je(/\/>/i,qe)){Fi(Oe,y);continue}Tt&&$s([L,R,W],nc=>{qe=Ti(qe,nc," ")});let tc=De(y.nodeName);if(Ql(tc,Sr,qe)){if(Vt&&(Sr==="id"||Sr==="name")&&(Fi(Oe,y),qe=Wt+qe),wn&&Je(/((--!?|])>)|<\/(style|title)/i,qe)){Fi(Oe,y);continue}if(b&&typeof d=="object"&&typeof d.getAttributeType=="function"&&!tt)switch(d.getAttributeType(tc,Sr)){case"TrustedHTML":{qe=b.createHTML(qe);break}case"TrustedScriptURL":{qe=b.createScriptURL(qe);break}}try{tt?y.setAttributeNS(tt,Oe,qe):y.setAttribute(Oe,qe),Xl(y)?Rt(y):jf(e.removed)}catch(nc){}}}Kt("afterSanitizeAttributes",y,null)},vd=function H(y){let M=null,V=Gl(y);for(Kt("beforeSanitizeShadowDOM",y,null);M=V.nextNode();)Kt("uponSanitizeShadowNode",M,null),!Jl(M)&&(M.content instanceof s&&H(M.content),ec(M));Kt("afterSanitizeShadowDOM",y,null)};return e.sanitize=function(H){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=null,V=null,ge=null,Ne=null;if(Gn=!H,Gn&&(H="<!-->"),typeof H!="string"&&!Yl(H))if(typeof H.toString=="function"){if(H=H.toString(),typeof H!="string")throw Si("dirty is not a string, aborting")}else throw Si("toString is not a function");if(!e.isSupported)return H;if($e||eo(y),e.removed=[],typeof H=="string"&&(_=!1),_){if(H.nodeName){let Lt=De(H.nodeName);if(!X[Lt]||Te[Lt])throw Si("root node is forbidden and cannot be sanitized in-place")}}else if(H instanceof a)M=ql("<!---->"),V=M.ownerDocument.importNode(H,!0),V.nodeType===Ci.element&&V.nodeName==="BODY"||V.nodeName==="HTML"?M=V:M.appendChild(V);else{if(!St&&!Tt&&!Ze&&H.indexOf("<")===-1)return b&&et?b.createHTML(H):H;if(M=ql(H),!M)return St?null:et?S:""}M&&xn&&Rt(M.firstChild);let Oe=Gl(_?H:M);for(;ge=Oe.nextNode();)Jl(ge)||(ge.content instanceof s&&vd(ge.content),ec(ge));if(_)return H;if(St){if(ct)for(Ne=P.call(M.ownerDocument);M.firstChild;)Ne.appendChild(M.firstChild);else Ne=M;return($.shadowroot||$.shadowrootmode)&&(Ne=z.call(r,Ne,!0)),Ne}let tt=Ze?M.outerHTML:M.innerHTML;return Ze&&X["!doctype"]&&M.ownerDocument&&M.ownerDocument.doctype&&M.ownerDocument.doctype.name&&Je(Gf,M.ownerDocument.doctype.name)&&(tt="<!DOCTYPE "+M.ownerDocument.doctype.name+`>
`+tt),Tt&&$s([L,R,W],Lt=>{tt=Ti(tt,Lt," ")}),b&&et?b.createHTML(tt):tt},e.setConfig=function(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};eo(H),$e=!0},e.clearConfig=function(){Xn=null,$e=!1},e.isValidAttribute=function(H,y,M){Xn||eo({});let V=De(H),ge=De(y);return Ql(V,ge,M)},e.addHook=function(H,y){typeof y=="function"&&(D[H]=D[H]||[],Ei(D[H],y))},e.removeHook=function(H){if(D[H])return jf(D[H])},e.removeHooks=function(H){D[H]&&(D[H]=[])},e.removeAllHooks=function(){D={}},e}var py=Xf();Yf.exports=py});var Iy={};ic(Iy,{RenderMarkdownModal:()=>Xs,default:()=>xr});module.exports=Ii(Iy);var gt=require("obsidian");var oc;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect=="undefined"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,c={create:o?function(){return En(Object.create(null))}:a?function(){return En({__proto__:null})}:function(){return En({})},has:l?function(_,T){return t.call(_,T)}:function(_,T){return T in _},get:l?function(_,T){return t.call(_,T)?_[T]:void 0}:function(_,T){return _[T]}},u=Object.getPrototypeOf(Function),h=typeof process=="object"&&process["env"]&&process["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!h&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:At(),d=!h&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Vt(),m=!h&&typeof WeakMap=="function"?WeakMap:Wt(),p=new m;function g(_,T,C,k){if(X(C)){if(!bn(_))throw new TypeError;if(!Tt(T))throw new TypeError;return z(_,T)}else{if(!bn(_))throw new TypeError;if(!Z(T))throw new TypeError;if(!Z(k)&&!X(k)&&!Y(k))throw new TypeError;return Y(k)&&(k=void 0),C=Ee(C),D(_,T,C,k)}}e("decorate",g);function v(_,T){function C(k,K){if(!Z(k))throw new TypeError;if(!X(K)&&!wn(K))throw new TypeError;ue(_,T,k,K)}return C}e("metadata",v);function w(_,T,C,k){if(!Z(C))throw new TypeError;return X(k)||(k=Ee(k)),ue(_,T,C,k)}e("defineMetadata",w);function E(_,T,C){if(!Z(T))throw new TypeError;return X(C)||(C=Ee(C)),R(_,T,C)}e("hasMetadata",E);function b(_,T,C){if(!Z(T))throw new TypeError;return X(C)||(C=Ee(C)),W(_,T,C)}e("hasOwnMetadata",b);function S(_,T,C){if(!Z(T))throw new TypeError;return X(C)||(C=Ee(C)),Q(_,T,C)}e("getMetadata",S);function A(_,T,C){if(!Z(T))throw new TypeError;return X(C)||(C=Ee(C)),re(_,T,C)}e("getOwnMetadata",A);function I(_,T){if(!Z(_))throw new TypeError;return X(T)||(T=Ee(T)),fe(_,T)}e("getMetadataKeys",I);function P(_,T){if(!Z(_))throw new TypeError;return X(T)||(T=Ee(T)),we(_,T)}e("getOwnMetadataKeys",P);function O(_,T,C){if(!Z(T))throw new TypeError;X(C)||(C=Ee(C));var k=L(T,C,!1);if(X(k)||!k.delete(_))return!1;if(k.size>0)return!0;var K=p.get(T);return K.delete(C),K.size>0||p.delete(T),!0}e("deleteMetadata",O);function z(_,T){for(var C=_.length-1;C>=0;--C){var k=_[C],K=k(T);if(!X(K)&&!Y(K)){if(!Tt(K))throw new TypeError;T=K}}return T}function D(_,T,C,k){for(var K=_.length-1;K>=0;--K){var Ae=_[K],ee=Ae(T,C,k);if(!X(ee)&&!Y(ee)){if(!Z(ee))throw new TypeError;k=ee}}return k}function L(_,T,C){var k=p.get(_);if(X(k)){if(!C)return;k=new f,p.set(_,k)}var K=k.get(T);if(X(K)){if(!C)return;K=new f,k.set(T,K)}return K}function R(_,T,C){var k=W(_,T,C);if(k)return!0;var K=et(T);return Y(K)?!1:R(_,K,C)}function W(_,T,C){var k=L(T,C,!1);return X(k)?!1:B(k.has(_))}function Q(_,T,C){var k=W(_,T,C);if(k)return re(_,T,C);var K=et(T);if(!Y(K))return Q(_,K,C)}function re(_,T,C){var k=L(T,C,!1);if(!X(k))return k.get(_)}function ue(_,T,C,k){var K=L(C,k,!0);K.set(_,T)}function fe(_,T){var C=we(_,T),k=et(_);if(k===null)return C;var K=fe(k,T);if(K.length<=0)return C;if(C.length<=0)return K;for(var Ae=new d,ee=[],ie=0,q=C;ie<q.length;ie++){var le=q[ie],ne=Ae.has(le);ne||(Ae.add(le),ee.push(le))}for(var He=0,Gn=K;He<Gn.length;He++){var le=Gn[He],ne=Ae.has(le);ne||(Ae.add(le),ee.push(le))}return ee}function we(_,T){var C=[],k=L(_,T,!1);if(X(k))return C;for(var K=k.keys(),Ae=$e(K),ee=0;;){var ie=St(Ae);if(!ie)return C.length=ee,C;var q=xn(ie);try{C[ee]=q}catch(le){try{ct(Ae)}finally{throw le}}ee++}}function lt(_){if(_===null)return 1;switch(typeof _){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return _===null?1:6;default:return 6}}function X(_){return _===void 0}function Y(_){return _===null}function $(_){return typeof _=="symbol"}function Z(_){return typeof _=="object"?_!==null:typeof _=="function"}function ae(_,T){switch(lt(_)){case 0:return _;case 1:return _;case 2:return _;case 3:return _;case 4:return _;case 5:return _}var C=T===3?"string":T===5?"number":"default",k=Ze(_,i);if(k!==void 0){var K=k.call(_,C);if(Z(K))throw new TypeError;return K}return Te(_,C==="default"?"number":C)}function Te(_,T){if(T==="string"){var C=_.toString;if(Et(C)){var k=C.call(_);if(!Z(k))return k}var K=_.valueOf;if(Et(K)){var k=K.call(_);if(!Z(k))return k}}else{var K=_.valueOf;if(Et(K)){var k=K.call(_);if(!Z(k))return k}var Ae=_.toString;if(Et(Ae)){var k=Ae.call(_);if(!Z(k))return k}}throw new TypeError}function B(_){return!!_}function se(_){return""+_}function Ee(_){var T=ae(_,3);return $(T)?T:se(T)}function bn(_){return Array.isArray?Array.isArray(_):_ instanceof Object?_ instanceof Array:Object.prototype.toString.call(_)==="[object Array]"}function Et(_){return typeof _=="function"}function Tt(_){return typeof _=="function"}function wn(_){switch(lt(_)){case 3:return!0;case 4:return!0;default:return!1}}function Ze(_,T){var C=_[T];if(C!=null){if(!Et(C))throw new TypeError;return C}}function $e(_){var T=Ze(_,s);if(!Et(T))throw new TypeError;var C=T.call(_);if(!Z(C))throw new TypeError;return C}function xn(_){return _.value}function St(_){var T=_.next();return T.done?!1:T}function ct(_){var T=_.return;T&&T.call(_)}function et(_){var T=Object.getPrototypeOf(_);if(typeof _!="function"||_===u||T!==u)return T;var C=_.prototype,k=C&&Object.getPrototypeOf(C);if(k==null||k===Object.prototype)return T;var K=k.constructor;return typeof K!="function"||K===_?T:K}function At(){var _={},T=[],C=function(){function ee(ie,q,le){this._index=0,this._keys=ie,this._values=q,this._selector=le}return ee.prototype["@@iterator"]=function(){return this},ee.prototype[s]=function(){return this},ee.prototype.next=function(){var ie=this._index;if(ie>=0&&ie<this._keys.length){var q=this._selector(this._keys[ie],this._values[ie]);return ie+1>=this._keys.length?(this._index=-1,this._keys=T,this._values=T):this._index++,{value:q,done:!1}}return{value:void 0,done:!0}},ee.prototype.throw=function(ie){throw this._index>=0&&(this._index=-1,this._keys=T,this._values=T),ie},ee.prototype.return=function(ie){return this._index>=0&&(this._index=-1,this._keys=T,this._values=T),{value:ie,done:!0}},ee}();return function(){function ee(){this._keys=[],this._values=[],this._cacheKey=_,this._cacheIndex=-2}return Object.defineProperty(ee.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ee.prototype.has=function(ie){return this._find(ie,!1)>=0},ee.prototype.get=function(ie){var q=this._find(ie,!1);return q>=0?this._values[q]:void 0},ee.prototype.set=function(ie,q){var le=this._find(ie,!0);return this._values[le]=q,this},ee.prototype.delete=function(ie){var q=this._find(ie,!1);if(q>=0){for(var le=this._keys.length,ne=q+1;ne<le;ne++)this._keys[ne-1]=this._keys[ne],this._values[ne-1]=this._values[ne];return this._keys.length--,this._values.length--,ie===this._cacheKey&&(this._cacheKey=_,this._cacheIndex=-2),!0}return!1},ee.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=_,this._cacheIndex=-2},ee.prototype.keys=function(){return new C(this._keys,this._values,k)},ee.prototype.values=function(){return new C(this._keys,this._values,K)},ee.prototype.entries=function(){return new C(this._keys,this._values,Ae)},ee.prototype["@@iterator"]=function(){return this.entries()},ee.prototype[s]=function(){return this.entries()},ee.prototype._find=function(ie,q){return this._cacheKey!==ie&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ie)),this._cacheIndex<0&&q&&(this._cacheIndex=this._keys.length,this._keys.push(ie),this._values.push(void 0)),this._cacheIndex},ee}();function k(ee,ie){return ee}function K(ee,ie){return ie}function Ae(ee,ie){return[ee,ie]}}function Vt(){return function(){function _(){this._map=new f}return Object.defineProperty(_.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),_.prototype.has=function(T){return this._map.has(T)},_.prototype.add=function(T){return this._map.set(T,T),this},_.prototype.delete=function(T){return this._map.delete(T)},_.prototype.clear=function(){this._map.clear()},_.prototype.keys=function(){return this._map.keys()},_.prototype.values=function(){return this._map.values()},_.prototype.entries=function(){return this._map.entries()},_.prototype["@@iterator"]=function(){return this.keys()},_.prototype[s]=function(){return this.keys()},_}()}function Wt(){var _=16,T=c.create(),C=k();return function(){function q(){this._key=k()}return q.prototype.has=function(le){var ne=K(le,!1);return ne!==void 0?c.has(ne,this._key):!1},q.prototype.get=function(le){var ne=K(le,!1);return ne!==void 0?c.get(ne,this._key):void 0},q.prototype.set=function(le,ne){var He=K(le,!0);return He[this._key]=ne,this},q.prototype.delete=function(le){var ne=K(le,!1);return ne!==void 0?delete ne[this._key]:!1},q.prototype.clear=function(){this._key=k()},q}();function k(){var q;do q="@@WeakMap@@"+ie();while(c.has(T,q));return T[q]=!0,q}function K(q,le){if(!t.call(q,C)){if(!le)return;Object.defineProperty(q,C,{value:c.create()})}return q[C]}function Ae(q,le){for(var ne=0;ne<le;++ne)q[ne]=Math.random()*255|0;return q}function ee(q){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(q)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(q)):Ae(new Uint8Array(q),q):Ae(new Array(q),q)}function ie(){var q=ee(_);q[6]=q[6]&79|64,q[8]=q[8]&191|128;for(var le="",ne=0;ne<_;++ne){var He=q[ne];(ne===4||ne===6||ne===8)&&(le+="-"),He<16&&(le+="0"),le+=He.toString(16).toLowerCase()}return le}}function En(_){return _.__=void 0,delete _.__,_}})})(oc||(oc={}));var Qs=pe(_e());var ut="CleverSearch",No='"\u25B6"',jo='"\u25BC"';var Bo="&nbsp;&nbsp;&nbsp;&nbsp;";var gp={},je,Ic=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ic.decode();var qi=null;function Yi(){return(qi===null||qi.buffer!==je.memory.buffer)&&(qi=new Uint8Array(je.memory.buffer)),qi}function zo(n,e){return Ic.decode(Yi().subarray(n,n+e))}var qt=new Array(32).fill(void 0);qt.push(void 0,null,!0,!1);var Dr=qt.length;function Pr(n){Dr===qt.length&&qt.push(qt.length+1);let e=Dr;return Dr=qt[e],qt[e]=n,e}function Ji(n){return qt[n]}function fp(n){n<36||(qt[n]=Dr,Dr=n)}function Mr(n){let e=Ji(n);return fp(n),e}function Uo(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=Uo(n[0]));for(let o=1;o<i;o++)s+=", "+Uo(n[o]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch(i){return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}var Zi=0,Qi=new TextEncoder("utf-8"),dp=typeof Qi.encodeInto=="function"?function(n,e){return Qi.encodeInto(n,e)}:function(n,e){let t=Qi.encode(n);return e.set(t),{read:n.length,written:t.length}};function Pc(n,e,t){if(t===void 0){let a=Qi.encode(n),l=e(a.length);return Yi().subarray(l,l+a.length).set(a),Zi=a.length,l}let r=n.length,i=e(r),s=Yi(),o=0;for(;o<r;o++){let a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3);let a=Yi().subarray(i+o,i+r),l=dp(n,a);o+=l.written}return Zi=o,i}var Gi=null;function es(){return(Gi===null||Gi.buffer!==je.memory.buffer)&&(Gi=new Int32Array(je.memory.buffer)),Gi}var Xi=null;function hp(){return(Xi===null||Xi.buffer!==je.memory.buffer)&&(Xi=new Uint32Array(je.memory.buffer)),Xi}function pp(n,e){let r=hp().subarray(n/4,n/4+e),i=[];for(let s=0;s<r.length;s++)i.push(Mr(r[s]));return i}function Vo(n,e){try{let a=je.__wbindgen_add_to_stack_pointer(-16);var t=Pc(n,je.__wbindgen_malloc,je.__wbindgen_realloc),r=Zi;je.cut_for_search(a,t,r,e);var i=es()[a/4+0],s=es()[a/4+1],o=pp(i,s).slice();return je.__wbindgen_free(i,s*4),o}finally{je.__wbindgen_add_to_stack_pointer(16)}}async function mp(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}async function Mc(n){typeof n=="undefined"&&(n=new URL("jieba_rs_wasm_bg.wasm",gp.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var o=zo(i,s);return Pr(o)},e.wbg.__wbindgen_object_drop_ref=function(i){Mr(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return Pr(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return Pr(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,o){Ji(i)[Mr(s)]=Mr(o)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=Ji(i);return Pr(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var o=new Error(zo(i,s));return Pr(o)},e.wbg.__wbindgen_debug_string=function(i,s){var o=Uo(Ji(s)),a=Pc(o,je.__wbindgen_malloc,je.__wbindgen_realloc),l=Zi;es()[i/4+1]=l,es()[i/4+0]=a},e.wbg.__wbindgen_throw=function(i,s){throw new Error(zo(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw Mr(i)},(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await mp(await n,e);return je=t.exports,Mc.__wbindgen_wasm_module=r,je}var Dc=Mc;var kr=(r=>(r.other="Other Language",r.en="English",r.zh="\u7B80\u4F53\u4E2D\u6587",r))(kr||{});var kc=pe(_e());var Or={traceLog:!1,loadIndexFromDatabase:!0};var Wo=class{constructor(){this.logLevel="debug";this.levelWeights={trace:1,debug:2,info:3,warn:4,error:5,none:6}}getLevel(){return this.logLevel}setLevel(e){this.logLevel=e}trace(...e){this.shouldLog("trace")&&(Or.traceLog?(console.groupCollapsed(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.log(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;",...e))}debug(...e){this.shouldLog("debug")&&(Or.traceLog?(console.groupCollapsed(`%c[debug] ${this.getCallerName()}
`,"color: #379237;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.debug(`%c[debug] ${this.getCallerName()}
`,"color: #379237",...e))}info(...e){this.shouldLog("info")&&console.info(`%c[info] ${this.getCallerName()}
`,"color: blue;",...e)}warn(...e){this.shouldLog("warn")&&console.warn(`%c[warn] ${this.getCallerName()}
`,"color: orange;",...e)}error(...e){this.shouldLog("error")&&console.error(`%c[error] ${this.getCallerName()}
`,"color: red;",...e)}getCallerName(){var i;let e=(i=new Error().stack)==null?void 0:i.split(`
`),t=e==null?void 0:e.slice(3).find(s=>!s.includes("eval")&&!s.includes("Array.map"));if(t!=null&&t.startsWith("    at blob:"))return"child-thread";let r=t==null?void 0:t.match(/at (\S+)/);return r?`<${r[1]}> `:"failed to parse caller"}shouldLog(e){return this.levelWeights[e]>=this.levelWeights[this.logLevel]}},F=new Wo;var Jn=!1,Qn="This branch hasn't been implemented",ts="this branch shouldn't be reached by design",jt=class{static extractDomainFromHttpsUrl(e){if(e.startsWith("http://"))return F.error("Only support https, current url starts with http"),"";let t=/^(https?:\/\/)?([\w.-]+)(?:\/|$)/,r=e.match(t);return r&&r[2]?r[2]:""}static append(e,t){for(let r of t)e.push(r);return e}static mergeDeep(e,...t){if(!t.length)return e;let r=t.shift();if(Ko(e)&&Ko(r))for(let i in r)Ko(r[i])?(e[i]||Object.assign(e,{[i]:{}}),jt.mergeDeep(e[i],r[i])):Object.assign(e,{[i]:r[i]});return jt.mergeDeep(e,...t)}static getCurrLanguage(){let e=window.localStorage.getItem("language")||"en";return e in kr?kr[e]:"Other Language"}static sleep(e){return new Promise(t=>setTimeout(t,e))}};async function Oc(n,...e){let t=Date.now();await n(...e);let r=Date.now(),i=Rc(r-t);F.debug(`<${n.name.replace(/^bound /,"")}> Execution time: ${i}`)}function Be(n,e,t){let r=t.value;return t.value=function(...i){let s=Date.now(),o=r.apply(this,i),a=()=>{let l=Date.now();F.trace(`<${n.constructor.name}-${e}> Execution time: ${Rc(l-s)}`)};return o instanceof Promise?o.then(l=>(a(),l)):(a(),o)},t}function Rc(n){if(n<1e3)return`${n} ms`;if(n<6e4){let e=Math.floor(n/1e3),t=n%1e3;return`${e} s ${t} ms`}else{let e=Math.floor(n/6e4),t=Math.floor(n%6e4/1e3),r=n%1e3;return`${e} min ${t} s ${r} ms`}}function x(n){try{return kc.container.resolve(n)}catch(e){let t=`CleverSearch for developer:
There might be wrong usages for tsyringe:
1. Inject an instance for static field
2. Cycle dependencies without delay
3. Unknown error`;return F.warn(t),F.error(e),alert(t),-1}}function Ko(n){return n&&typeof n=="object"&&!Array.isArray(n)}var de=class{},Lc=window.localStorage.getItem("language")==="zh",Nc={customExtensions:{plaintext:["md"]},followObsidianExcludedFiles:!0,excludedPaths:[],logLevel:Jn?"trace":"info",isCaseSensitive:!1,isPrefixMatch:!0,isFuzzy:!0,enableStopWordsEn:!0,enableChinesePatch:!!Lc,enableStopWordsZh:!!Lc,apiProvider1:{domain:"",key:""},apiProvider2:{domain:"",key:""},ui:{openInNewPane:!0,maxItemResults:30,floatingWindowForInFile:!0,showedExtension:"except md",collapseDevSettingByDefault:!1,inFileFloatingWindowTop:"2.7em",inFileFloatingWindowLeft:"2.5em"},semantic:{isEnabled:!1,serverType:"local"}},jc={search:{fuzzyProportion:.2,minTermLengthForPrefixSearch:2,weightFilename:3,weightFolder:2,weightTagText:1.15,weightHeading:1.27}};var $c=require("obsidian");var Zn=require("obsidian");var Ce=class extends Zn.Notice{constructor(e,t=0){super(e+`
(clever-search)`,t)}},ns=class extends Zn.AbstractInputSuggest{constructor(t,r,i){super(x(Zn.App),t);this.inputEl=t;this.onSelectCb=i;this.content=r}getSuggestions(t){return[...this.content].filter(r=>r.toLowerCase().contains(t.toLowerCase()))}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t,r){this.onSelectCb(t),this.inputEl.value="",this.close()}},$o=class{},Ev=new $o;var Wc=require("obsidian");var yp=pe(require("fs")),vp=pe(require("path")),Bc=pe(_e());var er=yp,ke=vp,ye=class{static getBasename(e){return ke.basename(e,ke.extname(e))}static getExtension(e){return ke.extname(e).slice(1)}static getFolderPath(e){let t=ke.dirname(e);return t==="."||t===ke.sep||t==="/"?"./":t.replace(new RegExp("\\"+ke.sep,"g"),"/")+"/"}static countFileByExtensions(e){let t=new Map;e.forEach(i=>{let s=i.extension||"no_extension";t.set(s,(t.get(s)||0)+1)});let r=Object.fromEntries(t);return F.trace(r),r}};ye.SPLIT_EOL=`
`,ye.JOIN_EOL=`
`,ye=U([(0,Bc.singleton)()],ye);var zc=require("electron"),_p=(zc.app||zc.remote.app).getPath("userData"),bp=ke.join(_p,"clever-search"),Ho=ke.join(bp,"stop-words-en.txt"),qo={"Reindexing...":"Reindexing...","Indexing finished":"Indexing finished","files need to be indexed. Obsidian may freeze for a while":"files need to be indexed. Obsidian may freeze for a while","Omnisearch isn't installed":"Omnisearch isn't installed","Omnisearch is installed but not enabled":"Omnisearch is installed but not enabled","Database has been updated, a reindex is required":"Database has been updated, a reindex is required","Semantic init time":"The local model indexes at a speed of approximately 100-500 words per second. During this time, please do not close Obsidian.","Semantic init finished":"Semantic engine is ready","Downloading aiHelper":"Downloading clever-search-ai-helper.zip (972 MB)...","Download success":"Successfully downloaded","Download failure":"Failed to download clever-search-ai-helper.zip  ","Download manually":"Download manually","Max items count":"Max items count","Max items count desc":"Due to renderer's limited capabilities, this plugin can find thousands of results, but cannot display them all at once","Floating window for in-file search":"Floating window for in-file search","Floating window for in-file search desc":"Execute 'in-file search' command again will close the existing floating window. Disable this option to use classic modal UI","Case sensitive":"Case sensitive","Prefix match":"Prefix match","Character fuzzy allowed":"Character fuzzy allowed","English word blacklist":"English word blacklist","English word blacklist desc":`Exclude some meaningless English words like "do", "and", "them" from indexing, enhancing search and indexing speed. Modify the file at ${Ho} to tailor the list to your needs.`,"Chinese patch":"Chinese patch","Chinese patch desc":"Better search result for Chinese","Chinese word blacklist":"Chinese word blacklist","Chinese word blacklist desc":`Activates only if the Chinese Patch is enabled. This excludes some meaningless Chinese words like "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" listed in 'stop-words-zh.txt', improving search efficiency and speed. More details are listed in "English word blacklist" option`,Advanced:"Advanced","Advanced.desc":"The previous settings cover most needs. For further customization, adjust the following options","Semantic search":"Semantic search",Introduction:"Introduction","Introduction.desc":"Semantic search is only supported on the Windows system. It is only recommended for small and medium-sized vault. If a vault has more than 8 million words, the initial indexing may take dozens of hours. You need to extract the .cache folder from the downloaded archive and place it in C:\\Users\\<current user>. Then, run clever-search-ai-helper.exe to start the semantic engine. Semantic search is intended to complement lexical search and is not as effective in exact matching as lexical search.",Enable:"Enable","Server type":"Server type","Server type.desc":"For local server, Clever Search AI Helper needs to run in the background. For remote server, it will not be implemented in the short term.",local:"local",Utilities:"Utilities","Test connection":"Test connection",Download:"Download","Additional Information":"Additional Information","Additional Information.desc":"When semantic search is turned on and ai-helper is running, Reindex will be applied to both lexical and semantic engine; each time this plugin is loaded, the semantic engine will automatically perform an incremental index, and subsequent file modifications will not update the index to avoid blocking semantic search.","Excluded files":"Excluded files",Manage:"Manage","Follow Obsidian Excluded Files":"Follow Obsidian Excluded Files","Enter path...":"Enter path...",Add:"Add","Customize extensions":"Customize extensions","extensionModal.desc":"Customize the file extensions you would like to index. By default, file types not natively supported by Obsidian, such as 'txt', will be opened with an external program. To open these files within Obsidian, you may need to install plugins like 'obsidian-custom-file-extension-plugin' or 'obsidian-vscode-editor'.","extensionModal.plaintextName":"Plaintext","extensionModal.plaintextDesc":"Extensions should be separated by a space or a newline character. Please do not include binary filetypes like 'pdf', 'jpg', 'mp4', etc, that can't be opened with notepad. Including them might cause indexing issues. Additionally, the indexing and searching of HTML files may be slower because they require conversion to clean Markdown format first. Furthermore, due to the extremely limited API, it seems impossible to automatically scroll to specific locations within HTML files.","For Development":"For Development","Collapse development setting by default":"Collapse development setting by default","Reindex the vault":"Reindex the vault",Reindex:"Reindex","Log level":"Log level","Reset floating window position":"Reset floating window position","Reset floating window position desc":"In case the window is moved outside the visible area","Reset position":"Reset position","Support the Project":"Support the Project","Support the Project desc":"Enjoying this plugin? Show your support with a star on GitHub!","Visit GitHub":"Visit GitHub"};var Uc={"Reindexing...":"\u91CD\u5EFA\u7D22\u5F15\u4E2D...","Indexing finished":"\u7D22\u5F15\u5B8C\u6210","files need to be indexed. Obsidian may freeze for a while":"\u6587\u4EF6\u9700\u8981\u88AB\u7D22\u5F15, Obsidian \u53EF\u80FD\u4F1A\u5361\u987F\u4E00\u4F1A\u513F","Omnisearch isn't installed":"\u672A\u5B89\u88C5 Omnisearch","Omnisearch is installed but not enabled":"\u5B89\u88C5\u4E86 Omnisearch \u4F46\u662F\u6CA1\u6709\u542F\u7528","Database has been updated, a reindex is required":"\u6570\u636E\u5E93\u5DF2\u66F4\u65B0\uFF0C\u9700\u8981\u91CD\u5EFA\u7D22\u5F15","Semantic init time":"\u672C\u5730\u6A21\u578B\u7D22\u5F15\u901F\u5EA6\u5927\u7EA6\u662F 200-800 \u5B57\u6BCF\u79D2\uFF0C\u5728\u6B64\u671F\u95F4\u8BF7\u4E0D\u8981\u5173\u95ED Obsidian","Semantic init finished":"\u8BED\u4E49\u5F15\u64CE\u5DF2\u5C31\u7EEA","Downloading aiHelper":"\u6B63\u5728\u4E0B\u8F7D clever-search-ai-helper.zip (972 MB)...","Download success":"\u4E0B\u8F7D\u6210\u529F","Download failure":"clever-search-ai-helper.zip \u4E0B\u8F7D\u5931\u8D25  ","Download manually":"\u70B9\u6B64\u624B\u52A8\u4E0B\u8F7D","Max items count":"\u6700\u5927\u5019\u9009\u9879\u6570","Max items count desc":"\u867D\u7136\u672C\u63D2\u4EF6\u53EF\u4EE5\u641C\u7D22\u5230\u6210\u5343\u4E0A\u4E07\u4E2A\u7ED3\u679C\uFF0C\u4F46\u7531\u4E8E\u5E95\u5C42\u6E32\u67D3\u5668\u6027\u80FD\u9650\u5236\uFF0C\u4E0D\u80FD\u5373\u65F6\u6E32\u67D3\u6240\u6709\u7ED3\u679C","Floating window for in-file search":"\u6587\u4EF6\u5185\u641C\u7D22\u4F7F\u7528\u60AC\u6D6E\u7A97\u53E3 UI","Floating window for in-file search desc":"\u518D\u6B21\u6267\u884C '\u6587\u4EF6\u5185\u641C\u7D22' \u547D\u4EE4\u4F1A\u5173\u95ED\u5DF2\u6709\u7684\u60AC\u6D6E\u7A97\u53E3\u3002\u5173\u95ED\u8FD9\u4E2A\u9009\u9879\u5C06\u4F7F\u7528\u6A21\u6001\u6846 UI","Case sensitive":"\u533A\u5206\u5927\u5C0F\u5199","Prefix match":"\u5355\u8BCD\u524D\u7F00\u5339\u914D","Character fuzzy allowed":"\u5141\u8BB8\u5B57\u7B26\u6A21\u7CCA","English word blacklist":"\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355","English word blacklist desc":`\u5EFA\u7ACB\u7D22\u5F15\u65F6\uFF0C\u5FFD\u7565\u4E00\u4E9B\u542B\u4E49\u6A21\u7CCA\u7684\u5355\u8BCD\uFF0C\u6BD4\u5982 "do", "and", "them", \u53EF\u4EE5\u52A0\u5FEB\u7D22\u5F15\u548C\u641C\u7D22\u901F\u5EA6\uFF0C\u4F46\u662F\u8FD9\u4E9B\u5355\u8BCD\u4E0D\u4F1A\u88AB\u641C\u7D22\u5230. \u53EF\u4EE5\u5728 ${Ho} \u6309\u9700\u4FEE\u6539\u5355\u8BCD\u9ED1\u540D\u5355`,"Chinese patch":"\u4E2D\u6587\u641C\u7D22\u4F18\u5316","Chinese patch desc":"\u66F4\u597D\u7684\u4E2D\u6587\u641C\u7D22\u7ED3\u679C","Chinese word blacklist":"\u4E2D\u6587\u8BCD\u8BED\u9ED1\u540D\u5355","Chinese word blacklist desc":'\u53EA\u5728\u5F00\u542F\u4E2D\u6587\u641C\u7D22\u4F18\u5316\u65F6\u751F\u6548\u3002\u5FFD\u7565 "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" \u7B49\u8BCD\u8BED\uFF0C\u8BE6\u7EC6\u5217\u8868\u5728 "stop-words-zh.txt"\u3002\u8BE6\u89C1 "\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355" \u9009\u9879',Advanced:"\u8FDB\u9636\u8BBE\u7F6E","Advanced.desc":"\u4E4B\u524D\u7684\u8BBE\u7F6E\u901A\u5E38\u80FD\u6EE1\u8DB3\u5927\u591A\u6570\u4F7F\u7528\u573A\u666F\uFF0C\u5982\u679C\u4F60\u60F3\u6709\u66F4\u4E2A\u6027\u5316\u7684\u8BBE\u7F6E\uFF0C\u53EF\u4EE5\u8C03\u6574\u4E0B\u9762\u7684\u9009\u9879","Semantic search":"\u8BED\u4E49\u641C\u7D22",Introduction:"\u4ECB\u7ECD","Introduction.desc":"\u8BED\u4E49\u641C\u7D22\u53EA\u652F\u6301 Windows \u7CFB\u7EDF\u3002\u4EC5\u63A8\u8350\u4E2D\u5C0F\u578B\u8D44\u6599\u5E93\u4F7F\u7528, \u5982\u679C\u67D0\u4E2A\u4ED3\u5E93\u6709\u8D85\u8FC71500\u4E07\u5B57, \u521D\u6B21\u7D22\u5F15\u53EF\u80FD\u9700\u8981\u51E0\u5341\u4E2A\u5C0F\u65F6\u3002\u5C06\u4E0B\u8F7D\u7684\u538B\u7F29\u5305\u89E3\u538B\u51FA\u7684 .cache \u6587\u4EF6\u5939\u653E\u5728 C:\\Users\\<current user>, \u7136\u540E\u8FD0\u884C clever-search-ai-helper.exe \u6765\u542F\u52A8\u8BED\u4E49\u5F15\u64CE\u3002\u8BED\u4E49\u641C\u7D22\u65E8\u5728\u4F5C\u4E3A\u8BCD\u6C47\u641C\u7D22\u7684\u8865\u5145\uFF0C\u5728\u7CBE\u786E\u5339\u914D\u4E0A\u6548\u679C\u662F\u4E0D\u5982\u8BCD\u6C47\u641C\u7D22\u7684",Enable:"\u542F\u7528","Server type":"\u670D\u52A1\u5668\u7C7B\u578B","Server type.desc":"\u5BF9\u4E8E\u672C\u5730\u670D\u52A1\u5668\uFF0Cclever-search-ai-helper.exe \u9700\u8981\u5728\u540E\u53F0\u8FD0\u884C; \u8FDC\u7A0B\u670D\u52A1\u5668\u77ED\u671F\u5185\u4E0D\u4F1A\u5B9E\u73B0",local:"\u672C\u5730",Utilities:"\u5B9E\u7528\u529F\u80FD","Test connection":"\u6D4B\u8BD5\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Additional Information":"\u8865\u5145\u4FE1\u606F","Additional Information.desc":"\u5728\u5F00\u542F\u8BED\u4E49\u641C\u7D22\u5E76\u8FD0\u884C ai-helper \u7684\u60C5\u51B5\u4E0B\uFF0C\u91CD\u65B0\u7D22\u5F15 \u4F1A\u540C\u65F6\u5E94\u7528\u4E8E\u8BCD\u6C47\u5F15\u64CE\u548C\u8BED\u4E49\u5F15\u64CE\uFF1B\u6BCF\u6B21\u52A0\u8F7D\u63D2\u4EF6\u7684\u65F6\u5019\uFF0C\u8BED\u4E49\u5F15\u64CE\u4F1A\u81EA\u52A8\u8FDB\u884C\u4E00\u6B21\u589E\u91CF\u7D22\u5F15\uFF0C\u4E4B\u540E\u4FEE\u6539\u6587\u4EF6\u4E0D\u4F1A\u66F4\u65B0\u7D22\u5F15\u4EE5\u907F\u514D\u963B\u585E\u8BED\u4E49\u641C\u7D22\u3002","Excluded files":"\u5FFD\u7565\u6587\u4EF6",Manage:"\u7BA1\u7406","Follow Obsidian Excluded Files":"\u8DDF\u968F Obsidian \u5FFD\u7565\u6587\u4EF6\u8BBE\u7F6E","Enter path...":"\u8BF7\u8F93\u5165\u8DEF\u5F84...",Add:"\u6DFB\u52A0","Customize extensions":"\u81EA\u5B9A\u4E49\u540E\u7F00\u540D","extensionModal.desc":"\u81EA\u5B9A\u4E49\u5E0C\u671B\u7D22\u5F15\u7684\u6587\u4EF6\u540E\u7F00\u540D\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B Obsidian \u4E0D\u539F\u751F\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B\uFF0C\u5982 'txt'\uFF0C\u5C06\u901A\u8FC7\u5916\u90E8\u7A0B\u5E8F\u6253\u5F00\u3002\u8981\u5728 Obsidian \u5185\u6253\u5F00\u8FD9\u4E9B\u6587\u4EF6\uFF0C\u53EF\u80FD\u9700\u8981\u5B89\u88C5\u63D2\u4EF6\uFF0C\u5982 'obsidian-custom-file-extension-plugin' \u6216 'obsidian-vscode-editor'\u3002","extensionModal.plaintextName":"\u7EAF\u6587\u672C","extensionModal.plaintextDesc":"\u540E\u7F00\u540D\u4F7F\u7528\u7A7A\u683C\u6216\u6362\u884C\u7B26\u5206\u9694\u3002\u8BF7\u4E0D\u8981\u5728\u6B64\u5904\u5305\u542B 'pdf'\u3001'jpg'\u3001'mp4' \u7B49\u65E0\u6CD5\u7528\u8BB0\u4E8B\u672C\u6253\u5F00\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u7D22\u5F15\u95EE\u9898\u3002\u53E6\u5916\uFF0C\u7D22\u5F15\u548C\u641C\u7D22 HTML \u6587\u4EF6\u53EF\u80FD\u4F1A\u66F4\u6162\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u9996\u5148\u9700\u8981\u8F6C\u6362\u4E3A\u5E72\u51C0\u7684 Markdown \u683C\u5F0F\u3002\u6B64\u5916\uFF0C\u53D7 API \u9650\u5236, \u81EA\u52A8\u6EDA\u52A8\u5230 HTML \u6587\u4EF6\u4E2D\u7684\u7279\u5B9A\u4F4D\u7F6E\u4F3C\u4E4E\u4E0D\u53EF\u884C\u3002","For Development":"\u5F00\u53D1\u8BBE\u7F6E","Collapse development setting by default":"\u9ED8\u8BA4\u6298\u53E0\u5F00\u53D1\u8BBE\u7F6E","Reindex the vault":"\u91CD\u65B0\u7D22\u5F15\u5168\u5E93",Reindex:"\u91CD\u65B0\u7D22\u5F15","Log level":"\u65E5\u5FD7\u7B49\u7EA7","Reset floating window position":"\u91CD\u7F6E\u60AC\u6D6E\u7A97\u53E3\u4F4D\u7F6E","Reset floating window position desc":"\u5982\u679C\u7A97\u53E3\u88AB\u62D6\u5230\u770B\u4E0D\u89C1\u7684\u4F4D\u7F6E, \u53EF\u4EE5\u70B9\u6B64\u6309\u94AE\u91CD\u7F6E","Reset position":"\u91CD\u7F6E\u4F4D\u7F6E","Support the Project":"\u652F\u6301\u8FD9\u4E2A\u9879\u76EE","Support the Project desc":"\u5982\u679C\u89C9\u5F97\u672C\u63D2\u4EF6\u5BF9\u4F60\u6709\u5E2E\u52A9\uFF0C\u5E0C\u671B\u80FD\u5230 GitHub \u70B9\u4E2A star","Visit GitHub":"\u8BBF\u95EE GitHub"};var wp={en:qo,"zh-cn":Uc},Vc=wp[Wc.moment.locale()];function j(n){return Vc&&Vc[n]||qo[n]}var Hc=pe(_e());var Kc=require("electron"),xp=(Kc.app||Kc.remote.app).getPath("userData"),Qo=ke.join(xp,"clever-search"),Ep="https://bitbucket.org/alexclifton37/obsidian-clever-search/raw/dev/assets/for-program/",Tp="https://raw.githubusercontent.com/yan42685/obsidian-clever-search/dev/assets/for-program/",Sp="https://bitbucket.org/alexclifton37/shared-assets/raw/master/",Ap="https://unpkg.com/",Uv=Ap+"@dqbd/tiktoken@1.0.7/tiktoken_bg.wasm",Vv=ke.join(Qo,"tiktoken_bg.wasm"),Go="jieba_rs_wasm_bg.wasm",Xo="stop-words-en.txt",Yo="stop-words-zh.txt",Jo="clever-search-ai-helper.zip",rt=class{constructor(){this.setting=x(de);this._assets=Cp}get assets(){return this._assets}async initAsync(){F.trace("preparing assets..."),F.trace(`target dir: ${Qo}`);try{await this.initHelper(Ep)}catch(e){try{await this.initHelper(Tp),F.info("download successfully")}catch(t){throw F.warn("failed to download assets"),t}}}async downloadAiHelper(){let e=new Ce(j("Downloading aiHelper"));try{await this.downloadFile(this.targetPath(Jo),Sp+Jo),new Ce(j("Download success"),5e3);let{shell:t}=require("electron");t.showItemInFolder(this.targetPath(Jo)),t.openPath(require("os").userInfo().homedir)}catch(t){F.error(t);let r=document.createDocumentFragment(),i=document.createTextNode(j("Download failure")),s=document.createElement("button");s.textContent=j("Download manually"),s.onclick=()=>window.open("https://bitbucket.org/alexclifton37/shared-assets/raw/master/clever-search-ai-helper.zip"),r.appendChild(i),r.appendChild(s),new $c.Notice(r,0)}finally{e.hide()}}async initHelper(e){this.setting.enableChinesePatch&&(await this.downloadFile(this.targetPath(Go),e+Go),await this.downloadFile(this.targetPath(Yo),e+Yo),this._assets.jiebaBinary=er.promises.readFile(this.targetPath(Go)),this._assets.stopWordsZh=await this.readLinesAsSet(this.targetPath(Yo))),await this.downloadFile(this.targetPath(Xo),e+Xo),this._assets.stopWordsEn=await this.readLinesAsSet(this.targetPath(Xo))}targetPath(e){return ke.join(Qo,e)}async readLinesAsSet(e){return new Set((await er.promises.readFile(e,{encoding:"utf-8"})).split(ye.SPLIT_EOL))}async downloadFile(e,t){try{await er.promises.access(e),F.trace("file exists:",e);return}catch(s){if(s.code!=="ENOENT")throw s}let r=ke.dirname(e);await er.promises.mkdir(r,{recursive:!0}).catch(s=>{if(s.code!=="EEXIST")throw s});let i=await fetch(t);if(!i.ok)throw new Error(`unexpected response ${i.statusText}`);try{await er.promises.writeFile(e,Buffer.from(await i.arrayBuffer()),"utf-8"),F.info(`successfully download from ${t}`)}catch(s){throw F.error(`failed to download ${t}`),s}}};rt=U([(0,Hc.singleton)()],rt);var Cp={stopWordsZh:null,stopWordsEn:null,jiebaBinary:new Promise(()=>null)};var qc=pe(_e());var It=class{constructor(){this.isReady=!1;this.reportedError=!1}async initAsync(){if(x(de).enableChinesePatch){let e=x(rt).assets.jiebaBinary;await Dc(e),Vo("",!1),this.isReady=!0}}cut(e,t){return!this.isReady&&!this.reportedError?(F.error("jieba segmenter isn't ready"),this.reportedError=!0,[e]):Vo(e,t)}};It=U([(0,qc.singleton)()],It);var be=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,Fe=Object.keys,Ue=Array.isArray;typeof Promise!="undefined"&&!be.Promise&&(be.Promise=Promise);function Ye(n,e){return typeof e!="object"||Fe(e).forEach(function(t){n[t]=e[t]}),n}var zr=Object.getPrototypeOf,Fp={}.hasOwnProperty;function dt(n,e){return Fp.call(n,e)}function sr(n,e){typeof e=="function"&&(e=e(zr(n))),(typeof Reflect=="undefined"?Fe:Reflect.ownKeys)(e).forEach(t=>{Zt(n,t,e[t])})}var ou=Object.defineProperty;function Zt(n,e,t,r){ou(n,e,Ye(t&&dt(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function or(n){return{from:function(e){return n.prototype=Object.create(e.prototype),Zt(n.prototype,"constructor",n),{extend:sr.bind(null,n.prototype)}}}}var Ip=Object.getOwnPropertyDescriptor;function ka(n,e){let t=Ip(n,e),r;return t||(r=zr(n))&&ka(r,e)}var Pp=[].slice;function Ts(n,e,t){return Pp.call(n,e,t)}function au(n,e){return e(n)}function Rr(n){if(!n)throw new Error("Assertion Failed")}function lu(n){be.setImmediate?setImmediate(n):setTimeout(n,0)}function cu(n,e){return n.reduce((t,r,i)=>{var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function Mp(n,e,t){try{n.apply(null,t)}catch(r){e&&e(r)}}function Qt(n,e){if(typeof e=="string"&&dt(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=Qt(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a==null?void 0:Qt(a,e.substr(o+1))}}function Pt(n,e,t){if(!(!n||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){Rr(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)Pt(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")t===void 0?Ue(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var l=n[o];(!l||!dt(n,o))&&(l=n[o]={}),Pt(l,a,t)}}else t===void 0?Ue(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function Dp(n,e){typeof e=="string"?Pt(n,e,void 0):"length"in e&&[].map.call(e,function(t){Pt(n,t,void 0)})}function uu(n){var e={};for(var t in n)dt(n,t)&&(e[t]=n[t]);return e}var kp=[].concat;function fu(n){return kp.apply([],n)}var du="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(fu([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>be[n]),Op=du.map(n=>be[n]);cu(du,n=>[n,!0]);var sn=null;function qr(n){sn=typeof WeakMap!="undefined"&&new WeakMap;let e=sa(n);return sn=null,e}function sa(n){if(!n||typeof n!="object")return n;let e=sn&&sn.get(n);if(e)return e;if(Ue(n)){e=[],sn&&sn.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(sa(n[t]))}else if(Op.indexOf(n.constructor)>=0)e=n;else{let s=zr(n);e=s===Object.prototype?{}:Object.create(s),sn&&sn.set(n,e);for(var i in n)dt(n,i)&&(e[i]=sa(n[i]))}return e}var{toString:Rp}={};function oa(n){return Rp.call(n).slice(8,-1)}var aa=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Lp=typeof aa=="symbol"?function(n){var e;return n!=null&&(e=n[aa])&&e.apply(n)}:function(){return null},rr={};function Yt(n){var e,t,r,i;if(arguments.length===1){if(Ue(n))return n.slice();if(this===rr&&typeof n=="string")return[n];if(i=Lp(n)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(n==null)return[n];if(e=n.length,typeof e=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}var Oa=typeof Symbol!="undefined"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1,zt=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function hu(n,e){zt=n,pu=e}var pu=()=>!0,Np=!new Error("").stack;function On(){if(Np)try{throw On.arguments,new Error}catch(n){return n}return new Error}function la(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(pu).map(r=>`
`+r).join("")):""}var jp=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],mu=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ra=jp.concat(mu),Bp={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ar(n,e){this._e=On(),this.name=n,this.message=e}or(ar).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+la(this._e,2))}},toString:function(){return this.name+": "+this.message}});function gu(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,r,i)=>i.indexOf(t)===r).join(`
`)}function ps(n,e,t,r){this._e=On(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=gu(n,e)}or(ps).from(ar);function Nr(n,e){this._e=On(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=gu(n,e)}or(Nr).from(ar);var La=Ra.reduce((n,e)=>(n[e]=e+"Error",n),{}),zp=ar,J=Ra.reduce((n,e)=>{var t=e+"Error";function r(i,s){this._e=On(),this.name=t,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Bp[e]||t,this.inner=null)}return or(r).from(zp),n[e]=r,n},{});J.Syntax=SyntaxError;J.Type=TypeError;J.Range=RangeError;var Gc=mu.reduce((n,e)=>(n[e+"Error"]=J[e],n),{});function Up(n,e){if(!n||n instanceof ar||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Gc[n.name])return n;var t=new Gc[n.name](e||n.message,n);return"stack"in n&&Zt(t,"stack",{get:function(){return this.inner.stack}}),t}var Ss=Ra.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=J[e]),n),{});Ss.ModifyError=ps;Ss.DexieError=ar;Ss.BulkError=Nr;function me(){}function Gr(n){return n}function Vp(n,e){return n==null||n===Gr?e:function(t){return e(n(t))}}function Dn(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function Wp(n,e){return n===me?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Dn(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Dn(i,this.onerror):i),s!==void 0?s:t}}function Kp(n,e){return n===me?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?Dn(t,this.onsuccess):t),r&&(this.onerror=this.onerror?Dn(r,this.onerror):r)}}function $p(n,e){return n===me?e:function(t){var r=n.apply(this,arguments);Ye(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Dn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Dn(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Ye(r,o)}}function Hp(n,e){return n===me?e:function(){return e.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function Na(n,e){return n===me?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var Ur={},qp=100,Gp=20,yu=100,[ca,ms,ua]=typeof Promise=="undefined"?[]:(()=>{let n=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[n,zr(n),n];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,zr(e),n]})(),vu=ms&&ms.then,ls=ca&&ca.constructor,ja=!!ua,fa=!1,Xp=ua?()=>{ua.then(rs)}:be.setImmediate?setImmediate.bind(null,rs):be.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{rs(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(rs,0)},Vr=function(n,e){Lr.push([n,e]),gs&&(Xp(),gs=!1)},da=!0,gs=!0,Pn=[],cs=[],ha=null,pa=Gr,ir={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Jc,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{Jc(n[0],n[1])}catch(e){}})}},G=ir,Lr=[],Mn=0,us=[];function N(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=me,this._lib=!1;var e=this._PSD=G;if(zt&&(this._stackHolder=On(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==Ur)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&ga(this,this._value);return}this._state=null,this._value=null,++e.ref,bu(this,n)}var ma={get:function(){var n=G,e=ys;function t(r,i){var s=!n.global&&(n!==G||e!==ys);let o=s&&!en();var a=new N((l,c)=>{Ba(this,new _u(_s(r,n,s,o),_s(i,n,s,o),l,c,n))});return zt&&Eu(a,this),a}return t.prototype=Ur,t},set:function(n){Zt(this,"then",n&&n.prototype===Ur?ma:{get:function(){return n},set:ma.set})}};sr(N.prototype,{then:ma,_then:function(n,e){Ba(this,new _u(null,null,n,e,G))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?t(r):fs(r)):this.then(null,r=>r&&r.name===e?t(r):fs(r))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),fs(e)))},stack:{get:function(){if(this._stack)return this._stack;try{fa=!0;var n=xu(this,[],Gp),e=n.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{fa=!1}}},timeout:function(n,e){return n<1/0?new N((t,r)=>{var i=setTimeout(()=>r(new J.Timeout(e)),n);this.then(t,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Zt(N.prototype,Symbol.toStringTag,"Dexie.Promise");ir.env=Tu();function _u(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}sr(N,{all:function(){var n=Yt.apply(null,arguments).map(vs);return new N(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach((i,s)=>N.resolve(i).then(o=>{n[s]=o,--r||e(n)},t))})},resolve:n=>{if(n instanceof N)return n;if(n&&typeof n.then=="function")return new N((t,r)=>{n.then(t,r)});var e=new N(Ur,!0,n);return Eu(e,ha),e},reject:fs,race:function(){var n=Yt.apply(null,arguments).map(vs);return new N((e,t)=>{n.map(r=>N.resolve(r).then(e,t))})},PSD:{get:()=>G,set:n=>G=n},totalEchoes:{get:()=>ys},newPSD:an,usePSD:cr,scheduler:{get:()=>Vr,set:n=>{Vr=n}},rejectionMapper:{get:()=>pa,set:n=>{pa=n}},follow:(n,e)=>new N((t,r)=>an((i,s)=>{var o=G;o.unhandleds=[],o.onunhandled=s,o.finalize=Dn(function(){Jp(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),n()},e,t,r))});ls&&(ls.allSettled&&Zt(N,"allSettled",function(){let n=Yt.apply(null,arguments).map(vs);return new N(e=>{n.length===0&&e([]);let t=n.length,r=new Array(t);n.forEach((i,s)=>N.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--t||e(r)))})}),ls.any&&typeof AggregateError!="undefined"&&Zt(N,"any",function(){let n=Yt.apply(null,arguments).map(vs);return new N((e,t)=>{n.length===0&&t(new AggregateError([]));let r=n.length,i=new Array(r);n.forEach((s,o)=>N.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||t(new AggregateError(i))}))})}));function bu(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&Xr();t&&typeof t.then=="function"?bu(n,(i,s)=>{t instanceof N?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,wu(n)),r&&Yr()}},ga.bind(null,n))}catch(t){ga(n,t)}}function ga(n,e){if(cs.push(e),n._state===null){var t=n._lib&&Xr();e=pa(e),n._state=!1,n._value=e,zt&&e!==null&&typeof e=="object"&&!e._promise&&Mp(()=>{var r=ka(e,"stack");e._promise=n,Zt(e,"stack",{get:()=>fa?r&&(r.get?r.get.apply(e):r.value):n.stack})}),Qp(n),wu(n),t&&Yr()}}function wu(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)Ba(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),Mn===0&&(++Mn,Vr(()=>{--Mn===0&&za()},[]))}function Ba(n,e){if(n._state===null){n._listeners.push(e);return}var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++Mn,Vr(Yp,[t,n,e])}function Yp(n,e,t){try{ha=e;var r,i=e._value;e._state?r=n(i):(cs.length&&(cs=[]),r=n(i),cs.indexOf(i)===-1&&Zp(e)),t.resolve(r)}catch(s){t.reject(s)}finally{ha=null,--Mn===0&&za(),--t.psd.ref||t.psd.finalize()}}function xu(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i=n._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=la(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return zt&&(r=la(n._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),n._prev&&xu(n._prev,e,t)),e}function Eu(n,e){var t=e?e._numPrev+1:0;t<qp&&(n._prev=e,n._numPrev=t)}function rs(){Xr()&&Yr()}function Xr(){var n=da;return da=!1,gs=!1,n}function Yr(){var n,e,t;do for(;Lr.length>0;)for(n=Lr,Lr=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(Lr.length>0);da=!0,gs=!0}function za(){var n=Pn;Pn=[],n.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=us.slice(0),t=e.length;t;)e[--t]()}function Jp(n){function e(){n(),us.splice(us.indexOf(e),1)}us.push(e),++Mn,Vr(()=>{--Mn===0&&za()},[])}function Qp(n){Pn.some(e=>e._value===n._value)||Pn.push(n)}function Zp(n){for(var e=Pn.length;e;)if(Pn[--e]._value===n._value){Pn.splice(e,1);return}}function fs(n){return new N(Ur,!1,n)}function xe(n,e){var t=G;return function(){var r=Xr(),i=G;try{return ln(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{ln(i,!1),r&&Yr()}}}var ze={awaits:0,echoes:0,id:0},em=0,ds=[],Zo=0,ys=0,tm=0;function an(n,e,t,r){var i=G,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++tm;var o=ir.env;s.env=ja?{Promise:N,PromiseProp:{value:N,configurable:!0,writable:!0},all:N.all,race:N.race,allSettled:N.allSettled,any:N.any,resolve:N.resolve,reject:N.reject,nthen:Xc(o.nthen,s),gthen:Xc(o.gthen,s)}:{},e&&Ye(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=cr(s,n,t,r);return s.ref===0&&s.finalize(),a}function lr(){return ze.id||(ze.id=++em),++ze.awaits,ze.echoes+=yu,ze.id}function en(){return ze.awaits?(--ze.awaits===0&&(ze.id=0),ze.echoes=ze.awaits*yu,!0):!1}(""+vu).indexOf("[native code]")===-1&&(lr=en=me);function vs(n){return ze.echoes&&n&&n.constructor===ls?(lr(),n.then(e=>(en(),e),e=>(en(),Me(e)))):n}function nm(n){++ys,(!ze.echoes||--ze.echoes===0)&&(ze.echoes=ze.id=0),ds.push(G),ln(n,!0)}function rm(){var n=ds[ds.length-1];ds.pop(),ln(n,!1)}function ln(n,e){var t=G;if((e?ze.echoes&&(!Zo++||n!==G):Zo&&(!--Zo||n!==G))&&Su(e?nm.bind(null,n):rm),n!==G&&(G=n,t===ir&&(ir.env=Tu()),ja)){var r=ir.env.Promise,i=n.env;ms.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(be,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Tu(){var n=be.Promise;return ja?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(be,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:ms.then,gthen:n.prototype.then}:{}}function cr(n,e,t,r,i){var s=G;try{return ln(n,!0),e(t,r,i)}finally{ln(s,!1)}}function Su(n){vu.call(ca,n)}function _s(n,e,t,r){return typeof n!="function"?n:function(){var i=G;t&&lr(),ln(e,!0);try{return n.apply(this,arguments)}finally{ln(i,!1),r&&Su(en)}}}function Xc(n,e){return function(t,r){return n.call(this,_s(t,e),_s(r,e))}}var Yc="unhandledrejection";function Jc(n,e){var t;try{t=e.onuncatched(n)}catch(s){}if(t!==!1)try{var r,i={promise:e,reason:n};if(be.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Yc,!0,!0),Ye(r,i)):be.CustomEvent&&(r=new CustomEvent(Yc,{detail:i}),Ye(r,i)),r&&be.dispatchEvent&&(dispatchEvent(r),!be.PromiseRejectionEvent&&be.onunhandledrejection))try{be.onunhandledrejection(r)}catch(s){}zt&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch(s){}}var Me=N.reject;function ya(n,e,t,r){if(!n.idbdb||!n._state.openComplete&&!G.letThrough&&!n._vip){if(n._state.openComplete)return Me(new J.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return Me(new J.DatabaseClosed);n.open().catch(me)}return n._state.dbReadyPromise.then(()=>ya(n,e,t,r))}else{var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(s){return s.name===La.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>ya(n,e,t,r))):Me(s)}return i._promise(e,(s,o)=>an(()=>(G.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var Qc="3.2.7",In=String.fromCharCode(65535),va=-1/0,Gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Au="String expected.",jr=[],As=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),im=As,sm=As,Cu=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),Cs="__dbnames",ea="readonly",ta="readwrite";function kn(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}var Fu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function is(n){return typeof n=="string"&&!/\./.test(n)?e=>(e[n]===void 0&&n in e&&(e=qr(e),delete e[n]),e):e=>e}var _a=class{_trans(e,t,r){let i=this._tx||G.trans,s=this.name;function o(l,c,u){if(!u.schema[s])throw new J.NotFound("Table "+s+" not part of transaction");return t(u.idbtrans,u)}let a=Xr();try{return i&&i.db===this.db?i===G.trans?i._promise(e,o,r):an(()=>i._promise(e,o,r),{trans:i,transless:G.transless||G}):ya(this.db,e,[this.name],o)}finally{a&&Yr()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ue(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let t=Fe(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);let r=this.schema.indexes.concat(this.schema.primKey).filter(c=>{if(c.compound&&t.every(u=>c.keyPath.indexOf(u)>=0)){for(let u=0;u<t.length;++u)if(t.indexOf(c.keyPath[u])===-1)return!1;return!0}return!1}).sort((c,u)=>c.keyPath.length-u.keyPath.length)[0];if(r&&this.db._maxKey!==In){let c=r.keyPath.slice(0,t.length);return this.where(c).equals(c.map(u=>e[u]))}!r&&zt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(c,u){try{return s.cmp(c,u)===0}catch(h){return!1}}let[a,l]=t.reduce(([c,u],h)=>{let f=i[h],d=e[h];return[c||f,c||!f?kn(u,f&&f.multi?m=>{let p=Qt(m,h);return Ue(p)&&p.some(g=>o(d,g))}:m=>o(d,Qt(m,h))):u]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ue(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let t=r=>{if(!r)return r;let i=Object.create(e.prototype);for(var s in r)if(dt(r,s))try{i[s]=r[s]}catch(o){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){function e(t){Ye(this,t)}return this.mapToClass(e)}add(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=is(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[s]})).then(o=>o.numFailures?N.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Pt(e,i,o)}catch(a){}return o})}update(e,t){if(typeof e=="object"&&!Ue(e)){let r=Qt(e,this.schema.primKey.keyPath);if(r===void 0)return Me(new J.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?Fe(t).forEach(i=>{Pt(e,i,t[i])}):t(e,{value:e,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(e).modify(t)}put(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=is(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:t!=null?[t]:null})).then(o=>o.numFailures?N.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{Pt(e,i,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?N.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Fu})).then(e=>e.numFailures?N.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");let c=e.length,u=l&&a?e.map(is(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:u,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:m})=>{let p=s?f:d;if(h===0)return p;throw new Nr(`${this.name}.bulkAdd(): ${h} of ${c} operations failed`,m)})})}bulkPut(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");let c=e.length,u=l&&a?e.map(is(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:u,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:m})=>{let p=s?f:d;if(h===0)return p;throw new Nr(`${this.name}.bulkPut(): ${h} of ${c} operations failed`,m)})})}bulkDelete(e){let t=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new Nr(`${this.name}.bulkDelete(): ${r} of ${t} operations failed`,s)})}};function Jr(n){var e={},t=function(a,l){if(l){for(var c=arguments.length,u=new Array(c-1);--c;)u[c-1]=arguments[c];return e[a].subscribe.apply(null,u),n}else if(typeof a=="string")return e[a]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(a,l,c){if(typeof a=="object")return o(a);l||(l=Hp),c||(c=me);var u={subscribers:[],fire:c,subscribe:function(h){u.subscribers.indexOf(h)===-1&&(u.subscribers.push(h),u.fire=l(u.fire,h))},unsubscribe:function(h){u.subscribers=u.subscribers.filter(function(f){return f!==h}),u.fire=u.subscribers.reduce(l,c)}};return e[a]=t[a]=u,u}function o(a){Fe(a).forEach(function(l){var c=a[l];if(Ue(c))s(l,a[l][0],a[l][1]);else if(c==="asap")var u=s(l,Gr,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];u.subscribers.forEach(function(m){lu(function(){m.apply(null,d)})})});else throw new J.InvalidArgument("Invalid event config")})}}function Qr(n,e){return or(e).from({prototype:n}),e}function om(n){return Qr(_a.prototype,function(t,r,i){this.db=n,this._tx=i,this.name=t,this.schema=r,this.hook=n._allTables[t]?n._allTables[t].hook:Jr(null,{creating:[Wp,me],reading:[Vp,Gr],updating:[$p,me],deleting:[Kp,me]})})}function tr(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function na(n,e){n.filter=kn(n.filter,e)}function ra(n,e,t){var r=n.replayFilter;n.replayFilter=r?()=>kn(r(),e()):e,n.justLimit=t&&!r}function am(n,e){n.isMatch=kn(n.isMatch,e)}function hs(n,e){if(n.isPrimKey)return e.primaryKey;let t=e.getIndexByKeyPath(n.index);if(!t)throw new J.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function Zc(n,e,t){let r=hs(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function ss(n,e,t,r){let i=n.replayFilter?kn(n.filter,n.replayFilter()):n.filter;if(n.or){let s={},o=(a,l,c)=>{if(!i||i(l,c,f=>l.stop(f),f=>l.fail(f))){var u=l.primaryKey,h=""+u;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(u)),dt(s,h)||(s[h]=!0,e(a,l,c))}};return Promise.all([n.or._iterate(o,t),eu(Zc(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}else return eu(Zc(n,r,t),kn(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function eu(n,e,t,r){var i=r?(o,a,l)=>t(r(o),a,l):t,s=xe(i);return n.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=me},l=>{o.fail(l),a=me}))&&s(o.value,o,l=>a=l),a()})})}function Xe(n,e){try{let t=tu(n),r=tu(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return cm(nu(n),nu(e));case"Array":return lm(n,e)}}catch(t){}return NaN}function lm(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s){let o=Xe(n[s],e[s]);if(o!==0)return o}return t===r?0:t<r?-1:1}function cm(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s)if(n[s]!==e[s])return n[s]<e[s]?-1:1;return t===r?0:t<r?-1:1}function tu(n){let e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";let t=oa(n);return t==="ArrayBuffer"?"binary":t}function nu(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var ba=class{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,Me.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Me.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=kn(t.algorithm,e)}_iterate(e,t){return ss(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Ye(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(r=>ss(t,e,r,t.table.core))}count(e){return this._read(t=>{let r=this._ctx,i=r.table.core;if(tr(r,!0))return i.count({trans:t,query:{index:hs(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return ss(r,()=>(++s,!1),t,i).then(()=>s)}).then(e)}sortBy(e,t){let r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(c,u){return u?o(c[r[u]],u-1):c[i]}var a=this._ctx.dir==="next"?1:-1;function l(c,u){var h=o(c,s),f=o(u,s);return h<f?-a:h>f?a:0}return this.toArray(function(c){return c.sort(l)}).then(t)}toArray(e){return this._read(t=>{var r=this._ctx;if(r.dir==="next"&&tr(r,!0)&&r.limit>0){let{valueMapper:i}=r,s=hs(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return ss(r,s=>i.push(s),t,r.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0?this:(t.offset+=e,tr(t)?ra(t,()=>{var r=e;return(i,s)=>r===0?!0:r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1)}):ra(t,()=>{var r=e;return()=>--r<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ra(this._ctx,()=>{var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this}until(e,t){return na(this._ctx,function(r,i,s){return e(r.value)?(i(s),t):!0}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return na(this._ctx,function(t){return e(t.value)}),am(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&tr(t,!0)&&t.limit>0)return this._read(i=>{var s=hs(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return na(this._ctx,function(i){var s=i.primaryKey.toString(),o=dt(r,s);return r[s]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=Fe(e),o=s.length;i=function(p){for(var g=!1,v=0;v<o;++v){var w=s[v],E=e[w];Qt(p,w)!==E&&(Pt(p,w,E),g=!0)}return g}}let a=t.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,u=this.db._options.modifyChunkSize||200,h=[],f=0,d=[],m=(p,g)=>{let{failures:v,numFailures:w}=g;f+=p-w;for(let E of Fe(v))h.push(v[E])};return this.clone().primaryKeys().then(p=>{let g=v=>{let w=Math.min(u,p.length-v);return a.getMany({trans:r,keys:p.slice(v,v+w),cache:"immutable"}).then(E=>{let b=[],S=[],A=l?[]:null,I=[];for(let O=0;O<w;++O){let z=E[O],D={value:qr(z),primKey:p[v+O]};i.call(D,D.value,D)!==!1&&(D.value==null?I.push(p[v+O]):!l&&Xe(c(z),c(D.value))!==0?(I.push(p[v+O]),b.push(D.value)):(S.push(D.value),l&&A.push(p[v+O])))}let P=tr(t)&&t.limit===1/0&&(typeof e!="function"||e===ia)&&{index:t.index,range:t.range};return Promise.resolve(b.length>0&&a.mutate({trans:r,type:"add",values:b}).then(O=>{for(let z in O.failures)I.splice(parseInt(z),1);m(b.length,O)})).then(()=>(S.length>0||P&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:A,values:S,criteria:P,changeSpec:typeof e!="function"&&e}).then(O=>m(S.length,O))).then(()=>(I.length>0||P&&e===ia)&&a.mutate({trans:r,type:"delete",keys:I,criteria:P}).then(O=>m(I.length,O))).then(()=>p.length>v+w&&g(v+u))})};return g(0).then(()=>{if(h.length>0)throw new ps("Error modifying one or more objects",h,f,d);return p.length})})})}delete(){var e=this._ctx,t=e.range;return tr(e)&&(e.isPrimKey&&!sm||t.type===3)?this._write(r=>{let{primaryKey:i}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:c,numFailures:u})=>{if(u)throw new ps("Could not delete some values",Object.keys(a).map(h=>a[h]),o-u);return o-u}))}):this.modify(ia)}},ia=(n,e)=>e.value=null;function um(n){return Qr(ba.prototype,function(t,r){this.db=n;let i=Fu,s=null;if(r)try{i=r()}catch(c){s=c}let o=t._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==Gr?l:null}})}function fm(n,e){return n<e?-1:n===e?0:1}function dm(n,e){return n>e?-1:n===e?0:1}function ft(n,e,t){var r=n instanceof bs?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function nr(n){return new n.Collection(n,()=>Iu("")).limit(0)}function hm(n){return n==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function pm(n){return n==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function mm(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),a=-1,l=0;l<o;++l){var c=e[l];if(c!==r[l])return i(n[l],t[l])<0?n.substr(0,l)+t[l]+t.substr(l+1):i(n[l],r[l])<0?n.substr(0,l)+r[l]+t.substr(l+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;i(n[l],c)<0&&(a=l)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+r[a]+t.substr(a+1)}function os(n,e,t,r){var i,s,o,a,l,c,u,h=t.length;if(!t.every(p=>typeof p=="string"))return ft(n,Au);function f(p){i=hm(p),s=pm(p),o=p==="next"?fm:dm;var g=t.map(function(v){return{lower:s(v),upper:i(v)}}).sort(function(v,w){return o(v.lower,w.lower)});a=g.map(function(v){return v.upper}),l=g.map(function(v){return v.lower}),c=p,u=p==="next"?"":r}f("next");var d=new n.Collection(n,()=>rn(a[0],l[h-1]+r));d._ondirectionchange=function(p){f(p)};var m=0;return d._addAlgorithm(function(p,g,v){var w=p.key;if(typeof w!="string")return!1;var E=s(w);if(e(E,l,m))return!0;for(var b=null,S=m;S<h;++S){var A=mm(w,E,a[S],l[S],o,c);A===null&&b===null?m=S+1:(b===null||o(b,A)>0)&&(b=A)}return g(b!==null?function(){p.continue(b+u)}:v),!1}),d}function rn(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function Iu(n){return{type:1,lower:n,upper:n}}var bs=class{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&!(r&&i)?nr(this):new this.Collection(this,()=>rn(e,t,!r,!i))}catch(s){return ft(this,Gt)}}equals(e){return e==null?ft(this,Gt):new this.Collection(this,()=>Iu(e))}above(e){return e==null?ft(this,Gt):new this.Collection(this,()=>rn(e,void 0,!0))}aboveOrEqual(e){return e==null?ft(this,Gt):new this.Collection(this,()=>rn(e,void 0,!1))}below(e){return e==null?ft(this,Gt):new this.Collection(this,()=>rn(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ft(this,Gt):new this.Collection(this,()=>rn(void 0,e))}startsWith(e){return typeof e!="string"?ft(this,Au):this.between(e,e+In,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):os(this,(t,r)=>t.indexOf(r[0])===0,[e],In)}equalsIgnoreCase(e){return os(this,(t,r)=>t===r[0],[e],"")}anyOfIgnoreCase(){var e=Yt.apply(rr,arguments);return e.length===0?nr(this):os(this,(t,r)=>r.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Yt.apply(rr,arguments);return e.length===0?nr(this):os(this,(t,r)=>r.some(i=>t.indexOf(i)===0),e,In)}anyOf(){let e=Yt.apply(rr,arguments),t=this._cmp;try{e.sort(t)}catch(s){return ft(this,Gt)}if(e.length===0)return nr(this);let r=new this.Collection(this,()=>rn(e[0],e[e.length-1]));r._ondirectionchange=s=>{t=s==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return r._addAlgorithm((s,o,a)=>{let l=s.key;for(;t(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return t(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[va,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=Yt.apply(rr,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return ft(this,Gt)}let t=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[va,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){let r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return nr(this);if(!e.every(b=>b[0]!==void 0&&b[1]!==void 0&&i(b[0],b[1])<=0))return ft(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);let l=!t||t.includeLowers!==!1,c=t&&t.includeUppers===!0;function u(b,S){let A=0,I=b.length;for(;A<I;++A){let P=b[A];if(r(S[0],P[1])<0&&r(S[1],P[0])>0){P[0]=o(P[0],S[0]),P[1]=a(P[1],S[1]);break}}return A===I&&b.push(S),b}let h=i;function f(b,S){return h(b[0],S[0])}let d;try{d=e.reduce(u,[]),d.sort(f)}catch(b){return ft(this,Gt)}let m=0,p=c?b=>i(b,d[m][1])>0:b=>i(b,d[m][1])>=0,g=l?b=>s(b,d[m][0])>0:b=>s(b,d[m][0])>=0;function v(b){return!p(b)&&!g(b)}let w=p,E=new this.Collection(this,()=>rn(d[0][0],d[d.length-1][1],!l,!c));return E._ondirectionchange=b=>{b==="next"?(w=p,h=i):(w=g,h=s),d.sort(f)},E._addAlgorithm((b,S,A)=>{for(var I=b.key;w(I);)if(++m,m===d.length)return S(A),!1;return v(I)?!0:(this._cmp(I,d[m][1])===0||this._cmp(I,d[m][0])===0||S(()=>{h===i?b.continue(d[m][0]):b.continue(d[m][1])}),!1)}),E}startsWithAnyOf(){let e=Yt.apply(rr,arguments);return e.every(t=>typeof t=="string")?e.length===0?nr(this):this.inAnyRange(e.map(t=>[t,t+In])):ft(this,"startsWithAnyOf() only works with strings")}};function gm(n){return Qr(bs.prototype,function(t,r,i){this.db=n,this._ctx={table:t,index:r===":id"?null:r,or:i};let s=n._deps.indexedDB;if(!s)throw new J.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=n._deps.IDBKeyRange})}function Bt(n){return xe(function(e){return Wr(e),n(e.target.error),!1})}function Wr(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Kr="storagemutated",on="x-storagemutated-1",cn=Jr(null,Kr),wa=class{_lock(){return Rr(!G.global),++this._reculock,this._reculock===1&&!G.global&&(G.lockOwnerFor=this),this}_unlock(){if(Rr(!G.global),--this._reculock===0)for(G.global||(G.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{cr(e[1],e[0])}catch(t){}}return this}_locked(){return this._reculock&&G.lockOwnerFor!==this}create(e){if(!this.mode)return this;let t=this.db.idbdb,r=this.db._state.dbOpenError;if(Rr(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new J.DatabaseClosed(r);case"MissingAPIError":throw new J.MissingAPI(r.message,r);default:throw new J.OpenFailed(r)}if(!this.active)throw new J.TransactionInactive;return Rr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=xe(i=>{Wr(i),this._reject(e.error)}),e.onabort=xe(i=>{Wr(i),this.active&&this._reject(new J.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=xe(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&cn.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,r){if(e==="readwrite"&&this.mode!=="readwrite")return Me(new J.ReadOnly("Transaction is readonly"));if(!this.active)return Me(new J.TransactionInactive);if(this._locked())return new N((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(s,o)},G])});if(r)return an(()=>{var s=new N((o,a)=>{this._lock();let l=t(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new N((s,o)=>{var a=t(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();let r=N.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>r);else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new N((o,a)=>{r.then(l=>t._waitingQueue.push(xe(o.bind(null,l))),l=>t._waitingQueue.push(xe(a.bind(null,l)))).finally(()=>{t._waitingFor===s&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))}table(e){let t=this._memoizedTables||(this._memoizedTables={});if(dt(t,e))return t[e];let r=this.schema[e];if(!r)throw new J.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i}};function ym(n){return Qr(wa.prototype,function(t,r,i,s,o){this.db=n,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Jr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new N((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),Me(a)})})}function xa(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Pu(e)}}function Pu(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Mu(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:cu(t,r=>[r.name,r])}}function vm(n){return n.length===1?n[0]:n}var $r=n=>{try{return n.only([[]]),$r=()=>[[]],[[]]}catch(e){return $r=()=>In,In}};function Ea(n){return n==null?()=>{}:typeof n=="string"?_m(n):e=>Qt(e,n)}function _m(n){return n.split(".").length===1?t=>t[n]:t=>Qt(t,n)}function ru(n){return[].slice.call(n)}var bm=0;function Br(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function wm(n,e,t){function r(u,h){let f=ru(u.objectStoreNames);return{schema:{name:u.name,tables:f.map(d=>h.objectStore(d)).map(d=>{let{keyPath:m,autoIncrement:p}=d,g=Ue(m),v=m==null,w={},E={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:v,compound:g,keyPath:m,autoIncrement:p,unique:!0,extractKey:Ea(m)},indexes:ru(d.indexNames).map(b=>d.index(b)).map(b=>{let{name:S,unique:A,multiEntry:I,keyPath:P}=b,O=Ue(P),z={name:S,compound:O,keyPath:P,unique:A,multiEntry:I,extractKey:Ea(P)};return w[Br(P)]=z,z}),getIndexByKeyPath:b=>w[Br(b)]};return w[":id"]=E.primaryKey,m!=null&&(w[Br(m)]=E.primaryKey),E})},hasGetAll:f.length>0&&"getAll"in h.objectStore(f[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:f,lowerOpen:d,upperOpen:m}=u;return h===void 0?f===void 0?null:e.upperBound(f,!!m):f===void 0?e.lowerBound(h,!!d):e.bound(h,f,!!d,!!m)}function s(u){let h=u.name;function f({trans:p,type:g,keys:v,values:w,range:E}){return new Promise((b,S)=>{b=xe(b);let A=p.objectStore(h),I=A.keyPath==null,P=g==="put"||g==="add";if(!P&&g!=="delete"&&g!=="deleteRange")throw new Error("Invalid operation type: "+g);let{length:O}=v||w||{length:1};if(v&&w&&v.length!==w.length)throw new Error("Given keys array must have same length as given values array.");if(O===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let z,D=[],L=[],R=0,W=re=>{++R,Wr(re)};if(g==="deleteRange"){if(E.type===4)return b({numFailures:R,failures:L,results:[],lastResult:void 0});E.type===3?D.push(z=A.clear()):D.push(z=A.delete(i(E)))}else{let[re,ue]=P?I?[w,v]:[w,null]:[v,null];if(P)for(let fe=0;fe<O;++fe)D.push(z=ue&&ue[fe]!==void 0?A[g](re[fe],ue[fe]):A[g](re[fe])),z.onerror=W;else for(let fe=0;fe<O;++fe)D.push(z=A[g](re[fe])),z.onerror=W}let Q=re=>{let ue=re.target.result;D.forEach((fe,we)=>fe.error!=null&&(L[we]=fe.error)),b({numFailures:R,failures:L,results:g==="delete"?v:D.map(fe=>fe.result),lastResult:ue})};z.onerror=re=>{W(re),Q(re)},z.onsuccess=Q})}function d({trans:p,values:g,query:v,reverse:w,unique:E}){return new Promise((b,S)=>{b=xe(b);let{index:A,range:I}=v,P=p.objectStore(h),O=A.isPrimaryKey?P:P.index(A.name),z=w?E?"prevunique":"prev":E?"nextunique":"next",D=g||!("openKeyCursor"in O)?O.openCursor(i(I),z):O.openKeyCursor(i(I),z);D.onerror=Bt(S),D.onsuccess=xe(L=>{let R=D.result;if(!R){b(null);return}R.___id=++bm,R.done=!1;let W=R.continue.bind(R),Q=R.continuePrimaryKey;Q&&(Q=Q.bind(R));let re=R.advance.bind(R),ue=()=>{throw new Error("Cursor not started")},fe=()=>{throw new Error("Cursor not stopped")};R.trans=p,R.stop=R.continue=R.continuePrimaryKey=R.advance=ue,R.fail=xe(S),R.next=function(){let we=1;return this.start(()=>we--?this.continue():this.stop()).then(()=>this)},R.start=we=>{let lt=new Promise((Y,$)=>{Y=xe(Y),D.onerror=Bt($),R.fail=$,R.stop=Z=>{R.stop=R.continue=R.continuePrimaryKey=R.advance=fe,Y(Z)}}),X=()=>{if(D.result)try{we()}catch(Y){R.fail(Y)}else R.done=!0,R.start=()=>{throw new Error("Cursor behind last entry")},R.stop()};return D.onsuccess=xe(Y=>{D.onsuccess=X,X()}),R.continue=W,R.continuePrimaryKey=Q,R.advance=re,X(),lt},b(R)},S)})}function m(p){return g=>new Promise((v,w)=>{v=xe(v);let{trans:E,values:b,limit:S,query:A}=g,I=S===1/0?void 0:S,{index:P,range:O}=A,z=E.objectStore(h),D=P.isPrimaryKey?z:z.index(P.name),L=i(O);if(S===0)return v({result:[]});if(p){let R=b?D.getAll(L,I):D.getAllKeys(L,I);R.onsuccess=W=>v({result:W.target.result}),R.onerror=Bt(w)}else{let R=0,W=b||!("openKeyCursor"in D)?D.openCursor(L):D.openKeyCursor(L),Q=[];W.onsuccess=re=>{let ue=W.result;if(!ue)return v({result:Q});if(Q.push(b?ue.value:ue.primaryKey),++R===S)return v({result:Q});ue.continue()},W.onerror=Bt(w)}})}return{name:h,schema:u,mutate:f,getMany({trans:p,keys:g}){return new Promise((v,w)=>{v=xe(v);let E=p.objectStore(h),b=g.length,S=new Array(b),A=0,I=0,P,O=D=>{let L=D.target;(S[L._pos]=L.result)!=null,++I===A&&v(S)},z=Bt(w);for(let D=0;D<b;++D)g[D]!=null&&(P=E.get(g[D]),P._pos=D,P.onsuccess=O,P.onerror=z,++A);A===0&&v(S)})},get({trans:p,key:g}){return new Promise((v,w)=>{v=xe(v);let b=p.objectStore(h).get(g);b.onsuccess=S=>v(S.target.result),b.onerror=Bt(w)})},query:m(a),openCursor:d,count({query:p,trans:g}){let{index:v,range:w}=p;return new Promise((E,b)=>{let S=g.objectStore(h),A=v.isPrimaryKey?S:S.index(v.name),I=i(w),P=I?A.count(I):A.count();P.onsuccess=xe(O=>E(O.target.result)),P.onerror=Bt(b)})}}}let{schema:o,hasGetAll:a}=r(n,t),l=o.tables.map(u=>s(u)),c={};return l.forEach(u=>c[u.name]=u),{stack:"dbcore",transaction:n.transaction.bind(n),table(u){if(!c[u])throw new Error(`Table '${u}' not found`);return c[u]},MIN_KEY:-1/0,MAX_KEY:$r(e),schema:o}}function xm(n,e){return e.reduce((t,{create:r})=>({...t,...r(t)}),n)}function Em(n,e,{IDBKeyRange:t,indexedDB:r},i){return{dbcore:xm(wm(e,t,i),n.dbcore)}}function Ua({_novip:n},e){let t=e.db,r=Em(n._middlewares,t,n._deps,e);n.core=r.dbcore,n.tables.forEach(i=>{let s=i.name;n.core.schema.tables.some(o=>o.name===s)&&(i.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=i.core))})}function ws({_novip:n},e,t,r){t.forEach(i=>{let s=r[i];e.forEach(o=>{let a=ka(o,i);(!a||"value"in a&&a.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?Zt(o,i,{get(){return this.table(i)},set(l){ou(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,s))})})}function Ta({_novip:n},e){e.forEach(t=>{for(let r in t)t[r]instanceof n.Table&&delete t[r]})}function Tm(n,e){return n._cfg.version-e._cfg.version}function Sm(n,e,t,r){let i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);let o=s._reject.bind(s),a=G.transless||G;an(()=>{G.trans=s,G.transless=a,e===0?(Fe(i).forEach(l=>{Va(t,l,i[l].primKey,i[l].indexes)}),Ua(n,t),N.follow(()=>n.on.populate.fire(s)).catch(o)):Am(n,e,s,t).catch(o)})}function Am({_novip:n},e,t,r){let i=[],s=n._versions,o=n._dbSchema=Wa(n,n.idbdb,r),a=!1;s.filter(u=>u._cfg.version>=e).forEach(u=>{i.push(()=>{let h=o,f=u._cfg.dbschema;Aa(n,h,r),Aa(n,f,r),o=n._dbSchema=f;let d=Du(h,f);d.add.forEach(p=>{Va(r,p[0],p[1].primKey,p[1].indexes)}),d.change.forEach(p=>{if(p.recreate)throw new J.Upgrade("Not yet support for changing primary key");{let g=r.objectStore(p.name);p.add.forEach(v=>Sa(g,v)),p.change.forEach(v=>{g.deleteIndex(v.name),Sa(g,v)}),p.del.forEach(v=>g.deleteIndex(v))}});let m=u._cfg.contentUpgrade;if(m&&u._cfg.version>e){Ua(n,r),t._memoizedTables={},a=!0;let p=uu(f);d.del.forEach(E=>{p[E]=h[E]}),Ta(n,[n.Transaction.prototype]),ws(n,[n.Transaction.prototype],Fe(p),p),t.schema=p;let g=Oa(m);g&&lr();let v,w=N.follow(()=>{if(v=m(t),v&&g){var E=en.bind(null,null);v.then(E,E)}});return v&&typeof v.then=="function"?N.resolve(v):w.then(()=>v)}}),i.push(h=>{if(!a||!im){let f=u._cfg.dbschema;Fm(f,h)}Ta(n,[n.Transaction.prototype]),ws(n,[n.Transaction.prototype],n._storeNames,n._dbSchema),t.schema=n._dbSchema})});function c(){return i.length?N.resolve(i.shift()(t.idbtrans)).then(c):N.resolve()}return c().then(()=>{Cm(o,r)})}function Du(n,e){let t={del:[],add:[],change:[]},r;for(r in n)e[r]||t.del.push(r);for(r in e){let i=n[r],s=e[r];if(!i)t.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!As)o.recreate=!0,t.change.push(o);else{let a=i.idxByName,l=s.idxByName,c;for(c in a)l[c]||o.del.push(c);for(c in l){let u=a[c],h=l[c];u?u.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}}return t}function Va(n,e,t,r){let i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(s=>Sa(i,s)),i}function Cm(n,e){Fe(n).forEach(t=>{e.db.objectStoreNames.contains(t)||Va(e,t,n[t].primKey,n[t].indexes)})}function Fm(n,e){[].slice.call(e.db.objectStoreNames).forEach(t=>n[t]==null&&e.db.deleteObjectStore(t))}function Sa(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Wa(n,e,t){let r={};return Ts(e.objectStoreNames,0).forEach(s=>{let o=t.objectStore(s),a=o.keyPath,l=xa(Pu(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),c=[];for(let h=0;h<o.indexNames.length;++h){let f=o.index(o.indexNames[h]);a=f.keyPath;var u=xa(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);c.push(u)}r[s]=Mu(s,l,c)}),r}function Im({_novip:n},e,t){n.verno=e.version/10;let r=n._dbSchema=Wa(n,e,t);n._storeNames=Ts(e.objectStoreNames,0),ws(n,[n._allTables],Fe(r),r)}function Pm(n,e){let t=Wa(n,n.idbdb,e),r=Du(t,n._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function Aa({_novip:n},e,t){let r=t.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=t.objectStore(s);n._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],c=o.index(l).keyPath,u=typeof c=="string"?c:"["+Ts(c).join("+")+"]";if(e[s]){let h=e[s].idxByName[u];h&&(h.name=l,delete e[s].idxByName[u],e[s].idxByName[l]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&be.WorkerGlobalScope&&be instanceof be.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function Mm(n){return n.split(",").map((e,t)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return xa(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Ue(i),t===0)})}var Ca=class{_parseStoresSpec(e,t){Fe(e).forEach(r=>{if(e[r]!==null){var i=Mm(e[r]),s=i.shift();if(s.multi)throw new J.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),t[r]=Mu(r,s,i)}})}stores(e){let t=this.db;this._cfg.storesSource=this._cfg.storesSource?Ye(this._cfg.storesSource,e):e;let r=t._versions,i={},s={};return r.forEach(o=>{Ye(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,Ta(t,[t._allTables,t,t.Transaction.prototype]),ws(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],Fe(s),s),t._storeNames=Fe(s),this}upgrade(e){return this._cfg.contentUpgrade=Na(this._cfg.contentUpgrade||me,e),this}};function Dm(n){return Qr(Ca.prototype,function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Ka(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new yt(Cs,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function $a(n){return n&&typeof n.databases=="function"}function km({indexedDB:n,IDBKeyRange:e}){return $a(n)?Promise.resolve(n.databases()).then(t=>t.map(r=>r.name).filter(r=>r!==Cs)):Ka(n,e).toCollection().primaryKeys()}function Om({indexedDB:n,IDBKeyRange:e},t){!$a(n)&&t!==Cs&&Ka(n,e).put({name:t}).catch(me)}function Rm({indexedDB:n,IDBKeyRange:e},t){!$a(n)&&t!==Cs&&Ka(n,e).delete(t).catch(me)}function Fa(n){return an(function(){return G.letThrough=!0,n()})}function Lm(){var n=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!n||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Nm(n){let e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Me(e.dbOpenError):n);zt&&(e.openCanceller._stackHolder=On()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new J.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1,l=()=>new N((c,u)=>{if(i(),!t)throw new J.MissingAPI;let h=n.name,f=e.autoSchema?t.open(h):t.open(h,Math.round(n.verno*10));if(!f)throw new J.MissingAPI;f.onerror=Bt(u),f.onblocked=xe(n._fireOnBlocked),f.onupgradeneeded=xe(d=>{if(o=f.transaction,e.autoSchema&&!n._options.allowEmptyDB){f.onerror=Wr,o.abort(),f.result.close();let p=t.deleteDatabase(h);p.onsuccess=p.onerror=xe(()=>{u(new J.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{o.onerror=Bt(u);var m=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=m<1,n._novip.idbdb=f.result,Sm(n,m/10,o,u)}},u),f.onsuccess=xe(()=>{o=null;let d=n._novip.idbdb=f.result,m=Ts(d.objectStoreNames);if(m.length>0)try{let p=d.transaction(vm(m),"readonly");e.autoSchema?Im(n,d,p):(Aa(n,n._dbSchema,p),Pm(n,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ua(n,p)}catch(p){}jr.push(n),d.onversionchange=xe(p=>{e.vcFired=!0,n.on("versionchange").fire(p)}),d.onclose=xe(p=>{n.on("close").fire(p)}),a&&Om(n._deps,h),c()},u)}).catch(c=>c&&c.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l()):N.reject(c));return N.race([r,(typeof navigator=="undefined"?N.resolve():Lm()).then(l)]).then(()=>(i(),e.onReadyBeingFired=[],N.resolve(Fa(()=>n.on.ready.fire(n.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(Na,me);return e.onReadyBeingFired=[],N.resolve(Fa(()=>u(n.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(c=>{e.dbOpenError=c;try{o&&o.abort()}catch(u){}return r===e.openCanceller&&n._close(),Me(c)}).finally(()=>{e.openComplete=!0,s()})}function Ia(n){var e=o=>n.next(o),t=o=>n.throw(o),r=s(e),i=s(t);function s(o){return a=>{var l=o(a),c=l.value;return l.done?c:!c||typeof c.then!="function"?Ue(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return s(e)()}function jm(n,e,t){var r=arguments.length;if(r<2)throw new J.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var s=fu(i);return[n,s,t]}function ku(n,e,t,r,i){return N.resolve().then(()=>{let s=G.transless||G,o=n._createTransaction(e,t,n._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(h){return h.name===La.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>ku(n,e,t,null,i))):Me(h)}let l=Oa(i);l&&lr();let c,u=N.follow(()=>{if(c=i.call(o,o),c)if(l){var h=en.bind(null,null);c.then(h,h)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Ia(c))},a);return(c&&typeof c.then=="function"?N.resolve(c).then(h=>o.active?h:Me(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(h=>(r&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),Me(h)))})}function as(n,e,t){let r=Ue(n)?n.slice():[n];for(let i=0;i<t;++i)r.push(e);return r}function Bm(n){return{...n,table(e){let t=n.table(e),{schema:r}=t,i={},s=[];function o(f,d,m){let p=Br(f),g=i[p]=i[p]||[],v=f==null?0:typeof f=="string"?1:f.length,w=d>0,E={...m,isVirtual:w,keyTail:d,keyLength:v,extractKey:Ea(f),unique:!w&&m.unique};if(g.push(E),E.isPrimaryKey||s.push(E),v>1){let b=v===2?f[0]:f.slice(0,v-1);o(b,d+1,m)}return g.sort((b,S)=>b.keyTail-S.keyTail),E}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let f of r.indexes)o(f.keyPath,0,f);function l(f){let d=i[Br(f)];return d&&d[0]}function c(f,d){return{type:f.type===1?2:f.type,lower:as(f.lower,f.lowerOpen?n.MAX_KEY:n.MIN_KEY,d),lowerOpen:!0,upper:as(f.upper,f.upperOpen?n.MIN_KEY:n.MAX_KEY,d),upperOpen:!0}}function u(f){let d=f.query.index;return d.isVirtual?{...f,query:{index:d,range:c(f.query.range,d.keyTail)}}:f}return{...t,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:l},count(f){return t.count(u(f))},query(f){return t.query(u(f))},openCursor(f){let{keyTail:d,isVirtual:m,keyLength:p}=f.query.index;if(!m)return t.openCursor(f);function g(v){function w(b){b!=null?v.continue(as(b,f.reverse?n.MAX_KEY:n.MIN_KEY,d)):f.unique?v.continue(v.key.slice(0,p).concat(f.reverse?n.MIN_KEY:n.MAX_KEY,d)):v.continue()}return Object.create(v,{continue:{value:w},continuePrimaryKey:{value(b,S){v.continuePrimaryKey(as(b,n.MAX_KEY,d),S)}},primaryKey:{get(){return v.primaryKey}},key:{get(){let b=v.key;return p===1?b[0]:b.slice(0,p)}},value:{get(){return v.value}}})}return t.openCursor(u(f)).then(v=>v&&g(v))}}}}}var zm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Bm};function Ha(n,e,t,r){return t=t||{},r=r||"",Fe(n).forEach(i=>{if(!dt(e,i))t[r+i]=void 0;else{var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=oa(s),l=oa(o);a!==l?t[r+i]=e[i]:a==="Object"?Ha(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}}),Fe(e).forEach(i=>{dt(n,i)||(t[r+i]=e[i])}),t}function Um(n,e){return e.type==="delete"?e.keys:e.keys||e.values.map(n.extractKey)}var Vm={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){let t=n.table(e),{primaryKey:r}=t.schema;return{...t,mutate(s){let o=G.trans,{deleting:a,creating:l,updating:c}=o.table(e).hook;switch(s.type){case"add":if(l.fire===me)break;return o._promise("readwrite",()=>u(s),!0);case"put":if(l.fire===me&&c.fire===me)break;return o._promise("readwrite",()=>u(s),!0);case"delete":if(a.fire===me)break;return o._promise("readwrite",()=>u(s),!0);case"deleteRange":if(a.fire===me)break;return o._promise("readwrite",()=>h(s),!0)}return t.mutate(s);function u(d){let m=G.trans,p=d.keys||Um(r,d);if(!p)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?{...d,keys:p}:{...d},d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),Wm(t,d,p).then(g=>{let v=p.map((w,E)=>{let b=g[E],S={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(S,w,b,m);else if(d.type==="add"||b===void 0){let A=l.fire.call(S,w,d.values[E],m);w==null&&A!=null&&(w=A,d.keys[E]=w,r.outbound||Pt(d.values[E],r.keyPath,w))}else{let A=Ha(b,d.values[E]),I=c.fire.call(S,A,w,b,m);if(I){let P=d.values[E];Object.keys(I).forEach(O=>{dt(P,O)?P[O]=I[O]:Pt(P,O,I[O])})}}return S});return t.mutate(d).then(({failures:w,results:E,numFailures:b,lastResult:S})=>{for(let A=0;A<p.length;++A){let I=E?E[A]:p[A],P=v[A];I==null?P.onerror&&P.onerror(w[A]):P.onsuccess&&P.onsuccess(d.type==="put"&&g[A]?d.values[A]:I)}return{failures:w,results:E,numFailures:b,lastResult:S}}).catch(w=>(v.forEach(E=>E.onerror&&E.onerror(w)),Promise.reject(w)))})}function h(d){return f(d.trans,d.range,1e4)}function f(d,m,p){return t.query({trans:d,values:!1,query:{index:r,range:m},limit:p}).then(({result:g})=>u({type:"delete",keys:g,trans:d}).then(v=>v.numFailures>0?Promise.reject(v.failures[0]):g.length<p?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...m,lower:g[g.length-1],lowerOpen:!0},p)))}}}}})};function Wm(n,e,t){return e.type==="add"?Promise.resolve([]):n.getMany({trans:e.trans,keys:t,cache:"immutable"})}function Ou(n,e,t){try{if(!e||e.keys.length<n.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<n.length;++i)Xe(e.keys[i],n[s])===0&&(r.push(t?qr(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch(r){return null}}var Km={stack:"dbcore",level:-1,create:n=>({table:e=>{let t=n.table(e);return{...t,getMany:r=>{if(!r.cache)return t.getMany(r);let i=Ou(r.keys,r.trans._cache,r.cache==="clone");return i?N.resolve(i):t.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?qr(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),t.mutate(r))}}})};function qa(n){return!("from"in n)}var Xt=function(n,e){if(this)Ye(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0});else{let t=new Xt;return n&&"d"in n&&Ye(t,n),t}};sr(Xt.prototype,{add(n){return xs(this,n),this},addKey(n){return Hr(this,n,n),this},addKeys(n){return n.forEach(e=>Hr(this,e,e)),this},[aa](){return Pa(this)}});function Hr(n,e,t){let r=Xe(e,t);if(isNaN(r))return;if(r>0)throw RangeError();if(qa(n))return Ye(n,{from:e,to:t,d:1});let i=n.l,s=n.r;if(Xe(t,n.from)<0)return i?Hr(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},iu(n);if(Xe(e,n.to)>0)return s?Hr(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},iu(n);Xe(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),Xe(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);let o=!n.r;i&&!n.l&&xs(n,i),s&&o&&xs(n,s)}function xs(n,e){function t(r,{from:i,to:s,l:o,r:a}){Hr(r,i,s),o&&t(r,o),a&&t(r,a)}qa(e)||t(n,e)}function $m(n,e){let t=Pa(e),r=t.next();if(r.done)return!1;let i=r.value,s=Pa(n),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Xe(a.from,i.to)<=0&&Xe(a.to,i.from)>=0)return!0;Xe(i.from,a.from)<0?i=(r=t.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function Pa(n){let e=qa(n)?null:{s:0,n};return{next(t){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Xe(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Xe(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function iu(n){var e,t;let r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...n},a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],o[i]=a[s],n[s]=o,o.d=su(o)}n.d=su(n)}function su({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}var Hm={stack:"dbcore",level:0,create:n=>{let e=n.schema.name,t=new Xt(n.MIN_KEY,n.MAX_KEY);return{...n,table:r=>{let i=n.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,c={...i,mutate:f=>{let d=f.trans,m=d.mutatedParts||(d.mutatedParts={}),p=A=>{let I=`idb://${e}/${r}/${A}`;return m[I]||(m[I]=new Xt)},g=p(""),v=p(":dels"),{type:w}=f,[E,b]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],S=f.trans._cache;return i.mutate(f).then(A=>{if(Ue(E)){w!=="delete"&&(E=A.results),g.addKeys(E);let I=Ou(E,S);!I&&w!=="add"&&v.addKeys(E),(I||b)&&qm(p,s,I,b)}else if(E){let I={from:E.lower,to:E.upper};v.add(I),g.add(I)}else g.add(t),v.add(t),s.indexes.forEach(I=>p(I.name).add(t));return A})}},u=({query:{index:f,range:d}})=>{var m,p;return[f,new Xt((m=d.lower)!==null&&m!==void 0?m:n.MIN_KEY,(p=d.upper)!==null&&p!==void 0?p:n.MAX_KEY)]},h={get:f=>[o,new Xt(f.key)],getMany:f=>[o,new Xt().addKeys(f.keys)],count:u,query:u,openCursor:u};return Fe(h).forEach(f=>{c[f]=function(d){let{subscr:m}=G;if(m){let p=b=>{let S=`idb://${e}/${r}/${b}`;return m[S]||(m[S]=new Xt)},g=p(""),v=p(":dels"),[w,E]=h[f](d);if(p(w.name||"").add(E),!w.isPrimaryKey)if(f==="count")v.add(t);else{let b=f==="query"&&l&&d.values&&i.query({...d,values:!1});return i[f].apply(this,arguments).then(S=>{if(f==="query"){if(l&&d.values)return b.then(({result:I})=>(g.addKeys(I),S));let A=d.values?S.result.map(a):S.result;d.values?g.addKeys(A):v.addKeys(A)}else if(f==="openCursor"){let A=S,I=d.values;return A&&Object.create(A,{key:{get(){return v.addKey(A.primaryKey),A.key}},primaryKey:{get(){let P=A.primaryKey;return v.addKey(P),P}},value:{get(){return I&&g.addKey(A.primaryKey),A.value}}})}return S})}}return i[f].apply(this,arguments)}}),c}}}};function qm(n,e,t,r){function i(s){let o=n(s.name||"");function a(c){return c!=null?s.extractKey(c):null}let l=c=>s.multiEntry&&Ue(c)?c.forEach(u=>o.addKey(u)):o.addKey(c);(t||r).forEach((c,u)=>{let h=t&&a(t[u]),f=r&&a(r[u]);Xe(h,f)!==0&&(h!=null&&l(h),f!=null&&l(f))})}e.indexes.forEach(i)}var yt=class{constructor(e,t){this._middlewares={},this.verno=0;let r=yt.dependencies;this._options=t={addons:yt.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};let{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new N(o=>{s.dbReadyResolve=o}),s.openCanceller=new N((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=Jr(this,"populate","blocked","versionchange","close",{ready:[Na,me]}),this.on.ready.subscribe=au(this.on.ready.subscribe,o=>(a,l)=>{yt.vip(()=>{let c=this._state;if(c.openComplete)c.dbOpenError||N.resolve().then(a),l&&o(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),l&&o(a);else{o(a);let u=this;l||o(function h(){u.on.ready.unsubscribe(a),u.on.ready.unsubscribe(h)})}})}),this.Collection=um(this),this.Table=om(this),this.Transaction=ym(this),this.Version=Dm(this),this.WhereClause=gm(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=$r(t.IDBKeyRange),this._createTransaction=(o,a,l,c)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,c),this._fireOnBlocked=o=>{this.on("blocked").fire(o),jr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(zm),this.use(Vm),this.use(Hm),this.use(Km),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new J.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let t=this._versions;var r=t.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),t.push(r),t.sort(Tm),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||G.letThrough||this._vip)?e():new N((t,r)=>{if(this._state.openComplete)return r(new J.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new J.DatabaseClosed);return}this.open().catch(me)}this._state.dbReadyPromise.then(t,r)}).then(e)}use({stack:e,create:t,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:r==null?10:r,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:t?i.name!==t:!1)),this}open(){return Nm(this)}_close(){let e=this._state,t=jr.indexOf(this);if(t>=0&&jr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}e.dbReadyPromise=new N(r=>{e.dbReadyResolve=r}),e.openCanceller=new N((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new J.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,t=this._state;return new N((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=xe(()=>{Rm(this._deps,this.name),r()}),o.onerror=Bt(i),o.onblocked=this._fireOnBlocked};if(e)throw new J.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Fe(this._allTables).map(e=>this._allTables[e])}transaction(){let e=jm.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let i=G.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=t.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===ea)o=ea;else if(e=="rw"||e==ta)o=ta;else throw new J.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===ea&&o===ta)if(s)i=null;else throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(c=>{if(i&&i.storeNames.indexOf(c)===-1)if(s)i=null;else throw new J.SubTransaction("Table "+c+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(u,h)=>{h(c)}):Me(c)}let l=ku.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):G.trans?cr(G.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!dt(this._allTables,e))throw new J.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},Gm=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Ma=class{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:t,complete:r}:e)}[Gm](){return this}};function Ru(n,e){return Fe(e).forEach(t=>{let r=n[t]||(n[t]=new Xt);xs(r,e[t])}),n}function Xm(n){let e=!1,t,r=new Ma(i=>{let s=Oa(n);function o(g){s&&lr();let v=()=>an(n,{subscr:g,trans:null}),w=G.trans?cr(G.transless,v):v();return s&&w.then(en,en),w}let a=!1,l={},c={},u={get closed(){return a},unsubscribe:()=>{a=!0,cn.storagemutated.unsubscribe(m)}};i.start&&i.start(u);let h=!1,f=!1;function d(){return Fe(c).some(g=>l[g]&&$m(l[g],c[g]))}let m=g=>{Ru(l,g),d()&&p()},p=()=>{if(h||a)return;l={};let g={},v=o(g);f||(cn(Kr,m),f=!0),h=!0,Promise.resolve(v).then(w=>{e=!0,t=w,h=!1,!a&&(d()?p():(l={},c=g,i.next&&i.next(w)))},w=>{h=!1,e=!1,i.error&&i.error(w),u.unsubscribe()})};return p(),u});return r.hasValue=()=>e,r.getValue=()=>t,r}var Da;try{Da={indexedDB:be.indexedDB||be.mozIndexedDB||be.webkitIndexedDB||be.msIndexedDB,IDBKeyRange:be.IDBKeyRange||be.webkitIDBKeyRange}}catch(n){Da={indexedDB:null,IDBKeyRange:null}}var Fn=yt;sr(Fn,{...Ss,delete(n){return new Fn(n,{addons:[]}).delete()},exists(n){return new Fn(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(n){try{return km(Fn.dependencies).then(n)}catch(e){return Me(new J.MissingAPI)}},defineClass(){function n(e){Ye(this,e)}return n},ignoreTransaction(n){return G.trans?cr(G.transless,n):n()},vip:Fa,async:function(n){return function(){try{var e=Ia(n.apply(this,arguments));return!e||typeof e.then!="function"?N.resolve(e):e}catch(t){return Me(t)}}},spawn:function(n,e,t){try{var r=Ia(n.apply(t,e||[]));return!r||typeof r.then!="function"?N.resolve(r):r}catch(i){return Me(i)}},currentTransaction:{get:()=>G.trans||null},waitFor:function(n,e){let t=N.resolve(typeof n=="function"?Fn.ignoreTransaction(n):n).timeout(e||6e4);return G.trans?G.trans.waitFor(t):t},Promise:N,debug:{get:()=>zt,set:n=>{hu(n,n==="dexie"?()=>!0:Cu)}},derive:or,extend:Ye,props:sr,override:au,Events:Jr,on:cn,liveQuery:Xm,extendObservabilitySet:Ru,getByKeyPath:Qt,setByKeyPath:Pt,delByKeyPath:Dp,shallowClone:uu,deepClone:qr,getObjectDiff:Ha,cmp:Xe,asap:lu,minKey:va,addons:[],connections:jr,errnames:La,dependencies:Da,semVer:Qc,version:Qc.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,t*2))});Fn.maxKey=$r(Fn.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(cn(Kr,n=>{if(!Jt){let e;As?(e=document.createEvent("CustomEvent"),e.initCustomEvent(on,!0,!0,n)):e=new CustomEvent(on,{detail:n}),Jt=!0,dispatchEvent(e),Jt=!1}}),addEventListener(on,({detail:n})=>{Jt||Es(n)}));function Es(n){let e=Jt;try{Jt=!0,cn.storagemutated.fire(n)}finally{Jt=e}}var Jt=!1;if(typeof BroadcastChannel!="undefined"){let n=new BroadcastChannel(on);typeof n.unref=="function"&&n.unref(),cn(Kr,e=>{Jt||n.postMessage(e)}),n.onmessage=e=>{e.data&&Es(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){cn(Kr,e=>{try{Jt||(typeof localStorage!="undefined"&&localStorage.setItem(on,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:on,changedParts:e})))}catch(t){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===on){let t=JSON.parse(e.newValue);t&&Es(t.changedParts)}});let n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",Ym)}function Ym({data:n}){n&&n.type===on&&Es(n.changedParts)}N.rejectionMapper=Up;hu(zt,Cu);var ju=require("obsidian");var Lu=require("obsidian");var Nu=pe(_e());var Ve=class{constructor(){this.app=x(Lu.App);this.plugin=x(ut);this.obsidianFs=this.app.vault.adapter}getVaultAbsolutePath(){return this.obsidianFs.getBasePath().replace(/\\/g,"/")+"/"}getAbsolutePath(e){return ke.join(this.getVaultAbsolutePath(),e)}getFileBacklinks(e){this.app.metadataCache.getBacklinksForFile(e)}getAppId(){return this.app.appId}executeCommandById(e){this.app.commands.executeCommandById(e)}isNotObsidianExcludedPath(e){return!(this.app.metadataCache.isUserIgnored&&this.app.metadataCache.isUserIgnored(e))}};Ve=U([(0,Nu.singleton)()],Ve);var Bu=pe(_e());var Mt=class{constructor(){this.app=x(ju.App);this.privateApi=x(Ve)}async initAsync(){if(this.app.plugins.plugins.omnisearch){let e="omnisearch/cache/"+this.privateApi.getAppId(),t=new yt(e);t.version(Mt.DB_VERSION).stores({searchHistory:"++id",minisearch:"date"}),this.db=t}}async getLastQuery(){let e="";if(this.checkOmnisearchStatus()){let t=await this.db.searchHistory.toArray();e=t.length!==0?t[t.length-1].query:""}return e}checkOmnisearchStatus(){let e=this.app.plugins.plugins.omnisearch,t=!0;return e?e._loaded||(new Ce(j("Omnisearch is installed but not enabled")),t=!1):(new Ce(j("Omnisearch isn't installed")),t=!1),t}};Mt.DB_VERSION=8,Mt=U([(0,Bu.singleton)()],Mt);var te=require("obsidian");var Un=pe(_e());var zu=pe(_e());var We=class{constructor(){this.setting=x(de);this.extensionViewMap=new Map;this.plugin=x(ut)}init(){this.fillMap(this.setting.customExtensions.plaintext,Rn.MARKDOWN);try{}catch(e){}}viewTypeByPath(e){let t=this.extensionViewMap.get(ye.getExtension(e));return t===void 0?Rn.UNSUPPORTED:t}refreshAll(){this.extensionViewMap.clear(),this.init()}fillMap(e,t){for(let r of e)this.extensionViewMap.set(r,t)}};We=U([(0,zu.singleton)()],We);var Rn=(a=>(a.UNSUPPORTED="unsupported",a.MARKDOWN="markdown",a.PDF="pdf",a.CANVAS="canvas",a.IMAGE="image",a.AUDIO="audio",a.VIDEO="video",a))(Rn||{});var ur=class{constructor(e,t){this.text=e,this.row=t}},tn=class{constructor(e,t){this.sourcePath=e,this.items=t}};var Zr=class{},un=class extends Zr{constructor(t,r){super();this.line=t,this.context=r}},fn=class extends Zr{constructor(t,r,i,s,o,a){super();this.engineType=t,this.path=r,this.queryTerms=i,this.matchedTerms=s,this.subItems=o,this.previewContent=a}get viewType(){return x(We).viewTypeByPath(this.path)}get basename(){return ye.getBasename(this.path)}get extension(){return ye.getExtension(this.path)}get folderPath(){return ye.getFolderPath(this.path)}},Fs=class extends Zr{constructor(t,r,i){super();this.text=t,this.row=r,this.col=i}};var Uu=require("obsidian");var Is=class{constructor(e){this.option=e}async get(e,t){return this.request("GET",e,t,void 0)}async post(e,t,r){return this.request("POST",e,t,r)}async put(e,t,r){return this.request("PUT",e,t,r)}async delete(e,t){return this.request("DELETE",e,t,void 0)}async request(e,t,r,i){return t=this.buildUrlWithParams(t,r),this.option.responseProcessor(await(0,Uu.requestUrl)({url:t,method:e,contentType:"application/json",body:i?JSON.stringify(i):void 0,headers:this.option.headers}))}buildUrlWithParams(e,t){e=`${this.option.protocol}://${this.option.baseUrl}/${e}`;let r=t?this.serializeParams(t):"";return r?`${e}?${r}`:e}serializeParams(e){return Object.keys(e).map(t=>{let r=e[t];return`${encodeURIComponent(t)}=${encodeURIComponent(this.stringifyParam(r))}`}).join("&")}stringifyParam(e){return typeof e=="object"?JSON.stringify(e):String(e)}};var Ga=pe(_e());var it=class{constructor(){this.request=x(ei);this.viewRegistry=x(We);this._status="stopped"}get status(){return this._status}async testConnection(){await this.request.testConnection()?new Ce("Connected",5e3):new Ce("Failed to connect",5e3)}async doesCollectionExist(){try{let e=await this.request.doesCollectionExist();return this._status="ready",e}catch(e){return this._status="stopped",F.warn("failed to connect to ai-helper. launch clever-search-ai-helper or disable semantic search in the setting to avoid this warning."),F.error(e),null}}async reindexAll(e){this._status="indexing";let t=this.convertToDocuments(e);try{await this.request.reindexAll(t),this._status="ready"}catch(r){F.error(r),this._status="stopped"}}async addDocuments(e){this._status="indexing";let t=this.convertToDocuments(e);try{let r=await this.request.addDocuments(t);return this._status="ready",r}catch(r){return F.error(r),this._status="stopped",!1}}async deleteDocuments(e){this._status="indexing";try{let t=await this.request.deleteDocuments(e);return this._status="ready",t}catch(t){return F.error(t),this._status="stopped",!1}}async search(e,t){try{let r=await this.request.search(e,t);return this._status="ready",r.map(i=>{let s=i.subItems.map(o=>new Fs(o.text,o.row,o.col));return new fn(i.engineType,i.path,i.queryTerms,i.matchedTerms,s,i.previewContent)})}catch(r){return F.error(r),this._status="stopped",[]}}async docsCount(){return this.request.docsCount()}convertToDocuments(e){return e.map(t=>({path:t.path,view_type:this.viewRegistry.viewTypeByPath(t.path),content:t.content}))}};it=U([(0,Ga.singleton)()],it);var ei=class{constructor(){this.responseProcessor=e=>{if(e.status===200){let t=e.json;if(t.code===0)return t.data;if(t.code===-1)return F.error(`KnownException: ${t.message}`),null;if(t.code===-2)return F.error(`UnknownException: ${t.message}`),null;throw Error(ts)}else return F.error(e.text),null};this.client=new Is({baseUrl:"localhost:19528/api",protocol:"http",responseProcessor:this.responseProcessor,headers:{"X-vaultId":x(Ve).getAppId()}})}async testConnection(){try{return!!await this.client.get("testConnection")}catch(e){return F.error(e),!1}}async doesCollectionExist(){return await this.client.get("doesCollectionExist",void 0)}async reindexAll(e){await this.client.post("reindexAll",void 0,e)}async docsCount(){try{return await this.client.get("docsCount")}catch(e){return F.error(e),null}}async addDocuments(e){return await this.client.post("addDocuments",void 0,e)}async deleteDocuments(e){return await this.client.post("deleteDocuments",void 0,e)}async search(e,t){return await this.client.get("search",{queryText:e,viewType:t})}};ei=U([(0,Ga.singleton)()],ei);var bf=require("obsidian");var ti=pe(_e());var dn=class{constructor(){this.db=x(vt)}async deleteMinisearchData(){this.db.minisearch.clear()}async setMiniSearchData(e){this.db.transaction("rw",this.db.minisearch,async()=>{await this.db.minisearch.clear(),await this.db.minisearch.add({data:e}),F.trace("minisearch data saved")})}async getMiniSearchData(){var e;return((e=(await this.db.minisearch.toArray())[0])==null?void 0:e.data)||null}async setLexicalDocRefs(e){this.db.transaction("rw",this.db.lexicalDocRefs,async()=>{await this.db.lexicalDocRefs.clear(),await this.db.lexicalDocRefs.bulkAdd(e)})}async getLexicalDocRefs(){return await this.db.lexicalDocRefs.toArray()||null}async setSemanticDocRefs(e){this.db.transaction("rw",this.db.semanticDocRefs,async()=>{await this.db.semanticDocRefs.clear(),await this.db.semanticDocRefs.bulkAdd(e)})}async getSemanticDocRefs(){return await this.db.semanticDocRefs.toArray()||null}async setPluginSetting(e){try{return await this.db.transaction("rw",this.db.pluginSetting,()=>{this.db.pluginSetting.clear(),this.db.pluginSetting.add({data:e})}),F.trace("settings have been saved to database"),!0}catch(t){return F.trace(`settings failed to be saved: ${t}`),!1}}async deleteOldDatabases(){let e=(await indexedDB.databases()).filter(t=>t.name===this.db.dbName&&t.version!==this.db.dbVersion*10);if(e.length){F.info("Old version databases will be deleted");for(let t of e)t.name&&indexedDB.deleteDatabase(t.name)}}};U([Be],dn.prototype,"getMiniSearchData",1),U([Be],dn.prototype,"getLexicalDocRefs",1),dn=U([(0,ti.singleton)()],dn);var vt=class extends yt{constructor(t){super(vt.dbNamePrefix+t.getAppId());this.privateApi=t,this.version(vt._dbVersion).stores({pluginSetting:"++id",minisearch:"++id",lexicalDocRefs:"++id",semanticDocRefs:"++id"})}get dbVersion(){return vt._dbVersion}get dbName(){return vt.dbNamePrefix+this.privateApi.getAppId()}};vt._dbVersion=2,vt.dbNamePrefix="clever-search/",vt=U([(0,ti.singleton)(),Pi(0,(0,ti.inject)(Ve))],vt);var Za={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let n="\u0300".codePointAt(0);n<="\u036F".codePointAt(0);++n){let e=String.fromCodePoint(n);for(let t of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let i=(t+e).normalize().codePointAt(0);i>126&&(Za[i]=t)}}var Xa={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(let n of Object.keys(Xa)){let e=n.toUpperCase();for(let t=Xa[n][0];t<=Xa[n][1];++t)Za[t]=t%2===0?e:n}function ai(n){if(n<192||n>8580)return n;let e=Za[n];return e!==void 0?e.codePointAt(0):n}function hn(n,e){return n>e?n:e}var Ku=n=>n.split("").map(e=>e.codePointAt(0));var Jm=new Set(` \f
\r	\v\xA0\u1680\u2028\u2029\u202F\u205F\u3000\uFEFF`.split("").map(n=>n.codePointAt(0)));for(let n="\u2000".codePointAt(0);n<="\u200A".codePointAt(0);n++)Jm.add(n);var dr="\x7F".codePointAt(0),ri="A".codePointAt(0),ii="Z".codePointAt(0),$u="a".codePointAt(0),Hu="z".codePointAt(0),Qm="0".codePointAt(0),Zm="9".codePointAt(0);function fr(n,e,t){return t?n:e-n-1}var si=16,Ps=-3,oi=-1,Ln=si/2,eg=si/2,tg=Ln+oi,qu=-(Ps+oi),Gu=2;function Ya(n){return n?new Set:null}function ni(n,e,t){if(e!==null&&e.i16.length>n+t){let r=e.i16.subarray(n,n+t);return[n+t,r]}return[n,new Int16Array(t)]}function Vu(n,e,t){if(e!==null&&e.i32.length>n+t){let r=e.i32.subarray(n,n+t);return[n+t,r]}return[n,new Int32Array(t)]}function Xu(n){return n>=$u&&n<=Hu?1:n>=ri&&n<=ii?2:n>=Qm&&n<=Zm?4:0}function Yu(n){let e=String.fromCodePoint(n);return e!==e.toUpperCase()?1:e!==e.toLowerCase()?2:e.match(/\p{Number}/gu)!==null?4:e.match(/\p{Letter}/gu)!==null?3:0}function Ms(n){return n<=dr?Xu(n):Yu(n)}function el(n,e){return n===0&&e!==0?Ln:n===1&&e===2||n!==4&&e===4?tg:e===0?eg:0}function ng(n,e){return e===0?Ln:el(Ms(n[e-1]),Ms(n[e]))}function rg(n,e,t,r){let i=n.slice(r),s=i.indexOf(t);if(s===0)return r;if(!e&&t>=$u&&t<=Hu){s>0&&(i=i.slice(0,s));let o=i.indexOf(t-32);o>=0&&(s=o)}return s<0?-1:r+s}function Wu(n){for(let e of n)if(e>=128)return!1;return!0}function tl(n,e,t){if(!Wu(n))return 0;if(!Wu(e))return-1;let r=0,i=0;for(let s=0;s<e.length;s++){if(i=rg(n,t,e[s],i),i<0)return-1;s===0&&i>0&&(r=i-1),i++}return r}var ig=(n,e,t,r,i,s,o)=>{let a=i.length;if(a===0)return[{start:0,end:0,score:0},Ya(s)];let l=r.length;if(o!==null&&l*a>o.i16.length)return Qu(n,e,t,r,i,s);let c=tl(r,i,n);if(c<0)return[{start:-1,end:-1,score:0},null];let u=0,h=0,f=null,d=null,m=null,p=null;[u,f]=ni(u,o,l),[u,d]=ni(u,o,l),[u,m]=ni(u,o,l),[h,p]=Vu(h,o,a);let[,g]=Vu(h,o,l);for(let Y=0;Y<g.length;Y++)g[Y]=r[Y];let v=0,w=0,E=0,b=0,S=i[0],A=i[0],I=0,P=0,O=!1,z=g.subarray(c),D=f.subarray(c).subarray(0,z.length),L=d.subarray(c).subarray(0,z.length),R=m.subarray(c).subarray(0,z.length);for(let[Y,$]of z.entries()){let Z=null;$<=dr?(Z=Xu($),!n&&Z===2&&($+=32)):(Z=Yu($),!n&&Z===2&&($=String.fromCodePoint($).toLowerCase().codePointAt(0)),e&&($=ai($))),z[Y]=$;let ae=el(P,Z);if(R[Y]=ae,P=Z,$===A&&(E<a&&(p[E]=c+Y,E++,A=i[Math.min(E,a-1)]),b=c+Y),$===S){let Te=si+ae*Gu;if(D[Y]=Te,L[Y]=1,a===1&&(t&&Te>v||!t&&Te>=v)&&(v=Te,w=c+Y,t&&ae===Ln))break;O=!1}else O?D[Y]=hn(I+oi,0):D[Y]=hn(I+Ps,0),L[Y]=0,O=!0;I=D[Y]}if(E!==a)return[{start:-1,end:-1,score:0},null];if(a===1){let Y={start:w,end:w+1,score:v};if(!s)return[Y,null];let $=new Set;return $.add(w),[Y,$]}let W=p[0],Q=b-W+1,re=null;[u,re]=ni(u,o,Q*a);{let Y=f.subarray(W,b+1);for(let[$,Z]of Y.entries())re[$]=Z}let[,ue]=ni(u,o,Q*a);{let Y=d.subarray(W,b+1);for(let[$,Z]of Y.entries())ue[$]=Z}let fe=p.subarray(1),we=i.slice(1).slice(0,fe.length);for(let[Y,$]of fe.entries()){let Z=!1,ae=we[Y],Te=Y+1,B=Te*Q,se=g.subarray($,b+1),Ee=m.subarray($).subarray(0,se.length),bn=ue.subarray(B+$-W).subarray(0,se.length),Et=ue.subarray(B+$-W-1-Q).subarray(0,se.length),Tt=re.subarray(B+$-W).subarray(0,se.length),wn=re.subarray(B+$-W-1-Q).subarray(0,se.length),Ze=re.subarray(B+$-W-1).subarray(0,se.length);Ze[0]=0;for(let[$e,xn]of se.entries()){let St=$e+$,ct=0,et=0,At=0;if(Z?et=Ze[$e]+oi:et=Ze[$e]+Ps,ae===xn){ct=wn[$e]+si;let Wt=Ee[$e];At=Et[$e]+1,Wt===Ln?At=1:At>1&&(Wt=hn(Wt,hn(qu,m[St-At+1]))),ct+Wt<et?(ct+=Ee[$e],At=0):ct+=Wt}bn[$e]=At,Z=ct<et;let Vt=hn(hn(ct,et),0);Te===a-1&&(t&&Vt>v||!t&&Vt>=v)&&(v=Vt,w=St),Tt[$e]=Vt}}let lt=Ya(s),X=W;if(s&&lt!==null){let Y=a-1;X=w;let $=!0;for(;;){let Z=Y*Q,ae=X-W,Te=re[Z+ae],B=0,se=0;if(Y>0&&X>=p[Y]&&(B=re[Z-Q+ae-1]),X>p[Y]&&(se=re[Z+ae-1]),Te>B&&(Te>se||Te===se&&$)){if(lt.add(X),Y===0)break;Y--}$=ue[Z+ae]>1||Z+Q+ae+1<ue.length&&ue[Z+Q+ae+1]>0,X--}}return[{start:X,end:w+1,score:v},lt]};function Ju(n,e,t,r,i,s,o){let a=0,l=0,c=!1,u=0,h=0,f=Ya(o),d=0;i>0&&(d=Ms(t[i-1]));for(let m=i;m<s;m++){let p=t[m],g=Ms(p);if(n||(p>=ri&&p<=ii?p+=32:p>dr&&(p=String.fromCodePoint(p).toLowerCase().codePointAt(0))),e&&(p=ai(p)),p===r[a]){o&&f!==null&&f.add(m),l+=si;let v=el(d,g);u===0?h=v:(v===Ln&&(h=v),v=hn(hn(v,h),qu)),a===0?l+=v*Gu:l+=v,c=!1,u++,a++}else c?l+=oi:l+=Ps,c=!0,u=0,h=0;d=g}return[l,f]}var Qu=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];if(tl(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let a=0,l=-1,c=-1,u=r.length,h=i.length;for(let f=0;f<u;f++){let d=r[fr(f,u,t)];n||(d>=ri&&d<=ii?d+=32:d>dr&&(d=String.fromCodePoint(d).toLowerCase().codePointAt(0))),e&&(d=ai(d));let m=i[fr(a,h,t)];if(d===m&&(l<0&&(l=f),a++,a===h)){c=f+1;break}}if(l>=0&&c>=0){a--;for(let m=c-1;m>=l;m--){let p=fr(m,u,t),g=r[p];n||(g>=ri&&g<=ii?g+=32:g>dr&&(g=String.fromCodePoint(g).toLowerCase().codePointAt(0)));let v=fr(a,h,t),w=i[v];if(g===w&&(a--,a<0)){l=m;break}}if(!t){let m=l;l=u-c,c=u-m}let[f,d]=Ju(n,e,r,i,l,c,s);return[{start:l,end:c,score:f},d]}return[{start:-1,end:-1,score:0},null]},sg=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];let a=r.length,l=i.length;if(a<l)return[{start:-1,end:-1,score:0},null];if(tl(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let c=0,u=-1,h=0,f=-1;for(let d=0;d<a;d++){let m=fr(d,a,t),p=r[m];n||(p>=ri&&p<=ii?p+=32:p>dr&&(p=String.fromCodePoint(p).toLowerCase().codePointAt(0))),e&&(p=ai(p));let g=fr(c,l,t);if(i[g]===p){if(g===0&&(h=ng(r,m)),c++,c===l){if(h>f&&(u=d,f=h),h===Ln)break;d-=c-1,c=0,h=0}}else d-=c,c=0,h=0}if(u>=0){let d=0,m=0;t?(d=u-l+1,m=u+1):(d=a-(u+1),m=a-(u-l+1));let[p]=Ju(n,e,r,i,d,m,!1);return[{start:d,end:m,score:p},null]}return[{start:-1,end:-1,score:0},null]};var og=100*1024,ag=2048;function lg(n,e){return{i16:new Int16Array(n),i32:new Int32Array(e)}}var cg=lg(og,ag);var Zu=(n,e,t)=>{let r=!1;switch(e){case"smart-case":n.toLowerCase()!==n&&(r=!0);break;case"case-sensitive":r=!0;break;case"case-insensitive":n=n.toLowerCase(),r=!1;break}let i=Ku(n);return t&&(i=i.map(ai)),{queryRunes:i,caseSensitive:r}};function ef(n,e){let t=Object.keys(n).map(i=>parseInt(i,10)).sort((i,s)=>s-i),r=[];for(let i of t)if(r=r.concat(n[i]),r.length>=e)break;return r}function tf(n,e,t){return r=>{let i=this.runesList[r];if(e.length>i.length)return;let[s,o]=this.algoFn(t,this.opts.normalize,this.opts.forward,i,e,!0,cg);if(s.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let l=s.start;l<s.end;++l)o.add(l)}let a=this.opts.sort?s.score:0;n[a]===void 0&&(n[a]=[]),n[a].push({item:this.items[r],...s,positions:o!=null?o:new Set})}}function ug(n){let{queryRunes:e,caseSensitive:t}=Zu(n,this.opts.casing,this.opts.normalize),r={},i=tf.bind(this)(r,e,t);for(let s=0,o=this.runesList.length;s<o;++s)i(s);return ef(r,this.opts.limit)}var fg=typeof require!="undefined"&&typeof window=="undefined";function dg(n,e,t,r){return new Promise((i,s)=>{let a=0,l=Math.min(1e3,e),c=()=>{if(n.cancelled)return s("search cancelled");for(;a<l;++a)t(a);l<e?(l=Math.min(l+1e3,e),fg?setImmediate(c):setTimeout(c)):i(r())};c()})}function hg(n,e){let{queryRunes:t,caseSensitive:r}=Zu(n,this.opts.casing,this.opts.normalize),i={};return dg(e,this.runesList.length,tf.bind(this)(i,t,r),()=>ef(i,this.opts.limit))}var nl={limit:1/0,selector:n=>n,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0},Ja=class{constructor(e,...t){switch(this.opts={...nl,...t[0]},this.items=e,this.runesList=e.map(r=>Ku(this.opts.selector(r).normalize())),this.algoFn=sg,this.opts.fuzzy){case"v2":this.algoFn=ig;break;case"v1":this.algoFn=Qu;break}}},B_={...nl,match:ug};var pg={...nl,match:hg},Qa=class extends Ja{constructor(e,...t){super(e,...t),this.opts={...pg,...t[0]},this.token={cancelled:!1}}async find(e){if(this.token.cancelled=!0,this.token={cancelled:!1},e.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(mg);e=e.normalize();let t=await this.opts.match.bind(this)(e,this.token);return gg(t,this.opts)}},mg=n=>({item:n,start:-1,end:-1,score:0,positions:new Set});function gg(n,e){if(e.sort){let{selector:t}=e;n.sort((r,i)=>{if(r.score===i.score)for(let s of e.tiebreakers){let o=s(r,i,t);if(o!==0)return o}return 0})}return Number.isFinite(e.limit)&&n.splice(e.limit),n}var Ds=class{constructor(e,...t){this.finder=new Qa(e,...t),this.find=this.finder.find.bind(this.finder)}};var ve=function(){return ve=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},ve.apply(this,arguments)};function yg(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}function vg(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(t=0)),t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function oe(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Se(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}var _g="ENTRIES",af="KEYS",lf="VALUES",Re="",rl=function(){function n(e,t){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:r,keys:i}]:[]}return n.prototype.next=function(){var e=this.dive();return this.backtrack(),e},n.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=hr(this._path),t=e.node,r=e.keys;if(hr(r)===Re)return{done:!1,value:this.result()};var i=t.get(hr(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},n.prototype.backtrack=function(){if(this._path.length!==0){var e=hr(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},n.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var t=e.keys;return hr(t)}).filter(function(e){return e!==Re}).join("")},n.prototype.value=function(){return hr(this._path).node.get(Re)},n.prototype.result=function(){switch(this._type){case lf:return this.value();case af:return this.key();default:return[this.key(),this.value()]}},n.prototype[Symbol.iterator]=function(){return this},n}(),hr=function(n){return n[n.length-1]},bg=function(n,e,t){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,s=i+t,o=new Uint8Array(s*i).fill(t+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return cf(n,e,t,r,o,1,i,""),r},cf=function(n,e,t,r,i,s,o,a){var l,c,u=s*o;try{e:for(var h=oe(n.keys()),f=h.next();!f.done;f=h.next()){var d=f.value;if(d===Re){var m=i[u-1];m<=t&&r.set(a,[n.get(d),m])}else{for(var p=s,g=0;g<d.length;++g,++p){for(var v=d[g],w=o*p,E=w-o,b=i[w],S=Math.max(0,p-t-1),A=Math.min(o-1,p+t),I=S;I<A;++I){var P=v!==e[I],O=i[E+I]+ +P,z=i[E+I+1]+1,D=i[w+I]+1,L=i[w+I+1]=Math.min(O,z,D);L<b&&(b=L)}if(b>t)continue e}cf(n.get(d),e,t,r,i,p,o,a+d)}}}catch(R){l={error:R}}finally{try{f&&!f.done&&(c=h.return)&&c.call(h)}finally{if(l)throw l.error}}},il=function(){function n(e,t){e===void 0&&(e=new Map),t===void 0&&(t=""),this._size=void 0,this._tree=e,this._prefix=t}return n.prototype.atPrefix=function(e){var t,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=Se(Os(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=Se(dl(o),2),l=a[0],c=a[1];try{for(var u=oe(l.keys()),h=u.next();!h.done;h=u.next()){var f=h.value;if(f!==Re&&f.startsWith(c)){var d=new Map;return d.set(f.slice(c.length),l.get(f)),new n(d,e)}}}catch(m){t={error:m}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}}return new n(s,e)},n.prototype.clear=function(){this._size=void 0,this._tree.clear()},n.prototype.delete=function(e){return this._size=void 0,wg(this._tree,e)},n.prototype.entries=function(){return new rl(this,_g)},n.prototype.forEach=function(e){var t,r;try{for(var i=oe(this),s=i.next();!s.done;s=i.next()){var o=Se(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.fuzzyGet=function(e,t){return bg(this._tree,e,t)},n.prototype.get=function(e){var t=cl(this._tree,e);return t!==void 0?t.get(Re):void 0},n.prototype.has=function(e){var t=cl(this._tree,e);return t!==void 0&&t.has(Re)},n.prototype.keys=function(){return new rl(this,af)},n.prototype.set=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=sl(this._tree,e);return r.set(Re,t),this},Object.defineProperty(n.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),n.prototype.update=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=sl(this._tree,e);return r.set(Re,t(r.get(Re))),this},n.prototype.fetch=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=sl(this._tree,e),i=r.get(Re);return i===void 0&&r.set(Re,i=t()),i},n.prototype.values=function(){return new rl(this,lf)},n.prototype[Symbol.iterator]=function(){return this.entries()},n.from=function(e){var t,r,i=new n;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=Se(o.value,2),l=a[0],c=a[1];i.set(l,c)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},n.fromObject=function(e){return n.from(Object.entries(e))},n}(),Os=function(n,e,t){var r,i;if(t===void 0&&(t=[]),e.length===0||n==null)return[n,t];try{for(var s=oe(n.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==Re&&e.startsWith(a))return t.push([n,a]),Os(n.get(a),e.slice(a.length),t)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return t.push([n,e]),Os(void 0,"",t)},cl=function(n,e){var t,r;if(e.length===0||n==null)return n;try{for(var i=oe(n.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==Re&&e.startsWith(o))return cl(n.get(o),e.slice(o.length))}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},sl=function(n,e){var t,r,i=e.length;e:for(var s=0;n&&s<i;){try{for(var o=(t=void 0,oe(n.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==Re&&e[s]===l[0]){for(var c=Math.min(i-s,l.length),u=1;u<c&&e[s+u]===l[u];)++u;var h=n.get(l);if(u===l.length)n=h;else{var f=new Map;f.set(l.slice(u),h),n.set(e.slice(s,s+u),f),n.delete(l),n=f}s+=u;continue e}}}catch(m){t={error:m}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}var d=new Map;return n.set(e.slice(s),d),d}return n},wg=function(n,e){var t=Se(Os(n,e),2),r=t[0],i=t[1];if(r!==void 0){if(r.delete(Re),r.size===0)uf(i);else if(r.size===1){var s=Se(r.entries().next().value,2),o=s[0],a=s[1];ff(i,o,a)}}},uf=function(n){if(n.length!==0){var e=Se(dl(n),2),t=e[0],r=e[1];if(t.delete(r),t.size===0)uf(n.slice(0,-1));else if(t.size===1){var i=Se(t.entries().next().value,2),s=i[0],o=i[1];s!==Re&&ff(n.slice(0,-1),s,o)}}},ff=function(n,e,t){if(n.length!==0){var r=Se(dl(n),2),i=r[0],s=r[1];i.set(s+e,t),i.delete(s)}},dl=function(n){return n[n.length-1]},li,hl="or",df="and",xg="and_not",Rs=function(){function n(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var t=e.autoVacuum==null||e.autoVacuum===!0?ll:e.autoVacuum;this._options=ve(ve(ve({},al),e),{autoVacuum:t,searchOptions:ve(ve({},nf),e.searchOptions||{}),autoSuggestOptions:ve(ve({},Cg),e.autoSuggestOptions||{})}),this._index=new il,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=fl,this.addFields(this._options.fields)}return n.prototype.add=function(e){var t,r,i,s,o,a,l=this._options,c=l.extractField,u=l.tokenize,h=l.processTerm,f=l.fields,d=l.idField,m=c(e,d);if(m==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(m))throw new Error("MiniSearch: duplicate ID ".concat(m));var p=this.addDocumentId(m);this.saveStoredFields(p,e);try{for(var g=oe(f),v=g.next();!v.done;v=g.next()){var w=v.value,E=c(e,w);if(E!=null){var b=u(E.toString(),w),S=this._fieldIds[w],A=new Set(b).size;this.addFieldLength(p,S,this._documentCount-1,A);try{for(var I=(i=void 0,oe(b)),P=I.next();!P.done;P=I.next()){var O=P.value,z=h(O,w);if(Array.isArray(z))try{for(var D=(o=void 0,oe(z)),L=D.next();!L.done;L=D.next()){var R=L.value;this.addTerm(S,p,R)}}catch(W){o={error:W}}finally{try{L&&!L.done&&(a=D.return)&&a.call(D)}finally{if(o)throw o.error}}else z&&this.addTerm(S,p,z)}}catch(W){i={error:W}}finally{try{P&&!P.done&&(s=I.return)&&s.call(I)}finally{if(i)throw i.error}}}}}catch(W){t={error:W}}finally{try{v&&!v.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}},n.prototype.addAll=function(e){var t,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.addAllAsync=function(e,t){var r=this;t===void 0&&(t={});var i=t.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(u,h,f){var d=u.chunk,m=u.promise;return d.push(h),(f+1)%s===0?{chunk:[],promise:m.then(function(){return new Promise(function(p){return setTimeout(p,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:m}},o),l=a.chunk,c=a.promise;return c.then(function(){return r.addAll(l)})},n.prototype.remove=function(e){var t,r,i,s,o,a,l=this._options,c=l.tokenize,u=l.processTerm,h=l.extractField,f=l.fields,d=l.idField,m=h(e,d);if(m==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var p=this._idToShortId.get(m);if(p==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(m,": it is not in the index"));try{for(var g=oe(f),v=g.next();!v.done;v=g.next()){var w=v.value,E=h(e,w);if(E!=null){var b=c(E.toString(),w),S=this._fieldIds[w],A=new Set(b).size;this.removeFieldLength(p,S,this._documentCount,A);try{for(var I=(i=void 0,oe(b)),P=I.next();!P.done;P=I.next()){var O=P.value,z=u(O,w);if(Array.isArray(z))try{for(var D=(o=void 0,oe(z)),L=D.next();!L.done;L=D.next()){var R=L.value;this.removeTerm(S,p,R)}}catch(W){o={error:W}}finally{try{L&&!L.done&&(a=D.return)&&a.call(D)}finally{if(o)throw o.error}}else z&&this.removeTerm(S,p,z)}}catch(W){i={error:W}}finally{try{P&&!P.done&&(s=I.return)&&s.call(I)}finally{if(i)throw i.error}}}}}catch(W){t={error:W}}finally{try{v&&!v.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}this._storedFields.delete(p),this._documentIds.delete(p),this._idToShortId.delete(m),this._fieldLength.delete(p),this._documentCount-=1},n.prototype.removeAll=function(e){var t,r;if(e)try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new il,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},n.prototype.discard=function(e){var t=this,r=this._idToShortId.get(e);if(r==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(r),this._storedFields.delete(r),(this._fieldLength.get(r)||[]).forEach(function(i,s){t.removeFieldLength(r,s,t._documentCount,i)}),this._fieldLength.delete(r),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},n.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,t=e.minDirtFactor,r=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:r,minDirtFactor:t})}},n.prototype.discardAll=function(e){var t,r,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},n.prototype.replace=function(e){var t=this._options,r=t.idField,i=t.extractField,s=i(e,r);this.discard(s),this.add(e)},n.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},n.prototype.conditionalVacuum=function(e,t){var r=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=r._enqueuedVacuumConditions;return r._enqueuedVacuumConditions=fl,r.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},n.prototype.performVacuuming=function(e,t){return yg(this,void 0,void 0,function(){var r,i,s,o,a,l,c,u,h,f,d,m,p,g,v,w,E,b,S,A,I,P,O,z,D;return vg(this,function(L){switch(L.label){case 0:if(r=this._dirtCount,!this.vacuumConditionsMet(t))return[3,10];i=e.batchSize||ul.batchSize,s=e.batchWait||ul.batchWait,o=1,L.label=1;case 1:L.trys.push([1,7,8,9]),a=oe(this._index),l=a.next(),L.label=2;case 2:if(l.done)return[3,6];c=Se(l.value,2),u=c[0],h=c[1];try{for(f=(P=void 0,oe(h)),d=f.next();!d.done;d=f.next()){m=Se(d.value,2),p=m[0],g=m[1];try{for(v=(z=void 0,oe(g)),w=v.next();!w.done;w=v.next())E=Se(w.value,1),b=E[0],!this._documentIds.has(b)&&(g.size<=1?h.delete(p):g.delete(b))}catch(R){z={error:R}}finally{try{w&&!w.done&&(D=v.return)&&D.call(v)}finally{if(z)throw z.error}}}}catch(R){P={error:R}}finally{try{d&&!d.done&&(O=f.return)&&O.call(f)}finally{if(P)throw P.error}}return this._index.get(u).size===0&&this._index.delete(u),o%i!==0?[3,4]:[4,new Promise(function(R){return setTimeout(R,s)})];case 3:L.sent(),L.label=4;case 4:o+=1,L.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return S=L.sent(),A={error:S},[3,9];case 8:try{l&&!l.done&&(I=a.return)&&I.call(a)}finally{if(A)throw A.error}return[7];case 9:this._dirtCount-=r,L.label=10;case 10:return[4,null];case 11:return L.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},n.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var t=e.minDirtCount,r=e.minDirtFactor;return t=t||ll.minDirtCount,r=r||ll.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=r},Object.defineProperty(n.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),n.prototype.has=function(e){return this._idToShortId.has(e)},n.prototype.getStoredFields=function(e){var t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)},n.prototype.search=function(e,t){var r,i;t===void 0&&(t={});var s=this.executeQuery(e,t),o=[];try{for(var a=oe(s),l=a.next();!l.done;l=a.next()){var c=Se(l.value,2),u=c[0],h=c[1],f=h.score,d=h.terms,m=h.match,p=d.length||1,g={id:this._documentIds.get(u),score:f*p,terms:Object.keys(m),queryTerms:d,match:m};Object.assign(g,this._storedFields.get(u)),(t.filter==null||t.filter(g))&&o.push(g)}}catch(v){r={error:v}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return e===n.wildcard&&t.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(sf),o},n.prototype.autoSuggest=function(e,t){var r,i,s,o;t===void 0&&(t={}),t=ve(ve({},this._options.autoSuggestOptions),t);var a=new Map;try{for(var l=oe(this.search(e,t)),c=l.next();!c.done;c=l.next()){var u=c.value,h=u.score,f=u.terms,d=f.join(" "),m=a.get(d);m!=null?(m.score+=h,m.count+=1):a.set(d,{score:h,terms:f,count:1})}}catch(S){r={error:S}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var p=[];try{for(var g=oe(a),v=g.next();!v.done;v=g.next()){var w=Se(v.value,2),m=w[0],E=w[1],h=E.score,f=E.terms,b=E.count;p.push({suggestion:m,terms:f,score:h/b})}}catch(S){s={error:S}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(s)throw s.error}}return p.sort(sf),p},Object.defineProperty(n.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),n.loadJSON=function(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)},n.getDefault=function(e){if(al.hasOwnProperty(e))return ol(al,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},n.loadJS=function(e,t){var r,i,s,o,a,l,c=e.index,u=e.documentCount,h=e.nextId,f=e.documentIds,d=e.fieldIds,m=e.fieldLength,p=e.averageFieldLength,g=e.storedFields,v=e.dirtCount,w=e.serializationVersion;if(w!==1&&w!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var E=new n(t);E._documentCount=u,E._nextId=h,E._documentIds=ks(f),E._idToShortId=new Map,E._fieldIds=d,E._fieldLength=ks(m),E._avgFieldLength=p,E._storedFields=ks(g),E._dirtCount=v||0,E._index=new il;try{for(var b=oe(E._documentIds),S=b.next();!S.done;S=b.next()){var A=Se(S.value,2),I=A[0],P=A[1];E._idToShortId.set(P,I)}}catch(we){r={error:we}}finally{try{S&&!S.done&&(i=b.return)&&i.call(b)}finally{if(r)throw r.error}}try{for(var O=oe(c),z=O.next();!z.done;z=O.next()){var D=Se(z.value,2),L=D[0],R=D[1],W=new Map;try{for(var Q=(a=void 0,oe(Object.keys(R))),re=Q.next();!re.done;re=Q.next()){var ue=re.value,fe=R[ue];w===1&&(fe=fe.ds),W.set(parseInt(ue,10),ks(fe))}}catch(we){a={error:we}}finally{try{re&&!re.done&&(l=Q.return)&&l.call(Q)}finally{if(a)throw a.error}}E._index.set(L,W)}}catch(we){s={error:we}}finally{try{z&&!z.done&&(o=O.return)&&o.call(O)}finally{if(s)throw s.error}}return E},n.prototype.executeQuery=function(e,t){var r=this;if(t===void 0&&(t={}),e===n.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){var i=ve(ve(ve({},t),e),{queries:void 0}),s=e.queries.map(function(g){return r.executeQuery(g,i)});return this.combineResults(s,i.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,c=o.searchOptions,u=ve(ve({tokenize:a,processTerm:l},c),t),h=u.tokenize,f=u.processTerm,d=h(e).flatMap(function(g){return f(g)}).filter(function(g){return!!g}),m=d.map(Ag(u)),p=m.map(function(g){return r.executeQuerySpec(g,u)});return this.combineResults(p,u.combineWith)},n.prototype.executeQuerySpec=function(e,t){var r,i,s,o,a=ve(ve({},this._options.searchOptions),t),l=(a.fields||this._options.fields).reduce(function(ue,fe){var we;return ve(ve({},ue),(we={},we[fe]=ol(a.boost,fe)||1,we))},{}),c=a.boostDocument,u=a.weights,h=a.maxFuzzy,f=a.bm25,d=ve(ve({},nf.weights),u),m=d.fuzzy,p=d.prefix,g=this._index.get(e.term),v=this.termResults(e.term,e.term,1,g,l,c,f),w,E;if(e.prefix&&(w=this._index.atPrefix(e.term)),e.fuzzy){var b=e.fuzzy===!0?.2:e.fuzzy,S=b<1?Math.min(h,Math.round(e.term.length*b)):b;S&&(E=this._index.fuzzyGet(e.term,S))}if(w)try{for(var A=oe(w),I=A.next();!I.done;I=A.next()){var P=Se(I.value,2),O=P[0],z=P[1],D=O.length-e.term.length;if(D){E==null||E.delete(O);var L=p*O.length/(O.length+.3*D);this.termResults(e.term,O,L,z,l,c,f,v)}}}catch(ue){r={error:ue}}finally{try{I&&!I.done&&(i=A.return)&&i.call(A)}finally{if(r)throw r.error}}if(E)try{for(var R=oe(E.keys()),W=R.next();!W.done;W=R.next()){var O=W.value,Q=Se(E.get(O),2),re=Q[0],D=Q[1];if(D){var L=m*O.length/(O.length+D);this.termResults(e.term,O,L,re,l,c,f,v)}}}catch(ue){s={error:ue}}finally{try{W&&!W.done&&(o=R.return)&&o.call(R)}finally{if(s)throw s.error}}return v},n.prototype.executeWildcardQuery=function(e){var t,r,i=new Map,s=ve(ve({},this._options.searchOptions),e);try{for(var o=oe(this._documentIds),a=o.next();!a.done;a=o.next()){var l=Se(a.value,2),c=l[0],u=l[1],h=s.boostDocument?s.boostDocument(u,"",this._storedFields.get(c)):1;i.set(c,{score:h,terms:[],match:{}})}}catch(f){t={error:f}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},n.prototype.combineResults=function(e,t){if(t===void 0&&(t=hl),e.length===0)return new Map;var r=t.toLowerCase();return e.reduce(Eg[r])||new Map},n.prototype.toJSON=function(){var e,t,r,i,s=[];try{for(var o=oe(this._index),a=o.next();!a.done;a=o.next()){var l=Se(a.value,2),c=l[0],u=l[1],h={};try{for(var f=(r=void 0,oe(u)),d=f.next();!d.done;d=f.next()){var m=Se(d.value,2),p=m[0],g=m[1];h[p]=Object.fromEntries(g)}}catch(v){r={error:v}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}s.push([c,h])}}catch(v){e={error:v}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},n.prototype.termResults=function(e,t,r,i,s,o,a,l){var c,u,h,f,d;if(l===void 0&&(l=new Map),i==null)return l;try{for(var m=oe(Object.keys(s)),p=m.next();!p.done;p=m.next()){var g=p.value,v=s[g],w=this._fieldIds[g],E=i.get(w);if(E!=null){var b=E.size,S=this._avgFieldLength[w];try{for(var A=(h=void 0,oe(E.keys())),I=A.next();!I.done;I=A.next()){var P=I.value;if(!this._documentIds.has(P)){this.removeTerm(w,P,t),b-=1;continue}var O=o?o(this._documentIds.get(P),t,this._storedFields.get(P)):1;if(O){var z=E.get(P),D=this._fieldLength.get(P)[w],L=Sg(z,b,this._documentCount,D,S,a),R=r*v*O*L,W=l.get(P);if(W){W.score+=R,Fg(W.terms,e);var Q=ol(W.match,t);Q?Q.push(g):W.match[t]=[g]}else l.set(P,{score:R,terms:[e],match:(d={},d[t]=[g],d)})}}}catch(re){h={error:re}}finally{try{I&&!I.done&&(f=A.return)&&f.call(A)}finally{if(h)throw h.error}}}}}catch(re){c={error:re}}finally{try{p&&!p.done&&(u=m.return)&&u.call(m)}finally{if(c)throw c.error}}return l},n.prototype.addTerm=function(e,t,r){var i=this._index.fetch(r,of),s=i.get(e);if(s==null)s=new Map,s.set(t,1),i.set(e,s);else{var o=s.get(t);s.set(t,(o||0)+1)}},n.prototype.removeTerm=function(e,t,r){if(!this._index.has(r)){this.warnDocumentChanged(t,e,r);return}var i=this._index.fetch(r,of),s=i.get(e);s==null||s.get(t)==null?this.warnDocumentChanged(t,e,r):s.get(t)<=1?s.size<=1?i.delete(e):s.delete(t):s.set(t,s.get(t)-1),this._index.get(r).size===0&&this._index.delete(r)},n.prototype.warnDocumentChanged=function(e,t,r){var i,s;try{for(var o=oe(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===t){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype.addDocumentId=function(e){var t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t},n.prototype.addFields=function(e){for(var t=0;t<e.length;t++)this._fieldIds[e[t]]=t},n.prototype.addFieldLength=function(e,t,r,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[t]=i;var o=this._avgFieldLength[t]||0,a=o*r+i;this._avgFieldLength[t]=a/(r+1)},n.prototype.removeFieldLength=function(e,t,r,i){if(r===1){this._avgFieldLength[t]=0;return}var s=this._avgFieldLength[t]*r-i;this._avgFieldLength[t]=s/(r-1)},n.prototype.saveStoredFields=function(e,t){var r,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var c=oe(o),u=c.next();!u.done;u=c.next()){var h=u.value,f=a(t,h);f!==void 0&&(l[h]=f)}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}},n.wildcard=Symbol("*"),n}(),ol=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0},Eg=(li={},li[hl]=function(n,e){var t,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=n.get(o);if(a==null)n.set(o,e.get(o));else{var l=e.get(o),c=l.score,u=l.terms,h=l.match;a.score=a.score+c,a.match=Object.assign(a.match,h),rf(a.terms,u)}}}catch(f){t={error:f}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},li[df]=function(n,e){var t,r,i=new Map;try{for(var s=oe(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=n.get(a);if(l!=null){var c=e.get(a),u=c.score,h=c.terms,f=c.match;rf(l.terms,h),i.set(a,{score:l.score+u,terms:l.terms,match:Object.assign(l.match,f)})}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},li[xg]=function(n,e){var t,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;n.delete(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},li),Tg={k:1.2,b:.7,d:.5},Sg=function(n,e,t,r,i,s){var o=s.k,a=s.b,l=s.d,c=Math.log(1+(t-e+.5)/(e+.5));return c*(l+n*(o+1)/(n+o*(1-a+a*r/i)))},Ag=function(n){return function(e,t,r){var i=typeof n.fuzzy=="function"?n.fuzzy(e,t,r):n.fuzzy||!1,s=typeof n.prefix=="function"?n.prefix(e,t,r):n.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},al={idField:"id",extractField:function(n,e){return n[e]},tokenize:function(n){return n.split(Ig)},processTerm:function(n){return n.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(n,e){typeof(console==null?void 0:console[n])=="function"&&console[n](e)},autoVacuum:!0},nf={combineWith:hl,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Tg},Cg={combineWith:df,prefix:function(n,e,t){return e===t.length-1}},ul={batchSize:1e3,batchWait:10},fl={minDirtFactor:.1,minDirtCount:20},ll=ve(ve({},ul),fl),Fg=function(n,e){n.includes(e)||n.push(e)},rf=function(n,e){var t,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;n.includes(o)||n.push(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},sf=function(n,e){var t=n.score,r=e.score;return r-t},of=function(){return new Map},ks=function(n){var e,t,r=new Map;try{for(var i=oe(Object.keys(n)),s=i.next();!s.done;s=i.next()){var o=s.value;r.set(parseInt(o,10),n[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},Ig=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;function ci(n,e,t){var r=t||{},i=r.noTrailing,s=i===void 0?!1:i,o=r.noLeading,a=o===void 0?!1:o,l=r.debounceMode,c=l===void 0?void 0:l,u,h=!1,f=0;function d(){u&&clearTimeout(u)}function m(g){var v=g||{},w=v.upcomingOnly,E=w===void 0?!1:w;d(),h=!E}function p(){for(var g=arguments.length,v=new Array(g),w=0;w<g;w++)v[w]=arguments[w];var E=this,b=Date.now()-f;if(h)return;function S(){f=Date.now(),e.apply(E,v)}function A(){u=void 0}!a&&c&&!u&&S(),d(),c===void 0&&b>n?a?(f=Date.now(),s||(u=setTimeout(c?A:S,n))):S():s!==!0&&(u=setTimeout(c?A:S,c===void 0?n-b:n))}return p.cancel=m,p}function hf(n,e,t){var r=t||{},i=r.atBegin,s=i===void 0?!1:i;return ci(n,e,{debounceMode:s!==!1})}var ui=class{static minInSet(e){let t=Number.MAX_VALUE;for(let r of e)r<t&&(t=r);return t}},Ls=class{constructor(e,t,r){this.flushThrottled=ci(1e4,()=>this.forceFlush());this.elementsMap=new Map,this.handler=e,this.identifier=t,this.autoFlushThreshold=r}add(e){let t=this.identifier(e);this.elementsMap.set(t,e),this.elementsMap.size>=this.autoFlushThreshold&&this.flushThrottled()}async forceFlush(){if(this.elementsMap.size===0)return;let e=Array.from(this.elementsMap.values());this.elementsMap.clear(),await this.handler(e),F.debug("flushed")}},Ns=class{constructor(e,t=Number.MAX_VALUE){this.heap=[],this.compare=e,this.capacity=t}values(){return this.heap}push(e){this.size()<this.capacity?(this.heap.push(e),this.heapifyUp()):this.compare(e,this.heap[0])>0&&(this.heap[0]=e,this.heapifyDown())}clear(){this.heap=[]}pop(){if(this.isEmpty())return;let e=this.heap[0];return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.heapifyDown(),e}peek(){return this.heap[0]}isEmpty(){return this.heap.length===0}size(){return this.heap.length}getLeftChildIndex(e){return 2*e+1}getRightChildIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}heapifyUp(){let e=this.heap.length-1;for(;this.getParentIndex(e)>=0&&this.compare(this.heap[this.getParentIndex(e)],this.heap[e])>0;)this.swap(this.getParentIndex(e),e),e=this.getParentIndex(e)}heapifyDown(){let e=0;for(;this.getLeftChildIndex(e)<this.heap.length;){let t=this.getLeftChildIndex(e);if(this.getRightChildIndex(e)<this.heap.length&&this.compare(this.heap[this.getRightChildIndex(e)],this.heap[t])<0&&(t=this.getRightChildIndex(e)),this.compare(this.heap[e],this.heap[t])<0)break;this.swap(e,t),e=t}}};var pl=pe(_e());var Pg=/[\u4e00-\u9fa5]/,pf=/[\u4e00-\u9fa5]/g,mf=/[\u4e00-\u9fa5]/,js=class{static isLargeCharset(e){return(e.match(pf)||[]).length>=Math.ceil(e.length*.35)}static testWideChar(e){return Pg.test(e)}static wideCharProportion(e){return(e.match(pf)||[]).length/e.length}};var gf=pe(_e());var Mg=/[\[\]{}()<>\s]+/u,Dg=/[\^=#%\/\*,\.`:;\?@\s\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,kg=/[-_]|([a-z](?=[A-Z]))/g,pn=class{constructor(){this.setting=x(de);this.chsSegmenter=x(It);this.logThrottled=ci(300,e=>F.info(e));this.assetsProvider=x(rt);this.stopWordsZh=this.assetsProvider.assets.stopWordsZh;this.stopWordsEn=this.assetsProvider.assets.stopWordsEn}tokenize(e,t){var s,o;let r=new Set,i=e.split(Mg);for(let a of i)if(a)if(this.setting.enableChinesePatch&&mf.test(a)){let l=this.chsSegmenter.cut(a,!0);for(let c of l){if(this.setting.enableStopWordsZh&&((s=this.stopWordsZh)!=null&&s.has(c))){t==="search"&&c.length>1&&F.debug(`excluded: ${c}`);continue}r.add(c)}}else{let l=a.split(Dg);for(let c of l)if(!(c.length<2||this.setting.enableStopWordsEn&&((o=this.stopWordsEn)!=null&&o.has(c)))&&(r.add(c),c.length>3)){let u=c.replace(kg,"$1 ").split(" ");for(let h of u)h.length>1&&r.add(h)}}return Array.from(r).filter(a=>a.length<30)}};pn=U([(0,gf.singleton)()],pn);var Nn=class{static forType(e,t){return t&&js.testWideChar(t)?this.limitsByLanguage["\u7B80\u4F53\u4E2D\u6587"][e]:this.limitsByLanguage["English"][e]}},_t=Nn;_t.default={line:{maxPreLines:0,maxPostLines:0,maxPreChars:30,maxPostChars:230,boundaryLineMinChars:4},paragraph:{maxPreLines:4,maxPostLines:7,maxPreChars:220,maxPostChars:600,boundaryLineMinChars:4},subItem:{maxPreLines:3,maxPostLines:3,maxPreChars:180,maxPostChars:200,boundaryLineMinChars:4}},_t.limitsByLanguage={["Other Language"]:Nn.default,["English"]:Nn.default,["\u7B80\u4F53\u4E2D\u6587"]:{line:{...Nn.default.line,maxPreChars:30,maxPostChars:230},paragraph:{...Nn.default.paragraph,maxPreChars:220,maxPostChars:600},subItem:{...Nn.default.subItem,maxPreChars:60,maxPostChars:80}}};var ht=class{constructor(){this.option=x(fi);this.outerSetting=x(de);this.filesIndex=new Rs(this.option.fileIndexOption);this.linesIndex=new Rs(this.option.lineIndexOption);this.tokenizer=x(pn);this._isReady=!1}async reIndexAll(e){if(this._isReady=!1,this.filesIndex.removeAll(),Array.isArray(e))F.trace("Indexing all documents..."),await this.addDocuments(e);else{F.trace("Loading indexed data...");try{this.filesIndex=Rs.loadJS(e,this.option.fileIndexOption)}catch(t){return F.error(t),!1}}return this._isReady=!0,F.trace(this.filesIndex),!0}get isReady(){return this._isReady}async addDocuments(e){let t=e.filter(r=>!this.filesIndex.has(r.path));await this.filesIndex.addAllAsync(t,{chunkSize:this.option.documentChunkSize}),F.debug(`added ${t.length}`)}deleteDocuments(e){let t=e.filter(r=>this.filesIndex.has(r));this.filesIndex.discardAll(t),F.debug(`deleted ${t.length}`)}async fzfMatch(e,t){return(await new Ds(t,{selector:i=>i.text}).find(e)).slice(0,this.outerSetting.ui.maxItemResults).map(i=>({text:i.item.text,row:i.item.row,positions:i.positions}))}async searchFiles(e){let t=new hi(e),r=this.filesIndex.search(t.text,this.option.getFileSearchOption(t.userOption));return F.debug(`maxFileItems: ${this.outerSetting.ui.maxItemResults}`),r.slice(0,this.outerSetting.ui.maxItemResults).map(i=>({path:i.id,queryTerms:i.queryTerms,matchedTerms:i.terms}))}async searchLinesByFileItem(e,t,r,i,s){F.debug(i.queryTerms),F.debug(i.matchedTerms);let o=50;return F.debug(`max subItems: ${o}`),new di(e,t,r,i.queryTerms,i.matchedTerms,s).parse()}async searchLinesForSmallCharset(e,t,r){this.linesIndex.removeAll(),this.linesIndex.addAll(e);let i=this.linesIndex.search(t,this.option.getLineSearchOption());return F.debug(`matched lines count: ${i.length}`),F.debug(`only parse top ${r} matched lines per file`),i.slice(0,r).map(s=>{let o=e[s.id].text;return{text:o,row:s.id,positions:this.findAllTermPositions(o,s.terms)}})}findAllTermPositions(e,t){let r=new RegExp(t.join("|"),"gi"),i=new Set,s,o=-1;for(;(s=r.exec(e))!==null;){if(s.index===o||s[0].length===0){r.lastIndex++;continue}for(let a=0;a<s[0].length;a++)i.add(s.index+a);o=s.index}return i}};U([Be],ht.prototype,"reIndexAll",1),U([Be],ht.prototype,"searchFiles",1),U([Be],ht.prototype,"searchLinesForSmallCharset",1),ht=U([(0,pl.singleton)()],ht);var fi=class{constructor(){this.outerSetting=x(de);this.inSetting=jc.search;this.tokenizer=x(pn);this.tokenizeIndex=e=>this.tokenizer.tokenize(e,"index");this.tokenizeSearch=e=>this.tokenizer.tokenize(e,"search");this.fileIndexOption={tokenize:this.tokenizeIndex,idField:"path",fields:["basename","aliases","folder","headings","content"],storeFields:["tags"],processTerm:e=>this.outerSetting.isCaseSensitive?e:e.toLocaleLowerCase()};this.lineIndexOption={tokenize:this.tokenizeIndex,idField:"row",fields:["text"]}}getFileSearchOption(e){return{tokenize:this.tokenizeSearch,prefix:t=>e.isPrefixMatch?t.length>=this.inSetting.minTermLengthForPrefixSearch:!1,fuzzy:t=>e.isFuzzy?t.length<=3?0:this.inSetting.fuzzyProportion:!1,boost:{basename:this.inSetting.weightFilename,aliases:this.inSetting.weightFilename,folder:this.inSetting.weightFolder,tags:this.inSetting.weightTagText,headings:this.inSetting.weightHeading},combineWith:"and"}}getLineSearchOption(){return{prefix:e=>e.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:e=>e.length<=3?0:this.inSetting.fuzzyProportion,combineWith:"or"}}};fi=U([(0,pl.singleton)()],fi);var di=class{constructor(e,t,r,i,s,o){this.outerSetting=x(de);let a=new hi(r);this.userOption=a.userOption,this.lines=e,this.matchedTerms=this.filterMatchedTerms(i,s),this.maxParsedLines=o;let l=_t.forType(t,a.text);this.preChars=l.maxPreChars,this.postChars=l.maxPostChars,F.debug(`doc matchedTerms: ${this.matchedTerms.join(" ")}`)}parse(){return this.highlightLines(this.getTopRelevantLines(this.lines,this.maxParsedLines))}filterMatchedTerms(e,t){let r=e.filter(s=>!e.some(o=>o.length>s.length&&o.includes(s))&&t.includes(s)),i;if(r.length===0)i=t.filter(s=>!t.some(o=>o.length>s.length&&o.includes(s)));else{i=r;for(let s of t)!r.includes(s)&&!this.isSubstringOrSuperString(s,t)&&i.push(s)}return i}isSubstringOrSuperString(e,t){return t.some(r=>r.length>e.length&&r.includes(e)||e.length>r.length&&e.includes(r))}getTopRelevantLines(e,t){let r=new RegExp(this.matchedTerms.join("|"),"i"),i=this.matchedTerms.map(l=>this.generateRegExpForTerm(l)),s=new Ns((l,c)=>l-c,t);s.push(0);let o=new Map,a=new Map;for(let l of e){if(!r.test(l.text))continue;a.clear();let c=0;for(let u of i){u.lastIndex=0;let h;for(;(h=u.exec(l.text))!==null;){let f=h[0],d=(a.get(f)||0)+1;a.set(f,d),c+=d===1?f.length:.01}}c>s.peek()&&(s.push(c),o.set(l,c))}return Array.from(o.entries()).sort((l,c)=>c[1]-l[1]).slice(0,t).map(l=>l[0])}highlightLines(e){let t=new Map;for(let r of this.matchedTerms)t.set(r,this.generateRegExpForTerm(r));return e.map(r=>{let i=new Set,s=-1,o=-1;for(let a=this.matchedTerms.length-1;a>=0;a--){let l=this.matchedTerms[a],c=r.text.search(t.get(l));if(c!==-1){s=Math.max(0,c-this.preChars),o=Math.min(r.text.length,c+l.length+this.postChars);break}}if(s!==-1&&o!==-1){let a=r.text.slice(s,o);for(let l of this.matchedTerms){let c=t.get(l),u;for(;(u=c.exec(a))!==null;){let h=u.index+s,f=h+u[0].length;for(let d=h;d<f;d++)i.add(d)}}}return{text:r.text,row:r.row,positions:i}})}generateRegExpForTerm(e){let t=this.outerSetting.isCaseSensitive?"g":"gi",r=this.userOption.isPrefixMatch?e:`${e}(?![a-zA-Z])`;return new RegExp(r,t)}};U([Be],di.prototype,"getTopRelevantLines",1),U([Be],di.prototype,"highlightLines",1);var Bs=class{constructor(){this.outerSetting=x(de);this.isPrefixMatch=this.outerSetting.isPrefixMatch,this.isFuzzy=this.outerSetting.isFuzzy}},hi=class{constructor(e){this.userOption=new Bs;this.parse(e)}parse(e){let t="";if(e.startsWith("/")){let r=e.indexOf(" ");r!==-1?(t=e.slice(0,r),this.text=e.slice(r+1)):(t=e,this.text="");let i=t.split("/").filter(s=>s);for(let s of i)if(s==="ap")this.userOption.isPrefixMatch=!0;else if(s==="np")this.userOption.isPrefixMatch=!1;else if(s==="af")this.userOption.isFuzzy=!0;else if(s==="nf")this.userOption.isFuzzy=!1;else{this.userOption=new Bs,F.info("invalid command: /"+s);break}}else this.text=e}};hi.registeredCommands=new Set(["ap","np","af","nf"]);var ml=class{constructor(){this.listeners=new Map}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(t)}off(e,t){let r=this.listeners.get(e);if(r){let i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){var r;(r=this.listeners.get(e))==null||r.forEach(i=>{i(...t)})}},mn=new ml;var wf=pe(_e());var bt=require("obsidian");var gl=pe(_e());var Ke=class{constructor(){this.vault=x(bt.Vault);this.app=x(bt.App);this.setting=x(de);this.privateApi=x(Ve);this.viewRegistry=x(We);this.htmlParser=x(pi);this.init()}init(){this.excludedPaths=new Set(this.setting.excludedPaths),this.supportedExtensions=new Set(this.setting.customExtensions.plaintext)}async generateAllIndexedDocuments(e){return Promise.all(e.map(async t=>{if(this.isContentIndexable(t)){let r=this.app.metadataCache.getFileCache(t);if(this.viewRegistry.viewTypeByPath(t.path)==="markdown")return{path:t.path,basename:t.basename,folder:ye.getFolderPath(t.path),aliases:this.parseAliases(r),tags:this.parseTags(r),headings:this.parseHeadings(r),content:await this.readPlainText(t)};throw new Error(Qn)}else return{path:t.path,basename:t.basename,folder:ye.getFolderPath(t.path)}}))}allFilesToBeIndexed(){let e=this.vault.getFiles();F.debug(`all files: ${e.length}`),ye.countFileByExtensions(e);let t=e.filter(r=>this.isIndexable(r));return F.debug(`indexable files: ${t.length}`),ye.countFileByExtensions(t),t}isIndexable(e){if(e instanceof bt.TFolder)return!1;let t;return typeof e=="string"?t=e:t=e.path,this.supportedExtensions.has(ye.getExtension(t))&&t.lastIndexOf("excalidraw.md")===-1&&(this.setting.followObsidianExcludedFiles?this.privateApi.isNotObsidianExcludedPath(t):!0)&&(this.excludedPaths.size===0?!0:this.isNotCustomExcludedPath(t))}async readPlainText(e){let t=typeof e=="string"?this.vault.getAbstractFileByPath(e):e;if(t instanceof bt.TFile)if(this.viewRegistry.viewTypeByPath(t.path)==="markdown"){let r=await this.vault.cachedRead(t);return t.extension==="html"?this.htmlParser.toMarkdown(r):r}else throw Error(`unsupported file extension as plain text to read, path: ${t.path}`);else return""}async readPlainTextLines(e){return(await this.readPlainText(e)).split(ye.SPLIT_EOL)}parseAliases(e){return((0,bt.parseFrontMatterAliases)(e==null?void 0:e.frontmatter)||[]).join(" ")}parseTags(e){var t;return((t=e==null?void 0:e.tags)==null?void 0:t.map(r=>r.tag.slice(1)).join(" "))||""}parseHeadings(e){var t;return((t=e==null?void 0:e.headings)==null?void 0:t.map(r=>r.heading).join(" "))||""}isContentIndexable(e){return Ke.contentIndexableViewTypes.has(this.viewRegistry.viewTypeByPath(e.path))}isNotCustomExcludedPath(e){let t=e.split("/"),r="";for(let i of t)if(r+=(r?"/":"")+i,this.excludedPaths.has(r))return!1;return!0}};Ke.contentIndexableViewTypes=new Set(["markdown"]),Ke=U([(0,gl.singleton)()],Ke);var pi=class{constructor(){this.MARKDOWN_LINK_REGEX=/\[([^[\]]+)\]\([^()]*\)/g;this.MARKDOWN_ASTERISK_REGEX=/\*\*(.*?)\*\*/g;this.MARKDOWN_BACKTICK_REGEX=/`(.*?)`/g}toMarkdown(e){let t=(0,bt.htmlToMarkdown)(e);return t=t.replace(this.MARKDOWN_LINK_REGEX,"$1"),t=t.replace(this.MARKDOWN_ASTERISK_REGEX,"$1"),t=t.replace(this.MARKDOWN_BACKTICK_REGEX,"$1"),t}};pi=U([(0,gl.singleton)()],pi);var yf=require("obsidian");var vf=pe(_e());var jn=class{constructor(){this.dataManager=x(st);this.app=x(yf.App);this.onCreate=e=>{F.debug(`created: ${e.path}`),this.dataManager.receiveDocOperation(new Bn(e))};this.onDelete=e=>{F.debug(`deleted: ${e.path}`),this.dataManager.receiveDocOperation(new zn(e.path))};this.onRename=(e,t)=>{F.debug(`renamed: ${t} => ${e.path}`),this.dataManager.receiveDocOperation(new zn(t)),this.dataManager.receiveDocOperation(new Bn(e))};this.onModify=e=>{F.debug(`modified: ${e.path}`),this.dataManager.receiveDocOperation(new zn(e.path)),this.dataManager.receiveDocOperation(new Bn(e))}}start(){this.stop(),this.app.vault.on("create",this.onCreate),this.app.vault.on("delete",this.onDelete),this.app.vault.on("rename",this.onRename),this.app.vault.on("modify",this.onModify),F.trace("FileWatcher started")}stop(){this.app.vault.off("create",this.onCreate),this.app.vault.off("delete",this.onDelete),this.app.vault.off("rename",this.onRename),this.app.vault.off("modify",this.onModify)}};jn=U([(0,vf.singleton)()],jn);var st=class{constructor(){this.plugin=x(ut);this.database=x(dn);this.dataProvider=x(Ke);this.lexicalEngine=x(ht);this.semanticEngine=x(it);this.semanticConfig=x(de).semantic;this.shouldForceRefresh=!1;this.isLexicalEngineUpToDate=!1;this.isSemanticEngineUpToDate=!1;this.docOperationsHandler=async e=>{e.sort((t,r)=>t.time-r.time);for(let t of e)if(t instanceof Bn)await this.addDocuments([t.file]);else if(t instanceof zn)await this.deleteDocuments([t.path]);else throw Error(ts)};this.docOperationsBuffer=new Ls(this.docOperationsHandler,e=>e.path+e.type,3)}async initAsync(){await this.database.deleteOldDatabases(),await this.initLexicalEngine(),await this.initSemanticEngine(),this.shouldForceRefresh||(this.plugin.registerInterval(window.setInterval(()=>{this.isSemanticEngineUpToDate||this.initSemanticEngine()},3500)),mn.on(10,()=>this.docOperationsBuffer.forceFlush()),x(jn).start())}onunload(){x(jn).stop()}receiveDocOperation(e){this.docOperationsBuffer.add(e)}async refreshAllAsync(){let e=new Ce(j("Reindexing..."));this.shouldForceRefresh=!0,await this.initAsync(),e.hide(),new Ce(j("Indexing finished"),5e3),this.shouldForceRefresh=!1}async addDocuments(e,t=!1){if(e.length>0){let r=[];for(let s of e)s instanceof bf.TFile&&r.push(s);let i=await this.dataProvider.generateAllIndexedDocuments(r.filter(s=>this.dataProvider.isIndexable(s)));t?this.semanticConfig.isEnabled&&await this.semanticEngine.addDocuments(i):await this.lexicalEngine.addDocuments(i)}}async deleteDocuments(e,t=!1){if(e.length>0){let r=e.filter(i=>this.dataProvider.isIndexable(i));t?this.semanticConfig.isEnabled&&await this.semanticEngine.deleteDocuments(r):this.lexicalEngine.deleteDocuments(r)}}async initLexicalEngine(){F.trace("Init lexical engine...");let e;!Or.loadIndexFromDatabase||this.shouldForceRefresh?e=null:e=await this.database.getMiniSearchData(),e?(this.database.deleteMinisearchData(),F.trace("Previous minisearch data is found."),await this.lexicalEngine.reIndexAll(e)||(new Ce(j("Database has been updated, a reindex is required"),7e3),await this.reindexLexicalEngineWithCurrFiles())):await this.reindexLexicalEngineWithCurrFiles(),this.isLexicalEngineUpToDate||await this.updateDocRefByMtime(!1),F.trace("Lexical engine is ready"),await this.database.setMiniSearchData(this.lexicalEngine.filesIndex.toJSON())}async reindexLexicalEngineWithCurrFiles(){F.trace("Indexing the whole vault...");let e=this.dataProvider.allFilesToBeIndexed(),t=0;for(let i of e)t+=i.stat.size;if(t/=1024,t>2e3){let i=(t/1024).toFixed(2)+" MB";new Ce(`${i} ${j("files need to be indexed. Obsidian may freeze for a while")}`,7e3)}let r=await this.dataProvider.generateAllIndexedDocuments(e);await this.lexicalEngine.reIndexAll(r),this.isLexicalEngineUpToDate=!0}async updateDocRefByMtime(e){let t=new Map(this.dataProvider.allFilesToBeIndexed().map(a=>[a.path,a])),r=e?await this.database.getSemanticDocRefs():await this.database.getLexicalDocRefs(),i=new Map(r==null?void 0:r.map(a=>[a.path,a])),s=[],o=[];for(let[a,l]of t){let c=i.get(a);c?l.stat.mtime>c.updateTime&&(o.push(l.path),s.push(l)):s.push(l)}for(let a of i.keys())t.has(a)||o.push(a);F.trace(`docs to delete: ${o.length}`),F.trace(`docs to add: ${s.length}`),await this.deleteDocuments(o,e),await this.addDocuments(s,e),await this.saveDocRefs(Array.from(t.values()),e)}async saveDocRefs(e,t){let r=e.map(i=>({path:i.path,updateTime:i.stat.mtime}));t?(await this.database.setSemanticDocRefs(r),F.trace(`${r.length} semantic refs updated`)):(await this.database.setLexicalDocRefs(r),F.trace(`${r.length} lexical refs updated`))}async initSemanticEngine(){if(this.semanticConfig.isEnabled){let e=await this.semanticEngine.doesCollectionExist();if(e===null)return;if(e===!1||this.shouldForceRefresh){let t=null;this.semanticConfig.serverType==="local"&&(t=new Ce(j("Semantic init time"),0));let r=this.dataProvider.allFilesToBeIndexed();await this.saveDocRefs(r,!0);let i=await this.dataProvider.generateAllIndexedDocuments(r);await this.semanticEngine.reindexAll(i),t&&t.hide(),new Ce(j("Semantic init finished"),0),this.isSemanticEngineUpToDate=!0}this.isSemanticEngineUpToDate||(this.isSemanticEngineUpToDate=!0,await this.updateDocRefByMtime(!0)),F.trace("Semantic engine is ready")}}};U([Be],st.prototype,"initAsync",1),st=U([(0,wf.singleton)()],st);var zs=class{constructor(e,t){this.time=performance.now();this.type=e,typeof t=="string"?this.path=t:this.path=t.path}},Bn=class extends zs{constructor(t){super("add",t);this.file=t}},zn=class extends zs{constructor(e){super("delete",e)}};var wt=class{constructor(){this.plugin=x(ut);this.shouldReload=!1}async initAsync(){await this.loadSettings(),Un.container.register(de,{useValue:this.setting}),this.plugin.addSettingTab(x(mi))}async saveSettings(){await this.plugin.saveData(this.setting)}async postSettingUpdated(){this.saveSettings(),this.shouldReload&&(this.shouldReload=!1,await this.downloadAndRefresh())}async loadSettings(){this.setting=jt.mergeDeep(Nc,await this.plugin.loadData()),F.setLevel(this.setting.logLevel)}async downloadAndRefresh(){x(We).refreshAll(),await x(rt).initAsync(),await x(It).initAsync(),x(Ke).init(),await x(st).refreshAllAsync()}};wt=U([(0,Un.singleton)()],wt);var mi=class extends te.PluginSettingTab{constructor(t){super(t.app,t);this.settingManager=x(wt);this.setting=x(de)}hide(){this.settingManager.postSettingUpdated()}display(){let{containerEl:t}=this;t.empty(),new te.Setting(t).setName(j("Max items count")).setDesc(j("Max items count desc")).addSlider(a=>a.setLimits(1,300,1).setValue(this.setting.ui.maxItemResults).setDynamicTooltip().onChange(l=>{this.setting.ui.maxItemResults=l})),new te.Setting(t).setName(j("Floating window for in-file search")).setDesc(j("Floating window for in-file search desc")).addToggle(a=>a.setValue(this.setting.ui.floatingWindowForInFile).onChange(l=>this.setting.ui.floatingWindowForInFile=l)),new te.Setting(t).setName(j("Case sensitive")).addToggle(a=>a.setValue(this.setting.isCaseSensitive).onChange(l=>{this.setting.isCaseSensitive=l,this.settingManager.shouldReload=!0})),new te.Setting(t).setName(j("Prefix match")).addToggle(a=>a.setValue(this.setting.isPrefixMatch).onChange(l=>this.setting.isPrefixMatch=l)),new te.Setting(t).setName(j("Character fuzzy allowed")).addToggle(a=>a.setValue(this.setting.isFuzzy).onChange(l=>this.setting.isFuzzy=l)),new te.Setting(t).setName(j("English word blacklist")).setDesc(j("English word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsEn).onChange(l=>{this.setting.enableStopWordsEn=l,this.settingManager.shouldReload=!0})),new te.Setting(t).setName(j("Chinese patch")).setDesc(j("Chinese patch desc")).addToggle(a=>a.setValue(this.setting.enableChinesePatch).onChange(async l=>{this.setting.enableChinesePatch=l,F.info(`enable chinese: ${x(de).enableChinesePatch}`),this.settingManager.shouldReload=!0})),new te.Setting(t).setName(j("Chinese word blacklist")).setDesc(j("Chinese word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsZh).onChange(async l=>{this.setting.enableStopWordsZh=l,this.settingManager.shouldReload=!0})),new te.Setting(t).setName(j("Advanced")).setDesc(j("Advanced.desc")),new te.Setting(t).setName(j("Semantic search")).addButton(a=>a.setButtonText(j("Manage")).onClick(()=>new _l(x(te.App)).open())),new te.Setting(t).setName(j("Excluded files")).addButton(a=>a.setButtonText(j("Manage")).onClick(()=>{new yl(x(te.App)).open()})),new te.Setting(t).setName(j("Customize extensions")).addButton(a=>a.setButtonText(j("Manage")).onClick(()=>new vl(x(te.App)).open())),new te.Setting(t).setName(j("Reindex the vault")).addButton(a=>{a.setButtonText(j("Reindex")).onClick(async()=>{await x(st).refreshAllAsync()})});let r=t.createDiv("cs-dev-setting-group");r.style.marginTop="1.5em";let i=r.createDiv({cls:"cs-setting-group-dev-title",text:j("For Development")}),s=r.createDiv({cls:"cs-setting-group-dev-content"}),o=this.setting.ui.collapseDevSettingByDefault;s.style.display=o?"none":"block",i.style.setProperty("--cs-dev-collapse-icon",o?No:jo),i.onclick=()=>{let a=s.style.display==="none";s.style.display=a?"block":"none",i.style.setProperty("--cs-dev-collapse-icon",a?jo:No)},new te.Setting(s).setName(j("Collapse development setting by default")).addToggle(a=>a.setValue(this.setting.ui.collapseDevSettingByDefault).onChange(l=>{this.setting.ui.collapseDevSettingByDefault=l})),new te.Setting(s).setName(j("Log level")).addDropdown(a=>a.addOptions({trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",none:"none"}).setValue(this.setting.logLevel.toLowerCase()).onChange(async l=>{let c=l;F.setLevel(c),this.setting.logLevel=c})),new te.Setting(s).setName(j("Reset floating window position")).setDesc(j("Reset floating window position desc")).addButton(a=>a.setButtonText(j("Reset position")).onClick(l=>{x(ot).resetAllPositions()})),new te.Setting(s).setName(j("Support the Project")).setDesc(j("Support the Project desc")).addButton(a=>{a.setButtonText(j("Visit GitHub")).onClick(()=>{window.open("https://github.com/yan42685/obsidian-clever-search","_blank")})}),new te.Setting(s).setName("API provider1").setDesc("domain and key").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider1.domain).onChange(l=>{this.setting.apiProvider1.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider1.key).onChange(l=>{this.setting.apiProvider1.key=l})),new te.Setting(s).setName("API provider2").setDesc("description").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider2.domain).onChange(l=>{this.setting.apiProvider2.domain=l})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider2.key).onChange(l=>{this.setting.apiProvider2.key=l}))}};mi=U([(0,Un.singleton)(),Pi(0,(0,Un.inject)(ut))],mi);var yl=class extends te.Modal{constructor(t){super(t);this.settingManager=x(wt);this.setting=x(de);this.excludedPaths=this.setting.excludedPaths;this.allPaths=new Set;this.allFolders=new Set;let r=x(te.Vault).getAllLoadedFiles();for(let i of r)this.allPaths.add(i.path),i instanceof te.TFolder&&this.allFolders.add(i.path)}onOpen(){var r;this.modalEl.style.width="48vw",this.modalEl.style.marginBottom="5em",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new te.Setting(t).setName(j("Follow Obsidian Excluded Files")).addToggle(i=>i.setValue(this.setting.followObsidianExcludedFiles).onChange(s=>{this.setting.followObsidianExcludedFiles=s,this.settingManager.shouldReload=!0})),t.createEl("h2",{text:j("Excluded files")}),this.excludesEl=t.createDiv(),this.renderExcludedList(this.excludesEl),new te.Setting(t).addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder(j("Enter path...")).onChange(s=>{this.suggester.close(),this.suggester.open()})}).addButton(i=>{i.setButtonText(j("Add")).onClick(()=>{this.addPath(this.inputEl.value)})}),this.suggester=new ns(this.inputEl,this.allFolders,i=>{this.addPath(i)}),setTimeout(()=>{this.inputEl.focus()},1)}renderExcludedList(t){t.empty(),this.excludedPaths.forEach((r,i)=>{let s=t.createDiv();s.style.overflow="auto",s.style.display="flex",s.style.margin="0.7em 0 0.7em 0",s.style.justifyContent="space-between";let o=s.createSpan();o.setText(r),o.style.width="90%",o.style.overflow="auto";let a=s.createSpan();a.setText("\u2715"),a.style.cursor="pointer",a.onClickEvent(()=>{this.excludedPaths.splice(i,1),this.settingManager.shouldReload=!0,this.renderExcludedList(t)})})}addPath(t){t&&!this.excludedPaths.includes(t)&&(this.allPaths.has(t)?(this.excludedPaths.push(t),this.settingManager.shouldReload=!0,this.renderExcludedList(this.excludesEl)):new Ce(`Path doesn't exist: ${t}`,5e3))}},vl=class extends te.Modal{constructor(){super(...arguments);this.setting=x(de);this.settingManager=x(wt)}onOpen(){var r;this.modalEl.style.width="60vw",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new te.Setting(t).setDesc(j("extensionModal.desc")),new te.Setting(t).setName(j("extensionModal.plaintextName")).setDesc(j("extensionModal.plaintextDesc")).addTextArea(i=>{i.inputEl.style.minWidth="20vw",i.inputEl.style.minHeight="20vh",i.setValue(this.setting.customExtensions.plaintext.join(" ")),i.onChange(s=>{let o=s.split(/[\s\n]+/).map(a=>a.startsWith(".")?a.substring(1):a).filter(a=>a.length>0);this.setting.customExtensions.plaintext=o,this.settingManager.shouldReload=!0})}),new te.Setting(t).setName("Image").setDesc("Todo")}},_l=class extends te.Modal{constructor(){super(...arguments);this.semanticEngine=x(it);this.setting=x(de).semantic;this.settingManager=x(wt);this.needInitSemanticEngine=!1}onOpen(){var r;this.modalEl.style.width="50vw",this.modalEl.style.height="55vh",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new te.Setting(t).setName(j("Introduction")).setDesc(j("Introduction.desc")),new te.Setting(t).setName(j("Enable")).addToggle(i=>i.setValue(this.setting.isEnabled).onChange(s=>{this.setting.isEnabled=s,s===!0&&(this.needInitSemanticEngine=!0)})),new te.Setting(t).setName(j("Server type")).setDesc(j("Server type.desc")).addDropdown(i=>i.addOptions({local:j("local")}).setValue(this.setting.serverType).onChange(s=>this.setting.serverType=s)),new te.Setting(t).setName(j("Utilities")).addButton(i=>i.setButtonText(j("Test connection")).onClick(()=>this.semanticEngine.testConnection())).addButton(i=>i.setButtonText(j("Download")).onClick(()=>x(rt).downloadAiHelper())),new te.Setting(t).setName(j("Additional Information")).setDesc(j("Additional Information.desc"))}onClose(){this.needInitSemanticEngine&&(this.needInitSemanticEngine=!1,x(st).initSemanticEngine())}};var jl=pe(_e());function gn(){}function El(n){return n()}function xf(){return Object.create(null)}function Ut(n){n.forEach(El)}function Us(n){return typeof n=="function"}function Tf(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function Sf(n){return Object.keys(n).length===0}var Af=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,yi=class{constructor(e){this.options=e,this._listeners="WeakMap"in Af?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(t=>{var r;for(let i of t)yi.entries.set(i.target,i),(r=this._listeners.get(i.target))===null||r===void 0||r(i)})}};yi.entries="WeakMap"in Af?new WeakMap:void 0;var Cf=!1;function Og(){Cf=!0}function Rg(){Cf=!1}function Le(n,e){n.appendChild(e)}function Ff(n,e,t){let r=Lg(n);if(!r.getElementById(e)){let i=Ie("style");i.id=e,i.textContent=t,Ng(r,i)}}function Lg(n){if(!n)return document;let e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function Ng(n,e){return Le(n.head||n,e),e.sheet}function pt(n,e,t){n.insertBefore(e,t||null)}function at(n){n.parentNode&&n.parentNode.removeChild(n)}function Tl(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function Ie(n){return document.createElement(n)}function jg(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function bi(n){return document.createTextNode(n)}function yr(){return bi(" ")}function Sl(){return bi("")}function Dt(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function Pe(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Bg(n){return Array.from(n.childNodes)}function Al(n,e){e=""+e,n.data!==e&&(n.data=e)}function Cl(n,e){n.value=e==null?"":e}function wi(n,e,t){n.classList[t?"add":"remove"](e)}var Vs=class{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=jg(t.nodeName):this.e=Ie(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)pt(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(at)}};var vi;function gi(n){vi=n}function zg(){if(!vi)throw new Error("Function called outside component initialization");return vi}function Ks(n){zg().$$.on_destroy.push(n)}var mr=[];var _i=[],gr=[],Ef=[],If=Promise.resolve(),wl=!1;function Pf(){wl||(wl=!0,If.then(Mf))}function xi(){return Pf(),If}function xl(n){gr.push(n)}var bl=new Set,pr=0;function Mf(){if(pr!==0)return;let n=vi;do{try{for(;pr<mr.length;){let e=mr[pr];pr++,gi(e),Ug(e.$$)}}catch(e){throw mr.length=0,pr=0,e}for(gi(null),mr.length=0,pr=0;_i.length;)_i.pop()();for(let e=0;e<gr.length;e+=1){let t=gr[e];bl.has(t)||(bl.add(t),t())}gr.length=0}while(mr.length);for(;Ef.length;)Ef.pop()();wl=!1,bl.clear(),gi(n)}function Ug(n){if(n.fragment!==null){n.update(),Ut(n.before_update);let e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(xl)}}function Vg(n){let e=[],t=[];gr.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),gr=e}var Wg=new Set;function Kg(n,e){n&&n.i&&(Wg.delete(n),n.i(e))}var $g=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],cw=new Set([...$g]);function Hg(n,e,t,r){let{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),r||xl(()=>{let o=n.$$.on_mount.map(El).filter(Us);n.$$.on_destroy?n.$$.on_destroy.push(...o):Ut(o),n.$$.on_mount=[]}),s.forEach(xl)}function Df(n,e){let t=n.$$;t.fragment!==null&&(Vg(t.after_update),Ut(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function qg(n,e){n.$$.dirty[0]===-1&&(mr.push(n),Pf(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function kf(n,e,t,r,i,s,o,a=[-1]){let l=vi;gi(n);let c=n.$$={fragment:null,ctx:[],props:s,update:gn,not_equal:i,bound:xf(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:xf(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=t?t(n,e.props||{},(h,f,...d)=>{let m=d.length?d[0]:f;return c.ctx&&i(c.ctx[h],c.ctx[h]=m)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](m),u&&qg(n,h)),f}):[],c.update(),u=!0,Ut(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){Og();let h=Bg(e.target);c.fragment&&c.fragment.l(h),h.forEach(at)}else c.fragment&&c.fragment.c();e.intro&&Kg(n.$$.fragment),Hg(n,e.target,e.anchor,e.customElement),Rg(),Mf()}gi(l)}var Gg;typeof HTMLElement=="function"&&(Gg=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:n}=this.$$;this.$$.on_disconnect=n.map(El).filter(Us);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(n,e,t){this[n]=t}disconnectedCallback(){Ut(this.$$.on_disconnect)}$destroy(){Df(this,1),this.$destroy=gn}$on(n,e){if(!Us(e))return gn;let t=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return t.push(e),()=>{let r=t.indexOf(e);r!==-1&&t.splice(r,1)}}$set(n){this.$$set&&!Sf(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}});var Ws=class{$destroy(){Df(this,1),this.$destroy=gn}$on(e,t){if(!Us(t))return gn;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Sf(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};function Vn(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}var Rf=require("obsidian");var Lf=pe(_e());var Of=pe(_e());var vr=class{constructor(){this.lexicalEngine=x(ht)}parseAll(e,t,r,i){return t.map(s=>{let o=ui.minInSet(s.positions),a=s.row,l=this.getTruncatedContext(e,a,o,r),c=l.matchedLineText,u=s.positions;s.row===l.lines[0].row&&(u=this.adjustPositionsByStartCol(u,l.firstLineStartCol));let h=this.highlightMatchedLine(c,u,i),f=l.lines.map(d=>d.row===a?h:d.text).join(ye.JOIN_EOL);return{row:s.row,col:o,text:f}})}parse(e,t,r,i){return this.parseAll(e,[t],r,i)[0]}async parseLineItems(e,t){let r=t.replace(/\s/g,""),i=[],s=await this.lexicalEngine.fzfMatch(r,e);for(let o of s){let a=o.row,l=ui.minInSet(o.positions),c=e[a].text,u=Math.max(l-30,0),h=Math.min(u+200,c.length),f=c.substring(u,h),d=this.adjustPositionsByStartCol(o.positions,u),m=this.highlightLineByCharPositions(f,d),p=await this.getLineHighlightedContext(e,a,l,t);i.push(new un({text:m,row:a,col:l},p))}return i}highlightMatchedLine(e,t,r){return r?`<span class="matched-line highlight-bg">${this.highlightLineByCharPositions(e,t)}</span>`:`<span class="matched-line">${this.highlightLineByCharPositions(e,t)}</span>`}highlightContextLine(e,t){let r=new RegExp(t,"gi");return e.replace(r,i=>`<mark>${i}</mark>`)}highlightLineByCharPositions(e,t){return e.split("").map((r,i)=>t.has(i)?`<mark>${r}</mark>`:r).join("")}adjustPositionsByStartCol(e,t){let r=new Set;return e.forEach(i=>{i>=t&&r.add(i-t)}),r}getTruncatedContext(e,t,r,i){if(e.length===0)return{lines:[],firstLineStartCol:0,matchedLineText:""};let s=i,o,a=0,l=0,c=e[t].text;if(r<s.maxPreChars){let u=this.extendContextAbove(e,t-1,s.maxPreChars-r,s.maxPreLines,s.boundaryLineMinChars);o=u.lines,a=u.firstLineStartCol;let h=Math.min(c.length-1,r+s.maxPostChars);h<c.length-1?(c=c.substring(0,h+1),o.push({text:c,row:t})):o.push(e[t]),l+=h-r}else{let u=r-s.maxPreChars;a=u;let h=Math.min(c.length-1,r+s.maxPostChars);h<c.length-1?c=c.substring(u,h+1):c=c.substring(u),o=[{text:c,row:t}],l+=h-r}return jt.append(o,this.extendContextBelow(e,t+1,s.maxPostChars-l,s.maxPostLines,s.boundaryLineMinChars)),{lines:o,firstLineStartCol:a,matchedLineText:c}}extendContextAbove(e,t,r,i,s){let o=0,a=t,l=0,c=[];for(;a>=0&&t-a<i;){let u=e[a].text;if(l+u.length<r)c.unshift(e[a]),l+=u.length,--a;else if(l+u.length==r){c.unshift(e[a]);break}else{let h=l+u.length-r;o=h;let f=e[a].text.substring(h);c.unshift({text:f,row:a});break}}return c.length>0&&c[0].text.length<s&&(o=0,c.shift()),{lines:c,firstLineStartCol:o}}extendContextBelow(e,t,r,i,s){let o=t,a=0,l=[];for(;o<=e.length-1&&o-t<i;){let c=e[o].text;if(a+c.length<r)l.push(e[o]),a+=c.length,++o;else if(a+c.length==r){l.push(e[o]);break}else{let u=c.length-(a+c.length-r)-1,h=e[o].text.substring(0,u+1);l.push({text:h,row:o});break}}return l.length>0&&l[0].text.length<s&&l.pop(),l}async getLineHighlightedContext(e,t,r,i){let s=jt.getCurrLanguage(),o=this.getTruncatedContext(e,t,r,_t.forType("paragraph")),a=o.lines;return(await Promise.all(a.map(async(c,u)=>{if(c.row===t){let h=await this.lexicalEngine.fzfMatch(i,[c]);try{let d=h[0].positions;return u===0&&(d=this.adjustPositionsByStartCol(d,o.firstLineStartCol)),this.highlightMatchedLine(c.text,d,!0)}catch(f){F.warn("There might be inconsistency with previous search step, which lead to a missed match to target line"),F.error(f)}}else return this.highlightContextLine(c.text,i)}))).join(ye.JOIN_EOL)}};vr=U([(0,Of.singleton)()],vr);var kt=class{constructor(){this.app=x(Rf.App);this.dataProvider=x(Ke);this.lexicalEngine=x(ht);this.semanticEngine=x(it);this.lineHighlighter=x(vr);this.viewRegistry=x(We)}async searchInVault(e){var o;let t=new tn("no result",[]);if(e.length===0)return t;let r=((o=this.app.workspace.getActiveFile())==null?void 0:o.path)||"no source path",i=await this.lexicalEngine.searchFiles(e),s=[];return i.length!==0?{sourcePath:r,items:i.map(a=>new fn(0,a.path,a.queryTerms,a.matchedTerms,[],"nothing"))}:(F.trace("lexical matched files count is 0"),t)}async searchInVaultSemantic(e){var r;let t=new tn("no result",[]);if(e.length===0)return t;{let s={sourcePath:((r=this.app.workspace.getActiveFile())==null?void 0:r.path)||"no source path",items:await this.semanticEngine.search(e.trim(),"markdown")};return F.debug(s),s}}async getFileSubItems(e,t){let r=t.path;if(this.viewRegistry.viewTypeByPath(r)!=="markdown")return F.warn(`view type for path "${r}" is not supported for sub-items.`),[];let s=(await this.dataProvider.readPlainText(r)).split(ye.SPLIT_EOL).map((l,c)=>new ur(l,c));F.debug("target file lines count: ",s.length);let o=await this.lexicalEngine.searchLinesByFileItem(s,"subItem",e,t,30);return this.lineHighlighter.parseAll(s,o,_t.forType("subItem",e),!1).map(l=>({text:l.text,row:l.row,col:l.col}))}async searchInFile(e){let t=new tn("",[]),r=this.app.workspace.getActiveFile();if(!e||!r)return t;if(this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return F.trace("Current file isn't PLAINT_TEXT"),t;let i=(await this.dataProvider.readPlainTextLines(r.path)).map((l,c)=>new ur(l,c)),s=e.replace(/\s/g,""),a=(await this.lexicalEngine.fzfMatch(s,i)).map(l=>{let c=this.lineHighlighter.parse(i,l,_t.forType("line"),!1),u=this.lineHighlighter.parse(i,l,_t.forType("paragraph"),!0);return new un(c,u.text)});return{sourcePath:r.path,items:a}}async deprecatedSearchInFile(e){let t=new tn("",[]),r=this.app.workspace.getActiveFile();if(!e||!r||this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return t;let i=r.path,s=(await this.dataProvider.readPlainTextLines(i)).map((a,l)=>new ur(a,l)),o=await this.lineHighlighter.parseLineItems(s,e);return{sourcePath:i,items:o}}};U([Be],kt.prototype,"searchInVault",1),U([Be],kt.prototype,"getFileSubItems",1),U([Be],kt.prototype,"searchInFile",1),U([Be],kt.prototype,"deprecatedSearchInFile",1),kt=U([(0,Lf.singleton)()],kt);var yn=require("obsidian");var Qf=pe(_e()),Zf=pe(Jf());var _r=class{constructor(){this.app=x(yn.App);this.privateApi=x(Ve);this.setting=x(de)}purifyHTML(e){return Zf.default.sanitize(e,{USE_PROFILES:{html:!0}})}updateSubItemIndex(e,t,r){let i=e[t],s=e.length-1;return this.scrollTo("center",i,"auto"),r==="next"?t<s?t+1:t:t>0?t-1:t}async handleConfirmAsync(e,t,r,i,s){if(e(),i)if(r===1){let o=i;await this.jumpInVaultAsync(t,o.line.row,o.line.col)}else if(r===2){let o=i,a=o.viewType;if(s!==-1){let l=o.subItems[s];if(a==="markdown")await this.jumpInVaultAsync(o.path,l.row,l.col);else throw Error("unsupported viewType to jump")}else await this.jumpInVaultAsync(o.path,0,0)}else throw Error(`unsupported search type to jump ${r}`)}scrollTo(e,t,r){setTimeout(()=>{t&&t.element&&t.element.scrollIntoView({behavior:r,block:e})},0)}focusInput(){setTimeout(()=>{let e=document.getElementById("cs-search-input");e==null||e.focus()},0)}showNoResult(e){if(e){if(!this.setting.semantic.isEnabled)return"Semantic search need to be enabled at the setting tab";let t=x(it).status;return t==="ready"?"No matched content":`Semantic engine is ${t}`}else return"No matched content"}insertFileLinkToActiveMarkdown(e){if(e){let t=this.app.workspace.getActiveViewOfType(yn.MarkdownView);if(!(t!=null&&t.file)){F.info("No markdown view to insert file link");return}let r=x(yn.Vault).getAbstractFileByPath(e),i=this.app.fileManager.generateMarkdownLink(r,t.file.path);t.editor.replaceSelection(i+`
`)}}async jumpInVaultAsync(e,t,r){let i=!1;this.app.workspace.iterateAllLeaves(s=>{var o;s.view instanceof yn.MarkdownView&&((o=s.getViewState().state)==null?void 0:o.file)===e&&(this.app.workspace.setActiveLeaf(s,{focus:!0}),i=!0)}),i?this.scrollIntoViewForExistingView(t,r):(await this.app.workspace.openLinkText(e,"",this.setting.ui.openInNewPane),this.scrollIntoViewForExistingView(t,r))}scrollIntoViewForExistingView(e,t){this.privateApi.executeCommandById("editor:focus");let r=this.app.workspace.getActiveViewOfType(yn.MarkdownView),i={line:e,ch:t};if(r){let s=r.getState();s.mode="source",r.setState(s,{history:!1}),r.editor.setCursor(i),this.app.workspace.onLayoutReady(()=>{r.editor.scrollIntoView({from:i,to:i},!0),setTimeout(()=>{r.editor.scrollIntoView({from:i,to:i},!0),this.privateApi.executeCommandById("editor:focus")},1)})}else F.info("No markdown view to jump")}};_r=U([(0,Qf.singleton)()],_r);function my(n){Ff(n,"svelte-1k7yxfd",`div.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd,button.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{user-select:text}.search-container.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{display:flex;white-space:pre-wrap;overflow-wrap:break-word}.search-container mark{background-color:var(--cs-highlight-bgc, rgba(219, 204, 149, 0.9));color:var(--cs-highlight-char-color, #111)}.left-pane.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{display:flex;flex-direction:column;align-items:left;width:27.5vw}.search-bar.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{position:sticky;top:-0.2em;left:0;width:97%;height:30px}.search-bar.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd::after{content:attr(data-match-count);position:absolute;right:0.6em;top:1.4em;font-size:0.8em;transform:translateY(-50%);color:var(--cs-hint-char-color, grey)}.search-bar.svelte-1k7yxfd input.svelte-1k7yxfd.svelte-1k7yxfd{width:100%;padding:8px 12px;border:none;border-radius:10px;background-color:var(--cs-search-bar-bgc, #20202066);box-shadow:0 2px 4px rgba(0, 0, 0, 0.07),
			0 2px 3px rgba(0, 0, 0, 0.1)}.result-items.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{display:flex;flex-direction:column;height:70vh;margin-top:0.15em}.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd.svelte-1k7yxfd{padding:0 0.5em 0 0;margin-bottom:0;width:97%;overflow-x:hidden}.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd button.svelte-1k7yxfd{align-items:center;justify-content:left;padding:0.65em;margin:0.5em 0 0 0.15em;width:25.35vw;height:fit-content;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;cursor:pointer}.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd button.svelte-1k7yxfd:hover,.result-items.svelte-1k7yxfd ul.svelte-1k7yxfd button.selected.svelte-1k7yxfd{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.result-items.svelte-1k7yxfd ul button .line-item.svelte-1k7yxfd.svelte-1k7yxfd,.result-items.svelte-1k7yxfd ul button .file-item.svelte-1k7yxfd.svelte-1k7yxfd{text-wrap:wrap;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.result-items.svelte-1k7yxfd ul button .file-item.svelte-1k7yxfd.svelte-1k7yxfd{-webkit-line-clamp:6}.result-items.svelte-1k7yxfd ul button .file-item span.filename.svelte-1k7yxfd.svelte-1k7yxfd{margin-top:-0.2em;display:block}.result-items.svelte-1k7yxfd ul button .file-item span.file-folder-path.svelte-1k7yxfd.svelte-1k7yxfd{color:var(--cs-secondary-font-color, #a29c9c);display:block}.right-pane.svelte-1k7yxfd.svelte-1k7yxfd.svelte-1k7yxfd{background-color:var(--cs-pane-bgc, #20202066);border-radius:6px;height:73.97vh;width:60%}.right-pane.svelte-1k7yxfd button.svelte-1k7yxfd.svelte-1k7yxfd{white-space:pre-wrap}.right-pane.svelte-1k7yxfd .preview-container.svelte-1k7yxfd.svelte-1k7yxfd{margin:0.7em 0 0 0.7em;height:72.5vh;overflow-y:auto}.right-pane.svelte-1k7yxfd .preview-container p.svelte-1k7yxfd.svelte-1k7yxfd,.right-pane.svelte-1k7yxfd .preview-container ul.svelte-1k7yxfd.svelte-1k7yxfd{margin:0;padding:0;overflow-x:hidden}.right-pane.svelte-1k7yxfd .preview-container p.svelte-1k7yxfd.svelte-1k7yxfd{width:39.7vw}.right-pane.svelte-1k7yxfd .preview-container ul button.file-sub-item.svelte-1k7yxfd.svelte-1k7yxfd{text-wrap:wrap;display:block;text-overflow:ellipsis;justify-content:left;margin-bottom:1em;height:fit-content;width:39.2vw;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;font-size:medium}.right-pane.svelte-1k7yxfd .preview-container ul button.file-sub-item.selected.svelte-1k7yxfd.svelte-1k7yxfd{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.right-pane.svelte-1k7yxfd .preview-container.svelte-1k7yxfd span.matched-line{display:inline-block;width:100%}.right-pane.svelte-1k7yxfd .preview-container.svelte-1k7yxfd span.matched-line.highlight-bg{background-color:var(--cs-hint-char-color, #468eeb33)}`)}function ed(n,e,t){let r=n.slice();return r[40]=e[t],r[41]=e,r[42]=t,r}function td(n,e,t){let r=n.slice();return r[43]=e[t],r[44]=e,r[42]=t,r}function gy(n){let e,t,r=n[43].basename+Bo+(n[43].extension==="md"?"":n[43].extension)+"",i,s,o=n[43].folderPath+"",a;return{c(){e=Ie("span"),t=Ie("span"),i=yr(),s=Ie("span"),a=bi(o),Pe(t,"class","filename svelte-1k7yxfd"),Pe(s,"class","file-folder-path svelte-1k7yxfd"),Pe(e,"class","file-item svelte-1k7yxfd")},m(l,c){pt(l,e,c),Le(e,t),t.innerHTML=r,Le(e,i),Le(e,s),Le(s,a)},p(l,c){c[0]&16&&r!==(r=l[43].basename+Bo+(l[43].extension==="md"?"":l[43].extension)+"")&&(t.innerHTML=r),c[0]&16&&o!==(o=l[43].folderPath+"")&&Al(a,o)},d(l){l&&at(e)}}}function yy(n){let e,t=n[11].purifyHTML(n[43].line.text)+"";return{c(){e=Ie("span"),Pe(e,"class","line-item svelte-1k7yxfd")},m(r,i){pt(r,e,i),e.innerHTML=t},p(r,i){i[0]&16&&t!==(t=r[11].purifyHTML(r[43].line.text)+"")&&(e.innerHTML=t)},d(r){r&&at(e)}}}function nd(n){let e,t,r=n[44],i=n[42],s,o;function a(p,g){if(p[43]instanceof un)return yy;if(p[43]instanceof fn)return gy}let l=a(n,[-1,-1]),c=l&&l(n),u=()=>n[18](e,r,i),h=()=>n[18](null,r,i);function f(...p){return n[19](n[42],...p)}function d(...p){return n[20](n[42],...p)}function m(...p){return n[21](n[42],...p)}return{c(){e=Ie("button"),c&&c.c(),t=yr(),Pe(e,"class","svelte-1k7yxfd"),wi(e,"selected",n[42]===n[5])},m(p,g){pt(p,e,g),c&&c.m(e,null),Le(e,t),u(),s||(o=[Dt(e,"click",f),Dt(e,"contextmenu",d),Dt(e,"dblclick",m)],s=!0)},p(p,g){n=p,l===(l=a(n,g))&&c?c.p(n,g):(c&&c.d(1),c=l&&l(n),c&&(c.c(),c.m(e,t))),(r!==n[44]||i!==n[42])&&(h(),r=n[44],i=n[42],u()),g[0]&32&&wi(e,"selected",n[42]===n[5])},d(p){p&&at(e),c&&c.d(),h(),s=!1,Ut(o)}}}function rd(n){let e,t;function r(o,a){if(o[3]===1)return _y;if(o[3]===2)return vy}let i=r(n,[-1,-1]),s=i&&i(n);return{c(){e=Ie("div"),t=Ie("div"),s&&s.c(),Pe(t,"class","preview-container svelte-1k7yxfd"),Pe(e,"class","right-pane svelte-1k7yxfd")},m(o,a){pt(o,e,a),Le(e,t),s&&s.m(t,null)},p(o,a){i===(i=r(o,a))&&s?s.p(o,a):(s&&s.d(1),s=i&&i(o),s&&(s.c(),s.m(t,null)))},d(o){o&&at(e),s&&s.d()}}}function vy(n){let e;function t(s,o){return s[7]&&s[7].viewType==="markdown"?wy:by}let r=t(n,[-1,-1]),i=r(n);return{c(){i.c(),e=Sl()},m(s,o){i.m(s,o),pt(s,e,o)},p(s,o){r===(r=t(s,o))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&at(e)}}}function _y(n){let e,t=n[6]&&sd(n);return{c(){t&&t.c(),e=Sl()},m(r,i){t&&t.m(r,i),pt(r,e,i)},p(r,i){r[6]?t?t.p(r,i):(t=sd(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){t&&t.d(r),r&&at(e)}}}function by(n){let e,t=n[11].showNoResult(n[0])+"",r;return{c(){e=Ie("span"),r=bi(t)},m(i,s){pt(i,e,s),Le(e,r)},p(i,s){s[0]&1&&t!==(t=i[11].showNoResult(i[0])+"")&&Al(r,t)},d(i){i&&at(e)}}}function wy(n){let e,t=n[8],r=[];for(let i=0;i<t.length;i+=1)r[i]=id(ed(n,t,i));return{c(){e=Ie("ul");for(let i=0;i<r.length;i+=1)r[i].c();Pe(e,"class","svelte-1k7yxfd")},m(i,s){pt(i,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null)},p(i,s){if(s[0]&51968){t=i[8];let o;for(o=0;o<t.length;o+=1){let a=ed(i,t,o);r[o]?r[o].p(a,s):(r[o]=id(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=t.length}},d(i){i&&at(e),Tl(r,i)}}}function id(n){let e,t,r=n[11].purifyHTML(n[40].text)+"",i,s=n[41],o=n[42],a,l;function c(...m){return n[24](n[42],...m)}function u(...m){return n[25](n[42],...m)}function h(...m){return n[26](n[42],...m)}let f=()=>n[27](e,s,o),d=()=>n[27](null,s,o);return{c(){e=Ie("button"),t=new Vs(!1),i=yr(),t.a=i,Pe(e,"class","file-sub-item svelte-1k7yxfd"),wi(e,"selected",n[42]===n[9])},m(m,p){pt(m,e,p),t.m(r,e),Le(e,i),f(),a||(l=[Dt(e,"click",c),Dt(e,"contextmenu",u),Dt(e,"dblclick",h)],a=!0)},p(m,p){n=m,p[0]&256&&r!==(r=n[11].purifyHTML(n[40].text)+"")&&t.p(r),(s!==n[41]||o!==n[42])&&(d(),s=n[41],o=n[42],f()),p[0]&512&&wi(e,"selected",n[42]===n[9])},d(m){m&&at(e),d(),a=!1,Ut(l)}}}function sd(n){let e,t=n[11].purifyHTML(n[6])+"",r,i;return{c(){e=Ie("p"),Pe(e,"class","svelte-1k7yxfd")},m(s,o){pt(s,e,o),e.innerHTML=t,r||(i=[Dt(e,"contextmenu",n[22]),Dt(e,"dblclick",n[23])],r=!0)},p(s,o){o[0]&64&&t!==(t=s[11].purifyHTML(s[6])+"")&&(e.innerHTML=t)},d(s){s&&at(e),r=!1,Ut(i)}}}function xy(n){let e,t,r,i,s,o,a,l,c,u,h=n[4].items,f=[];for(let m=0;m<h.length;m+=1)f[m]=nd(td(n,h,m));let d=n[2]!=="floatingWindow"&&rd(n);return{c(){e=Ie("div"),t=Ie("div"),r=Ie("div"),i=Ie("input"),s=yr(),o=Ie("div"),a=Ie("ul");for(let m=0;m<f.length;m+=1)f[m].c();l=yr(),d&&d.c(),Pe(i,"id","cs-search-input"),Pe(i,"class","svelte-1k7yxfd"),Pe(r,"class","search-bar svelte-1k7yxfd"),Pe(r,"data-match-count",n[10]),Pe(a,"class","svelte-1k7yxfd"),Pe(o,"class","result-items svelte-1k7yxfd"),Pe(t,"class","left-pane svelte-1k7yxfd"),Pe(e,"class","search-container svelte-1k7yxfd")},m(m,p){pt(m,e,p),Le(e,t),Le(t,r),Le(r,i),Cl(i,n[1]),Le(t,s),Le(t,o),Le(o,a);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(a,null);Le(e,l),d&&d.m(e,null),c||(u=[Dt(i,"input",n[17]),Dt(i,"input",n[12])],c=!0)},p(m,p){if(p[0]&2&&i.value!==m[1]&&Cl(i,m[1]),p[0]&1024&&Pe(r,"data-match-count",m[10]),p[0]&43060){h=m[4].items;let g;for(g=0;g<h.length;g+=1){let v=td(m,h,g);f[g]?f[g].p(v,p):(f[g]=nd(v),f[g].c(),f[g].m(a,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=h.length}m[2]!=="floatingWindow"?d?d.p(m,p):(d=rd(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:gn,o:gn,d(m){m&&at(e),Tl(f,m),d&&d.d(),c=!1,Ut(u)}}}function Ey(n,e,t){let r,i=x(kt),s=x(_r),{uiType:o}=e,{onConfirmExternal:a}=e,{searchType:l}=e,{isSemantic:c}=e,{queryText:u}=e,h=new Map,f=new tn("",[]),d=-1,m="",p=null,g=[],v,w=-1;function E(B){return Vn(this,void 0,void 0,function*(){yield xi();let se=f.items;if(B>=0&&B<se.length){if(t(5,d=B),l===1){let Ee=se[B];t(6,m=Ee.context)}else if(l===2)t(7,p=se[B]),c||t(7,p.subItems=yield i.getFileSubItems(u,p),p),t(8,g=p.subItems),t(9,w=g.length>0?0:-1),yield xi(),s.scrollTo("start",g[w],"instant");else throw Error(`unsupported search type: ${l}`);yield xi(),s.scrollTo("center",se[B],"smooth")}else t(6,m=""),t(7,p=null),t(8,g=[]),t(5,d=-1),t(9,w=-1)})}let b=hf(100,()=>S());function S(){return Vn(this,void 0,void 0,function*(){if(h.has(u)){t(4,f=h.get(u)),yield E(0);return}if(l===1)t(4,f=yield i.searchInFile(u));else if(l===2)t(4,f=c?yield i.searchInVaultSemantic(u):yield i.searchInVault(u));else throw Error(Qn);h.set(u,f),yield E(0)})}function A(B){return Vn(this,void 0,void 0,function*(){yield E(B)})}function I(){return Vn(this,void 0,void 0,function*(){yield E(Math.min(d+1,f.items.length-1)),o==="floatingWindow"&&L(null)})}function P(){return Vn(this,void 0,void 0,function*(){yield E(Math.max(d-1,0)),o==="floatingWindow"&&L(null)})}function O(B){t(9,w=B)}function z(){t(9,w=s.updateSubItemIndex(g,w,"next"))}function D(){t(9,w=s.updateSubItemIndex(g,w,"prev"))}function L(B){return Vn(this,void 0,void 0,function*(){B==null||B.preventDefault();let se=f.items[d];yield s.handleConfirmAsync(a,f.sourcePath,l,se,w)})}function R(){h.delete(u),t(0,c=!c),S()}function W(){s.insertFileLinkToActiveMarkdown(p==null?void 0:p.path)}Ks(()=>{F.trace("mounted element has been destroyed.")});function Q(B,se){mn.on(B,se),Ks(()=>{mn.off(B,se)})}o==="floatingWindow"?(Q(3,I),Q(6,P)):(Q(2,I),Q(5,P),Q(4,z),Q(7,D),Q(8,L),Q(9,R),Q(11,W)),s.focusInput(),S();function re(){u=this.value,t(1,u)}function ue(B,se,Ee){_i[B?"unshift":"push"](()=>{se[Ee].element=B,t(4,f)})}let fe=(B,se)=>{A(B),o==="floatingWindow"&&L(null)},we=async(B,se)=>{await A(B),await L(se)},lt=async(B,se)=>{await A(B),await L(se)},X=B=>L(B),Y=B=>L(B),$=(B,se)=>O(B),Z=(B,se)=>{t(9,w=B),L(se)},ae=(B,se)=>{t(9,w=B),L(se)};function Te(B,se,Ee){_i[B?"unshift":"push"](()=>{se[Ee].element=B,t(8,g)})}return n.$$set=B=>{"uiType"in B&&t(2,o=B.uiType),"onConfirmExternal"in B&&t(16,a=B.onConfirmExternal),"searchType"in B&&t(3,l=B.searchType),"isSemantic"in B&&t(0,c=B.isSemantic),"queryText"in B&&t(1,u=B.queryText)},n.$$.update=()=>{if(n.$$.dirty[0]&48){e:t(10,r=`${d+1} / ${f.items.length}`)}},[c,u,o,l,f,d,m,p,g,w,r,s,b,A,O,L,a,re,ue,fe,we,lt,X,Y,$,Z,ae,Te]}var Ll=class extends Ws{constructor(e){super(),kf(this,e,Ey,xy,Tf,{uiType:2,onConfirmExternal:16,searchType:3,isSemantic:0,queryText:1},my,[-1,-1])}},Gs=Ll;var ot=class{toggle(e){if(e==="inFile")x(br).toggle();else throw Error(Qn)}resetAllPositions(){let e=x(de).ui;e.inFileFloatingWindowLeft="2.7em",e.inFileFloatingWindowTop="2.5em",x(ot).toggle("inFile"),x(ot).toggle("inFile")}onunload(){x(br).onClose()}};ot=U([(0,jl.singleton)()],ot);var Nl=class{constructor(){this.isDragging=!1;this.dragStartX=0;this.dragStartY=0;this.uiSetting=x(de).ui;this.mountedElement=null;this.onClose=()=>{var e,t;document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),(e=this.mountedElement)==null||e.$destroy(),this.mountedElement=null,(t=this.containerEl)==null||t.remove()};this.handleMouseDown=e=>{this.isDragging=!0,this.containerEl.style.opacity="0.75",this.dragStartX=e.pageX-this.containerEl.offsetLeft,this.dragStartY=e.pageY-this.containerEl.offsetTop,e.preventDefault()};this.handleMouseMove=e=>{this.isDragging&&(this.containerEl.style.left=`${e.pageX-this.dragStartX}px`,this.containerEl.style.top=`${e.pageY-this.dragStartY}px`)};this.handleMouseUp=()=>{this.isDragging=!1,this.containerEl.style.opacity="1",this.saveContainerElStates(),x(wt).postSettingUpdated()}}toggle(){if(this.mountedElement!==null)return this.onClose(),this;this.containerEl=document.body.createDiv(),this.frameEl=this.containerEl.createDiv(),this.contentEl=this.containerEl.createDiv(),this.frameEl.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.containerEl.addClass("cs-floating-window-container"),this.containerEl.style.position="fixed",this.loadContainerElStates(),this.containerEl.style.zIndex="20",this.containerEl.style.border="1px solid #454545",this.containerEl.style.borderRadius="10px",this.containerEl.style.overflow="hidden",this.containerEl.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",this.frameEl.style.width="100%",this.frameEl.style.height="20px",this.frameEl.style.backgroundColor="#333",this.frameEl.style.cursor="move",this.frameEl.style.color="#fff",this.frameEl.style.display="flex",this.frameEl.style.alignItems="center",this.frameEl.style.justifyContent="right",this.frameEl.style.padding="10px 0 10px 10px";let e=this.frameEl.createSpan();return e.innerText="\u2716",e.style.cursor="pointer",e.style.fontSize="13px",e.style.margin="5px",e.addEventListener("click",this.onClose),this.contentEl.style.padding="10px 0 10px 10px",this.mountComponent(),this}},br=class extends Nl{mountComponent(){this.mountedElement=new Gs({target:this.contentEl,props:{uiType:"floatingWindow",onConfirmExternal:()=>{},searchType:1,isSemantic:!1,queryText:""}})}loadContainerElStates(){this.containerEl.style.top=this.uiSetting.inFileFloatingWindowTop,this.containerEl.style.left=this.uiSetting.inFileFloatingWindowLeft}saveContainerElStates(){this.uiSetting.inFileFloatingWindowLeft=this.containerEl.style.left,this.uiSetting.inFileFloatingWindowTop=this.containerEl.style.top}};br=U([(0,jl.singleton)()],br);var od=require("obsidian");var ad=pe(_e());var wr=class{async createChildThreads(){if(Jn)F.warn("web worker only enabled on dev environment now");else return;F.debug("init child threads...");let e=x(Ve).obsidianFs,t=x(od.Vault).configDir,r=ke.join(t,"plugins/clever-search/dist/cs-search-worker.js");try{let i=await e.readBinary(r);F.debug(`worker script size (6x bigger than in production build): ${(i.byteLength/1e3).toFixed(2)} KB`);let s=new Blob([i],{type:"text/javascript"}),o=URL.createObjectURL(s);this.worker=new Worker(o),this.worker.addEventListener("message",a=>{console.log(`Received from worker:
`,a.data)})}catch(i){console.error("Error initializing worker:",i)}}async testImageSearch(){var e;(e=this.worker)==null||e.postMessage({type:"image-search"})}};wr=U([(0,ad.singleton)()],wr);var fd=pe(_e());var ld=pe(_e());var vn=class{constructor(){this.privacyModeEnabled=!1;this.plugin=x(xr)}togglePrivacyMode(){this.privacyModeEnabled=!this.privacyModeEnabled,this.privacyModeEnabled?document.body.classList.add("cs-privacy-blur"):document.body.classList.remove("cs-privacy-blur")}init(){this.watchSelectionAndAutoCopy()}watchSelectionAndAutoCopy(){this.plugin.registerDomEvent(document,"mousedown",e=>{Ty(e,["cs-modal","cs-floating-window-container"])&&document.addEventListener("mouseup",()=>{Sy()},{once:!0})})}};vn=U([(0,ld.singleton)()],vn);function Ty(n,e){let t=n.target;for(;t;){if(e.some(r=>t==null?void 0:t.classList.contains(r)))return!0;t=t.parentElement}return!1}function Sy(){let n=window.getSelection();if(n&&n.rangeCount>0){let t=n.getRangeAt(0).toString();t&&navigator.clipboard.writeText(t).then(()=>F.debug(`selection copied: ${t}`))}}var zl=require("obsidian");var Bl=require("obsidian");async function Ay(){let n=x(Ke).allFilesToBeIndexed().filter(t=>t.basename.includes("Mysql")||t.basename.includes("Breath")),e=await x(Ke).generateAllIndexedDocuments(n);x(it).reindexAll(e)}async function cd(){let n=x(de);Oc(()=>Ay())}var ud=require("obsidian");var $n=class extends ud.Modal{constructor(t,r,i,s){var l;super(t);let o=((l=window.getSelection())==null?void 0:l.toString())||"",a=s||o;this.modalEl.replaceChildren(),this.modalEl.addClass("cs-modal"),this.mountedElement=new Gs({target:this.modalEl,props:{uiType:"modal",onConfirmExternal:()=>this.close(),searchType:r,isSemantic:i,queryText:a||""}}),new Ys(this.scope).registerAll()}onOpen(){}onClose(){this.mountedElement.$destroy()}};var Ul=pe(_e());var Hn="Ctrl",Cy="Alt";var _n=class{constructor(){this.plugin=x(ut);this.setting=x(de);this.app=x(zl.App);x(Er).registerAll()}addDevCommands(){Jn&&(this.addCommand({id:"cs-in-file-search-floating-window",name:"In file search - floating window",callback:()=>x(ot).toggle("inFile")}),this.addCommand({id:"clever-search-triggerTest",name:"clever-search-triggerTest",callback:async()=>await cd()}))}addCommandsWithoutDependency(){this.addCommand({id:"clever-search-in-file",name:"Search in file",callback:()=>{this.setting.ui.floatingWindowForInFile?x(ot).toggle("inFile"):new $n(this.app,1,!1).open()}}),this.addCommand({id:"cs-toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>x(vn).togglePrivacyMode()})}addInVaultCommands(){this.addCommand({id:"clever-search-in-vault",name:"Search in Vault",callback:()=>{mn.emit(10),new $n(this.app,2,!1).open()}}),this.addCommand({id:"cs-in-file-search-with-omnisearch-query",name:"Search in file with last Omnisearch query",callback:async()=>{new $n(this.app,1,!1,await x(Mt).getLastQuery()).open()}}),this.addCommand({id:"clever-search-in-vault-semantic",name:"Search in vault semantically",callback:async()=>new $n(this.app,2,!0).open()})}onunload(){x(Er).unregisterAll()}addCommand(e){this.plugin.addCommand(e)}};_n=U([(0,Ul.singleton)()],_n);function Fy(n){return e=>{e.preventDefault(),mn.emit(n),console.log("emit...")}}var Js=class{constructor(e){this.handlers=[];this.scope=e}unregisterAll(){this.handlers.forEach(e=>{this.scope.unregister(e)}),this.handlers=[]}register(e,t,r){this.handlers.push(this.scope.register(e,t,Fy(r)))}},Er=class extends Js{constructor(){super(x(zl.App).scope)}registerAll(){this.handlers=[],this.register([Hn],"J",3),this.register([Hn],"K",6)}};Er=U([(0,Ul.singleton)()],Er);var Ys=class extends Js{constructor(e){super(e)}registerAll(){this.register([Hn],"J",2),this.register([Hn],"K",5),this.register([],"ArrowDown",2),this.register([],"ArrowUp",5),this.register([],"Enter",8),this.register([Hn],"N",4),this.register([Hn],"P",7),this.register([Hn],"S",9),this.register([Cy],"I",11)}};var qn=class{async onload(){await x(wt).initAsync(),x(We).init(),x(_n).addCommandsWithoutDependency(),await x(rt).initAsync(),await x(It).initAsync(),await x(wr).createChildThreads(),x(vn).init()}async onLayoutReady(){let e=x(_n);e.addInVaultCommands(),e.addDevCommands(),await x(st).initAsync(),await x(Mt).initAsync()}onunload(){x(_n).onunload(),x(st).onunload(),x(ot).onunload()}onAppQuit(){}};qn=U([(0,fd.singleton)()],qn);var xr=class extends gt.Plugin{async onload(){Qs.container.register(ut,{useValue:this}),Qs.container.register(gt.App,{useValue:this.app}),Qs.container.register(gt.Vault,{useValue:this.app.vault});let e=x(qn);await e.onload(),this.app.workspace.onLayoutReady(()=>{e.onLayoutReady()}),this.registerEvent(this.app.workspace.on("quit",()=>e.onAppQuit(),this))}onunload(){document.body.classList.remove("cs-privacy-blur"),x(qn).onunload()}exampleCode(){this.registerDomEvent(document,"click",e=>{console.log("click",e)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}},Xs=class extends gt.Modal{constructor(t,r){super(t);this.mdContent=r}onOpen(){this.containerEl.empty(),this.containerEl.style.display="block",this.containerEl.style.overflow="auto",this.containerEl.style.backgroundColor="black",gt.MarkdownRenderer.render(x(gt.App),this.mdContent,this.containerEl,"",new gt.Component)}onClose(){}};0&&(module.exports={RenderMarkdownModal});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

dompurify/dist/purify.cjs.js:
  (*! @license DOMPurify 3.1.7 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.7/LICENSE *)

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

fzf/dist/fzf.es.js:
  (** @license
   * fzf v0.5.2
   * Copyright (c) 2021 Ajit
   * Licensed under BSD 3-Clause
   *)
*/
