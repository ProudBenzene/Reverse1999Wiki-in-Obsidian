/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
https://github.com/kotaindah55/animated-cursor
*/

var p=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var I=(t,e,r)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var q=(t,e)=>{for(var r in e)p(t,r,{get:e[r],enumerable:!0})},F=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of x(e))!D.call(t,s)&&s!==r&&p(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t};var N=t=>F(p({},"__esModule",{value:!0}),t);var a=(t,e,r)=>I(t,typeof e!="symbol"?e+"":e,r);var J={};q(J,{DEFAULT_SETTINGS:()=>S,default:()=>h});module.exports=N(J);var g=require("obsidian");var f=require("obsidian");function C(t,e){let r=Object.keys(e).map(n=>H(t,n,e[n]));return r.length===1?r[0]:function(){r.forEach(n=>n())}}function H(t,e,r){let n=t[e],s=t.hasOwnProperty(e),i=s?n:function(){return Object.getPrototypeOf(t)[e].apply(this,arguments)},o=r(i);return n&&Object.setPrototypeOf(o,n),Object.setPrototypeOf(l,o),t[e]=l,c;function l(...O){return o===i&&t[e]===l&&c(),o.apply(this,O)}function c(){t[e]===l&&(s?t[e]=i:delete t[e]),o!==i&&(o=i,Object.setPrototypeOf(l,n||Function))}}var b=require("@codemirror/state"),P=require("@codemirror/view"),w=require("obsidian"),U=0,X=t=>function(e){if(e.button!==U)return;if(e.composedPath().some(s=>s instanceof HTMLElement&&s.hasClass("table-wrapper"))){let{scrollDOM:s}=t;s.addClass("cm-hasTablePointed"),s.win.addEventListener("pointerup",()=>{s.removeClass("cm-hasTablePointed")},{once:!0})}},y=b.Annotation.define(),T=P.ViewPlugin.define(t=>{let{editor:e}=t.state.field(w.editorInfoField),r={},n=new AbortController;return e!=null&&e.inTableCell&&e.activeCM===t&&(r.update=s=>{s.focusChanged&&e.cm.dispatch({annotations:y.of(t.hasFocus)})}),(e==null?void 0:e.cm)===t&&(t.dom.addEventListener("pointerdown",X(t),{capture:!0,signal:n.signal}),r.destroy=()=>n.abort()),r});var v=require("@codemirror/view"),A=require("obsidian");function E(t){let e=t.scrollDOM.getBoundingClientRect(),r=t.textDirection==v.Direction.LTR?e.left:e.right-t.scrollDOM.clientWidth*t.scaleX;return{top:e.top-t.scrollDOM.scrollTop*t.scaleY,left:r-t.scrollDOM.scrollLeft*t.scaleX}}var u=class t{constructor(e,r,n,s,i){a(this,"className");a(this,"useTransform");a(this,"left");a(this,"top");a(this,"height");a(this,"adjust",e=>{requestAnimationFrame(()=>{this.useTransform?e.setCssStyles({transform:`translateX(${this.left}px) translateY(${this.top}px)`}):e.setCssStyles({left:this.left+"px",top:this.top+"px"}),e.setCssStyles({height:this.height+"px"})})});a(this,"requestAdjust",(0,A.debounce)((e,r)=>{e(r)},10,!1));this.className=e,this.left=Math.round(r),this.top=Math.round(n),this.height=Math.round(s),this.useTransform=i}draw(){let e=createDiv(this.className);return this.adjust(e),e}update(e,r){var n;return r.className!=this.className||r.useTransform!=this.useTransform?!1:(this.requestAdjust=(n=r.requestAdjust)!=null?n:this.requestAdjust,this.requestAdjust(this.adjust,e),!0)}eq(e){return this.left==e.left&&this.top==e.top&&this.height==e.height&&this.className==e.className&&this.useTransform==e.useTransform}static forRange(e,r,n,s){let i=e.coordsAtPos(n.head,n.assoc||1);if(!i)return null;let o=E(e);return new t(r,i.left-o.left,i.top-o.top,i.bottom-i.top,s)}static forTableCellRange(e,r,n,s,i){let o=r.coordsAtPos(s.head,s.assoc||1);if(!o)return null;let l=E(e);return new t(n,o.left-l.left,o.top-l.top,o.bottom-o.top,i)}};var Y=function(t,e){var s;if(!t.docChanged&&!t.selectionSet&&t.transactions.some(i=>!!i.annotation(y)))return!1;let r=M(t.state);if(r===t.view)return!1;let n=!t.view.hasFocus&&((s=r==null?void 0:r.hasFocus)!=null?s:!1);return e.toggleClass("cm-overTableCell",n),(t.docChanged||t.selectionSet)&&(t.view.hasFocus||n)?(e.removeClass("cm-blinkLayer"),$(e),!0):!1},B=t=>function(e){let{state:r}=e,n,s=[];if(e.hasFocus||(n=M(r)),n&&({state:r}=n),e===n)return s;for(let i of r.selection.ranges){let o=i==r.selection.main,l="cm-cursor "+(o?"cm-cursor-primary":"cm-cursor-secondary"),c=n?u.forTableCellRange(e,n,l,i,t.useTransform):u.forRange(e,l,i,t.useTransform);c&&s.push(c)}return s},$=(0,f.debounce)(t=>{t.addClass("cm-blinkLayer")},350,!0);function M(t){let e=t.field(f.editorInfoField).editor,{activeCM:r}=e!=null?e:{};if(e!=null&&e.inTableCell)return r}function V(t,e){return C(t.layer,{update:()=>Y,markers:()=>B(e)})}var m=require("obsidian");var d=class extends m.PluginSettingTab{constructor(r,n){super(r,n);a(this,"plugin");this.plugin=n}display(){new m.Setting(this.containerEl).setName("Slightly more smoothly").setDesc("If turned on, cursor moves slightly more smoothly, especially when the user moves it continously. There is a downside, the cursor appears blurry.").addToggle(r=>r.setValue(this.plugin.settings.useTransform).onChange(n=>{this.plugin.settings.useTransform=n,this.plugin.saveSettings()}))}hide(){this.containerEl.empty(),super.hide()}};var L=require("@codemirror/view");function z(t){return"above"in t&&typeof t.above=="boolean"&&(!("class"in t)||typeof t.class=="string")&&(!("updateOnDocViewUpdate"in t)||typeof t.updateOnDocViewUpdate=="boolean")&&"update"in t&&typeof t.update=="function"&&"markers"in t&&typeof t.markers=="function"&&(!("mount"in t)||typeof t.mount=="function")&&(!("destroy"in t)||typeof t.destroy=="function")}function G(t){return"read"in t&&typeof t.read=="function"&&(!("write"in t)||typeof t.write=="function")}function W(t){let e=t.value;return!!e&&"view"in e&&e.view instanceof L.EditorView&&"layer"in e&&!!e.layer&&z(e.layer)&&"measureReq"in e&&!!e.measureReq&&G(e.measureReq)&&"drawn"in e&&e.drawn instanceof Array&&"dom"in e&&e.dom instanceof HTMLElement&&"scaleX"in e&&typeof e.scaleX=="number"&&"scaleY"in e&&typeof e.scaleY=="number"&&"setOrder"in e&&typeof e.setOrder=="function"&&"measure"in e&&typeof e.measure=="function"&&"scale"in e&&typeof e.scale=="function"&&"draw"in e&&typeof e.draw=="function"&&e.layer.class=="cm-cursorLayer"}function k(t){return t.plugins.find(r=>!!r.value&&W(r))}var S={useTransform:!0};function _(t,e){t.workspace.getLeavesOfType("markdown").forEach(r=>{r.view instanceof g.MarkdownView&&e(r.view)})}var h=class extends g.Plugin{constructor(){super(...arguments);a(this,"settings");a(this,"alreadyPatched");a(this,"tryPatchRef");a(this,"cursorPlugin")}async onload(){var n;await this.loadSettings(),this.alreadyPatched=!1,this.addSettingTab(new d(this.app,this)),this.registerEditorExtension(T);let r=(n=this.app.workspace.activeEditor)==null?void 0:n.editor;r?this.tryPatch(r):this.tryPatchRef=this.app.workspace.on("editor-selection-change",this.tryPatch.bind(this)),this.app.workspace.trigger("parse-style-settings"),console.log("Load Animated Cursor plugin")}async loadSettings(){this.settings=Object.assign({},S,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}onunload(){this.cancelPatchAttempt(),_(this.app,r=>{var s;if(!((s=this.cursorPlugin)!=null&&s.spec))return;let n=r.editor.cm.plugin(this.cursorPlugin.spec);n==null||n.dom.removeClass("cm-blinkLayer")}),console.log("Unload Animated Cursor plugin")}tryPatch(r){if(this.alreadyPatched){this.cancelPatchAttempt();return}let n=r.cm,s=k(n);s!=null&&s.value&&(this.register(V(s.value,this.settings)),this.alreadyPatched=!0,this.cursorPlugin=s,this.cancelPatchAttempt())}cancelPatchAttempt(){this.tryPatchRef&&(this.app.workspace.offref(this.tryPatchRef),delete this.tryPatchRef)}};

/* nosourcemap */